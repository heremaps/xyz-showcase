/*! For license information please see harp.js.LICENSE.txt */
var harp;harp=(()=>{var e={3187:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(4482),t),n(i(8937),t),n(i(7828),t),n(i(8212),t),n(i(172),t),n(i(6792),t),n(i(7487),t),n(i(2904),t),n(i(7299),t),n(i(2525),t),n(i(5253),t),n(i(7954),t),n(i(1460),t),n(i(84),t),n(i(7187),t),n(i(6665),t),n(i(8648),t),n(i(8783),t)},4456:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3139:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(2931),t),n(i(1754),t),n(i(7466),t),n(i(7073),t),n(i(6233),t),n(i(2553),t),n(i(2779),t),n(i(6373),t),n(i(9881),t),n(i(120),t),n(i(7746),t),n(i(8816),t),n(i(1404),t),n(i(115),t),n(i(8457),t),n(i(8053),t),n(i(4955),t),n(i(4276),t),n(i(730),t),n(i(5707),t),n(i(6368),t),n(i(20),t),n(i(3465),t),n(i(7511),t),n(i(1914),t),n(i(7821),t),n(i(1555),t),n(i(1498),t),n(i(8836),t),n(i(5644),t),n(i(4222),t),n(i(8909),t),n(i(2076),t),n(i(6256),t),n(i(463),t),n(i(8703),t)},249:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(6155),t),n(i(8655),t),n(i(1314),t),n(i(1274),t)},3844:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(7197),t)},2972:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(6422),t),n(i(2476),t),n(i(7476),t)},2530:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(4502),t),n(i(1761),t),n(i(2859),t),n(i(3076),t),n(i(3547),t),n(i(7365),t),n(i(6906),t),n(i(2712),t),n(i(4088),t),n(i(6636),t),n(i(6450),t),n(i(8663),t),n(i(1115),t),n(i(6101),t),n(i(5532),t),n(i(7571),t),n(i(4450),t),n(i(2084),t),n(i(1233),t),n(i(5882),t),n(i(4091),t),n(i(1683),t),n(i(1679),t),n(i(7805),t),n(i(3714),t),n(i(4894),t),n(i(3978),t),n(i(5667),t),n(i(771),t),n(i(5259),t),n(i(8309),t),n(i(6552),t),n(i(5295),t),n(i(5237),t),n(i(5005),t),n(i(3171),t),n(i(6682),t),n(i(3925),t),n(i(6569),t),n(i(3119),t),n(i(2315),t),n(i(4840),t),n(i(7180),t),n(i(8730),t),n(i(8033),t),n(i(4756),t),n(i(1931),t),n(i(2235),t)},2519:function(e){e.exports=function(){"use strict";function e(e,r,n,s,o){!function e(i,r,n,s,o){for(;s>n;){if(s-n>600){var a=s-n+1,l=r-n+1,c=Math.log(a),h=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*h*(a-h)/a)*(l-a/2<0?-1:1);e(i,r,Math.max(n,Math.floor(r-l*h/a+d)),Math.min(s,Math.floor(r+(a-l)*h/a+d)),o)}var u=i[r],m=n,p=s;for(t(i,n,r),o(i[s],u)>0&&t(i,n,s);m<p;){for(t(i,m,p),m++,p--;o(i[m],u)<0;)m++;for(;o(i[p],u)>0;)p--}0===o(i[n],u)?t(i,n,p):t(i,++p,s),p<=r&&(n=p+1),r<=p&&(s=p-1)}}(e,r,n||0,s||e.length-1,o||i)}function t(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function i(e,t){return e<t?-1:e>t?1:0}var r=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(e,t,i){if(!i)return t.indexOf(e);for(var r=0;r<t.length;r++)if(i(e,t[r]))return r;return-1}function s(e,t){o(e,0,e.children.length,t,e)}function o(e,t,i,r,n){n||(n=p(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var s=t;s<i;s++){var o=e.children[s];a(n,e.leaf?r(o):o)}return n}function a(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function u(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function m(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function p(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function f(t,i,r,n,s){for(var o=[i,r];o.length;)if(!((r=o.pop())-(i=o.pop())<=n)){var a=i+Math.ceil((r-i)/n/2)*n;e(t,a,i,r,s),o.push(i,a,a,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(e){var t=this.data,i=[];if(!m(e,t))return i;for(var r=this.toBBox,n=[];t;){for(var s=0;s<t.children.length;s++){var o=t.children[s],a=t.leaf?r(o):o;m(e,a)&&(t.leaf?i.push(o):u(e,a)?this._all(o,i):n.push(o))}t=n.pop()}return i},r.prototype.collides=function(e){var t=this.data;if(!m(e,t))return!1;for(var i=[];t;){for(var r=0;r<t.children.length;r++){var n=t.children[r],s=t.leaf?this.toBBox(n):n;if(m(e,s)){if(t.leaf||u(e,s))return!0;i.push(n)}}t=i.pop()}return!1},r.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},r.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(e,t){if(!e)return this;for(var i,r,s,o=this.data,a=this.toBBox(e),l=[],c=[];o||l.length;){if(o||(o=l.pop(),r=l[l.length-1],i=c.pop(),s=!0),o.leaf){var h=n(e,o.children,t);if(-1!==h)return o.children.splice(h,1),l.push(o),this._condense(l),this}s||o.leaf||!u(o,a)?r?(i++,o=r.children[i],s=!1):o=null:(l.push(o),c.push(i),i=0,r=o,o=o.children[0])}return this},r.prototype.toBBox=function(e){return e},r.prototype.compareMinX=function(e,t){return e.minX-t.minX},r.prototype.compareMinY=function(e,t){return e.minY-t.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(e){return this.data=e,this},r.prototype._all=function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},r.prototype._build=function(e,t,i,r){var n,o=i-t+1,a=this._maxEntries;if(o<=a)return s(n=p(e.slice(t,i+1)),this.toBBox),n;r||(r=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,r-1))),(n=p([])).leaf=!1,n.height=r;var l=Math.ceil(o/a),c=l*Math.ceil(Math.sqrt(a));f(e,t,i,c,this.compareMinX);for(var h=t;h<=i;h+=c){var d=Math.min(h+c-1,i);f(e,h,d,l,this.compareMinY);for(var u=h;u<=d;u+=l){var m=Math.min(u+l-1,d);n.children.push(this._build(e,u,m,r-1))}}return s(n,this.toBBox),n},r.prototype._chooseSubtree=function(e,t,i,r){for(;r.push(t),!t.leaf&&r.length-1!==i;){for(var n=1/0,s=1/0,o=void 0,a=0;a<t.children.length;a++){var l=t.children[a],c=h(l),d=(u=e,m=l,(Math.max(m.maxX,u.maxX)-Math.min(m.minX,u.minX))*(Math.max(m.maxY,u.maxY)-Math.min(m.minY,u.minY))-c);d<s?(s=d,n=c<n?c:n,o=l):d===s&&c<n&&(n=c,o=l)}t=o||t.children[0]}var u,m;return t},r.prototype._insert=function(e,t,i){var r=i?e:this.toBBox(e),n=[],s=this._chooseSubtree(r,this.data,t,n);for(s.children.push(e),a(s,r);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(r,n,t)},r.prototype._split=function(e,t){var i=e[t],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var o=this._chooseSplitIndex(i,n,r),a=p(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,s(i,this.toBBox),s(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)},r.prototype._splitRoot=function(e,t){this.data=p([e,t]),this.data.height=e.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(e,t,i){for(var r,n,s,a,l,c,d,u=1/0,m=1/0,p=t;p<=i-t;p++){var f=o(e,0,p,this.toBBox),g=o(e,p,i,this.toBBox),v=(n=f,s=g,a=Math.max(n.minX,s.minX),l=Math.max(n.minY,s.minY),c=Math.min(n.maxX,s.maxX),d=Math.min(n.maxY,s.maxY),Math.max(0,c-a)*Math.max(0,d-l)),_=h(f)+h(g);v<u?(u=v,r=p,m=_<m?_:m):v===u&&_<m&&(m=_,r=p)}return r||i-t},r.prototype._chooseSplitAxis=function(e,t,i){var r=e.leaf?this.compareMinX:l,n=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,n)&&e.children.sort(r)},r.prototype._allDistMargin=function(e,t,i,r){e.children.sort(r);for(var n=this.toBBox,s=o(e,0,t,n),l=o(e,i-t,i,n),c=d(s)+d(l),h=t;h<i-t;h++){var u=e.children[h];a(s,e.leaf?n(u):u),c+=d(s)}for(var m=i-t-1;m>=t;m--){var p=e.children[m];a(l,e.leaf?n(p):p),c+=d(l)}return c},r.prototype._adjustParentBBoxes=function(e,t,i){for(var r=i;r>=0;r--)a(t[r],e)},r.prototype._condense=function(e){for(var t=e.length-1,i=void 0;t>=0;t--)0===e[t].children.length?t>0?(i=e[t-1].children).splice(i.indexOf(e[t]),1):this.clear():s(e[t],this.toBBox)},r}()},284:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(963),t),n(i(5083),t),n(i(3255),t),n(i(7833),t),n(i(5656),t),n(i(5172),t),n(i(884),t),n(i(2343),t),n(i(5930),t),n(i(8136),t),n(i(5722),t),n(i(8682),t),n(i(3993),t),n(i(5421),t),n(i(1420),t),n(i(7355),t),n(i(1703),t),n(i(9930),t)},4100:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonDataProvider=t.AuthenticationMethod=t.APIFormat=void 0;var s=i(4742);Object.defineProperty(t,"APIFormat",{enumerable:!0,get:function(){return s.APIFormat}}),Object.defineProperty(t,"AuthenticationMethod",{enumerable:!0,get:function(){return s.AuthenticationMethod}}),Object.defineProperty(t,"GeoJsonDataProvider",{enumerable:!0,get:function(){return s.GeoJsonDataProvider}}),n(i(8193),t)},5084:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(2272),t),n(i(4453),t),n(i(4836),t),n(i(5813),t),n(i(2577),t),n(i(4673),t),n(i(9678),t),n(i(9668),t),n(i(7984),t)},6919:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(1341),t)},2183:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(9826),t),n(i(1721),t)},4742:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(1047),t),n(i(6555),t),n(i(1173),t),n(i(4992),t),n(i(9890),t),n(i(6007),t)},2058:(e,t)=>{var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(e){return(e=Math.round(e))<0?0:e>255?255:e}function n(e){return e<0?0:e>1?1:e}function s(e){return"%"===e[e.length-1]?r(parseFloat(e)/100*255):r(parseInt(e))}function o(e){return"%"===e[e.length-1]?n(parseFloat(e)/100):n(parseFloat(e))}function a(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{t.parseCSSColor=function(e){var t,n=e.replace(/ /g,"").toLowerCase();if(n in i)return i[n].slice();if("#"===n[0])return 4===n.length?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===n.length&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=n.indexOf("("),c=n.indexOf(")");if(-1!==l&&c+1===n.length){var h=n.substr(0,l),d=n.substr(l+1,c-(l+1)).split(","),u=1;switch(h){case"rgba":if(4!==d.length)return null;u=o(d.pop());case"rgb":return 3!==d.length?null:[s(d[0]),s(d[1]),s(d[2]),u];case"hsla":if(4!==d.length)return null;u=o(d.pop());case"hsl":if(3!==d.length)return null;var m=(parseFloat(d[0])%360+360)%360/360,p=o(d[1]),f=o(d[2]),g=f<=.5?f*(p+1):f+p-f*p,v=2*f-g;return[r(255*a(v,g,m+1/3)),r(255*a(v,g,m)),r(255*a(v,g,m-1/3)),u];default:return null}}return null}}catch(e){}},5263:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(5257),t),n(i(1470),t),n(i(9416),t),n(i(8937),t),n(i(1549),t),n(i(6665),t)},4482:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorUtils=void 0;const r=i(2183),n=i(4428),s=i(5795),o=255,a=new n.Color;var l;(l=t.ColorUtils||(t.ColorUtils={})).getHexFromRgba=function(e,t,i,n){return r.assert(n>=0&&n<=1),o-Math.floor(n*o)<<24^e*o<<16^t*o<<8^i*o<<0},l.getHexFromRgb=function(e,t,i){return r.assert(e>=0&&e<=1),r.assert(t>=0&&t<=1),r.assert(i>=0&&i<=1),e*o<<16^t*o<<8^i*o<<0},l.getHexFromHsl=function(e,t,i){return r.assert(e>=0&&e<=1),r.assert(t>=0&&t<=1),r.assert(i>=0&&i<=1),a.setHSL(e,t,i).getHex()},l.getRgbaFromHex=function(e,t=new s.RGBA){return r.assert(0==(0&e),"Wrong hex format"),t.r=(e>>16&o)/o,t.g=(e>>8&o)/o,t.b=(e>>0&o)/o,t.a=(o-(e>>24&o))/o,t},l.hasAlphaInHex=function(e){return r.assert(0==(0&e),"Wrong hex format"),e>>24!=0},l.getAlphaFromHex=function(e){return r.assert(0==(0&e),"Wrong hex format"),(o-(e>>24)&o)/o},l.removeAlphaFromHex=function(e){return r.assert(0==(0&e),"Wrong hex format"),16777215&e}},84:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scaleHeight=t.getFeatureText=t.getFeatureName=t.getFeatureId=t.getProjectionName=t.getProjection=t.GeometryType=t.getArrayConstructor=void 0;const r=i(3139),n=i(8937),s=i(3024),o=i(7828);function a(e,t,i,r,n){var s;let o;if(void 0===t&&(t="name"),i){const i=e.lookup(`${t}:short`);if("string"==typeof i&&i.length>0)return i}if(r){const t=e.lookup("iso_code");if("string"==typeof t&&t.length>0)return t}if(void 0!==n)for(const i of n)if(o=null!==(s=e.lookup(`${t}:${i}`))&&void 0!==s?s:e.lookup(`${t}_${i}`),"string"==typeof o&&o.length>0)return o;if(o=e.lookup(t),"string"==typeof o)return o}var l;t.getArrayConstructor=function(e){switch(e){case"float":return Float32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array}},(l=t.GeometryType||(t.GeometryType={}))[l.Unspecified=0]="Unspecified",l[l.Point=1]="Point",l[l.Line=2]="Line",l[l.SolidLine=3]="SolidLine",l[l.Text=4]="Text",l[l.TextPath=5]="TextPath",l[l.ExtrudedLine=6]="ExtrudedLine",l[l.Polygon=7]="Polygon",l[l.ExtrudedPolygon=8]="ExtrudedPolygon",l[l.Object3D=9]="Object3D",l[l.Other=1e3]="Other",t.getProjection=function(e){switch(e){case"mercator":return r.mercatorProjection;case"webMercator":return r.webMercatorProjection;case"sphere":return r.sphereProjection;case"normalizedEquirectangular":return r.normalizedEquirectangularProjection;case"equirectangular":return r.equirectangularProjection;default:throw new Error(`Unknown projection ${e}`)}},t.getProjectionName=function(e){if(e===r.mercatorProjection)return"mercator";if(e===r.webMercatorProjection)return"webMercator";if(e===r.sphereProjection)return"sphere";if(e===r.normalizedEquirectangularProjection)return"normalizedEquirectangular";if(e===r.equirectangularProjection)return"equirectangular";throw new Error("Unknown projection")},t.getFeatureId=function(e){if(void 0===e)return 0;if("string"==typeof e||"number"==typeof e)return e;if(e.hasOwnProperty("$id")){const t=e.$id;if("string"==typeof t||"number"==typeof t)return t}return 0},t.getFeatureName=a,t.getFeatureText=function(e,t,i){let r,l;const c=e instanceof n.Env?e:e.env;let h="name";if(o.isTextTechnique(t)||o.isPoiTechnique(t)||o.isLineMarkerTechnique(t)){if(void 0!==t.text)return s.evaluateTechniqueAttr(e,t.text);if(void 0!==t.label&&(h=s.evaluateTechniqueAttr(e,t.label),"string"!=typeof h))return;r=t.useAbbreviation,l=t.useIsoCode}return a(c,h,r,l,i)},t.scaleHeight=function(e,t,i){return!s.evaluateTechniqueAttr(e,t.constantHeight,i<12)}},9415:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapEnv=t.Env=void 0;class i{static isEnv(e){return e instanceof i}lookup(e){}unmap(){return{}}}t.Env=i,t.MapEnv=class extends i{constructor(e,t){super(),this.entries=e,this.parent=t}lookup(e){if(this.entries.hasOwnProperty(e)){const t=this.entries[e];if(void 0!==t)return t}return this.parent?this.parent.lookup(e):void 0}unmap(){const e=this.parent?this.parent.unmap():{};for(const t in this.entries)this.entries.hasOwnProperty(t)&&(e[t]=this.entries[t]);return e}}},8937:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.InterpolateExpr=t.StepExpr=t.CaseExpr=t.MatchExpr=t.CallExpr=t.HasAttributeExpr=t.ObjectLiteralExpr=t.StringLiteralExpr=t.NumberLiteralExpr=t.BooleanLiteralExpr=t.NullLiteralExpr=t.LiteralExpr=t.VarExpr=t.Expr=t.ExprScope=t.isJsonExpr=t.ExprDependencies=void 0;const s=i(4428),o=i(2344),a=i(5318),l=i(4973),c=i(2904),h=i(5997),d=i(5795);n(i(9415),t);const u=new o.ExprEvaluator,m=new a.ExprInstantiator;class p{constructor(){this.properties=new Set}}t.ExprDependencies=p;class f{static of(e){const t=new p;return e.accept(this.instance,t),t}visitNullLiteralExpr(e,t){}visitBooleanLiteralExpr(e,t){}visitNumberLiteralExpr(e,t){}visitStringLiteralExpr(e,t){}visitObjectLiteralExpr(e,t){}visitVarExpr(e,t){t.properties.add(e.name)}visitHasAttributeExpr(e,t){t.properties.add(e.name)}visitCallExpr(e,t){switch(e.args.forEach((e=>e.accept(this,t))),e.op){case"dynamic-properties":t.volatile=!0;break;case"feature-state":t.featureState=!0,t.properties.add("$state"),t.properties.add("$id");break;case"id":t.properties.add("$id");break;case"zoom":case"world-ppi-scale":case"world-discrete-ppi-scale":t.properties.add("$zoom");break;case"geometry-type":t.properties.add("$geometryType")}}visitMatchExpr(e,t){e.value.accept(this,t),e.branches.forEach((([e,i])=>i.accept(this,t))),e.fallback.accept(this,t)}visitCaseExpr(e,t){e.branches.forEach((([e,i])=>{e.accept(this,t),i.accept(this,t)})),e.fallback.accept(this,t)}visitStepExpr(e,t){e.input.accept(this,t),e.defaultValue.accept(this,t),e.stops.forEach((([e,i])=>i.accept(this,t)))}visitInterpolateExpr(e,t){e.input.accept(this,t),e.stops.forEach((([e,i])=>i.accept(this,t)))}}function g(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]}var v;f.instance=new f,t.isJsonExpr=g,function(e){e[e.Value=0]="Value",e[e.Condition=1]="Condition",e[e.Dynamic=2]="Dynamic"}(v=t.ExprScope||(t.ExprScope={}));class _{static isExpr(e){return e instanceof _}static parse(e){return new l.ExprParser(e).parse()}static fromJSON(e,t,i){return O(e,void 0!==t?{definitions:t,lockedNames:new Set,cache:null!=i?i:new Map}:void 0)}evaluate(e,t=v.Value,i){return this.accept(u,new o.ExprEvaluatorContext(u,e,t,i))}instantiate(e){return this.accept(m,e)}dependencies(){return this.m_dependencies||(this.m_dependencies=f.of(this)),this.m_dependencies}intern(e){return e.add(this)}toJSON(){return(new D).serialize(this)}isDynamic(){return void 0===this.m_isDynamic&&(this.m_isDynamic=this.exprIsDynamic()),this.m_isDynamic}}t.Expr=_;class y extends _{constructor(e){super(),this.name=e}accept(e,t){return e.visitVarExpr(this,t)}exprIsDynamic(){return!1}}t.VarExpr=y;class x extends _{static fromValue(e){switch(typeof e){case"boolean":return new T(e);case"number":return new w(e);case"string":return new S(e);case"object":return null===e?b.instance:new M(e);default:throw new Error(`failed to create a literal from '${e}'`)}}exprIsDynamic(){return!1}}t.LiteralExpr=x;class b extends x{constructor(){super(),this.value=null}accept(e,t){return e.visitNullLiteralExpr(this,t)}exprIsDynamic(){return!1}}t.NullLiteralExpr=b,b.instance=new b;class T extends x{constructor(e){super(),this.value=e}accept(e,t){return e.visitBooleanLiteralExpr(this,t)}}t.BooleanLiteralExpr=T;class w extends x{constructor(e){super(),this.value=e}accept(e,t){return e.visitNumberLiteralExpr(this,t)}}t.NumberLiteralExpr=w;class S extends x{constructor(e){super(),this.value=e}get promotedValue(){var e,t,i;return void 0===this.m_promotedValue&&(this.m_promotedValue=null!==(t=null!==(e=d.RGBA.parse(this.value))&&void 0!==e?e:h.Pixels.parse(this.value))&&void 0!==t?t:null),null!==(i=this.m_promotedValue)&&void 0!==i?i:void 0}accept(e,t){return e.visitStringLiteralExpr(this,t)}}t.StringLiteralExpr=S;class M extends x{constructor(e){super(),this.value=e}get isArrayLiteral(){return Array.isArray(this.value)}accept(e,t){return e.visitObjectLiteralExpr(this,t)}}t.ObjectLiteralExpr=M;class E extends _{constructor(e){super(),this.name=e}accept(e,t){return e.visitHasAttributeExpr(this,t)}exprIsDynamic(){return!1}}t.HasAttributeExpr=E;class P extends _{constructor(e,t){super(),this.op=e,this.args=t}get children(){return this.args}accept(e,t){return e.visitCallExpr(this,t)}exprIsDynamic(){var e;const t=null!==(e=this.descriptor)&&void 0!==e?e:o.ExprEvaluator.getOperator(this.op);return!!(t&&t.isDynamicOperator&&t.isDynamicOperator(this))||this.args.some((e=>e.isDynamic()))}}t.CallExpr=P;class C extends _{constructor(e,t,i){super(),this.value=e,this.branches=t,this.fallback=i}static isValidMatchLabel(e){switch(typeof e){case"number":case"string":return!0;case"object":if(!Array.isArray(e)||0===e.length)return!1;const t=typeof e[0];return("number"===t||"string"===t)&&e.every((e=>typeof e===t));default:return!1}}accept(e,t){return e.visitMatchExpr(this,t)}exprIsDynamic(){return this.value.isDynamic()||this.branches.some((([e,t])=>t.isDynamic()))||this.fallback.isDynamic()}}t.MatchExpr=C;class A extends _{constructor(e,t){super(),this.branches=e,this.fallback=t}accept(e,t){return e.visitCaseExpr(this,t)}exprIsDynamic(){return this.branches.some((([e,t])=>e.isDynamic()||t.isDynamic()))||this.fallback.isDynamic()}}t.CaseExpr=A;class L extends _{constructor(e,t,i){super(),this.input=e,this.defaultValue=t,this.stops=i}accept(e,t){return e.visitStepExpr(this,t)}exprIsDynamic(){return this.input.isDynamic()||this.defaultValue.isDynamic()||this.stops.some((([e,t])=>t.isDynamic()))}}t.StepExpr=L;class R extends _{constructor(e,t,i){super(),this.mode=e,this.input=t,this.stops=i}accept(e,t){return e.visitInterpolateExpr(this,t)}exprIsDynamic(){return this.input.isDynamic()||this.stops.some((([e,t])=>t.isDynamic()))}}t.InterpolateExpr=R;class D{serialize(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value instanceof s.Vector2?["make-vector",e.value.x,e.value.y]:e.value instanceof s.Vector3?["make-vector",e.value.x,e.value.y,e.value.z]:e.value instanceof s.Vector4?["make-vector",e.value.x,e.value.y,e.value.z,e.value.w]:["literal",e.value]}visitVarExpr(e,t){return["get",e.name]}visitHasAttributeExpr(e,t){return["has",e.name]}visitCallExpr(e,t){return[e.op,...e.args.map((e=>this.serialize(e)))]}visitMatchExpr(e,t){const i=[];for(const[t,r]of e.branches)i.push(t,this.serialize(r));return["match",this.serialize(e.value),...i,this.serialize(e.fallback)]}visitCaseExpr(e,t){const i=[];for(const[t,r]of e.branches)i.push(this.serialize(t),this.serialize(r));return["case",...i,this.serialize(e.fallback)]}visitStepExpr(e,t){const i=["step"];return i.push(this.serialize(e.input)),i.push(this.serialize(e.defaultValue)),e.stops.forEach((([e,t])=>{i.push(e),i.push(this.serialize(t))})),i}visitInterpolateExpr(e,t){const i=["interpolate",e.mode];return i.push(this.serialize(e.input)),e.stops.forEach((([e,t])=>{i.push(e),i.push(this.serialize(t))})),i}}function O(e,t){if(Array.isArray(e))return F(e,t);if(null===e)return b.instance;if("boolean"==typeof e)return new T(e);if("number"==typeof e)return new w(e);if("string"==typeof e)return new S(e);throw new Error(`failed to create expression from: ${JSON.stringify(e)}`)}function F(e,t){const i=e[0];if("string"!=typeof i)throw new Error("expected a builtin function name");switch(i){case"!has":case"!in":return new P("!",[F([i.slice(1),...e.slice(1)])]);case"ref":return function(e,t){if("string"!=typeof e[1])throw new Error("expected the name of an attribute");if(void 0===t)throw new Error("ref used with no definitions");const i=e[1];if(t.lockedNames.has(i))throw new Error(`circular referene to '${i}'`);if(!(i in t.definitions))throw new Error(`definition '${i}' not found`);const r=t.cache.get(i);if(void 0!==r)return r;let n,s=t.definitions[i];if(c.isInterpolatedPropertyDefinition(s.value))return _.fromJSON(c.interpolatedPropertyDefinitionToJsonExpr(s.value));if(!g(s.value))return _.fromJSON(s.value);if(s=s.value,!g(s))throw new Error(`unsupported definition ${i}`);t.lockedNames.add(i);try{n=O(s,t)}finally{t.lockedNames.delete(i)}return t.cache.set(i,n),n}(e,t);case"get":return function(e,t){if(void 0!==e[2])return I("get",e,t);const i=e[1];if("string"!=typeof i)throw new Error("expected the name of an attribute");return new y(i)}(e,t);case"has":return function(e,t){if(void 0!==e[2])return I("has",e,t);const i=e[1];if("string"!=typeof i)throw new Error("expected the name of an attribute");return new E(i)}(e,t);case"literal":return function(e){const t=e[1];if(null===t||"object"!=typeof t)throw new Error("expected an object or array literal");return new M(t)}(e);case"match":return function(e,t){if(e.length<4)throw new Error("not enough arguments");if(!(e.length%2))throw new Error("fallback is missing in 'match' expression");const i=O(e[1],t),r=[];for(let i=2;i<e.length-1;i+=2){const n=e[i];if(!C.isValidMatchLabel(n))throw new Error(`'${JSON.stringify(n)}' is not a valid label for 'match'`);const s=O(e[i+1],t);r.push([n,s])}const n=O(e[e.length-1],t);return new C(i,r,n)}(e,t);case"case":return function(e,t){if(e.length<3)throw new Error("not enough arguments");if(e.length%2)throw new Error("fallback is missing in 'case' expression");const i=[];for(let r=1;r<e.length-1;r+=2){const n=O(e[r],t),s=O(e[r+1],t);i.push([n,s])}const r=O(e[e.length-1],t);return new A(i,r)}(e,t);case"interpolate":return function(e,t){const i=e[1];if(!function(e){if(!Array.isArray(e))return!1;switch(e[0]){case"discrete":case"linear":case"cubic":case"exponential":return!0;default:return!1}}(i))throw new Error("expected an interpolation type");if("exponential"===i[0]&&"number"!=typeof i[1])throw new Error("expected the base of the exponential interpolation");const r=void 0!==e[2]?O(e[2],t):void 0;if(!_.isExpr(r))throw new Error("expected the input of the interpolation");if(3===e.length||!(e.length%2))throw new Error("invalid number of samples");const n=[];for(let i=3;i<e.length-1;i+=2){const r=e[i],s=O(e[i+1],t);n.push([r,s])}return new R(i,r,n)}(e,t);case"step":return function(e,t){if(e.length<2)throw new Error("expected the input of the 'step' operator");if(e.length<3||!(e.length%2))throw new Error("not enough arguments");const i=O(e[1],t),r=O(e[2],t),n=[];for(let i=3;i<e.length;i+=2){const r=e[i],s=O(e[i+1],t);n.push([r,s])}return new L(i,r,n)}(e,t);default:return I(i,e,t)}}function I(e,t,i){return new P(e,t.slice(1).map((e=>O(e,i))))}},2344:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprEvaluator=t.ExprEvaluatorContext=void 0;const r=i(4428),n=i(8937),s=i(6075),o=i(2099),a=i(8210),l=i(7922),c=i(7877),h=i(8146),d=i(1139),u=i(1701),m=i(4292),p=i(9156),f=i(9388),g=i(8992),v=i(2273),_=i(5997),y=i(5795),x=new Map;function b(e,t){var i,r,s;if(t instanceof n.StringLiteralExpr)return null!==(i=t.promotedValue)&&void 0!==i?i:t.value;const o=e.evaluate(t);return"string"==typeof o&&null!==(s=null!==(r=y.RGBA.parse(o))&&void 0!==r?r:_.Pixels.parse(o))&&void 0!==s?s:o}t.ExprEvaluatorContext=class{constructor(e,t,i,r){this.evaluator=e,this.env=t,this.scope=i,this.cache=r}evaluate(e){var t,i;if(void 0===e)throw new Error("Failed to evaluate expression");const r=null===(t=this.cache)||void 0===t?void 0:t.get(e);if(void 0!==r)return r;const n=e.accept(this.evaluator,this);return null===(i=this.cache)||void 0===i||i.set(e,n),n}wrapValue(e){return n.Expr.isExpr(e)?e:n.LiteralExpr.fromValue(e)}};class T{static defineOperator(e,t){x.set(e,t)}static defineOperators(e){Object.getOwnPropertyNames(e).forEach((t=>{this.defineOperator(t,e[t])}))}static getOperator(e){return x.get(e)}visitVarExpr(e,t){const i=t.env.lookup(e.name);return void 0!==i?i:null}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value}visitHasAttributeExpr(e,t){return void 0!==t.env.lookup(e.name)}visitMatchExpr(e,t){const i=t.evaluate(e.value);for(const[r,n]of e.branches){if(Array.isArray(r)&&r.includes(i))return t.evaluate(n);if(r===i)return t.evaluate(n)}return t.evaluate(e.fallback)}visitCaseExpr(e,t){if(t.scope===n.ExprScope.Value){const i=e.branches.findIndex((([e,t])=>e.isDynamic()));if(-1!==i){let r;for(let s=0;s<e.branches.length;++s){const[o,a]=e.branches[s],l=t.evaluate(o),c=t.evaluate(a);if(s<i&&Boolean(l))return c;if((n.Expr.isExpr(l)||Boolean(l))&&(void 0===r&&(r=[]),null==r||r.push([t.wrapValue(l),t.wrapValue(c)]),!n.Expr.isExpr(l)&&Boolean(l)))return new n.CaseExpr(r,n.LiteralExpr.fromValue(null))}const s=t.evaluate(e.fallback);return void 0===r?s:new n.CaseExpr(r,t.wrapValue(s))}}for(const[i,r]of e.branches)if(t.evaluate(i))return t.evaluate(r);return t.evaluate(e.fallback)}visitCallExpr(e,t){var i;const r=null!==(i=e.descriptor)&&void 0!==i?i:x.get(e.op);if(r){let i;if(e.descriptor=r,t.scope===n.ExprScope.Value&&e.isDynamic()){if(e.descriptor.partialEvaluate)return e.descriptor.partialEvaluate(t,e);const r=e.args.map((e=>t.wrapValue(t.evaluate(e))));if(r.every(((t,i)=>t===e.args[i])))return e;i=new n.CallExpr(e.op,r)}else i=r.call(t,e);return i}throw new Error(`undefined operator '${e.op}'`)}visitStepExpr(e,t){if(t.scope===n.ExprScope.Value){const i=t.evaluate(e.input),r=t.evaluate(e.defaultValue);return new n.StepExpr(t.wrapValue(i),t.wrapValue(r),e.stops.map((([e,i])=>{const r=t.evaluate(i);return[e,t.wrapValue(r)]})))}{const i=t.evaluate(e.input);if("number"!=typeof i)throw new Error(`input '${i}' must be a number`);if(i<e.stops[0][0])return t.evaluate(e.defaultValue);let r=e.stops.findIndex((e=>e[0]>i));return-1===r&&(r=e.stops.length),t.evaluate(e.stops[r-1][1])}}visitInterpolateExpr(e,t){if(t.scope===n.ExprScope.Value){const i=t.evaluate(e.input);return new n.InterpolateExpr(e.mode,t.wrapValue(i),e.stops.map((([e,i])=>{const r=t.evaluate(i);return[e,t.wrapValue(r)]})))}{const i=t.evaluate(e.input);if("number"!=typeof i)throw new Error("input must be a number");if("cubic"===e.mode[0])return function(e,t,i){if(i<t.stops[0][0])return b(e,t.stops[0][1]);if(i>=t.stops[t.stops.length-1][0])return b(e,t.stops[t.stops.length-1][1]);const n=t.stops.findIndex((e=>e[0]>i)),s=Math.max(0,n-1),o=0===s?n:s-1,a=n<t.stops.length-1?n+1:n-1,l=t.stops[o][0],c=t.stops[s][0],h=t.stops[n][0],d=.5*(h-c),u=d/(c-l),m=d/(t.stops[a][0]-h),p=(i-c)/(h-c),f=p*p,g=f*p,v=-u*g+2*u*f-u*p,x=(1+u)*g+(-1.5-2*u)*f+(-.5+u)*p+1,T=(-1-m)*g+(1.5+m)*f+.5*p,w=m*g-m*f,S=b(e,t.stops[o][1]),M=b(e,t.stops[s][1]),E=b(e,t.stops[n][1]),P=b(e,t.stops[a][1]);if("number"==typeof S&&"number"==typeof M&&"number"==typeof E&&"number"==typeof P)return v*S+x*M+T*E+w*P;if(S instanceof y.RGBA&&M instanceof y.RGBA&&E instanceof y.RGBA&&P instanceof y.RGBA)return new y.RGBA(r.MathUtils.clamp(v*S.r+x*M.r+T*E.r+w*P.r,0,1),r.MathUtils.clamp(v*S.g+x*M.g+T*E.g+w*P.g,0,1),r.MathUtils.clamp(v*S.b+x*M.b+T*E.b+w*P.b,0,1),r.MathUtils.clamp(v*S.a+x*M.a+T*E.a+w*P.a,0,1));if(S instanceof _.Pixels&&M instanceof _.Pixels&&E instanceof _.Pixels&&P instanceof _.Pixels)return new _.Pixels(v*S.value+x*M.value+T*E.value+w*P.value);if(S instanceof r.Color&&M instanceof r.Color&&E instanceof r.Color&&P instanceof r.Color)return new r.Color(v*S.r+x*M.r+T*E.r+w*P.r,v*S.g+x*M.g+T*E.g+w*P.g,v*S.b+x*M.b+T*E.b+w*P.b);if(S instanceof r.Vector2&&M instanceof r.Vector2&&E instanceof r.Vector2&&P instanceof r.Vector2)return new r.Vector2(v*S.x+x*M.x+T*E.x+w*P.x,v*S.y+x*M.y+T*E.y+w*P.y);if(S instanceof r.Vector3&&M instanceof r.Vector3&&E instanceof r.Vector3&&P instanceof r.Vector3)return new r.Vector3(v*S.x+x*M.x+T*E.x+w*P.x,v*S.y+x*M.y+T*E.y+w*P.y,v*S.z+x*M.z+T*E.z+w*P.z);if(S instanceof r.Vector4&&M instanceof r.Vector4&&E instanceof r.Vector4&&P instanceof r.Vector4)return new r.Vector4(v*S.x+x*M.x+T*E.x+w*P.x,v*S.y+x*M.y+T*E.y+w*P.y,v*S.z+x*M.z+T*E.z+w*P.z,v*S.w+x*M.w+T*E.w+w*P.w);if(Array.isArray(S)&&Array.isArray(M)&&Array.isArray(E)&&Array.isArray(P)){const e=S.length,t=[];for(let i=0;i<e;++i)t[i]=v*S[i]+x*M[i]+T*E[i]+w*P[i];return t}throw new Error("failed to interpolate values")}(t,e,i);const n=e.stops.findIndex((e=>e[0]>i));if(-1===n)return t.evaluate(e.stops[e.stops.length-1][1]);if(0===n)return t.evaluate(e.stops[0][1]);const[s,o]=e.stops[n],[a,l]=e.stops[n-1],c=b(t,l);let h=0;switch(e.mode[0]){case"discrete":return c;case"linear":h=(i-a)/(s-a);break;case"exponential":{const t=e.mode[1];h=1===t?(i-a)/(s-a):(Math.pow(t,i-a)-1)/(Math.pow(t,s-a)-1);break}default:throw new Error(`interpolation mode ${JSON.stringify(e.mode)} is not supported`)}const d=b(t,o);if("number"==typeof c&&"number"==typeof d)return r.MathUtils.lerp(c,d,h);if(c instanceof y.RGBA&&d instanceof y.RGBA)return c.clone().lerp(d,h);if(c instanceof _.Pixels&&d instanceof _.Pixels)return new _.Pixels(r.MathUtils.lerp(c.value,d.value,h));if(c instanceof r.Color&&d instanceof r.Color)return c.clone().lerp(d,h);if(c instanceof r.Vector2&&d instanceof r.Vector2)return c.clone().lerp(d,h);if(c instanceof r.Vector3&&d instanceof r.Vector3)return c.clone().lerp(d,h);if(c instanceof r.Vector4&&d instanceof r.Vector4)return c.clone().lerp(d,h);if(Array.isArray(c)&&Array.isArray(d)&&c.length===d.length)return c.map(((e,t)=>r.MathUtils.lerp(e,d[t],h)));throw new Error(`todo: mix(${JSON.stringify(c)}, ${JSON.stringify(d)}, ${h})`)}}}t.ExprEvaluator=T,T.defineOperators(o.CastOperators),T.defineOperators(l.ComparisonOperators),T.defineOperators(u.MathOperators),T.defineOperators(f.StringOperators),T.defineOperators(a.ColorOperators),T.defineOperators(g.TypeOperators),T.defineOperators(m.MiscOperators),T.defineOperators(h.FlowOperators),T.defineOperators(s.ArrayOperators),T.defineOperators(p.ObjectOperators),T.defineOperators(c.FeatureOperators),T.defineOperators(d.MapOperators),T.defineOperators(v.VectorOperators)},5318:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprInstantiator=void 0;const r=i(9415),n=i(8937),s=new r.Env;t.ExprInstantiator=class{visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const i=t.env.lookup(e.name);return n.LiteralExpr.fromValue(void 0!==i?i:null)}visitHasAttributeExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const i=void 0!==t.env.lookup(e.name);return n.LiteralExpr.fromValue(i)}visitCallExpr(e,t){const i=e.args.map((e=>e.accept(this,t)));return i.some(((t,i)=>t!==e.args[i]))?new n.CallExpr(e.op,i):e}visitMatchExpr(e,t){const i=e.value.accept(this,t);if(i instanceof n.LiteralExpr){const r=i.value;for(const[i,n]of e.branches){if(Array.isArray(i)&&i.includes(r))return n.accept(this,t);if(i===r)return n.accept(this,t)}return e.fallback.accept(this,t)}let r=e.value!==i;const s=e.branches.map((([e,i])=>{const n=i.accept(this,t);return n!==i&&(r=!0),[e,n]})),o=e.fallback.accept(this,t);return o!==e.fallback&&(r=!0),r?new n.MatchExpr(i,s,o):e}visitCaseExpr(e,t){const i=[];let r=!1;for(const[o,a]of e.branches){const e=o.accept(this,t),l=e.dependencies();if(o.isDynamic()||0!==l.properties.size)e!==o&&(r=!0),i.push([e,a]);else if(Boolean(e.evaluate(s,n.ExprScope.Condition)))return a.accept(this,t)}if(0===i.length)return e.fallback.accept(this,t);i.length!==e.branches.length&&(r=!0),i.forEach((e=>{const i=e[1].accept(this,t);i!==e[1]&&(r=!0),e[1]=i}));const o=e.fallback.accept(this,t);return o!==e.fallback&&(r=!0),r?new n.CaseExpr(i,o):e}visitStepExpr(e,t){const i=e.input.accept(this,t),r=e.defaultValue.accept(this,t),s=e.stops.map((([e,i])=>[e,i.accept(this,t)]));return new n.StepExpr(i,r,s)}visitInterpolateExpr(e,t){const i=e.input.accept(this,t),r=e.stops.map((([e,i])=>[e,i.accept(this,t)]));return new n.InterpolateExpr(e.mode,i,r)}}},4973:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprParser=void 0;const r=i(8937);var n,s;function o(e){switch(e){case n.Tab:case n.Lf:case n.Cr:case n.Space:return!0;default:return!1}}function a(e){return e>=n._0&&e<=n._9}function l(e){return e>=n.a&&e<=n.z||e>=n.A&&e<=n.Z}function c(e){return function(e){return l(e)||a(e)}(e)||e===n._||e===n.Dollar||e===n.Dot||e===n.LBracket||e===n.RBracket}function h(e){switch(e){case s.Eof:return"eof";case s.Error:return"error";case s.Identifier:return"identifier";case s.Number:return"number";case s.String:return"string";case s.Comma:return",";case s.LParen:return"(";case s.RParen:return")";case s.LBracket:return"[";case s.RBracket:return"]";case s.Exclaim:return"!";case s.TildeEqual:return"~=";case s.CaretEqual:return"^=";case s.DollarEqual:return"$=";case s.EqualEqual:return"==";case s.ExclaimEqual:return"!=";case s.Less:return"<";case s.Greater:return">";case s.LessEqual:return"<=";case s.GreaterEqual:return">=";case s.BarBar:return"||";case s.AmpAmp:return"&&";default:throw new Error(`invalid token ${e}`)}}!function(e){e[e.Tab=9]="Tab",e[e.Lf=10]="Lf",e[e.Cr=13]="Cr",e[e.Space=32]="Space",e[e.LParen=40]="LParen",e[e.RParen=41]="RParen",e[e.Comma=44]="Comma",e[e.Dot=46]="Dot",e[e.LBracket=91]="LBracket",e[e.Backslash=92]="Backslash",e[e.RBracket=93]="RBracket",e[e._0=48]="_0",e[e._9=57]="_9",e[e._=95]="_",e[e.A=64]="A",e[e.Z=90]="Z",e[e.a=97]="a",e[e.z=122]="z",e[e.DoubleQuote=34]="DoubleQuote",e[e.SingleQuote=39]="SingleQuote",e[e.Exclaim=33]="Exclaim",e[e.Equal=61]="Equal",e[e.Caret=94]="Caret",e[e.Tilde=126]="Tilde",e[e.Dollar=36]="Dollar",e[e.Less=60]="Less",e[e.Greater=62]="Greater",e[e.Bar=124]="Bar",e[e.Amp=38]="Amp"}(n||(n={})),function(e){e[e.Eof=0]="Eof",e[e.Error=1]="Error",e[e.Identifier=2]="Identifier",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Comma=5]="Comma",e[e.LParen=6]="LParen",e[e.RParen=7]="RParen",e[e.LBracket=8]="LBracket",e[e.RBracket=9]="RBracket",e[e.Exclaim=10]="Exclaim",e[e.TildeEqual=11]="TildeEqual",e[e.CaretEqual=12]="CaretEqual",e[e.DollarEqual=13]="DollarEqual",e[e.EqualEqual=14]="EqualEqual",e[e.ExclaimEqual=15]="ExclaimEqual",e[e.Less=16]="Less",e[e.Greater=17]="Greater",e[e.LessEqual=18]="LessEqual",e[e.GreaterEqual=19]="GreaterEqual",e[e.BarBar=20]="BarBar",e[e.AmpAmp=21]="AmpAmp"}(s||(s={}));class d{constructor(e){this.code=e,this.m_token=s.Error,this.m_index=0,this.m_char=n.Lf}token(){return this.m_token}text(){var e;return null!==(e=this.m_text)&&void 0!==e?e:""}next(){if(this.m_token=this.yylex(),this.m_token===s.Error)throw new Error(`unexpected character ${this.m_char}`);return this.m_token}yyinp(){var e;this.m_char=null!==(e=this.code.codePointAt(this.m_index++))&&void 0!==e?e:0}yylex(){for(this.m_text=void 0;o(this.m_char);)this.yyinp();if(0===this.m_char)return s.Eof;const e=this.m_char;switch(this.yyinp(),e){case n.LParen:return s.LParen;case n.RParen:return s.RParen;case n.LBracket:return s.LBracket;case n.RBracket:return s.RBracket;case n.Comma:return s.Comma;case n.SingleQuote:case n.DoubleQuote:{const t=this.m_index-1;for(;this.m_char&&this.m_char!==e;)this.yyinp();if(this.m_char!==e)throw new Error("Unfinished string literal");return this.yyinp(),this.m_text=this.code.substring(t,this.m_index-2),s.String}case n.Exclaim:return this.m_char===n.Equal?(this.yyinp(),s.ExclaimEqual):s.Exclaim;case n.Caret:return this.m_char===n.Equal?(this.yyinp(),s.CaretEqual):s.Error;case n.Tilde:return this.m_char===n.Equal?(this.yyinp(),s.TildeEqual):s.Error;case n.Equal:return this.m_char===n.Equal?(this.yyinp(),s.EqualEqual):s.Error;case n.Less:return this.m_char===n.Equal?(this.yyinp(),s.LessEqual):s.Less;case n.Greater:return this.m_char===n.Equal?(this.yyinp(),s.GreaterEqual):s.Greater;case n.Bar:return this.m_char===n.Bar?(this.yyinp(),s.BarBar):s.Error;case n.Amp:return this.m_char===n.Amp?(this.yyinp(),s.AmpAmp):s.Error;default:{const t=this.m_index-2;if(l(e)||e===n._||e===n.Dollar&&c(this.m_char)){for(;c(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),s.Identifier}if(a(e)){for(;a(this.m_char);)this.yyinp();if(this.m_char===n.Dot)for(this.yyinp();a(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),s.Number}if(e===n.Dollar)return this.m_char===n.Equal?(this.yyinp(),s.DollarEqual):s.Error}}return s.Error}}function u(e){switch(e){case s.TildeEqual:return"~=";case s.CaretEqual:return"^=";case s.DollarEqual:return"$=";case s.EqualEqual:return"==";case s.ExclaimEqual:return"!=";default:return}}function m(e){switch(e){case s.Less:return"<";case s.Greater:return">";case s.LessEqual:return"<=";case s.GreaterEqual:return">=";default:return}}t.ExprParser=class{constructor(e){this.lex=new d(e),this.lex.next()}parse(){return this.parseLogicalOr()}yyexpect(e){if(this.lex.token()!==e)throw new Error(`Syntax error: Expected token '${h(e)}' but found '${h(this.lex.token())}'`);this.lex.next()}parsePrimary(){switch(this.lex.token()){case s.Identifier:{const e=this.lex.text();switch(e){case"has":this.lex.next(),this.yyexpect(s.LParen);const t=this.lex.text();return this.yyexpect(s.Identifier),this.yyexpect(s.RParen),new r.HasAttributeExpr(t);case"length":this.lex.next(),this.yyexpect(s.LParen);const i=this.parseLogicalOr();return this.yyexpect(s.RParen),new r.CallExpr("length",[i]);default:const n=new r.VarExpr(e);return this.lex.next(),n}}case s.LParen:{this.lex.next();const e=this.parseLogicalOr();return this.yyexpect(s.RParen),e}default:return this.parseLiteral()}}parseLiteral(){switch(this.lex.token()){case s.Number:{const e=new r.NumberLiteralExpr(parseFloat(this.lex.text()));return this.lex.next(),e}case s.String:{const e=new r.StringLiteralExpr(this.lex.text());return this.lex.next(),e}default:throw new Error("Syntax error")}}parseUnary(){return this.lex.token()===s.Exclaim?(this.lex.next(),new r.CallExpr("!",[this.parseUnary()])):this.parsePrimary()}parseRelational(){let e=this.parseUnary();for(;;)if(this.lex.token()===s.Identifier&&"in"===this.lex.text()){this.lex.next(),this.yyexpect(s.LBracket);const t=[this.parseLiteral()];for(;this.lex.token()===s.Comma;)this.lex.next(),t.push(this.parseLiteral());this.yyexpect(s.RBracket),e=new r.CallExpr("in",[e,r.LiteralExpr.fromValue(t.map((({value:e})=>e)))])}else{const t=m(this.lex.token());if(void 0===t)break;this.lex.next();const i=this.parseUnary();e=new r.CallExpr(t,[e,i])}return e}parseEquality(){let e=this.parseRelational();for(;;){let t=u(this.lex.token());if(void 0===t)break;"~="===t&&(t="in"),this.lex.next();const i=this.parseRelational();e=new r.CallExpr(t,[e,i])}return e}parseLogicalAnd(){const e=this.parseEquality();if(this.lex.token()!==s.AmpAmp)return e;const t=[e];do{this.lex.next(),t.push(this.parseEquality())}while(this.lex.token()===s.AmpAmp);return new r.CallExpr("all",t)}parseLogicalOr(){const e=this.parseLogicalAnd();if(this.lex.token()!==s.BarBar)return e;const t=[e];do{this.lex.next(),t.push(this.parseLogicalAnd())}while(this.lex.token()===s.BarBar);return new r.CallExpr("any",t)}}},2475:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExprPool=void 0;const r=i(8937);t.ExprPool=class{constructor(){this.m_booleanLiterals=new Map,this.m_numberLiterals=new Map,this.m_stringLiterals=new Map,this.m_objectLiterals=new Map,this.m_arrayLiterals=[],this.m_varExprs=new Map,this.m_hasAttributeExprs=new Map,this.m_matchExprs=[],this.m_caseExprs=[],this.m_interpolateExprs=[],this.m_stepExprs=[],this.m_callExprs=new Map}add(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return r.NullLiteralExpr.instance}visitBooleanLiteralExpr(e,t){return this.m_booleanLiterals.get(e.value)||(this.m_booleanLiterals.set(e.value,e),e)}visitNumberLiteralExpr(e,t){return this.m_numberLiterals.get(e.value)||(this.m_numberLiterals.set(e.value,e),e)}visitStringLiteralExpr(e,t){return this.m_stringLiterals.get(e.value)||(this.m_stringLiterals.set(e.value,e),e)}visitObjectLiteralExpr(e,t){const i=this.m_objectLiterals.get(e.value);if(i)return i;if(Array.isArray(e.value)){const t=e.value,i=this.m_arrayLiterals.find((e=>{const i=e.value;return i.length===t.length&&t.every(((e,t)=>e===i[t]))}));if(void 0!==i)return i;this.m_arrayLiterals.push(e)}return this.m_objectLiterals.set(e.value,e),e}visitVarExpr(e,t){return this.m_varExprs.get(e.name)||(this.m_varExprs.set(e.name,e),e)}visitHasAttributeExpr(e,t){return this.m_hasAttributeExprs.get(e.name)||(this.m_hasAttributeExprs.set(e.name,e),e)}visitMatchExpr(e,t){const i=e.value.accept(this,t),n=e.branches.map((([e,i])=>[e,i.accept(this,t)])),s=e.fallback.accept(this,t);for(const e of this.m_matchExprs){if(e.value!==i)continue;if(e.fallback!==s)continue;if(e.branches.length!==n.length)continue;let t=!0;for(let i=0;i<n.length;i++)if(n[i][0]!==e.branches[i][0]||n[i][1]!==e.branches[i][1]){t=!1;break}if(t)return e}const o=new r.MatchExpr(i,n,s);return this.m_matchExprs.push(o),o}visitCaseExpr(e,t){const i=e.branches.map((([e,i])=>[e.accept(this,t),i.accept(this,t)])),n=e.fallback.accept(this,t);for(const e of this.m_caseExprs){if(e.fallback!==n)continue;if(e.branches.length!==i.length)continue;let t=!0;for(let r=0;r<i.length;r++)if(i[r][0]!==e.branches[r][0]||i[r][1]!==e.branches[r][1]){t=!1;break}if(t)return e}const s=new r.CaseExpr(i,n);return this.m_caseExprs.push(s),s}visitCallExpr(e,t){const i=e.args.map((e=>e.accept(this,t)));this.m_callExprs.has(e.op)||this.m_callExprs.set(e.op,[]);const n=this.m_callExprs.get(e.op);for(const e of n){if(e.args.length!==i.length)continue;let t=0;for(;t<e.args.length&&e.args[t]===i[t];++t);if(t===e.args.length)return e}const s=new r.CallExpr(e.op,i);return s.descriptor=e.descriptor,n.push(s),s}visitStepExpr(e,t){if(this.m_stepExprs.includes(e))return e;const i=e.input.accept(this,t),n=e.defaultValue.accept(this,t),s=e.stops.map((e=>{const i=e[0],r=e[1].accept(this,t);return r===e[1]?e:[i,r]}));for(const e of this.m_stepExprs)if(e.input===i&&e.defaultValue===n&&s.length===e.stops.length&&s.every((([t,i],r)=>t===e.stops[r][0]&&i===e.stops[r][1])))return e;const o=new r.StepExpr(i,n,s);return this.m_stepExprs.push(o),o}visitInterpolateExpr(e,t){if(this.m_interpolateExprs.includes(e))return e;const i=e.input.accept(this,t),n=e.stops.map((e=>{const i=e[0],r=e[1].accept(this,t);return r===e[1]?e:[i,r]}));for(const t of this.m_interpolateExprs)if(t.input===i&&t.mode[0]===e.mode[0]&&t.mode[1]===e.mode[1]&&n.length===t.stops.length&&n.every((([e,i],r)=>e===t.stops[r][0]&&i===t.stops[r][1])))return t;const s=new r.InterpolateExpr(e.mode,i,n);return this.m_interpolateExprs.push(s),s}}},6665:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isFeatureGeometry=void 0,t.isFeatureGeometry=function(e){const t=e.type;return"Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}},1470:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7954:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1460:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2904:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.interpolatedPropertyDefinitionToJsonExpr=t.isInterpolatedPropertyDefinition=t.InterpolationMode=void 0,(i=t.InterpolationMode||(t.InterpolationMode={}))[i.Discrete=0]="Discrete",i[i.Linear=1]="Linear",i[i.Cubic=2]="Cubic",i[i.Exponential=3]="Exponential",t.isInterpolatedPropertyDefinition=function(e){return!!(e&&void 0===e.interpolationMode&&Array.isArray(e.values)&&e.values.length>0&&void 0!==e.values[0]&&Array.isArray(e.zoomLevels)&&e.zoomLevels.length>0&&void 0!==e.zoomLevels[0]&&e.values.length===e.zoomLevels.length)},t.interpolatedPropertyDefinitionToJsonExpr=function(e){if(void 0===e.interpolation||"Discrete"===e.interpolation){const t=["step",["zoom"],e.values[0]];for(let i=1;i<e.zoomLevels.length;++i)t.push(e.zoomLevels[i],e.values[i]);return t}const t=["interpolate"];switch(e.interpolation){case"Linear":t.push(["linear"]);break;case"Cubic":t.push(["cubic"]);break;case"Exponential":t.push(["exponential",void 0!==e.exponent?e.exponent:2]);break;default:throw new Error(`interpolation mode '${e.interpolation}' is not supported`)}t.push(["zoom"]);for(let i=0;i<e.zoomLevels.length;++i)t.push(e.zoomLevels[i],e.values[i]);return t}},9416:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addPolygonEdges=void 0;const r=i(4428),n=new r.Vector2,s=new r.Vector2,o=new r.Vector2,a=new r.Vector2;t.addPolygonEdges=function(e,t,i,r,l,c,h,d){for(let u=0;u<l.length;++u)if(l[u])if(!0===c){const c=t+2*u,m=c+1,p=t+(u+1)%l.length*2,f=p+1;!0===h&&e.push(c,p),e.push(m,f);const g=(0===u?l.length:u)-1;if(l[g])if(void 0!==d){const t=r[u*i],h=r[u*i+1],p=r[(u+1)%l.length*i],f=r[(u+1)%l.length*i+1];n.set(t,h),s.set(p,f),o.set(r[g*i],r[g*i+1]),a.set(n.x,n.y),a.sub(o).normalize().dot(s.sub(n).normalize())<=d&&e.push(c,m)}else e.push(c,m)}else{const i=t+u,r=t+(u+1)%l.length;e.push(i,r)}}},5997:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pixels=void 0;const i=/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))px$/;class r{constructor(e){this.value=e}static parse(e){const t=i.exec(e);if(null!==t)return new r(Number(t[1]))}toJSON(){return`${this.value}px`}}t.Pixels=r},6792:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7487:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPropertyValue=void 0;const r=i(2183),n=i(8937),s=i(5997),o=i(5795),a=i(8783),l=r.LoggerManager.instance.create("PropertyValue");t.getPropertyValue=function(e,t,i){var r,c,h;if(n.Expr.isExpr(e))try{let a=e.evaluate(t,n.ExprScope.Dynamic,i);return"string"==typeof a&&(a=null!==(c=null!==(r=o.RGBA.parse(a))&&void 0!==r?r:s.Pixels.parse(a))&&void 0!==c?c:a),a instanceof o.RGBA?a.getHex():a instanceof s.Pixels?a.value*(null!==(h=Number(t.lookup("$pixelToMeters")))&&void 0!==h?h:1):a}catch(t){return l.error("failed to evaluate expression",JSON.stringify(e),"error",String(t)),null}if(null==e)return null;if("string"!=typeof e)return e;{const i=t.lookup("$pixelToMeters")||1,r=a.parseStringEncodedNumeral(e,i);return void 0!==r?r:e}}},5795:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RGBA=void 0;const r=i(4428),n=i(4482),s=i(8783);class o{constructor(e=1,t=1,i=1,r=1){this.r=e,this.g=t,this.b=i,this.a=r}static parse(e){const t=s.parseStringEncodedColor(e);if(void 0!==t)return n.ColorUtils.getRgbaFromHex(t)}clone(){return new o(this.r,this.g,this.b,this.a)}getHex(){return n.ColorUtils.getHexFromRgba(this.r,this.g,this.b,this.a)}lerp(e,t){return this.r=r.MathUtils.lerp(this.r,e.r,t),this.g=r.MathUtils.lerp(this.g,e.g,t),this.b=r.MathUtils.lerp(this.b,e.b,t),this.a=r.MathUtils.lerp(this.a,e.a,t),this}toJSON(){return`rgba(${255*this.r<<0}, ${255*this.g<<0}, ${255*this.b<<0}, ${this.a})`}}t.RGBA=o},8783:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseStringEncodedColor=t.parseStringEncodedNumeral=t.StringEncodedNumeralFormatMaxSize=t.StringEncodedNumeralFormats=t.StringEncodedColorFormats=t.StringEncodedMetricFormats=t.StringEncodedNumeralType=void 0;const r=i(2183),n=i(2058),s=i(4482);var o;!function(e){e[e.Meters=0]="Meters",e[e.Pixels=1]="Pixels",e[e.Hex=2]="Hex"}(o=t.StringEncodedNumeralType||(t.StringEncodedNumeralType={}));const a={type:o.Meters,size:1,regExp:/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))m$/,decoder:(e,t)=>{const i=a.regExp.exec(e);return!!i&&void 0!==(t[0]=Number(i[1]))}},l={type:o.Pixels,size:1,mask:1,regExp:/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))px$/,decoder:(e,t)=>{const i=l.regExp.exec(e);return null!==i&&(t[0]=Number(i[1]),!0)}},c={type:o.Hex,size:4,regExp:/^\#((?:[0-9A-Fa-f][0-9A-Fa-f]){4}|[0-9A-Fa-f]{4})$/,decoder:(e,t)=>{const i=c.regExp.exec(e);if(null===i)return!1;const n=i[1],s=n.length;return r.assert(4===s||8===s,"Matched incorrect hex color format"),4===s?(t[0]=parseInt(n.charAt(0)+n.charAt(0),16)/255,t[1]=parseInt(n.charAt(1)+n.charAt(1),16)/255,t[2]=parseInt(n.charAt(2)+n.charAt(2),16)/255,t[3]=4===s?parseInt(n.charAt(3)+n.charAt(3),16)/255:1):8===s&&(t[0]=parseInt(n.charAt(0)+n.charAt(1),16)/255,t[1]=parseInt(n.charAt(2)+n.charAt(3),16)/255,t[2]=parseInt(n.charAt(4)+n.charAt(5),16)/255,t[3]=8===s?parseInt(n.charAt(6)+n.charAt(7),16)/255:1),!0}};t.StringEncodedMetricFormats=[a,l];const h=t.StringEncodedMetricFormats.reduce(((e,t)=>Math.max(e,t.size)),0);t.StringEncodedColorFormats=[c];const d=t.StringEncodedColorFormats.reduce(((e,t)=>Math.max(e,t.size)),0);t.StringEncodedNumeralFormats=[...t.StringEncodedMetricFormats,...t.StringEncodedColorFormats],t.StringEncodedNumeralFormatMaxSize=Math.max(d,h);const u=new Array(t.StringEncodedNumeralFormatMaxSize);function m(e,t,i=1){const r=t.find((t=>!!t.decoder(e,u)));if(void 0===r){const t=n.parseCSSColor(e);return Array.isArray(t)&&!t.some((e=>isNaN(e)))?s.ColorUtils.getHexFromRgba(t[0]/255,t[1]/255,t[2]/255,t[3]):void 0}switch(null==r?void 0:r.type){case o.Pixels:return u[0]*i;case o.Hex:return s.ColorUtils.getHexFromRgba(u[0],u[1],u[2],u[3]);default:return u[0]}}t.parseStringEncodedNumeral=function(e,i=1){return m(e,t.StringEncodedNumeralFormats,i)},t.parseStringEncodedColor=function(e){return m(e,t.StringEncodedColorFormats)}},5257:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeDecodedTechnique=t.StyleSetEvaluator=void 0;const r=i(2183),n=i(8937),s=i(2475),o=i(2904),a=i(6671),l=i(7828),c=r.LoggerManager.instance.create("StyleSetEvaluator"),h=a.AttrScope.TechniqueGeometry;class d{classify(e){if(e._whenExpr){const t=this.switchStyle(e);e._whenExpr=e._whenExpr.accept(this,void 0),this._style=t}}visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){return e}visitHasAttributeExpr(e,t){return e}visitMatchExpr(e,t){return e}visitCaseExpr(e,t){return e}visitCallExpr(e,t){if("all"===e.op){const t=e.args.map((t=>t.accept(this,e))).filter((e=>void 0!==e));return new n.CallExpr(e.op,t)}if(t){const t=this.matchVarStringComparison(e);if(t){if(void 0===this._style.layer&&"$layer"===t.name)return void(this._style.layer=t.value);if(void 0===this._style._geometryType&&"$geometryType"===t.name)return void(this._style._geometryType=t.value)}}return e}visitStepExpr(e,t){return e}visitInterpolateExpr(e,t){return e}matchVarStringComparison(e){if("=="===e.op){const t=e.args[0],i=e.args[1];if(t instanceof n.VarExpr&&i instanceof n.StringLiteralExpr)return{name:t.name,value:i.value};if(i instanceof n.VarExpr&&t instanceof n.StringLiteralExpr)return{name:i.name,value:t.value}}}switchStyle(e){const t=this._style;return this._style=e,t}}class u{constructor(e,t){this.key="",this.set(e,t)}set(e,t,i){let r=!1;if(void 0===e){const t=void 0!==i?i.lookup("$layer"):void 0;e="string"==typeof t?t:void 0}if(this.layer!==e&&(this.layer=e,r=!0),void 0===t){const e=void 0!==i?i.lookup("$geometryType"):void 0;t="string"==typeof e?e:void 0}return this.geometryType!==t&&(this.geometryType=t,r=!0),r&&this.updateKey(),this}updateKey(){void 0!==this.layer?void 0!==this.geometryType?this.key=`${this.layer}:${this.geometryType}`:this.key=`${this.layer}:`:void 0!==this.geometryType?this.key=`:${this.geometryType}`:this.key="all",this.cachedStyleSet=void 0}}function m(e){const t={};for(const i in e){if(!e.hasOwnProperty(i))continue;let r=e[i];"object"==typeof r&&(r.isVector2||r.isVector3||r.isVector4)&&(r=n.LiteralExpr.fromValue(r)),n.Expr.isExpr(r)&&(r=r.toJSON()),t[i]=r}return t}t.StyleSetEvaluator=class{constructor(e){var t;this.m_options=e,this.m_techniques=[],this.m_exprPool=new s.ExprPool,this.m_cachedResults=new Map,this.m_styleConditionClassifier=new d,this.m_subStyleSetCache=new Map,this.m_definitionExprCache=new Map,this.m_tmpOptimizedSubSetKey=new u,this.m_emptyEnv=new n.Env,this.m_featureDependencies=[],this.m_definitions=this.m_options.definitions,this.styleSet=(t=this.m_options.styleSet,this.m_definitions,t.map((e=>function(e,t){return Object.assign({},e)}(e)))),function(e){let t=0,i=0;for(const r of e)r._styleSetIndex=i++,void 0!==r.technique&&void 0===r.renderOrder&&(r.renderOrder=t++)}(this.styleSet),this.compileStyleSet()}getMatchingTechniques(e,t,i){if(this.m_previousResult&&this.m_previousEnv&&this.m_featureDependencies.every((t=>{var i;return(null===(i=this.m_previousEnv)||void 0===i?void 0:i.lookup(t))===e.lookup(t)})))return this.m_previousResult;const r=[];this.m_cachedResults.clear();const n=this.m_tmpOptimizedSubSetKey;n.set(t,i,e),this.m_layer=n.layer,this.m_geometryType=n.geometryType,this.m_zoomLevel=e.lookup("$zoom");const s=this.getOptimizedStyleSet(n);for(const t of s)if(this.processStyle(e,t,r))break;return this.m_previousResult=r,this.m_previousEnv=e,r}wantsLayer(e){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,void 0)).length>0}wantsFeature(e,t){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,t)).length>0}get expressionEvaluatorCache(){return this.m_cachedResults}resetTechniques(){for(const e of this.m_techniques)e._index=void 0;this.m_techniques.length=0,this.m_previousResult=void 0,this.m_previousEnv=void 0}get techniques(){return this.m_techniques}get decodedTechniques(){return this.m_techniques.map(m)}getOptimizedStyleSet(e){if(void 0!==e.cachedStyleSet)return e.cachedStyleSet;let t=this.m_subStyleSetCache.get(e.key);return void 0!==t?(e.cachedStyleSet=t,t):(t=this.createPreFilteredStyleSet(e),this.m_subStyleSetCache.set(e.key,t),e.cachedStyleSet=t,t)}createPreFilteredStyleSet(e){const{layer:t,geometryType:i}=e;return this.styleSet.filter((e=>!(void 0!==t&&void 0!==e.layer&&e.layer!==t||void 0!==i&&void 0!==e._geometryType&&e._geometryType!==i)))}compileStyleSet(){this.m_featureDependencies=["$layer","$geometryType","$zoom"],this.styleSet.forEach((e=>this.compileStyle(e))),this.styleSet.forEach((e=>{this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e.layer,e._geometryType))}))}compileStyle(e){if(this.checkStyleDynamicAttributes(e),void 0!==e.when)try{e._whenExpr=Array.isArray(e.when)?n.Expr.fromJSON(e.when,this.m_definitions,this.m_definitionExprCache):n.Expr.parse(e.when),this.m_styleConditionClassifier.classify(e),void 0!==e._whenExpr&&(e._whenExpr=e._whenExpr.intern(this.m_exprPool));const t=e._whenExpr.dependencies();null==t||t.properties.forEach((e=>{this.m_featureDependencies.includes(e)||this.m_featureDependencies.push(e)})),n.isJsonExpr(e.minZoomLevel)&&(e._minZoomLevelExpr=n.Expr.fromJSON(e.minZoomLevel).intern(this.m_exprPool)),n.isJsonExpr(e.maxZoomLevel)&&(e._maxZoomLevelExpr=n.Expr.fromJSON(e.maxZoomLevel).intern(this.m_exprPool))}catch(t){c.log("failed to evaluate expression",JSON.stringify(e.when),"error",String(t))}}processStyle(e,t,i){if(!this.checkZoomLevel(e,t))return!1;if(void 0!==this.m_layer&&void 0!==t.layer&&t.layer!==this.m_layer)return!1;if(void 0!==this.m_geometryType&&void 0!==t._geometryType&&t._geometryType!==this.m_geometryType)return!1;if(t._whenExpr)try{if(!t._whenExpr.evaluate(e,n.ExprScope.Condition,this.m_cachedResults))return!1}catch(e){return c.error(`failed to evaluate expression '${JSON.stringify(t.when)}': ${e}`),!1}return void 0!==t.technique&&("none"!==t.technique&&i.push(this.getTechniqueForStyleMatch(e,t)),!0===t.final)}checkZoomLevel(e,t){var i,r;if(void 0===t.minZoomLevel&&void 0===t.maxZoomLevel)return!0;const s=this.m_zoomLevel;if(void 0===s)return!0;if(void 0!==t.minZoomLevel){let r=t.minZoomLevel;if(!1===(null===(i=t._minZoomLevelExpr)||void 0===i?void 0:i.isDynamic()))try{r=t._minZoomLevelExpr.evaluate(e,n.ExprScope.Condition,this.m_cachedResults)}catch(e){c.error(`failed to evaluate expression '${JSON.stringify(t._minZoomLevelExpr)}': ${e}`)}if("number"==typeof r&&s<r)return!1}if(void 0!==t.maxZoomLevel){let i=t.maxZoomLevel;if(!1===(null===(r=t._maxZoomLevelExpr)||void 0===r?void 0:r.isDynamic()))try{i=t._maxZoomLevelExpr.evaluate(e,n.ExprScope.Condition,this.m_cachedResults)}catch(e){c.error(`failed to evaluate expression '${JSON.stringify(t._maxZoomLevelExpr)}': ${e}`)}if("number"==typeof i&&s>=i)return!1}return!0}getTechniqueForStyleMatch(e,t){let i;if(void 0!==t._dynamicTechniques){const r=this.evaluateTechniqueProperties(t,e),n=this.getDynamicTechniqueKey(t,r);i=t._dynamicTechniques.get(n),void 0===i&&(i=this.createTechnique(t,n,r),t._dynamicTechniques.set(n,i))}else i=t._staticTechnique,void 0===i&&(t._staticTechnique=i=this.createTechnique(t,`${t._styleSetIndex}`,[]));return void 0===i._index&&(i._index=this.m_techniques.length,this.m_techniques.push(i)),i}getDynamicTechniqueKey(e,t){const i=t.map((([e,t])=>void 0===t?"U":JSON.stringify(t))).join(":");return`${e._styleSetIndex}:${i}`}checkStyleDynamicAttributes(e){var t;if(void 0!==e._dynamicTechniqueAttributes||"none"===e.technique)return;e._dynamicTechniqueAttributes=[],e._dynamicFeatureAttributes=[],e._dynamicForwardedAttributes=[],e._staticAttributes=[];const i=e._dynamicFeatureAttributes,r=e._dynamicTechniqueAttributes,s=e._dynamicForwardedAttributes,l=e._staticAttributes,d=(t,d)=>{if(void 0!==d){if(n.isJsonExpr(d)?d=n.Expr.fromJSON(d,this.m_definitions,this.m_definitionExprCache).intern(this.m_exprPool):o.isInterpolatedPropertyDefinition(d)&&(d=n.Expr.fromJSON(o.interpolatedPropertyDefinitionToJsonExpr(d)).intern(this.m_exprPool)),n.Expr.isExpr(d)){const i=d.dependencies();i.featureState&&("enabled"!==t?c.log("feature-state is not supported in this context"):e._usesFeatureState=!0),0!==i.properties.size||d.isDynamic()||(d=d.evaluate(this.m_emptyEnv))}if(n.Expr.isExpr(d)){const n=function(e,t){var i,r;return"extruded-polygon"===e.technique&&"color"===t&&!1!==e.vertexColors?h:null!==(r=null===(i=a.getTechniqueAttributeDescriptor(e.technique,t))||void 0===i?void 0:i.scope)&&void 0!==r?r:h}(e,t),o=d.dependencies();switch(o.properties.forEach((e=>{this.m_featureDependencies.includes(e)||this.m_featureDependencies.push(e)})),n){case a.AttrScope.FeatureGeometry:i.push([t,d]);break;case a.AttrScope.TechniqueGeometry:r.push([t,d]);break;case a.AttrScope.TechniqueRendering:0===o.properties.size?s.push([t,d]):r.push([t,d])}}else null!=d&&l.push([t,d])}},u=new Map([["category","_category"],["secondaryCategory","_secondaryCategory"]]);for(const i in e)e.hasOwnProperty(i)&&(i.startsWith("_")||["when","technique","layer","attr","description"].includes(i)||d(null!==(t=u.get(i))&&void 0!==t?t:i,e[i]));if(void 0!==e.attr)for(const t in e.attr)e.attr.hasOwnProperty(t)&&d(t,e.attr[t]);r.length>0&&(e._dynamicTechniques=new Map)}evaluateTechniqueProperties(e,t){return void 0===e._dynamicTechniqueAttributes?[]:e._dynamicTechniqueAttributes.map((([e,i])=>{try{return[e,i.evaluate(t,n.ExprScope.Value,this.m_cachedResults)]}catch(t){return c.error(`failed to evaluate expression '${i.toJSON()}': ${t}`),[e,null]}}))}createTechnique(e,t,i){var r,n;const s={};if(s.name=e.technique,void 0!==e._staticAttributes)for(const[t,i]of e._staticAttributes)null!==i&&(s[t]=i);for(const[e,t]of i)null!==t&&(s[e]=t);if(void 0!==e._dynamicFeatureAttributes)for(const[t,i]of e._dynamicFeatureAttributes)s[t]=i;if(void 0!==e._dynamicForwardedAttributes)for(const[t,i]of e._dynamicForwardedAttributes)s[t]=i;return s._index=this.m_techniques.length,s._styleSetIndex=e._styleSetIndex,void 0!==e.styleSet&&(s._styleSet=e.styleSet),void 0!==e._usesFeatureState&&(s._usesFeatureState=e._usesFeatureState),l.setTechniqueRenderOrderOrPriority(s,null!==(r=this.m_options.priorities)&&void 0!==r?r:[],null!==(n=this.m_options.labelPriorities)&&void 0!==n?n:[]),this.m_techniques.push(s),s}},t.makeDecodedTechnique=m},3024:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateTechniqueAttr=void 0;const r=i(8937),n=i(7487);t.evaluateTechniqueAttr=function(e,t,i){if(void 0===t)return i;const s=r.Env.isEnv(e)?n.getPropertyValue(t,e):n.getPropertyValue(t,e.env,e.cachedExprResults);return null!=s?s:i}},6671:(e,t)=>{"use strict";var i;function r(...e){const t={attrDescriptors:{}};for(const i of e)void 0!==i.attrTransparencyColor&&(t.attrTransparencyColor=i.attrTransparencyColor),void 0!==i.attrDescriptors&&(t.attrDescriptors=Object.assign(Object.assign({},t.attrDescriptors),i.attrDescriptors));return t}Object.defineProperty(t,"__esModule",{value:!0}),t.getTechniqueAutomaticAttrs=t.getTechniqueAttributeDescriptor=t.getTechniqueDescriptor=t.AttrScope=void 0,function(e){e[e.FeatureGeometry=0]="FeatureGeometry",e[e.TechniqueGeometry=1]="TechniqueGeometry",e[e.TechniqueRendering=2]="TechniqueRendering"}(i=t.AttrScope||(t.AttrScope={}));const n={attrTransparencyColor:"color",attrDescriptors:{constantHeight:i.FeatureGeometry,enabled:i.FeatureGeometry,fadeFar:i.TechniqueRendering,fadeNear:i.TechniqueRendering,transparent:{scope:i.TechniqueRendering,automatic:!0},side:{scope:i.TechniqueRendering,automatic:!0}}},s=r(n,{attrDescriptors:{color:{scope:i.TechniqueRendering,automatic:!0},size:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0}}}),o=r(n,s),a=r(n,s),l=r(n,{attrDescriptors:{text:i.FeatureGeometry,label:i.FeatureGeometry,useAbbreviation:i.FeatureGeometry,useIsoCode:i.FeatureGeometry,poiName:i.FeatureGeometry,imageTexture:i.FeatureGeometry,iconColor:i.TechniqueRendering,iconBrightness:i.TechniqueRendering,backgroundColor:i.TechniqueRendering,backgroundSize:i.TechniqueRendering,backgroundOpacity:i.TechniqueRendering,color:i.TechniqueRendering,opacity:i.TechniqueRendering,size:i.TechniqueRendering}}),c={attrDescriptors:{polygonOffset:{scope:i.TechniqueRendering,automatic:!0},polygonOffsetFactor:{scope:i.TechniqueRendering,automatic:!0},polygonOffsetUnits:{scope:i.TechniqueRendering,automatic:!0},depthTest:{scope:i.TechniqueRendering,automatic:!0},transparent:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0},color:{scope:i.TechniqueRendering,automatic:!0},lineColor:i.TechniqueRendering,lineFadeFar:i.TechniqueRendering,lineFadeNear:i.TechniqueRendering}},h=r(n,c,{attrDescriptors:{lineWidth:i.TechniqueRendering,secondaryWidth:i.TechniqueRendering,secondaryColor:i.TechniqueRendering,dashSize:i.TechniqueRendering,gapSize:i.TechniqueRendering,outlineColor:{scope:i.TechniqueRendering,automatic:!0},caps:{scope:i.TechniqueRendering,automatic:!0},drawRangeStart:{scope:i.TechniqueRendering,automatic:!0},drawRangeEnd:{scope:i.TechniqueRendering,automatic:!0},dashes:{scope:i.TechniqueRendering,automatic:!0},dashColor:{scope:i.TechniqueRendering,automatic:!0}}}),d=r(n,{attrDescriptors:{color:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0},lineWidth:i.FeatureGeometry}}),u=r(n,c,{attrDescriptors:{wireframe:{scope:i.TechniqueRendering,automatic:!0},color:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0},transparent:{scope:i.TechniqueRendering,automatic:!0},lineWidth:i.TechniqueRendering}}),m=r(n,{attrDescriptors:{color:i.FeatureGeometry,vertexColors:{scope:i.TechniqueRendering,automatic:!0},wireframe:{scope:i.TechniqueRendering,automatic:!0},roughness:{scope:i.TechniqueRendering,automatic:!0},metalness:{scope:i.TechniqueRendering,automatic:!0},alphaTest:{scope:i.TechniqueRendering,automatic:!0},depthTest:{scope:i.TechniqueRendering,automatic:!0},transparent:{scope:i.TechniqueRendering,automatic:!0},opacity:{scope:i.TechniqueRendering,automatic:!0},emissive:{scope:i.TechniqueRendering,automatic:!0},emissiveIntensity:{scope:i.TechniqueRendering,automatic:!0},refractionRatio:{scope:i.TechniqueRendering,automatic:!0},normalMapType:{scope:i.TechniqueRendering,automatic:!0}}}),p={"extruded-polygon":r(n,m,{attrDescriptors:{height:i.FeatureGeometry,floorHeight:i.FeatureGeometry,color:i.FeatureGeometry,defaultColor:i.FeatureGeometry,defaultHeight:i.FeatureGeometry,boundaryWalls:i.FeatureGeometry,footprint:i.FeatureGeometry,maxSlope:i.FeatureGeometry,animateExtrusion:i.TechniqueRendering,lineWidth:i.TechniqueRendering,lineFadeNear:i.TechniqueRendering,lineFadeFar:i.TechniqueRendering,lineColor:i.TechniqueRendering}}),"line-marker":l,"labeled-icon":l,"solid-line":h,"dashed-line":h,terrain:m,standard:m,squares:o,circles:a,line:d,segments:d,fill:u,text:r(n,{attrDescriptors:{text:i.FeatureGeometry,label:i.FeatureGeometry,useAbbreviation:i.FeatureGeometry,useIsoCode:i.FeatureGeometry,backgroundColor:i.TechniqueRendering,backgroundSize:i.TechniqueRendering,backgroundOpacity:i.TechniqueRendering,color:i.TechniqueRendering,opacity:i.TechniqueRendering,priority:i.TechniqueRendering,size:i.TechniqueRendering}}),shader:r(n,{attrDescriptors:{params:i.TechniqueRendering}})};function f(e){return"string"!=typeof e&&(e=e.name),p[e]}t.getTechniqueDescriptor=f,t.getTechniqueAttributeDescriptor=function(e,t){const i=f(e),r=null==i?void 0:i.attrDescriptors,n=null==r?void 0:r[t];if(void 0!==typeof n)return"object"==typeof n?n:{scope:n}};const g=new Map;t.getTechniqueAutomaticAttrs=function(e){var t;if("string"!=typeof e&&(e=e.name),g.has(e))return g.get(e);const i=[],r=null===(t=f(e))||void 0===t?void 0:t.attrDescriptors;if(void 0===r)return i;for(const e in r){if(!r.hasOwnProperty(e))continue;const t=r[e];void 0!==t&&"number"!=typeof t&&!0===t.automatic&&i.push(e)}return g.set(e,i),i}},8212:(e,t)=>{"use strict";var i,r,n,s,o;Object.defineProperty(t,"__esModule",{value:!0}),t.isTextureBuffer=t.PlacementToken=t.transientToPickability=t.Pickability=t.PoiStackMode=t.TextureCoordinateType=t.GeometryKindSet=t.GeometryKind=t.StandardGeometryKind=void 0,function(e){e.All="_all_",e.Background="background",e.Terrain="terrain",e.Area="area",e.Line="line",e.Water="water",e.Border="border",e.Road="road",e.Building="building",e.Label="label",e.Detail="detail"}(i=t.StandardGeometryKind||(t.StandardGeometryKind={})),t.GeometryKind=i;class a extends Set{isSuperset(e){for(const t of e)if(!this.has(t))return!1;return!0}hasIntersection(e){for(const t of e)if(this.has(t))return!0;return!1}hasOrIntersects(e){return e instanceof Set?this.hasIntersection(e):this.has(e)}hasOrIntersectsArray(e){for(const t of e)if(this.has(t))return!0;return!1}}t.GeometryKindSet=a,(o=t.TextureCoordinateType||(t.TextureCoordinateType={})).TileSpace="tile-space",o.EquirectangularSpace="equirectangular-space",o.FeatureSpace="feature-space",(s=t.PoiStackMode||(t.PoiStackMode={})).Show="show-in-stack",s.Hide="hide-in-stack",s.ShowParent="show-parent",function(e){e.onlyVisible="only-visible",e.transient="transient",e.all="all"}(r=t.Pickability||(t.Pickability={})),t.transientToPickability=function(e){let t=r.onlyVisible;return null!=e&&(t="string"==typeof e?e:!0===e?r.transient:r.onlyVisible),t},(n=t.PlacementToken||(t.PlacementToken={})).TopLeft="TL",n.Top="T",n.TopRight="TR",n.Right="R",n.BottomRight="BR",n.Bottom="B",n.BottomLeft="BL",n.Left="L",n.Center="C",n.NorthWest="NW",n.North="N",n.NorthEast="NE",n.East="E",n.SouthEast="SE",n.South="S",n.SouthWest="SW",n.West="W",t.isTextureBuffer=function(e){return e&&e.buffer&&"string"==typeof e.type}},7828:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setTechniqueRenderOrderOrPriority=t.composeTechniqueTextureName=t.addBuffersToTransferList=t.textureCoordinateType=t.needsVertexNormals=t.isLabelRejectionLineTechnique=t.isShaderTechnique=t.isTextTechnique=t.isTerrainTechnique=t.isStandardTechnique=t.isExtrudedPolygonTechnique=t.isFillTechnique=t.isStandardExtrudedLineTechnique=t.isBasicExtrudedLineTechnique=t.isExtrudedLineTechnique=t.isSegmentsTechnique=t.isSpecialDashesLineTechnique=t.isSolidLineTechnique=t.isLineTechnique=t.isLineMarkerTechnique=t.isPoiTechnique=t.isSquaresTechnique=t.isCirclesTechnique=t.TRANSPARENCY_PROPERTY_KEYS=t.TEXTURE_PROPERTY_KEYS=void 0;const r=i(8212);function n(e){return"labeled-icon"===e.name}function s(e){return"line-marker"===e.name}function o(e){return"extruded-line"===e.name}function a(e){return o(e)&&"standard"===e.shading}function l(e){return"fill"===e.name}function c(e){return"extruded-polygon"===e.name}function h(e){return"standard"===e.name}function d(e){return"terrain"===e.name}function u(e){return"text"===e.name}function m(e){return"shader"===e.name}t.TEXTURE_PROPERTY_KEYS=["map","normalMap","displacementMap","roughnessMap","emissiveMap","alphaMap","metalnessMap","bumpMap"],t.TRANSPARENCY_PROPERTY_KEYS=["opacity","transparent"],t.isCirclesTechnique=function(e){return"circles"===e.name},t.isSquaresTechnique=function(e){return"squares"===e.name},t.isPoiTechnique=n,t.isLineMarkerTechnique=s,t.isLineTechnique=function(e){return"line"===e.name},t.isSolidLineTechnique=function(e){return"solid-line"===e.name||"dashed-line"===e.name},t.isSpecialDashesLineTechnique=function(e){return("solid-line"===e.name||"dashed-line"===e.name)&&void 0!==e.dashes&&"Square"!==e.dashes},t.isSegmentsTechnique=function(e){return"segments"===e.name},t.isExtrudedLineTechnique=o,t.isBasicExtrudedLineTechnique=function(e){return o(e)&&"basic"===e.shading},t.isStandardExtrudedLineTechnique=a,t.isFillTechnique=l,t.isExtrudedPolygonTechnique=c,t.isStandardTechnique=h,t.isTerrainTechnique=d,t.isTextTechnique=u,t.isShaderTechnique=m,t.isLabelRejectionLineTechnique=function(e){return"label-rejection-line"===e.name},t.needsVertexNormals=function(e){return c(e)||l(e)||h(e)||d(e)||a(e)},t.textureCoordinateType=function(e){return h(e)||c(e)||d(e)||m(e)?e.textureCoordinateType:void 0},t.addBuffersToTransferList=function(e,i){if(h(e)||c(e)||d(e))for(const n of t.TEXTURE_PROPERTY_KEYS){const t=e[n];r.isTextureBuffer(t)&&t.buffer instanceof ArrayBuffer&&i.push(t.buffer)}},t.composeTechniqueTextureName=function(e,t){let i=e;return"string"==typeof t.imageTexturePrefix&&(i=t.imageTexturePrefix+i),"string"==typeof t.imageTexturePostfix&&(i+=t.imageTexturePostfix),i},t.setTechniqueRenderOrderOrPriority=function(e,t,i){if(u(e)||n(e)||s(e)){if(i&&"string"==typeof e._category){const t=i.indexOf(e._category);-1!==t&&(e.priority=i.length-t)}}else if(t&&void 0!==e._styleSet){const i=i=>{const r=null==t?void 0:t.findIndex((t=>t.group===e._styleSet&&t.category===i));return void 0!==r&&-1!==r?10*(r+1):void 0};if("string"==typeof e._category){const t=i(e._category);void 0!==t&&(e.renderOrder=t)}if("string"==typeof e._secondaryCategory){const t=i(e._secondaryCategory);void 0!==t&&(e.secondaryRenderOrder=t)}}}},172:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isJsonExprReference=void 0,t.isJsonExprReference=function(e){return Array.isArray(e)&&2===e.length&&"ref"===e[0]&&"string"==typeof e[1]}},8648:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeVisitor=void 0;const r=i(8937);t.ThemeVisitor=class{constructor(e){this.theme=e}visitStyles(e){const t=t=>!r.isJsonExpr(t)&&!!e(t);if(void 0!==this.theme.styles)for(const e in this.theme.styles)if(void 0!==this.theme.styles[e])for(const i of this.theme.styles[e])if(t(i))return!0;return!1}}},1549:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThreeBufferUtils=void 0;const r=i(84);!function(e){function t(e){if(e instanceof Int8Array)return"int8";if(e instanceof Uint8Array)return"uint8";if(e instanceof Int16Array)return"int16";if(e instanceof Uint16Array)return"uint16";if(e instanceof Int32Array)return"int32";if(e instanceof Uint32Array)return"uint32";if(e instanceof Float32Array)return"float";throw new Error(`Unsupported buffer type ${name}`)}function i(e){const i=e.array;return{name:e.name,buffer:i.buffer,type:t(i),itemCount:e.itemSize,normalized:e.normalized}}e.getBufferElementType=t,e.fromThreeBufferAttribute=i,e.fromThreeInterleavedBufferAttribute=function(e){throw new Error("Not implemented yet")},e.fromThreeBufferGeometry=function(e,t){const n=[],s=Object.getOwnPropertyNames(e.attributes);for(const t of s){const r=i(e.attributes[t]);r.name=t,n.push(r)}const o=null!==e.index?i(e.index):void 0;let a=0;if(void 0!==o)a=null===e.index?0:e.index.count;else{const t=e.attributes.position;if(void 0===t)throw new Error("Missing position attibute to deduce item count");a=t.count}return{type:r.GeometryType.Unspecified,vertexAttributes:n,index:o,groups:[{start:0,count:a,technique:t}]}}}(t.ThreeBufferUtils||(t.ThreeBufferUtils={}))},7187:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5253:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerDecoderProtocol=t.RequestController=void 0,t.RequestController=class{constructor(e=0,t=new AbortController){this.priority=e,this.abortController=t}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}},function(e){let t,i;!function(e){e.Configuration="configuration"}(t=e.DecoderMessageName||(e.DecoderMessageName={})),e.isConfigurationMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Configuration},function(e){e.DecodeTileRequest="decode-tile-request",e.TileInfoRequest="tile-info-request"}(i=e.Requests||(e.Requests={})),e.isDecodeTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.DecodeTileRequest},e.isTileInfoRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.TileInfoRequest}}(t.WorkerDecoderProtocol||(t.WorkerDecoderProtocol={}))},7299:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerServiceProtocol=void 0,function(e){let t,i;e.WORKER_SERVICE_MANAGER_SERVICE_ID="worker-service-manager",function(e){e.Initialized="initialized",e.Request="request",e.Response="response"}(t=e.ServiceMessageName||(e.ServiceMessageName={})),e.isInitializedMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Initialized},function(e){e.CreateService="create-service",e.DestroyService="destroy-service"}(i=e.Requests||(e.Requests={})),e.isUnknownServiceError=function(e){return e.message.includes("unknown targetServiceType requested: ")},e.isRequestMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Request},e.isResponseMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Response}}(t.WorkerServiceProtocol||(t.WorkerServiceProtocol={}))},2525:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerTilerProtocol=void 0,function(e){let t;!function(e){e.RegisterIndex="register-index",e.UpdateIndex="update-index",e.TileRequest="tile-request"}(t=e.Requests||(e.Requests={})),e.isRegisterIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.RegisterIndex},e.isUpdateIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.UpdateIndex},e.isTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.TileRequest}}(t.WorkerTilerProtocol||(t.WorkerTilerProtocol={}))},6075:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArrayOperators=void 0;const r=i(8937),n=["boolean","number","string"];function s(e,t){if(!(e instanceof r.StringLiteralExpr&&n.includes(e.value)))throw new Error(`expected "boolean", "number" or "string" instead of '${JSON.stringify(e)}'`);const i=e.value;t.forEach(((e,t)=>{if(typeof e!==i)throw new Error(`expected array element at index ${t} to have type '${i}'`)}))}function o(e,t){const i=e.evaluate(t);if(!Array.isArray(i))throw new Error(`'${i}' is not an array`);return i}const a={array:{call:(e,t)=>{switch(t.args.length){case 0:throw new Error("not enough arguments");case 1:return o(e,t.args[0]);case 2:{const i=o(e,t.args[1]);return s(t.args[0],i),i}case 3:{const i=o(e,t.args[2]);return function(e,t){if(!(e instanceof r.NumberLiteralExpr))throw new Error("missing expected number of elements");const i=e.value;if(t.length!==i)throw new Error(`the array must have ${i} element(s)`)}(t.args[1],i),s(t.args[0],i),i}default:throw new Error("too many arguments")}}},"make-array":{call:(e,t)=>{if(0===t.args.length)throw new Error("not enough arguments");return[...t.args.map((t=>e.evaluate(t)))]}},at:{call:(e,t)=>{const i=t.args,r=e.evaluate(i[0]);if("number"!=typeof r)throw new Error("expected the index of the element to retrieve");const n=e.evaluate(i[1]);if(!Array.isArray(n))throw new Error("expected an array");return r>=0&&r<n.length?n[r]:null}},slice:{call:(e,t)=>{if(t.args.length<2)throw new Error("not enough arguments");const i=e.evaluate(t.args[0]);if("string"!=typeof i&&!Array.isArray(i))throw new Error("input must be a string or an array");const r=e.evaluate(t.args[1]);if("number"!=typeof r)throw new Error("expected an index");let n;if(t.args.length>2&&(n=e.evaluate(t.args[2]),"number"!=typeof n))throw new Error("expected an index");return i.slice(r,n)}}};t.ArrayOperators=a},2099:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CastOperators=void 0;const i={"to-boolean":{call:(e,t)=>Boolean(e.evaluate(t.args[0]))},"to-string":{call:(e,t)=>String(e.evaluate(t.args[0]))},"to-number":{call:(e,t)=>{for(const i of t.args){const t=Number(e.evaluate(i));if(!isNaN(t))return t}throw new Error("cannot convert the value to a number")}}};t.CastOperators=i},8210:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorOperators=void 0;const r=i(4428),n=i(4482),s=i(8783),o={alpha:{call:(e,t)=>{let i=e.evaluate(t.args[0]);return"string"==typeof i&&(i=s.parseStringEncodedColor(i)),"number"==typeof i?n.ColorUtils.getAlphaFromHex(i):1}},rgba:{call:(e,t)=>{const i=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]),a=e.evaluate(t.args[3]);if("number"==typeof i&&"number"==typeof s&&"number"==typeof o&&"number"==typeof a&&i>=0&&s>=0&&o>=0&&a>=0&&a<=1)return function(e,t,i,s){return n.ColorUtils.getHexFromRgba(r.MathUtils.clamp(e,0,255)/255,r.MathUtils.clamp(t,0,255)/255,r.MathUtils.clamp(i,0,255)/255,r.MathUtils.clamp(s,0,1))}(i,s,o,a);throw new Error(`unknown color 'rgba(${i},${s},${o},${a})'`)}},rgb:{call:(e,t)=>{const i=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]);if("number"==typeof i&&"number"==typeof s&&"number"==typeof o&&i>=0&&s>=0&&o>=0)return function(e,t,i){return n.ColorUtils.getHexFromRgb(r.MathUtils.clamp(e,0,255)/255,r.MathUtils.clamp(t,0,255)/255,r.MathUtils.clamp(i,0,255)/255)}(i,s,o);throw new Error(`unknown color 'rgb(${i},${s},${o})'`)}},hsl:{call:(e,t)=>{const i=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]);if("number"==typeof i&&"number"==typeof s&&"number"==typeof o&&i>=0&&s>=0&&o>=0)return function(e,t,i){return n.ColorUtils.getHexFromHsl(r.MathUtils.euclideanModulo(e,360)/360,r.MathUtils.clamp(t,0,100)/100,r.MathUtils.clamp(i,0,100)/100)}(i,s,o);throw new Error(`unknown color 'hsl(${i},${s}%,${o}%)'`)}}};t.ColorOperators=o},7922:(e,t)=>{"use strict";function i(e,t,i=!1){const r=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if(!("number"==typeof r&&"number"==typeof n||"string"==typeof r&&"string"==typeof n)&&i)throw new Error(`invalid operands '${r}' and '${n}' for operator '${t.op}'`);switch(t.op){case"<":return r<n;case">":return r>n;case"<=":return r<=n;case">=":return r>=n;default:throw new Error(`invalid comparison operator '${t.op}'`)}}Object.defineProperty(t,"__esModule",{value:!0}),t.ComparisonOperators=void 0;const r={"!":{call:(e,t)=>!e.evaluate(t.args[0])},"==":{call:(e,t)=>e.evaluate(t.args[0])===e.evaluate(t.args[1])},"!=":{call:(e,t)=>e.evaluate(t.args[0])!==e.evaluate(t.args[1])},"<":{call:(e,t)=>i(e,t)},">":{call:(e,t)=>i(e,t)},"<=":{call:(e,t)=>i(e,t)},">=":{call:(e,t)=>i(e,t)}};t.ComparisonOperators=r},7877:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureOperators=void 0;const r=i(9415),n=i(8937),s={"geometry-type":{call:(e,t)=>{switch(e.env.lookup("$geometryType")){case"point":return"Point";case"line":return"LineString";case"polygon":return"Polygon";default:return null}}},"feature-state":{isDynamicOperator:()=>!0,call:(e,t)=>{var i,s;if(e.scope!==n.ExprScope.Dynamic)throw new Error("feature-state cannot be used in this context");const o=e.evaluate(t.args[0]);if("string"!=typeof o)throw new Error("expected the name of the property of the feature state");const a=e.env.lookup("$state");return r.Env.isEnv(a)?null!==(i=a.lookup(o))&&void 0!==i?i:null:a instanceof Map&&null!==(s=a.get(o))&&void 0!==s?s:null}},id:{call:(e,t)=>{var i;return null!==(i=e.env.lookup("$id"))&&void 0!==i?i:null}}};t.FeatureOperators=s},8146:(e,t)=>{"use strict";function i(e,t,i){switch(t){case"boolean":case"number":case"string":for(const r of i){const i=e.evaluate(r);if(typeof i===t)return i}throw new Error(`expected a '${t}'`);default:throw new Error(`invalid type '${t}'`)}}Object.defineProperty(t,"__esModule",{value:!0}),t.FlowOperators=void 0;const r={all:{call:(e,t)=>{for(const i of t.args)if(!e.evaluate(i))return!1;return!0}},any:{call:(e,t)=>{for(const i of t.args)if(e.evaluate(i))return!0;return!1}},none:{call:(e,t)=>{for(const i of t.args)if(e.evaluate(i))return!1;return!0}},boolean:{call:(e,t)=>i(e,"boolean",t.args)},number:{call:(e,t)=>i(e,"number",t.args)},string:{call:(e,t)=>i(e,"string",t.args)}};t.FlowOperators=r},1139:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapOperators=void 0;const r=i(8937),n={"ppi-scale":{call:(e,t)=>e.evaluate(t.args[0])*(t.args[1]?e.evaluate(t.args[1]):1)},"world-ppi-scale":{isDynamicOperator:()=>!0,call:(e,t)=>{const i=e.evaluate(t.args[0]),r=t.args[1]?e.evaluate(t.args[1]):1,n=e.env.lookup("$zoom");return i*(Math.pow(2,17)/Math.pow(2,n))*r}},"world-discrete-ppi-scale":{isDynamicOperator:()=>!0,call:(e,t)=>{const i=e.evaluate(t.args[0]),r=t.args[1]?e.evaluate(t.args[1]):1,n=e.env.lookup("$zoom");return i*(Math.pow(2,17)/Math.pow(2,Math.floor(n)))*r}},ppi:{call:e=>{const t=e.env.lookup("$ppi");return"number"==typeof t?t:72}},zoom:{isDynamicOperator:()=>!0,call:(e,t)=>{var i;return e.scope===r.ExprScope.Value?t:null!==(i=e.env.lookup("$zoom"))&&void 0!==i?i:null}}};t.MapOperators=n},1701:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathOperators=void 0;const r=i(4428),n={"^":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof r)throw new Error(`invalid operands '${typeof i}' and '${typeof r}' for operator '^'`);return Math.pow(i,r)}},"-":{call:(e,t)=>{if(1===t.args.length){const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`ìnvalid operand '${typeof i} for operator '-'`);return-i}const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof r)throw new Error(`invalid operands '${typeof i}' and '${typeof r}' for operator '-'`);return i-r}},"/":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof r)throw new Error(`invalid operands '${typeof i}' and '${typeof r}' for operator '/'`);return i/r}},"%":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof r)throw new Error(`invalid operands '${typeof i}' and '${typeof r}' for operator '%'`);return i%r}},"+":{call:(e,t)=>t.args.reduce(((t,i)=>Number(t)+Number(e.evaluate(i))),0)},"*":{call:(e,t)=>t.args.reduce(((t,i)=>Number(t)*Number(e.evaluate(i))),1)},abs:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'abs'`);return Math.abs(i)}},acos:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'acos'`);return Math.acos(i)}},asin:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'asin'`);return Math.asin(i)}},atan:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'atan'`);return Math.atan(i)}},ceil:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ceil'`);return Math.ceil(i)}},cos:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'cos'`);return Math.cos(i)}},e:{call:()=>Math.E},floor:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'floor'`);return Math.floor(i)}},ln:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ln'`);return Math.log(i)}},ln2:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ln2'`);return Math.log2(i)}},log10:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'log10'`);return Math.log10(i)}},max:{call:(e,t)=>Math.max(...t.args.map((t=>Number(e.evaluate(t)))))},min:{call:(e,t)=>Math.min(...t.args.map((t=>Number(e.evaluate(t)))))},clamp:{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]);if("number"!=typeof i||"number"!=typeof n||"number"!=typeof s)throw new Error(`invalid operands '${i}', ${n}, ${s} for operator 'clamp'`);return r.MathUtils.clamp(i,n,s)}},pi:{call:()=>Math.PI},round:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'round'`);return Math.round(i)}},sin:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'sin'`);return Math.sin(i)}},sqrt:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'sqrt'`);return Math.sqrt(i)}},tan:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'tan'`);return Math.tan(i)}}};t.MathOperators=n},4292:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MiscOperators=void 0;const i={length:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if(Array.isArray(i)||"string"==typeof i)return i.length;throw new Error(`invalid operand '${i}' for operator 'length'`)}},coalesce:{call:(e,t)=>{for(const i of t.args){const t=e.evaluate(i);if(null!==t)return t}return null}}};t.MiscOperators=i},9156:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectOperators=void 0;const r=i(9415),n=i(8937),s=Object.prototype.hasOwnProperty;var o;function a(e,t,i){var n;const a=e.evaluate(t[0]);if("string"!=typeof a)throw new Error("expected the name of an attribute");const l=e.evaluate(t[1]);if(l&&"object"==typeof l){if(r.Env.isEnv(l)){const e=null!==(n=l.lookup(a))&&void 0!==n?n:null;return i===o.get?e:null!==e}if(s.call(l,a))return i!==o.get||l[a]}return i===o.get&&null}!function(e){e[e.get=0]="get",e[e.has=1]="has"}(o||(o={}));const l={in:{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);return("string"==typeof i&&"string"==typeof r||!!Array.isArray(r))&&r.includes(i)}},get:{call:(e,t)=>a(e,t.args,o.get)},has:{call:(e,t)=>a(e,t.args,o.has)},"dynamic-properties":{isDynamicOperator:()=>!0,call:(e,t)=>e.scope===n.ExprScope.Dynamic?e.env:t}};t.ObjectOperators=l},9388:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StringOperators=void 0;const i={concat:{call:(e,t)=>"".concat(...t.args.map((t=>String(e.evaluate(t)))))},downcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleLowerCase()},upcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleUpperCase()},"~=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof r&&i.includes(r)}},"^=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof r&&i.startsWith(r)}},"$=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof r&&i.endsWith(r)}}};t.StringOperators=i},8992:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeOperators=void 0,t.TypeOperators={typeof:{call:(e,t)=>typeof e.evaluate(t.args[0])}}},2273:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorOperators=void 0;const r=i(4428),n=i(8937);function s(e,t,i){let n;switch(i){case"vector2":n=r.Vector2;break;case"vector3":n=r.Vector3;break;case"vector4":n=r.Vector4}for(const i of t.args){const t=e.evaluate(i);if(t instanceof n)return t}throw new Error(`expected a "${i}"`)}function o(e,t,i){let n,s;switch(i){case"vector2":n=r.Vector2,s=2;break;case"vector3":n=r.Vector3,s=3;break;case"vector4":n=r.Vector4,s=4}for(const i of t.args){const t=e.evaluate(i);if(t instanceof n)return t;if(Array.isArray(t)&&t.length===s&&t.every((e=>"number"==typeof e)))return(new n).fromArray(t)}throw new Error(`expected a "${i}"`)}const a={"make-vector":{call:(e,t)=>{if(void 0!==t._value)return t._value;if(t.args.length<2)throw new Error("not enough arguments");if(t.args.length>4)throw new Error("too many arguments");const i=t.args.map((t=>e.evaluate(t)));let s;switch(i.forEach(((e,t)=>{if("number"!=typeof e)throw new Error(`expected vector component at index ${t} to have type "number"`)})),i.length){case 2:s=(new r.Vector2).fromArray(i);break;case 3:s=(new r.Vector3).fromArray(i);break;case 4:s=(new r.Vector4).fromArray(i);break;default:throw new Error("too many arguments")}return t.args.every((e=>e instanceof n.NumberLiteralExpr))&&(t._value=s),s}},vector2:{call:(e,t)=>s(e,t,"vector2")},vector3:{call:(e,t)=>s(e,t,"vector3")},vector4:{call:(e,t)=>s(e,t,"vector4")},"to-vector2":{call:(e,t)=>o(e,t,"vector2")},"to-vector3":{call:(e,t)=>o(e,t,"vector3")},"to-vector4":{call:(e,t)=>o(e,t,"vector4")}};t.VectorOperators=a},1526:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(7690),t)},7690:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DebugTileDataSource=t.DebugTile=void 0;const r=i(3139),n=i(2530),s=i(5084),o=i(4428),a=new o.LineBasicMaterial({color:16711680,linewidth:1,depthTest:!1}),l=Number.MAX_SAFE_INTEGER;class c extends n.Tile{constructor(e,t){super(e,t),this.geometry=new o.BufferGeometry,this.m_labelPositions=new o.BufferAttribute(new Float32Array(3),3),this.m_textRenderStyle=new s.TextRenderStyle({fontSize:{unit:s.FontUnit.Pixel,size:16,backgroundSize:0},color:new o.Color("#ff0000")});const i=e.getTilingScheme(),c=i.boundingBoxGenerator.getWorldBox(t),h=i.projection,d=[h.unprojectPoint(new o.Vector3(c.min.x,c.min.y,0)),h.unprojectPoint(new o.Vector3(c.max.x,c.min.y,0)),h.unprojectPoint(new o.Vector3(c.max.x,c.max.y,0)),h.unprojectPoint(new o.Vector3(c.min.x,c.max.y,0))],u=new o.Vector3,m=[];d.forEach((e=>{const t=new o.Vector3;this.projection.projectPoint(e,t),t.sub(this.center),m.push(...t.toArray()),u.add(t)})),this.geometry.setAttribute("position",new o.BufferAttribute(new Float32Array(m),3)),u.divideScalar(d.length);const p=new o.Line(this.geometry,a);p.renderOrder=l,this.objects.push(p),this.m_labelPositions.setXYZ(0,0,0,0);const f=new o.Vector3;this.projection.type===r.ProjectionType.Planar?(f.set(this.geometry.getAttribute("position").getX(3),this.geometry.getAttribute("position").getY(3),this.geometry.getAttribute("position").getZ(3)),f.multiplyScalar(.95),this.m_textLayoutStyle=new s.TextLayoutStyle({verticalAlignment:s.VerticalAlignment.Below,horizontalAlignment:s.HorizontalAlignment.Left})):(f.copy(u),this.m_textLayoutStyle=new s.TextLayoutStyle({verticalAlignment:s.VerticalAlignment.Center,horizontalAlignment:s.HorizontalAlignment.Center}));const g=`${t.mortonCode()} (${t.row}, ${t.column}, ${t.level})`;f.add(this.center);const v=new n.TextElement(g,f,this.m_textRenderStyle,this.m_textLayoutStyle,l,.8);v.mayOverlap=!0,v.reserveSpace=!1,v.alwaysOnTop=!0,v.ignoreDistance=!0,this.addTextElement(v)}}t.DebugTile=c;class h extends n.DataSource{constructor(e,t="debug",i=20){super({name:t,minDataLevel:1,maxDataLevel:20,storageLevelOffset:-1}),this.m_tilingScheme=e,this.maxDbgZoomLevel=i,this.cacheable=!0,this.enablePicking=!1}getTilingScheme(){return this.m_tilingScheme}getTile(e){return new c(this,e)}canGetTile(e,t){return!(t.level>this.maxDbgZoomLevel)&&super.canGetTile(e,t)}}t.DebugTileDataSource=h},2194:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(5025),t),n(i(8015),t)},5025:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewMultiPointFeature=t.MapViewPointFeature=t.MapViewMultiPolygonFeature=t.MapViewPolygonFeature=t.MapViewMultiLineFeature=t.MapViewLineFeature=t.MapViewFeature=void 0;const r=i(4428);class n{constructor(e,t){this.coordinates=e,this.properties=t,this.type="Point",this.uuid=r.MathUtils.generateUUID()}}t.MapViewFeature=n,t.MapViewLineFeature=class extends n{constructor(e,t){super(e,t),this.coordinates=e,this.properties=t,this.type="LineString"}},t.MapViewMultiLineFeature=class extends n{constructor(e,t){super(e,t),this.coordinates=e,this.properties=t,this.type="MultiLineString"}},t.MapViewPolygonFeature=class extends n{constructor(e,t){super(e,t),this.coordinates=e,this.properties=t,this.type="Polygon"}},t.MapViewMultiPolygonFeature=class extends n{constructor(e,t){super(e,t),this.coordinates=e,this.properties=t,this.type="MultiPolygon"}},t.MapViewPointFeature=class extends n{constructor(e,t){super(e,t),this.coordinates=e,this.properties=t,this.type="Point"}},t.MapViewMultiPointFeature=class extends n{constructor(e,t){super(e,t),this.coordinates=e,this.properties=t,this.type="MultiPoint"}}},8015:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeaturesDataSource=void 0;const r=i(3139),n=i(2183),s=i(4742),o=n.LoggerManager.instance.create("FeaturesDataSource"),a={type:"FeatureCollection",features:[]};class l extends s.VectorTileDataSource{constructor(e){super(Object.assign(Object.assign({},e),{dataProvider:new s.GeoJsonDataProvider("user-features-datasource",a,e)})),this.m_isAttached=!1,this.m_featureCollection=this.emptyGeojson(),void 0!==e&&(void 0!==e.features&&this.add(...e.features),void 0!==e.geojson&&this.setFromGeojson(e.geojson))}setFromGeojson(e){if("FeatureCollection"===e.type)this.m_featureCollection=e;else if("Feature"===e.type)this.m_featureCollection=this.emptyGeojson(),this.m_featureCollection.features.push(e);else{if("GeometryCollection"!==e.type)throw new TypeError("The provided object is not a valid GeoJSON object.");this.m_featureCollection=this.emptyGeojson();for(const t of e.geometries)this.m_featureCollection.features.push({type:"Feature",geometry:t})}return this.update(),this}add(...e){for(const t of e)this.addFeature(t);return this.update(),this}remove(...e){for(const t of e)this.removeFeature(t);return this.update(),this}clear(){this.m_featureCollection=this.emptyGeojson(),this.update()}async connect(){await super.connect(),this.m_featureCollection.features.length>0&&await this.update()}attach(e){super.attach(e),this.m_isAttached=!0}detach(e){super.detach(e),this.m_isAttached=!1}getGeoBox(){let e;const t=t=>{const i=new r.GeoCoordinates(t[1],t[0]);void 0===e?e=new r.GeoBox(i,i.clone()):e.growToContain(i)};for(const e of this.m_featureCollection.features)switch(e.geometry.type){case"Point":t(e.geometry.coordinates);break;case"MultiPoint":case"LineString":e.geometry.coordinates.forEach(t);break;case"MultiLineString":case"Polygon":e.geometry.coordinates.forEach((e=>e.forEach(t)));break;case"MultiPolygon":e.geometry.coordinates.forEach((e=>e.forEach((e=>e.forEach(t)))))}return e}addFeature(e){if(this.m_featureCollection.features.some((t=>t.properties.__mapViewUuid===e.uuid)))return;const t={type:"Feature",geometry:{type:e.type,coordinates:e.coordinates},properties:Object.assign(Object.assign({},e.properties),{__mapViewUuid:e.uuid})};this.m_featureCollection.features.push(t)}removeFeature(e){const t=this.m_featureCollection.features.findIndex((t=>t.properties.__mapViewUuid===e.uuid));-1!==t&&this.m_featureCollection.features.splice(t,1)}async update(){const e=this.dataProvider();if(this.m_isAttached&&e.ready())try{await e.updateInput(this.m_featureCollection),this.m_isAttached&&this.mapView.markTilesDirty(this)}catch(e){o.error(`[${this.name}]: failed to update tile index`,e)}}emptyGeojson(){return{features:[],type:"FeatureCollection"}}}t.FeaturesDataSource=l},8113:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(6690),t),n(i(5408),t)},5408:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonDataProvider=void 0;var r=i(4742);Object.defineProperty(t,"GeoJsonDataProvider",{enumerable:!0,get:function(){return r.GeoJsonDataProvider}})},6690:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonDataSource=void 0;const r=i(4742);class n extends r.VectorTileDataSource{constructor(e){super(Object.assign({styleSetName:"geojson"},e))}}t.GeoJsonDataSource=n},7771:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeLengthGeometrySubdivisionModifier=t.SubdivisionMode=void 0;const r=i(3139),n=i(2183),s=i(4428),o=i(5372),a=[new s.Vector3,new s.Vector3];var l;!function(e){e[e.All=0]="All",e[e.NoDiagonals=1]="NoDiagonals"}(l=t.SubdivisionMode||(t.SubdivisionMode={}));class c extends o.SubdivisionModifier{constructor(e,t,i=l.All,s){super(),this.subdivision=e,this.geoBox=t,this.subdivisionMode=i,this.projection=s,n.assert(s.type===r.ProjectionType.Planar,"EdgeLengthGeometrySubdivisionModifier only supports planar projections");const o=s.projectPoint(t.northEast,a[0]),c=s.projectPoint(t.southWest,a[1]);this.m_projectedBox={min:{x:Math.min(o.x,c.x),y:Math.min(o.y,c.y),z:Math.min(o.z,c.z)},max:{x:Math.max(o.x,c.x),y:Math.max(o.y,c.y),z:Math.max(o.z,c.z)}},this.m_maxLengthX=(this.m_projectedBox.max.x-this.m_projectedBox.min.x)/e,this.m_maxLengthY=(this.m_projectedBox.max.y-this.m_projectedBox.min.y)/e,this.subdivisionMode===l.All&&(this.m_maxLengthX*=1.1,this.m_maxLengthY*=1.1),this.m_maxLength=Math.sqrt(this.m_maxLengthX*this.m_maxLengthX+this.m_maxLengthY*this.m_maxLengthY)}get maxLength(){return this.m_maxLength}get maxLengthX(){return this.m_maxLengthX}get maxLengthY(){return this.m_maxLengthY}shouldSplitTriangle(e,t,i){const r=this.shouldSplitEdge(e,t),n=this.shouldSplitEdge(t,i),s=this.shouldSplitEdge(i,e);if(!(r||n||s))return;const o=e.distanceTo(t),a=t.distanceTo(i),l=i.distanceTo(e),c=Math.max(r?o:0,n?a:0,s?l:0);if(o===c)return 0;if(a===c)return 1;if(l===c)return 2;throw new Error("Could not split triangle.")}shouldSplitEdge(e,t){switch(this.subdivisionMode){case l.All:return e.y===t.y&&Math.abs(e.x-t.x)>this.m_maxLengthX||e.x===t.x&&Math.abs(e.y-t.y)>this.m_maxLengthY||e.distanceTo(t)>this.m_maxLength;case l.NoDiagonals:return e.y===t.y&&Math.abs(e.x-t.x)>this.m_maxLengthX||e.x===t.x&&Math.abs(e.y-t.y)>this.m_maxLengthY}}}t.EdgeLengthGeometrySubdivisionModifier=c},7478:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphericalGeometrySubdivisionModifier=void 0;const r=i(3139),n=i(4428),s=i(5372),o=[new n.Vector3,new n.Vector3,new n.Vector3];class a extends s.SubdivisionModifier{constructor(e,t=r.sphereProjection){super(),this.angle=e,this.projection=t}shouldSplitTriangle(e,t,i){const n=r.sphereProjection.reprojectPoint(this.projection,e,o[0]),s=r.sphereProjection.reprojectPoint(this.projection,t,o[1]),a=r.sphereProjection.reprojectPoint(this.projection,i,o[2]),l=n.angleTo(s),c=s.angleTo(a),h=a.angleTo(n),d=Math.max(l,Math.max(c,h));if(!(d<this.angle)){if(d===l)return 0;if(d===c)return 1;if(d===h)return 2;throw new Error("failed to split triangle")}}}t.SphericalGeometrySubdivisionModifier=a},5372:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubdivisionModifier=void 0;const r=i(4428),n=new r.Vector3,s=new r.Vector3,o=new r.Vector3;t.SubdivisionModifier=class{constructor(){}modify(e){const t=e.getAttribute("position"),i=Array.from(t.array),r=e.getAttribute("uv"),a=void 0!==r?Array.from(r.array):void 0,l=e.getAttribute("edge"),c=void 0!==l?Array.from(l.array):void 0,h=e.getAttribute("wall"),d=void 0!==h?Array.from(h.array):void 0,u=e.getIndex(),m=Array.from(u.array),p=new Map;function f(e,t){const r=`${Math.min(e,t)}_${Math.max(e,t)}`,l=p.get(r);if(void 0!==l)return l;n.set(i[3*e],i[3*e+1],i[3*e+2]),s.set(i[3*t],i[3*t+1],i[3*t+2]),o.lerpVectors(n,s,.5);const h=i.length/3;return i.push(...o.toArray()),p.set(r,h),void 0!==a&&(n.set(a[2*e],a[2*e+1],0),s.set(a[2*t],a[2*t+1],0),o.lerpVectors(n,s,.5),a.push(o.x,o.y)),void 0!==c&&(c[e]===t?(c.push(t),c[e]=h):c[t]===e?(c.push(e),c[t]=h):c.push(-1)),void 0!==d&&(d[e]===t?(d.push(t),d[e]=h):d[t]===e?(d.push(e),d[t]=h):d.push(-1)),h}const g=[];for(;m.length>=3;){const e=m.shift(),t=m.shift(),r=m.shift();switch(n.set(i[3*e],i[3*e+1],i[3*e+2]),s.set(i[3*t],i[3*t+1],i[3*t+2]),o.set(i[3*r],i[3*r+1],i[3*r+2]),this.shouldSplitTriangle(n,s,o)){case 0:{const i=f(e,t);m.push(e,i,r,i,t,r);break}case 1:{const i=f(t,r);m.push(e,t,i,e,i,r);break}case 2:{const i=f(r,e);m.push(e,t,i,i,t,r);break}case void 0:g.push(e,t,r);break;default:throw new Error("failed to subdivide the given geometry")}}return t.array=t.array instanceof Float32Array?new Float32Array(i):new Float64Array(i),t.count=i.length/t.itemSize,t.needsUpdate=!0,e.setIndex(g),void 0!==a&&(r.array=new Float32Array(a),r.count=a.length/r.itemSize,r.needsUpdate=!0),void 0!==c&&(l.array=new Float32Array(c),l.count=c.length/l.itemSize,l.needsUpdate=!0),e}}},2931:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoBox=void 0;const r=i(4428),n=i(7073);class s{constructor(e,t){this.southWest=e,this.northEast=t,this.west>this.east&&(this.northEast.longitude+=360)}static fromCoordinates(e,t){return new s(e,t)}static fromCenterAndExtents(e,t){return new s(new n.GeoCoordinates(e.latitude-t.latitudeSpan/2,e.longitude-t.longitudeSpan/2),new n.GeoCoordinates(e.latitude+t.latitudeSpan/2,e.longitude+t.longitudeSpan/2))}get minAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.min(this.southWest.altitude,this.northEast.altitude)}get maxAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.max(this.southWest.altitude,this.northEast.altitude)}get south(){return this.southWest.latitude}get north(){return this.northEast.latitude}get west(){return this.southWest.longitude}get east(){return this.northEast.longitude}get center(){const e=.5*(this.south+this.north),{west:t,east:i}=this,{minAltitude:r,altitudeSpan:s}=this;let o;if(void 0!==r&&void 0!==s&&(o=r+.5*s),t<=i)return new n.GeoCoordinates(e,.5*(t+i),o);let a=.5*(360+i+t);return a>360&&(a-=360),new n.GeoCoordinates(e,a,o)}get latitudeSpanInRadians(){return r.MathUtils.degToRad(this.latitudeSpan)}get longitudeSpanInRadians(){return r.MathUtils.degToRad(this.longitudeSpan)}get latitudeSpan(){return this.north-this.south}get altitudeSpan(){if(void 0!==this.maxAltitude&&void 0!==this.minAltitude)return this.maxAltitude-this.minAltitude}get longitudeSpan(){let e=this.northEast.longitude-this.southWest.longitude;return e<0&&(e+=360),e}get latitudeSpanInDegrees(){return this.latitudeSpan}get longitudeSpanInDegrees(){return this.longitudeSpan}contains(e){if(void 0===e.altitude||void 0===this.minAltitude||void 0===this.maxAltitude)return this.containsHelper(e);const t=this.minAltitude===this.maxAltitude,i=this.minAltitude===e.altitude,r=this.minAltitude<=e.altitude&&this.maxAltitude>e.altitude;return!!(t?i:r)&&this.containsHelper(e)}clone(){return new s(this.southWest.clone(),this.northEast.clone())}growToContain(e){this.southWest.latitude=Math.min(this.southWest.latitude,e.latitude),this.southWest.longitude=Math.min(this.southWest.longitude,e.longitude),this.southWest.altitude=void 0!==this.southWest.altitude&&void 0!==e.altitude?Math.min(this.southWest.altitude,e.altitude):void 0!==this.southWest.altitude?this.southWest.altitude:void 0!==e.altitude?e.altitude:void 0,this.northEast.latitude=Math.max(this.northEast.latitude,e.latitude),this.northEast.longitude=Math.max(this.northEast.longitude,e.longitude),this.northEast.altitude=void 0!==this.northEast.altitude&&void 0!==e.altitude?Math.max(this.northEast.altitude,e.altitude):void 0!==this.northEast.altitude?this.northEast.altitude:void 0!==e.altitude?e.altitude:void 0}containsHelper(e){if(e.latitude<this.southWest.latitude||e.latitude>=this.northEast.latitude)return!1;const{west:t,east:i}=this;let r=e.longitude;if(i>n.MAX_LONGITUDE)for(;r<t;)r+=360;if(r>i)for(;r>t+360;)r-=360;return r>=t&&r<i}}t.GeoBox=s},1754:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoBoxExtentLike=void 0,t.isGeoBoxExtentLike=function(e){return e&&"object"==typeof e&&"number"==typeof e.latitudeSpan&&"number"==typeof e.longitudeSpan}},4908:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordLike=t.geoCoordLikeToGeoPointLike=t.geoCoordLikeToGeoCoordinatesLike=void 0;const r=i(7466),n=i(6233),s=i(6373);t.geoCoordLikeToGeoCoordinatesLike=function(e){return r.isGeoCoordinatesLike(e)?e:s.isLatLngLike(e)?{latitude:e.lat,longitude:e.lng}:{latitude:e[1],longitude:e[0]}},t.geoCoordLikeToGeoPointLike=function(e){return n.isGeoPointLike(e)?e:s.isLatLngLike(e)?[e.lng,e.lat]:[e.longitude,e.latitude]},t.isGeoCoordLike=function(e){return r.isGeoCoordinatesLike(e)||s.isLatLngLike(e)||!n.isGeoPointLike(e)}},7073:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoCoordinates=t.MIN_LONGITUDE=t.MAX_LONGITUDE=t.MIN_LATITUDE=t.MAX_LATITUDE=void 0;const r=i(4428),n=i(7466),s=i(6233),o=i(6373);t.MAX_LATITUDE=90,t.MIN_LATITUDE=-90,t.MAX_LONGITUDE=180,t.MIN_LONGITUDE=-180;const a=new r.Vector3,l=new r.Vector3;class c{constructor(e,t,i){this.latitude=e,this.longitude=t,this.altitude=i}static fromDegrees(e,t,i){return new c(e,t,i)}static fromRadians(e,t,i){return new c(r.MathUtils.radToDeg(e),r.MathUtils.radToDeg(t),i)}static fromLatLng(e){return new c(e.lat,e.lng)}static fromGeoPoint(e){return new c(e[1],e[0],e[2])}static fromObject(e){if(s.isGeoPointLike(e))return c.fromGeoPoint(e);if(n.isGeoCoordinatesLike(e))return c.fromDegrees(e.latitude,e.longitude,e.altitude);if(o.isLatLngLike(e))return c.fromDegrees(e.lat,e.lng);throw new Error("Invalid input coordinate format.")}static lerp(e,t,i,r=!1,n=!1){var s,o;if(r){if(e.lng<t.lng){const r=e.clone();return r.longitude+=360,this.lerp(t,r,1-i)}{const r=t.clone();return r.longitude+=360,this.lerp(e,r,i)}}const h=a.set(e.lat,e.lng,null!==(s=e.altitude)&&void 0!==s?s:0),d=l.set(t.lat,t.lng,null!==(o=t.altitude)&&void 0!==o?o:0);h.lerp(d,i);const u=new c(h.x,h.y,h.z);return n?u.normalized():u}get latitudeInRadians(){return r.MathUtils.degToRad(this.latitude)}get longitudeInRadians(){return r.MathUtils.degToRad(this.longitude)}get latitudeInDegrees(){return this.latitude}get longitudeInDegrees(){return this.longitude}get lat(){return this.latitude}get lng(){return this.longitude}isValid(){return!isNaN(this.latitude)&&!isNaN(this.longitude)}normalized(){let{latitude:e,longitude:t}=this;return isNaN(e)||isNaN(t)?this:((t<-180||t>180)&&(t=function(e,t){const i=e%360;return i<0==0?i:i+360}(t+180)-180),e=r.MathUtils.clamp(e,-90,90),new c(e,t,this.altitude))}equals(e){return this.latitude===e.latitude&&this.longitude===e.longitude&&this.altitude===e.altitude}copy(e){return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this}clone(){return new c(this.latitude,this.longitude,this.altitude)}toLatLng(){return{lat:this.latitude,lng:this.longitude}}toGeoPoint(){return void 0!==this.altitude?[this.longitude,this.latitude,this.altitude]:[this.longitude,this.latitude]}minLongitudeSpanTo(e){const t=Math.min(this.longitude,e.longitude),i=Math.max(this.longitude,e.longitude);return Math.min(i-t,360+t-i)}}t.GeoCoordinates=c},7466:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordinatesLike=void 0,t.isGeoCoordinatesLike=function(e){return e&&"number"==typeof e.latitude&&"number"==typeof e.longitude&&("number"==typeof e.altitude||void 0===e.altitude)}},6233:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoPointLike=void 0,t.isGeoPointLike=function(e){if(Array.isArray(e)){const[t,i,r]=e;return"number"==typeof t&&"number"==typeof i&&(void 0===r||"number"==typeof r)}return!1}},2779:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoPolygon=t.isAntimeridianCrossing=void 0;const r=i(4428),n=i(2931),s=i(7073),o=i(4908);function a(e,t){return Math.max(e,t)-Math.min(e,t)}function l(e,t){return e>0&&t<0&&a(e,t)>180}t.isAntimeridianCrossing=function(e,t){return Math.sign(e)===-Math.sign(t)&&a(e,t)>180},t.GeoPolygon=class{constructor(e,t=!1,i=!1){this.m_coordinates=e.map((e=>o.geoCoordLikeToGeoCoordinatesLike(e))),t&&this.sortCCW(),i&&this.wrapCoordinatesAround()}get coordinates(){return this.m_coordinates}getGeoBoundingBox(){const e=this.getCentroid();if(void 0===e)return n.GeoBox.fromCoordinates(this.coordinates[0],this.coordinates[0]);const{east:t,west:i}=this.getEastAndWest(e),{north:r,south:o}=this.getNorthAndSouth();return n.GeoBox.fromCoordinates(new s.GeoCoordinates(o,i),new s.GeoCoordinates(r,t))}getCentroid(){const e=this.getArea();if(0===e)return;let t,i=0,r=0,n=this.m_coordinates.length-1;return this.m_coordinates.forEach(((e,s)=>{const o=this.m_coordinates[n];t=e.latitude*o.longitude-o.latitude*e.longitude,i+=(e.latitude+o.latitude)*t,r+=(e.longitude+o.longitude)*t,n=s})),t=6*e,new s.GeoCoordinates(i/t,e<0?r/t-180:r/t)}sortCCW(){const e=this.getPolyAverageCenter();e&&this.m_coordinates.sort(((t,i)=>{const n=new r.Vector2(t.latitude-e.latitude,t.longitude-e.longitude).normalize();return new r.Vector2(i.latitude-e.latitude,i.longitude-e.longitude).normalize().angle()-n.angle()}))}wrapCoordinatesAround(){const e=this.m_coordinates.findIndex(((e,t)=>{const i=0===t?this.m_coordinates.length-1:t-1;return l(this.m_coordinates[i].longitude,e.longitude)}));if(e<0)return;let t=!0;for(let i=0;i<this.m_coordinates.length;i++){const r=(e+i)%this.m_coordinates.length,n=this.m_coordinates[r].longitude,s=this.m_coordinates[(r+1)%this.m_coordinates.length].longitude;t&&(this.m_coordinates[r].longitude+=360),l(s,n)?t=!1:l(n,s)&&(t=!0)}}getPolyAverageCenter(){const e=this.m_coordinates.reduce(((e,t)=>new s.GeoCoordinates(e.latitude+t.latitude,e.longitude+t.longitude)));return new s.GeoCoordinates(e.latitude/this.m_coordinates.length,e.longitude/this.m_coordinates.length)}getArea(){let e=0,t=this.m_coordinates.length-1;return this.m_coordinates.forEach(((i,r)=>{const n=this.m_coordinates[t];e+=i.latitude*n.longitude,e-=i.longitude*n.latitude,t=r})),e/=2}getEastAndWest(e){let t=e.longitude,i=e.longitude,n=this.m_coordinates.length-1;return this.m_coordinates.forEach(((s,o)=>{const a=this.m_coordinates[n];n=o;const l=new r.Vector2(s.latitude-e.latitude,s.longitude-e.longitude).normalize(),c=new r.Vector2(a.latitude-e.latitude,a.longitude-e.longitude).normalize();let h=1===Math.sign(c.angle()-l.angle());c.y>=0&&l.y<0&&(h=!0);const d=s.longitude;d<e.longitude?h?t=Math.min(t,d):i=Math.min(i,d):h?i=Math.max(i,d):t=Math.max(t,d)})),{east:i,west:t}}getNorthAndSouth(){let e=s.MIN_LATITUDE,t=s.MAX_LATITUDE;return this.m_coordinates.forEach(((i,r)=>{e=Math.max(e,i.latitude),t=Math.min(t,i.latitude)})),{north:e,south:t}}}},2553:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoPolygonLike=void 0;const r=i(4908);t.isGeoPolygonLike=function(e){if(!e||!Array.isArray(e.coordinates)&&e.coordinates.length>2)return!1;let t=!0;return e.coordinates.forEach((i=>{r.isGeoCoordLike(e)||(t=!1)})),t}},6373:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLatLngLike=void 0,t.isLatLngLike=function(e){return e&&"number"==typeof e.lat&&"number"==typeof e.lng}},8909:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBox3Like=void 0,t.isBox3Like=function(e){const t=e;return void 0!==t.min&&void 0!==t.max}},6256:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathUtils=void 0;const r=i(4428);!function(e){function t(e){return(e%=360)<0&&(e+=360),e}function i(e,i){const r=(e=t(e))-(i=t(i));return r>180?r-360:r<=-180?r+360:r}e.newEmptyBox3=function(){return{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}},e.newVector3=function(e,t,i,r){return void 0===r?{x:e,y:t,z:i}:(r.x=e,r.y=t,r.z=i,r)},e.copyVector3=function(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t},e.degToRad=r.MathUtils.degToRad,e.radToDeg=r.MathUtils.radToDeg,e.clamp=r.MathUtils.clamp,e.normalizeAngleDeg=t,e.normalizeLongitudeDeg=function(e){return(e=t(e))>180&&(e-=360),e},e.angleDistanceDeg=i,e.interpolateAnglesDeg=function(e,t,r){return(e+i(t,e)*r)%360}}(t.MathUtils||(t.MathUtils={}))},8703:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrientedBox3=void 0;const r=i(4428);function n(e,t,i,r,n){const s=i.dot(t),o=i.dot(e);if(Math.abs(o)<1e-20)return Math.abs(s)<=r;const a=1/o,l=(s+r)*a,c=(s-r)*a;return l>c?(c>n.min&&(n.min=c),l<n.max&&(n.max=l)):(l>n.min&&(n.min=l),c<n.max&&(n.max=c)),n.min<=n.max&&n.max>=0}const s=new r.Vector3,o={min:-1/0,max:1/0};class a{constructor(e,t,i){this.position=new r.Vector3,this.xAxis=new r.Vector3(1,0,0),this.yAxis=new r.Vector3(0,1,0),this.zAxis=new r.Vector3(0,0,1),this.extents=new r.Vector3,void 0!==e&&this.position.copy(e),void 0!==t&&t.extractBasis(this.xAxis,this.yAxis,this.zAxis),void 0!==i&&this.extents.copy(i)}clone(){const e=new a;return e.copy(this),e}copy(e){this.position.copy(e.position),this.xAxis.copy(e.xAxis),this.yAxis.copy(e.yAxis),this.zAxis.copy(e.zAxis),this.extents.copy(e.extents)}getCenter(e=new r.Vector3){return e.copy(this.position)}getSize(e=new r.Vector3){return e.copy(this.extents).multiplyScalar(2)}getRotationMatrix(e=new r.Matrix4){return e.makeBasis(this.xAxis,this.yAxis,this.zAxis)}intersects(e){const t=Array.isArray(e)?e:e.planes;for(const e of t){const t=Math.abs(e.normal.dot(this.xAxis)*this.extents.x)+Math.abs(e.normal.dot(this.yAxis)*this.extents.y)+Math.abs(e.normal.dot(this.zAxis)*this.extents.z);if(e.distanceToPoint(this.position)+t<0)return!1}return!0}intersectsRay(e){if(o.min=-1/0,o.max=1/0,s.copy(this.position).sub(e.origin),n(e.direction,s,this.xAxis,this.extents.x,o)&&n(e.direction,s,this.yAxis,this.extents.y,o)&&n(e.direction,s,this.zAxis,this.extents.z,o))return o.min>0?o.min:o.max}contains(e){const t=e.x-this.position.x,i=e.y-this.position.y,r=e.z-this.position.z,n=Math.abs(t*this.xAxis.x+i*this.xAxis.y+r*this.xAxis.z),s=Math.abs(t*this.yAxis.x+i*this.yAxis.y+r*this.yAxis.z),o=Math.abs(t*this.zAxis.x+i*this.zAxis.y+r*this.zAxis.z);return!(n>this.extents.x||s>this.extents.y||o>this.extents.z)}distanceToPoint(e){return Math.sqrt(this.distanceToPointSquared(e))}distanceToPointSquared(e){const t=new r.Vector3;t.subVectors(e,this.position);const i=[t.dot(this.xAxis),t.dot(this.yAxis),t.dot(this.zAxis)];let n=0;for(let e=0;e<3;++e){const t=i[e],r=this.extents.getComponent(e);if(t<-r){const e=r+t;n+=e*e}else if(t>r){const e=t-r;n+=e*e}}return n}}t.OrientedBox3=a},2076:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOrientedBox3Like=void 0,t.isOrientedBox3Like=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis&&void 0!==t.extents}},463:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isTransformLike=void 0,t.isTransformLike=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis}},5644:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector2Like=void 0,t.isVector2Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y}},4222:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector3Like=void 0,t.isVector3Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z}},9881:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EarthConstants=void 0;class i{}t.EarthConstants=i,i.EQUATORIAL_CIRCUMFERENCE=40075016.68557849,i.EQUATORIAL_RADIUS=6378137,i.MIN_ELEVATION=-433,i.MAX_ELEVATION=8848,i.MAX_BUILDING_HEIGHT=828},120:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.equirectangularProjection=t.normalizedEquirectangularProjection=void 0;const r=i(4428),n=i(2931),s=i(7073),o=i(8909),a=i(6256),l=i(2076),c=i(9881),h=i(8816);class d extends h.Projection{constructor(){super(...arguments),this.type=h.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,i){return i||(i=new r.Box3),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale/2,i.max.z=t,i}projectPoint(e,t){var i;return void 0===t&&(t={x:0,y:0,z:0}),t.x=(r.MathUtils.degToRad(e.longitude)+Math.PI)*d.geoToWorldScale*this.unitScale,t.y=(r.MathUtils.degToRad(e.latitude)+.5*Math.PI)*d.geoToWorldScale*this.unitScale,t.z=null!==(i=e.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){return s.GeoCoordinates.fromRadians(e.y*d.worldToGeoScale/this.unitScale-.5*Math.PI,e.x*d.worldToGeoScale/this.unitScale-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){const i=this.projectPoint(new s.GeoCoordinates(e.center.latitude,e.center.longitude,0)),{latitudeSpanInRadians:n,longitudeSpanInRadians:c,altitudeSpan:h}=e,u=c*d.geoToWorldScale,m=n*d.geoToWorldScale;return t||(t=new r.Box3),o.isBox3Like(t)?(t.min.x=i.x-.5*u*this.unitScale,t.min.y=i.y-.5*m*this.unitScale,t.max.x=i.x+.5*u*this.unitScale,t.max.y=i.y+.5*m*this.unitScale,void 0!==h?(t.min.z=i.z-.5*h,t.max.z=i.z+.5*h):(t.min.z=0,t.max.z=0)):l.isOrientedBox3Like(t)&&(a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=i.x,t.position.y=i.y,t.position.z=i.z,t.extents.x=.5*u*this.unitScale,t.extents.y=.5*m*this.unitScale,t.extents.z=Math.max(Number.EPSILON,.5*(null!=h?h:0))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return n.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}d.geoToWorldScale=1/(2*Math.PI),d.worldToGeoScale=2*Math.PI/1,t.normalizedEquirectangularProjection=new d(1),t.equirectangularProjection=new d(c.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},7746:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.identityProjection=void 0;const r=i(4428),n=i(2931),s=i(7073),o=i(8909),a=i(6256),l=i(2076),c=i(8816);class h extends c.Projection{constructor(){super(...arguments),this.type=c.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,i){return i||(i=new r.Box3),i.min.x=-Math.PI,i.min.y=.5*-Math.PI,i.min.z=e,i.max.x=Math.PI,i.max.y=.5*Math.PI,i.max.z=t,i}projectPoint(e,t){var i;return t||(t={x:0,y:0,z:0}),t.x=r.MathUtils.degToRad(e.longitude),t.y=r.MathUtils.degToRad(e.latitude),t.z=null!==(i=e.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){return s.GeoCoordinates.fromRadians(e.y,e.x,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){t||(t=new r.Box3);const i=this.projectPoint(new s.GeoCoordinates(e.south,e.west,e.minAltitude)),n=this.projectPoint(new s.GeoCoordinates(e.north,e.east,e.maxAltitude));return o.isBox3Like(t)?(t.min.x=i.x,t.min.y=i.y,t.min.z=i.z,t.max.x=n.x,t.max.y=n.y,t.max.z=n.z):l.isOrientedBox3Like(t)&&(a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(i.x+n.x),t.position.y=.5*(i.y+n.y),t.position.z=.5*(i.z+n.z),t.extents.x=.5*(n.x-i.x),t.extents.y=.5*(n.y-i.y),t.extents.z=Math.max(Number.EPSILON,.5*(n.z-i.z))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return n.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}t.identityProjection=new h(1)},1404:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webMercatorProjection=t.mercatorProjection=t.MercatorConstants=void 0;const r=i(4428),n=i(2931),s=i(7073),o=i(7466),a=i(8909),l=i(6256),c=i(2076),h=i(9881),d=i(8816);class u extends d.Projection{constructor(){super(...arguments),this.type=d.ProjectionType.Planar}static clamp(e,t,i){return Math.min(Math.max(t,e),i)}static latitudeClamp(e){return u.clamp(e,-m.MAXIMUM_LATITUDE,m.MAXIMUM_LATITUDE)}static latitudeProject(e){return Math.log(Math.tan(.25*Math.PI+.5*e))/Math.PI}static latitudeClampProject(e){return u.latitudeProject(u.latitudeClamp(e))}static unprojectLatitude(e){return 2*Math.atan(Math.exp(Math.PI*e))-.5*Math.PI}getScaleFactor(e){return Math.cosh(2*Math.PI*(e.y/this.unitScale-.5))}worldExtent(e,t,i){return i||(i=new r.Box3),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale,i.max.z=t,i}projectPoint(e,t){var i;let r;return r=e instanceof s.GeoCoordinates?e:new s.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(r.longitude+180)/360*this.unitScale,t.y=(.5*u.latitudeClampProject(r.latitudeInRadians)+.5)*this.unitScale,t.z=null!==(i=r.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){return s.GeoCoordinates.fromRadians(u.unprojectLatitude(2*(e.y/this.unitScale-.5)),e.x/this.unitScale*2*Math.PI-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){var i;const n=this.projectPoint(e.center),s=(.5*u.latitudeClampProject(e.northEast.latitudeInRadians)+.5)*this.unitScale,o=(.5*u.latitudeClampProject(e.southWest.latitudeInRadians)+.5)*this.unitScale,h=.5*(s+o);n.y=h;const d=s-o,m=e.longitudeSpan/360*this.unitScale;if(t||(t=new r.Box3),a.isBox3Like(t)){t.min.x=n.x-.5*m,t.min.y=n.y-.5*d,t.max.x=n.x+.5*m,t.max.y=n.y+.5*d;const i=e.altitudeSpan;void 0!==i?(t.min.z=n.z-.5*i,t.max.z=n.z+.5*i):(t.min.z=0,t.max.z=0)}else{if(!c.isOrientedBox3Like(t))throw new Error("invalid bounding box");l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,1,0,t.yAxis),l.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=n.x,t.position.y=n.y,t.position.z=n.z,t.extents.x=.5*m,t.extents.y=.5*d,t.extents.z=Math.max(Number.EPSILON,.5*(null!==(i=e.altitudeSpan)&&void 0!==i?i:0))}return t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return n.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}reprojectPoint(e,i,r){return e===this||e!==t.webMercatorProjection&&e!==t.mercatorProjection?super.reprojectPoint(e,i,r):(void 0===r&&(r={}),r.x=i.x,r.y=this.unitScale-i.y,r.z=i.z,r)}}class m{}t.MercatorConstants=m,m.MAXIMUM_LATITUDE=1.4844222297453322,t.mercatorProjection=new u(h.EarthConstants.EQUATORIAL_CIRCUMFERENCE),t.webMercatorProjection=new class extends u{projectPoint(e,t){var i;let r;r=e instanceof s.GeoCoordinates?e:new s.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(r.longitude+180)/360*this.unitScale;const n=Math.sin(u.latitudeClamp(r.latitudeInRadians));return t.y=(.5-Math.log((1+n)/(1-n))/(4*Math.PI))*this.unitScale,t.z=null!==(i=r.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){const t=e.x/this.unitScale-.5,i=.5-e.y/this.unitScale,r=360*t,n=90-360*Math.atan(Math.exp(2*-i*Math.PI))/Math.PI;return new s.GeoCoordinates(n,r,e.z)}projectBox(e,t){const i=super.projectBox(e,t);if(a.isBox3Like(i)){const e=i.max.y;i.max.y=this.unitScale-i.min.y,i.min.y=this.unitScale-e}else c.isOrientedBox3Like(i)&&(l.MathUtils.newVector3(1,0,0,i.xAxis),l.MathUtils.newVector3(0,-1,0,i.yAxis),l.MathUtils.newVector3(0,0,-1,i.zAxis),i.position.y=this.unitScale-i.position.y);return i}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return new n.GeoBox(new s.GeoCoordinates(i.latitude,t.longitude,t.altitude),new s.GeoCoordinates(t.latitude,i.longitude,i.altitude))}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}localTangentSpace(e,t){return o.isGeoCoordinatesLike(e)?this.projectPoint(e,t.position):l.MathUtils.copyVector3(e,t.position),l.MathUtils.newVector3(1,0,0,t.xAxis),l.MathUtils.newVector3(0,-1,0,t.yAxis),l.MathUtils.newVector3(0,0,-1,t.zAxis),t}}(h.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},8816:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Projection=t.ProjectionType=void 0;const r=i(7466),n=i(6256);var s;(s=t.ProjectionType||(t.ProjectionType={}))[s.Planar=0]="Planar",s[s.Spherical=1]="Spherical",t.Projection=class{constructor(e){this.unitScale=e}localTangentSpace(e,t){return r.isGeoCoordinatesLike(e)?this.projectPoint(e,t.position):n.MathUtils.copyVector3(e,t.position),n.MathUtils.newVector3(1,0,0,t.xAxis),n.MathUtils.newVector3(0,1,0,t.yAxis),n.MathUtils.newVector3(0,0,1,t.zAxis),t}reprojectPoint(e,t,i){return e===this?void 0===i?{x:t.x,y:t.y,z:t.z}:(i.x=t.x,i.y=t.y,i.z=t.z,i):this.projectPoint(e.unprojectPoint(t),i)}}},8457:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sphereProjection=void 0;const r=i(4428),n=i(7073),s=i(7466),o=i(8909),a=i(6256),l=i(2076),c=i(9881),h=i(1404),d=i(8816);function u(e){const t=1/Math.PI,i=Math.floor(2*(e*t+1));return r.MathUtils.clamp(i,0,4)}function m(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}function p(e,t,i){var n;const s=.5*(i+(null!==(n=e.maxAltitude)&&void 0!==n?n:0)),o=r.MathUtils.degToRad(e.west),a=r.MathUtils.degToRad(e.east),l=u(o),c=u(a);let h=Math.cos(o),d=h,m=Math.sin(o),p=m;for(let e=l+1;e<=c;e++){const t=(e+1&1)*((2&e)-1);h=Math.min(t,h),d=Math.max(t,d);const i=(1&e)*((2&e)-1);m=Math.min(i,m),p=Math.max(i,p)}const f=Math.cos(a);h=Math.min(f,h),d=Math.max(f,d);const g=Math.sin(a);m=Math.min(g,m),p=Math.max(g,p);const v=(d+h)*s,_=(d-h)*s,y=(p+m)*s,x=(p-m)*s,b=r.MathUtils.degToRad(e.south),T=r.MathUtils.degToRad(e.north),w=Math.sin(T),S=Math.sin(b),M=(w+S)*s,E=(w-S)*s;return t.min.x=v-_,t.min.y=y-x,t.min.z=M-E,t.max.x=v+_,t.max.y=y+x,t.max.z=M+E,t}class f extends d.Projection{constructor(){super(...arguments),this.type=d.ProjectionType.Spherical}worldExtent(e,t,i=new r.Box3){const n=this.unitScale+t;return i.min.x=-n,i.min.y=-n,i.min.z=-n,i.max.x=n,i.max.y=n,i.max.z=n,i}projectPoint(e,t=a.MathUtils.newVector3(0,0,0)){return function(e,t,i){var n;const s=i+(null!==(n=e.altitude)&&void 0!==n?n:0),o=r.MathUtils.degToRad(e.latitude),a=r.MathUtils.degToRad(e.longitude),l=Math.cos(o);return t.x=s*l*Math.cos(a),t.y=s*l*Math.sin(a),t.z=s*Math.sin(o),t}(e,t,this.unitScale)}unprojectPoint(e){const t=e.x*e.x+e.y*e.y,i=Math.sqrt(t),r=e.z/i;if(isNaN(r))return n.GeoCoordinates.fromRadians(0,0,-this.unitScale);const s=Math.sqrt(t+e.z*e.z);return n.GeoCoordinates.fromRadians(Math.atan(r),Math.atan2(e.y,e.x),s-this.unitScale)}unprojectAltitude(e){const t=e.x*e.x+e.y*e.y+e.z*e.z;return Math.sqrt(t)-c.EarthConstants.EQUATORIAL_RADIUS}projectBox(e,t=new r.Box3){var i,n;if(o.isBox3Like(t))return p(e,t,this.unitScale);if(l.isOrientedBox3Like(t)){if(e.longitudeSpan>=90){const i=p(e,new r.Box3,this.unitScale);return a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(i.max.x+i.min.x),t.position.y=.5*(i.max.y+i.min.y),t.position.z=.5*(i.max.z+i.min.z),t.extents.x=.5*(i.max.x-i.min.x),t.extents.y=.5*(i.max.y-i.min.y),t.extents.z=.5*(i.max.z-i.min.z),t}const{south:s,west:o,north:l,east:c,center:h}=e,d=h.longitude,u=h.latitude,m=Math.cos(r.MathUtils.degToRad(s)),f=Math.sin(r.MathUtils.degToRad(s)),g=Math.cos(r.MathUtils.degToRad(o)),v=Math.sin(r.MathUtils.degToRad(o)),_=Math.cos(r.MathUtils.degToRad(l)),y=Math.sin(r.MathUtils.degToRad(l)),x=Math.cos(r.MathUtils.degToRad(c)),b=Math.sin(r.MathUtils.degToRad(c)),T=Math.cos(r.MathUtils.degToRad(d)),w=Math.sin(r.MathUtils.degToRad(d)),S=Math.cos(r.MathUtils.degToRad(u)),M=Math.sin(r.MathUtils.degToRad(u));let E,P,C;a.MathUtils.newVector3(T*S,w*S,M,t.zAxis),a.MathUtils.newVector3(-w,T,0,t.xAxis),a.MathUtils.newVector3(-T*M,-w*M,S,t.yAxis),s>=0?(E=Math.abs(m*(T*(v-b)+w*(x-g))),P=S*f-M*m,C=S*y-M*_*(T*x+w*b)):(l<=0?(E=Math.abs(_*(T*(v-b)+w*(x-g))),C=S*y-M*_):(E=Math.abs(T*(v-b)+w*(x-g)),C=S*y-M*_*(w*b+T*x)),P=S*f-M*m*(T*x+w*b));const A=.5*(this.unitScale+(null!==(i=e.maxAltitude)&&void 0!==i?i:0)),L=.5*(this.unitScale+(null!==(n=e.minAltitude)&&void 0!==n?n:0)),R=S*(T*x+w*b),D=Math.min(_*R+y*M,m*R+f*M);return a.MathUtils.newVector3(E*A,(C-P)*A,A-D*L,t.extents),a.MathUtils.newVector3(0,(P+C)*A,A+A,t.position),function(e,t,i,r){const n=e.x*r.x+t.x*r.y+i.x*r.z,s=e.y*r.x+t.y*r.y+i.y*r.z,o=e.z*r.x+t.z*r.y+i.z*r.z;r.x=n,r.y=s,r.z=o}(t.xAxis,t.yAxis,t.zAxis,t.position),t.position.x=t.position.x-t.zAxis.x*t.extents.z,t.position.y=t.position.y-t.zAxis.y*t.extents.z,t.position.z=t.position.z-t.zAxis.z*t.extents.z,t}throw new Error("Invalid bounding box")}unprojectBox(e){throw new Error("Method not implemented.")}getScaleFactor(e){return 1}groundDistance(e){return m(e)-this.unitScale}scalePointToSurface(e){const t=this.unitScale/(m(e)||1);return e.x*=t,e.y*=t,e.z*=t,e}surfaceNormal(e,t){void 0===t&&(t={x:0,y:0,z:0});const i=1/(m(e)||1);return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t}reprojectPoint(e,t,i){if(e===h.mercatorProjection||e===h.webMercatorProjection){const{x:r,y:n,z:s}=t,o=this.unitScale,a=r/o-Math.PI,l=n/o-Math.PI,c=Math.exp(l),d=c*c,u=2*c/(d+1),m=(d-1)/(d+1),p=o+s;return void 0===i&&(i={}),i.x=Math.cos(a)*u*p,i.y=Math.sin(a)*u*p,i.z=m*p,e===h.webMercatorProjection&&(i.z=-i.z),i}return super.reprojectPoint(e,t,i)}localTangentSpace(e,t){let i;s.isGeoCoordinatesLike(e)?(this.projectPoint(e,t.position),i=e):(a.MathUtils.copyVector3(e,t.position),i=this.unprojectPoint(e));const n=r.MathUtils.degToRad(i.latitude),o=r.MathUtils.degToRad(i.longitude),l=Math.cos(o),c=Math.sin(o),h=Math.cos(n),d=Math.sin(n);return a.MathUtils.newVector3(l*h,c*h,d,t.zAxis),a.MathUtils.newVector3(-c,l,0,t.xAxis),a.MathUtils.newVector3(-l*d,-c*d,h,t.yAxis),t}}t.sphereProjection=new f(c.EarthConstants.EQUATORIAL_RADIUS)},115:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transverseMercatorProjection=t.TransverseMercatorUtils=void 0;const r=i(4428),n=i(2931),s=i(7073),o=i(8909),a=i(6256),l=i(2076),c=i(9881),h=i(8816);class d extends h.Projection{constructor(e){super(e),this.unitScale=e,this.type=h.ProjectionType.Planar,this.m_phi0=0,this.m_lambda0=0}static clampGeoPoint(e,t){const i=e.latitude,r=e.longitude,n=u.POLE_RADIUS,o=u.POLE_RADIUS_SQ,a=Math.round(r/90),l=90*a-r;if(a%2==0||Math.abs(l)>n)return e;const c=i-0,h=l*l+c*c;if(h<o){const e=Math.sqrt(h),t=(n-e)/e,o=1,a=0===l&&0===c?n*o:l;return new s.GeoCoordinates(i+c*t,r+a*t)}return e}getScaleFactor(e){return Math.cosh(2*(e.x/this.unitScale-.5)*Math.PI)}worldExtent(e,t,i){return i||(i=new r.Box3),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale,i.max.z=t,i}projectPoint(e,t){var i;t||(t={x:0,y:0,z:0});const n=d.clampGeoPoint(e,this.unitScale),s=n.longitude/360+.5,o=1===s?0:Math.floor(s),a=r.MathUtils.degToRad(n.latitude),l=r.MathUtils.degToRad(n.longitude-360*o)-this.m_lambda0,c=Math.cos(a)*Math.sin(l);t.x=Math.atanh(c),t.y=Math.atan2(Math.tan(a),Math.cos(l))-this.m_phi0;const h=.5/Math.PI;return t.x=this.unitScale*(r.MathUtils.clamp(t.x*h+.5,0,1)+o),t.y=this.unitScale*r.MathUtils.clamp(t.y*h+.5,0,1),t.z=null!==(i=e.altitude)&&void 0!==i?i:0,t}unprojectPoint(e){const t=2*Math.PI,i=e.x/this.unitScale,r=e.y/this.unitScale,n=1===i?0:Math.floor(i),o=t*(i-.5-n),a=t*(r-.5),l=e.z||0,c=a+this.m_phi0,h=Math.asin(Math.sin(c)/Math.cosh(o)),d=this.m_lambda0+Math.atan2(Math.sinh(o),Math.cos(c))+n*t;return s.GeoCoordinates.fromRadians(h,d,l)}projectBox(e,t){const{north:i,south:n,east:c,west:h}=e,d=[e.center,e.northEast,e.southWest,new s.GeoCoordinates(n,c),new s.GeoCoordinates(i,h)],m=u.POLE_EDGE_DEG,p=h<90&&c>90,f=h<0&&c>0,g=h<m&&c>-m&&i>0&&n<0;h<-90&&c>-90&&(d.push(new s.GeoCoordinates(i,-90)),d.push(new s.GeoCoordinates(n,-90))),p&&(d.push(new s.GeoCoordinates(i,90)),d.push(new s.GeoCoordinates(n,90))),f&&(d.push(new s.GeoCoordinates(i,0)),d.push(new s.GeoCoordinates(n,0))),g&&(d.push(new s.GeoCoordinates(0,h)),d.push(new s.GeoCoordinates(0,c))),u.alignLatitude(d,d[0]);const v=d.map((e=>this.projectPoint(e))),_=v.map((e=>e.x)),y=v.map((e=>e.y)),x=v.map((e=>e.z)),b=Math.min(..._),T=Math.min(...y),w=Math.min(...x),S=Math.max(..._),M=Math.max(...y),E=Math.max(...x);if(t||(t=new r.Box3),o.isBox3Like(t))t.min.x=b,t.min.y=T,t.min.z=w,t.max.x=S,t.max.y=M,t.max.z=E;else{if(!l.isOrientedBox3Like(t))throw new Error("invalid bounding box");a.MathUtils.newVector3(1,0,0,t.xAxis),a.MathUtils.newVector3(0,1,0,t.yAxis),a.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=(b+S)/2,t.position.y=(T+M)/2,t.position.z=(w+E)/2,t.extents.x=(S-b)/2,t.extents.y=(M-T)/2,t.extents.z=(E-w)/2}return t}unprojectBox(e){const t=this.unitScale,i=e.min,r=e.max,o=[{x:(i.x+r.x)/2,y:(i.y+r.y)/2,z:0},i,r,{x:i.x,y:r.y,z:0},{x:r.x,y:i.y,z:0}],a=.5*t,l=.25*t,c=.75*t,h=i.x<a&&r.x>a,d=i.y<a&&r.y>a,m=i.y<l&&r.y>l,p=i.y<c&&r.y>c;d&&(o.push({x:i.x,y:a,z:0}),o.push({x:r.x,y:a,z:0}),h&&o.push({x:a,y:a,z:0})),m&&(o.push({x:i.x,y:l,z:0}),o.push({x:r.x,y:l,z:0}),h&&o.push({x:a,y:l,z:0})),p&&(o.push({x:i.x,y:c,z:0}),o.push({x:r.x,y:c,z:0}),h&&o.push({x:a,y:c,z:0}));const f=o.map((e=>this.unprojectPoint(e)));u.alignLongitude(f,f[0]);const g=f.map((e=>e.latitude)),v=f.filter((e=>Math.abs(e.latitude)<90)).map((e=>e.longitude)),_=f.map((e=>{var t;return null!==(t=e.altitude)&&void 0!==t?t:0})),y=new s.GeoCoordinates(Math.min(...g),Math.min(...v),Math.min(..._)),x=new s.GeoCoordinates(Math.max(...g),Math.max(...v),Math.max(..._));return n.GeoBox.fromCoordinates(y,x)}unprojectAltitude(e){return e.z}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}}class u{static alignLatitude(e,t){for(const i of e)0===i.latitude&&(i.latitude=1e-9*t.latitude)}static alignLongitude(e,t){const i=t.longitude<0?180:-180,r=t.longitude<0?-180:180;for(const t of e)t.longitude===i&&(t.longitude=r)}}t.TransverseMercatorUtils=u,u.POLE_EDGE=1.4844222297453322,u.POLE_EDGE_DEG=r.MathUtils.radToDeg(u.POLE_EDGE),u.POLE_RADIUS=90-u.POLE_EDGE_DEG,u.POLE_RADIUS_SQ=Math.pow(u.POLE_RADIUS,2),t.transverseMercatorProjection=new d(c.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},8053:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FlatTileBoundingBoxGenerator=void 0;const r=i(4428);t.FlatTileBoundingBoxGenerator=class{constructor(e,t=0,i=0){this.tilingScheme=e,this.minElevation=t,this.maxElevation=i,this.m_tilingScheme=e,this.m_worldBox=e.projection.worldExtent(t,i);const{min:r,max:n}=this.m_worldBox;this.m_worldDimensions={x:n.x-r.x,y:n.y-r.y,z:n.z-r.z}}get projection(){return this.m_tilingScheme.projection}get subdivisionScheme(){return this.m_tilingScheme.subdivisionScheme}getWorldBox(e,t){const i=e.level,n=this.subdivisionScheme.getLevelDimensionX(i),s=this.subdivisionScheme.getLevelDimensionY(i),o=this.m_worldDimensions.x/n,a=this.m_worldDimensions.y/s,l=this.m_worldBox.min.x+o*e.column,c=this.m_worldBox.min.y+a*e.row;return t||(t=new r.Box3),t.min.x=l,t.min.y=c,t.min.z=this.m_worldBox.min.z,t.max.x=l+o,t.max.y=c+a,t.max.z=this.m_worldBox.max.z,t}getGeoBox(e){const t=this.getWorldBox(e);return this.projection.unprojectBox(t)}}},4955:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.halfQuadTreeSubdivisionScheme=void 0,t.halfQuadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(e){return 0===e?1:2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 0!==e?1<<e-1:1}}},7821:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hereTilingScheme=void 0;const r=i(120),n=i(4955),s=i(1914);t.hereTilingScheme=new s.TilingScheme(n.halfQuadTreeSubdivisionScheme,r.normalizedEquirectangularProjection)},1498:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mercatorTilingScheme=void 0;const r=i(1404),n=i(4276),s=i(1914);t.mercatorTilingScheme=new s.TilingScheme(n.quadTreeSubdivisionScheme,r.mercatorProjection)},8836:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.polarTilingScheme=void 0;const r=i(115),n=i(4276),s=i(1914);t.polarTilingScheme=new s.TilingScheme(n.quadTreeSubdivisionScheme,r.transverseMercatorProjection)},730:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuadTree=void 0;const r=i(20);t.QuadTree=class{constructor(e){this.tilingScheme=e}visit(e){this.visitTileKey(r.TileKey.fromRowColumnLevel(0,0,0),e)}visitTileKey(e,t){if(t(e,this.tilingScheme.getGeoBox(e)))for(const i of this.tilingScheme.getSubTileKeys(e))this.visitTileKey(i,t)}}},4276:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.quadTreeSubdivisionScheme=void 0,t.quadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(){return 2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 1<<e}}},5707:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubTiles=void 0;const r=i(20);class n{constructor(e,t,i){this.tileKey=e,this.sizeX=t,this.sizeY=i}[Symbol.iterator](){return 2===this.sizeX&&2===this.sizeY?n.ZCurveIterator(this.tileKey):n.RowColumnIterator(this.tileKey,this.sizeX,this.sizeY)}}t.SubTiles=n,function(e){e.RowColumnIterator=function*(e,t,i){for(let n=0;n<i;n++)for(let s=0;s<t;s++)yield r.TileKey.fromRowColumnLevel(e.row*i+n,e.column*t+s,e.level+1)},e.ZCurveIterator=function*(e){for(let t=0;t<4;t++)yield r.TileKey.fromRowColumnLevel(e.row<<1|t>>1,e.column<<1|1&t,e.level+1)}}(n=t.SubTiles||(t.SubTiles={}))},6368:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},20:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileKey=void 0;const i=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,0x4000000000000,0x8000000000000,4503599627370496];class r{constructor(e,t,i){this.row=e,this.column=t,this.level=i}static fromRowColumnLevel(e,t,i){return new r(e,t,i)}static fromQuadKey(e){const t=e.length;let i=0,n=0;for(let r=0;r<e.length;++r){const s=1<<r,o=parseInt(e.charAt(t-r-1),10);1&o&&(n|=s),2&o&&(i|=s)}return r.fromRowColumnLevel(i,n,t)}static fromMortonCode(e){let t=0,i=0,n=0,s=e;for(;s>1;){const e=1<<t;1&s&&(n|=e),2&s&&(i|=e),t++,s=(s-(3&s))/4}const o=r.fromRowColumnLevel(i,n,t);return o.m_mortonCode=e,o}static fromHereTile(e){const t=r.fromMortonCode(parseInt(e,10));return t.m_hereTile=e,t}static columnsAtLevel(e){return Math.pow(2,e)}static rowsAtLevel(e){return Math.pow(2,e)}static atCoords(e,t,i,n,s){return r.fromRowColumnLevel(Math.floor(i/(s/r.rowsAtLevel(e))),Math.floor(t/(n/r.columnsAtLevel(e))),e)}static parentMortonCode(e){return Math.floor(e/4)}parent(){if(0===this.level)throw new Error("Cannot get the parent of the root tile key");return r.fromRowColumnLevel(this.row>>>1,this.column>>>1,this.level-1)}changedLevelBy(e){const t=Math.max(0,this.level+e);let i=this.row,n=this.column;return e>=0?(i<<=e,n<<=e):(i>>>=-e,n>>>=-e),r.fromRowColumnLevel(i,n,t)}changedLevelTo(e){return this.changedLevelBy(e-this.level)}mortonCode(){if(void 0===this.m_mortonCode){let e=this.column,t=this.row,r=i[this.level<<1];for(let n=0;n<this.level;++n)1&e&&(r+=i[2*n]),1&t&&(r+=i[2*n+1]),e>>>=1,t>>>=1;this.m_mortonCode=r}return this.m_mortonCode}toHereTile(){return void 0===this.m_hereTile&&(this.m_hereTile=this.mortonCode().toString()),this.m_hereTile}toQuadKey(){let e="";for(let t=this.level;t>0;--t){const i=1<<t-1,r=0!=(this.column&i),n=0!=(this.row&i);e+=r&&n?"3":n?"2":r?"1":"0"}return e}equals(e){return this.row===e.row&&this.column===e.column&&this.level===e.level}addedSubKey(e){const t=r.fromQuadKey(0===e.length?"-":e),i=this.changedLevelBy(t.level);return r.fromRowColumnLevel(i.row+t.row,i.column+t.column,i.level)}addedSubHereTile(e){const t=r.fromHereTile(e),i=this.changedLevelBy(t.level);return r.fromRowColumnLevel(i.row+t.row,i.column+t.column,i.level)}getSubHereTile(e){const t=1<<2*e;return(this.mortonCode()&t-1|t).toString()}rowCount(){return r.rowsAtLevel(this.level)}columnCount(){return r.columnsAtLevel(this.level)}}t.TileKey=r},3465:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileKeyUtils=void 0;const r=i(7073),n=i(20);class s{static geoCoordinatesToTileKey(e,t,i){const r=e.projection.projectPoint(t);return this.worldCoordinatesToTileKey(e,r,i)}static worldCoordinatesToTileKey(e,t,i){const r=e.projection,s=e.subdivisionScheme,o=s.getLevelDimensionX(i),a=s.getLevelDimensionY(i),{min:l,max:c}=r.worldExtent(0,0),h=c.x-l.x,d=c.y-l.y;if(t.x<l.x||t.x>c.x)return null;if(t.y<l.y||t.y>c.y)return null;const u=Math.min(o-1,Math.floor(o*(t.x-l.x)/h)),m=Math.min(a-1,Math.floor(a*(t.y-l.y)/d));return n.TileKey.fromRowColumnLevel(m,u,i)}static geoRectangleToTileKeys(e,t,i){const o=(e,t,i)=>e<t?i-(t-e)%(i-t):t+(e-t)%(i-t),a=(e,t,i)=>Math.min(Math.max(e,t),i),l=o(t.southWest.longitudeInRadians,-Math.PI,Math.PI),c=a(t.southWest.latitudeInRadians,-.5*Math.PI,.5*Math.PI),h=o(t.northEast.longitudeInRadians,-Math.PI,Math.PI),d=a(t.northEast.latitudeInRadians,-.5*Math.PI,.5*Math.PI),u=s.geoCoordinatesToTileKey(e,r.GeoCoordinates.fromRadians(c,l),i),m=s.geoCoordinatesToTileKey(e,r.GeoCoordinates.fromRadians(d,h),i),p=e.subdivisionScheme.getLevelDimensionX(i);if(!u||!m)throw new Error("Invalid coordinates");const f=u.column;let g=m.column;l>h&&(g+=g!==f?p:p-1);const v=Math.min(u.row,m.row),_=Math.max(u.row,m.row),y=new Array;for(let e=v;e<=_;++e)for(let t=f;t<=g;++t)y.push(n.TileKey.fromRowColumnLevel(e,t%p,i));return y}}t.TileKeyUtils=s},7511:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileTreeTraverse=void 0;const r=i(5707);t.TileTreeTraverse=class{constructor(e){this.m_subdivisionScheme=e}subTiles(e){const t=this.m_subdivisionScheme.getSubdivisionX(e.level),i=this.m_subdivisionScheme.getSubdivisionY(e.level);return new r.SubTiles(e,t,i)}}},1914:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TilingScheme=void 0;const r=i(8053),n=i(3465),s=i(7511);t.TilingScheme=class{constructor(e,t){this.subdivisionScheme=e,this.projection=t,this.boundingBoxGenerator=new r.FlatTileBoundingBoxGenerator(this),this.tileTreeTraverse=new s.TileTreeTraverse(e)}getSubTileKeys(e){return this.tileTreeTraverse.subTiles(e)}getTileKey(e,t){return n.TileKeyUtils.geoCoordinatesToTileKey(this,e,t)}getTileKeys(e,t){return n.TileKeyUtils.geoRectangleToTileKeys(this,e,t)}getGeoBox(e){return this.boundingBoxGenerator.getGeoBox(e)}getWorldBox(e,t){return this.boundingBoxGenerator.getWorldBox(e,t)}}},1555:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webMercatorTilingScheme=void 0;const r=i(1404),n=i(4276),s=i(1914);t.webMercatorTilingScheme=new s.TilingScheme(n.quadTreeSubdivisionScheme,r.webMercatorProjection)},1314:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighPrecisionLine=t.HighPrecisionWireFrameLine=void 0;const r=i(4428),n=i(1274);class s extends r.Line{constructor(e,t,i){super(e,t),this.matrixWorldInverse=new r.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}get shaderMaterial(){return this.material}setPositions(e){n.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.onBeforeRender=(e,t,i,r,s,o)=>{n.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.copy(this.matrixWorld).invert()}}t.HighPrecisionWireFrameLine=s;class o extends r.Mesh{constructor(e,t,i){super(e,t),this.matrixWorldInverse=new r.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}get shaderMaterial(){return this.material}setPositions(e){n.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.onBeforeRender=(e,t,i,r,s,o)=>{n.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.copy(this.matrixWorld).invert()}}t.HighPrecisionLine=o},82:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighPrecisionPoints=void 0;const r=i(284),n=i(4428),s=i(1274);class o extends n.Points{constructor(e,t,i,s,o){void 0===t&&(t=new r.HighPrecisionPointMaterial({color:s||r.HighPrecisionPointMaterial.DEFAULT_COLOR,opacity:void 0!==o?o:1})),super(void 0===e?new n.BufferGeometry:e,t),this.matrixWorldInverse=new n.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}clearGeometry(){return this.geometry=new n.BufferGeometry}get shaderMaterial(){return this.material}setPositions(e){s.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.material.isHighPrecisionPointsMaterial&&void 0!==this.dimensionality&&this.material.setDimensionality(this.dimensionality),this.onBeforeRender=(e,t,i,r,n,o)=>{s.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.copy(this.matrixWorld).invert()}}t.HighPrecisionPoints=o},1274:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighPrecisionUtils=void 0;const r=i(284),n=i(4428),s=i(1314),o=i(82),a=i(8655);!function(e){function t(e){return new n.Vector3(Math.fround(e.x),Math.fround(e.y),Math.fround(e.z))}function i(e,i){const r=(new n.Matrix4).copy(e.projectionMatrix).multiply(e.matrixWorldInverse),s=new n.Vector3(0,0,0).applyMatrix4(i),o=t(s);return{viewProjection:r,eyePosHi:o,eyePosLo:t(s.sub(o))}}function l(e){if(e.length>0){const t=e[0];if(null==t)throw Error("Empty element in positions");const i=new Array,r=new Array,s=(...e)=>{for(const t of e){const e=Math.fround(t);r.push(t-e),i.push(e)}},o=e=>{s(e.x,e.y,e.z)};if(void 0!==t.z)e.forEach((e=>{o(e)}));else{if(i.length%3!=0)throw Error("Positions must be 3D, not 2D");e.forEach((e=>{s(e)}))}return{positionHigh:new n.Float32BufferAttribute(i,3),positionLow:new n.Float32BufferAttribute(r,3)}}return{positionHigh:new n.Float32BufferAttribute([],3),positionLow:new n.Float32BufferAttribute([],3)}}function c(e,t,i=0){const r=new Array,n=e.length;for(let s=0;s<n;s+=t){for(let t=0;t<i;t++)r.push(e[s+t]);const n=e[s+i],o=e[s+i+1],a=e[s+i+2],l=Math.fround(n),c=n-l,h=Math.fround(o),d=o-h,u=Math.fround(a),m=a-u;r.push(l,h,u,c,d,m);for(let n=i+3;n<t;n++)r.push(e[s+n])}return r}function h(e,t){const i=l(t);return e.bufferGeometry.setAttribute("position",i.positionHigh),e.bufferGeometry.setAttribute("positionLow",i.positionLow),i.positionHigh.itemSize}e.doubleToFloatVec=t,e.makeFloatVec=function(e){const t=Math.fround(e.x),i=Math.fround(e.y),r=Math.fround(e.z),s=new n.Vector3(e.x-t,e.y-i,e.z-r);return e.x=Math.fround(t),e.y=Math.fround(i),e.z=Math.fround(r),s},e.createHighPrecisionCameraPos=i,e.updateHpUniforms=function(e,t,r){const n=i(t,e.matrixWorldInverse),s=n.viewProjection;if(void 0===r||!r.isMaterial)throw Error("High pecision line has no high precision material");if(!(r.uniforms&&r.uniforms.u_mvp&&r.uniforms.u_eyepos&&r.uniforms.u_eyepos_lowpart))throw Error("High pecision material has missing uniforms");r.uniforms.u_mvp.value=new Float32Array(s.elements),r.uniforms.u_eyepos.value=new Float32Array(n.eyePosHi.toArray()),r.uniforms.u_eyepos_lowpart.value=new Float32Array(n.eyePosLo.toArray())},e.createAttributes=l,e.addInterleavedAttributes3=c,e.setPositions=h,e.convertPositions=function(e){if(e.length<=0)return{positions:[]};const t=e[0];if(null==t)throw Error("Empty element in positions");const i=t;if(void 0===i.y&&void 0===i.z)return{positions:e};const r=new Array;return e.forEach((e=>{r.push(e.x,e.y,e.z)})),{positions:r}},e.createLine=function(e,t){const i=void 0!==t.lineWidth?t.lineWidth:5,o=void 0!==t.addCircles&&t.addCircles,l=void 0!==t.wireFrame&&t.wireFrame,h=[],d=[];a.triangulateLine(e,i,h,d,o);const u=new n.BufferGeometry,m=c(h,3),p=new n.InterleavedBuffer(new Float32Array(m),6),f=new n.InterleavedBufferAttribute(p,3,0,!1),g=new n.InterleavedBufferAttribute(p,3,3,!1);u.setAttribute("position",f),u.setAttribute("positionLow",g),u.setIndex(new n.BufferAttribute(new Uint32Array(d),1));const v=new r.HighPrecisionLineMaterial(t),_=l?new s.HighPrecisionWireFrameLine(u,v):new s.HighPrecisionLine(u,v);return _.setupForRendering(),_},e.createPoints=function(e,t){const i=[];for(let t=0;t<e.length;t++)i.push(i.length/3);const s=new n.BufferGeometry,a=r.isHighPrecisionPointMaterial(t)?t:new r.HighPrecisionPointMaterial(t),l=new o.HighPrecisionPoints(s,a);return h(l,e),l.setupForRendering(),l}}(t.HighPrecisionUtils||(t.HighPrecisionUtils={}))},6155:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineGroup=t.createSimpleLineGeometry=t.createLineGeometry=t.LineGeometry=void 0;const r=i(2183),n=i(4428),s=new n.Vector3,o=new n.Vector3,a=new n.Vector3,l=new n.Vector3,c=new n.Vector3,h={attributes:[{name:"extrusionCoord",itemSize:3,offset:0},{name:"position",itemSize:3,offset:3},{name:"tangent",itemSize:3,offset:6},{name:"bitangent",itemSize:4,offset:9}],stride:13},d={attributes:[{name:"uv",itemSize:2,offset:h.stride},{name:"normal",itemSize:3,offset:h.stride+2}],stride:5},u={attributes:[...h.attributes,...d.attributes],stride:h.stride+d.stride},m={attributes:[{name:"extrusionCoord",itemSize:2,offset:0},{name:"position",itemSize:3,offset:2},{name:"positionLow",itemSize:3,offset:5},{name:"tangent",itemSize:3,offset:8},{name:"bitangent",itemSize:4,offset:11}],stride:15},p={attributes:[...m.attributes,...d.attributes],stride:m.stride+d.stride};class f{constructor(){this.vertices=[],this.vertexColors=[],this.indices=[]}}function g(e,t){return t?e?p:m:e?u:h}function v(e,t,i,n,h,d,u=new f,m=!1){if(0===t.length)return u;const p=g(void 0!==h,m).stride,v=t.length/3,_=new Array(v),y=new Array(t.length-3),x=u.vertices.length/p,b=void 0!==n&&n.length>0,T=void 0!==h&&h.length>0,w=void 0!==d&&d.length&&t.length;r.assert(!b||n.length===v),r.assert(!T||h.length/2===v),r.assert(!w||d.length===t.length);let S=.1;_[0]=S;for(let e=0;e<v-1;++e){let i=0;for(let r=0;r<3;++r){const n=t[3*(e+1)+r]-t[3*e+r];y[3*e+r]=n,i+=n*n}S+=Math.sqrt(i),_[e+1]=S}const M=b?Math.abs(n[n.length-1]-n[0]):1,E=_[_.length-1]/M;if(b)for(let e=0;e<v;++e)_[e]=n[e]*E+.1;let P=!0;for(let e=0;e<3;++e)P=P&&t[e]===t[t.length-3+e];const C=[],A=(r,n,p,f,g)=>{C.length=0,u.vertices.push(f,-1*g,E),C.push(f,1*g,E);for(let e=0;e<3;++e){if(m){const i=Math.fround(t[3*r+e]),n=t[3*r+e]-i;u.vertices.push(i,n),C.push(i,n)}else u.vertices.push(t[3*r+e]),C.push(t[3*r+e]);o.setComponent(e,t[3*r+e])}for(let e=0;e<3;++e)a.setComponent(e,y[n+e]),l.setComponent(e,y[p+e]);a.normalize(),u.vertices.push(a.x,a.y,a.z),C.push(a.x,a.y,a.z),o.add(e),i.surfaceNormal(o,o);const v=function(e,t,i,r){let n=0;return t.equals(i)||(n=Math.acos(t.dot(i))*Math.sign(e.dot(s.copy(t).cross(i))),Number.isNaN(n)&&(n=0)),r.copy(t).add(i).normalize().cross(e).normalize(),n}(o,a,l.normalize(),c);u.vertices.push(c.x,c.y,c.z,v),C.push(c.x,c.y,c.z,v),T&&(u.vertices.push(h[2*r],h[2*r+1]),C.push(h[2*r],h[2*r+1]),u.vertices.push(o.x,o.y,o.z),C.push(o.x,o.y,o.z)),u.vertices.push(...C),w&&(u.vertexColors.push(d[3*r],d[3*r+1],d[3*r+2]),u.vertexColors.push(d[3*r],d[3*r+1],d[3*r+2]))};for(let e=0;e<v;++e){const t=P&&0===e?y.length-3:3*Math.max(0,e-1),i=P&&e===v-1?0:Math.min(3*e,y.length-3);e>0&&A(e,t,i,_[e-1],_[e]),e+1<v&&A(e,t,i,-1*_[Math.min(e,_.length-1)],_[Math.min(e+1,_.length-1)])}for(let e=0;e<v-1;++e){const t=x+4*e;u.indices.push(t,t+1,t+2,t+2,t+1,t+3)}return u}function _(e,t,i=new f){if(0===e.length)return i;const r=e.length/3;let n=i.vertices.length/3;const s=void 0!==t&&t.length&&e.length;for(let o=0;o<r;++o,n++){o>0&&i.indices.push(n),o<r-1&&i.indices.push(n);for(let r=0;r<3;++r)i.vertices.push(e[3*o+r]),s&&i.vertexColors.push(t[3*o+r])}return i}t.LineGeometry=f,t.createLineGeometry=v,t.createSimpleLineGeometry=_;class y{constructor(e=!1,t=!1,i=!1){this.hasNormalsAndUvs=e,this.highPrecision=t,this.isSimple=i,this.m_geometry=new f}static createGeometry(e,t,i,r,s=!1,o=!1,a=!1){if(a)return r.setAttribute("position",new n.BufferAttribute(new Float32Array(e),3)),t.length===e.length&&r.setAttribute("color",new n.BufferAttribute(new Float32Array(t),3)),r.setIndex(new n.BufferAttribute(new Uint32Array(i),1)),r;{const a=g(s,o),l=new n.InterleavedBuffer(new Float32Array(e),a.stride);return a.attributes.forEach((e=>{const t=new n.InterleavedBufferAttribute(l,e.itemSize,e.offset,!1);r.setAttribute(e.name,t)})),t.length===e.length&&r.setAttribute("color",new n.BufferAttribute(new Float32Array(t),3)),r.setIndex(new n.BufferAttribute(new Uint32Array(i),1)),r}}clear(){this.m_geometry.vertices=[],this.m_geometry.vertexColors=[],this.m_geometry.indices=[]}add(e,t,i,n,s,o){return this.isSimple?_(t,o,this.m_geometry):(r.assert(!this.hasNormalsAndUvs||void 0!==s),v(e,t,i,n,s,o,this.m_geometry,this.highPrecision)),this}get vertices(){return this.m_geometry.vertices}get vertexColors(){return this.m_geometry.vertexColors}get indices(){return this.m_geometry.indices}get vertexAttributes(){return g(this.hasNormalsAndUvs,this.highPrecision).attributes}get stride(){return g(this.hasNormalsAndUvs,this.highPrecision).stride}createGeometry(e){return void 0===e&&(e=new n.BufferGeometry),y.createGeometry(this.m_geometry.vertices,this.m_geometry.vertexColors,this.m_geometry.indices,e,this.hasNormalsAndUvs,this.highPrecision)}}t.LineGroup=y},8655:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reconstructLineWidth=t.reconstructLine=t.triangulateLine=t.numCirclePoints=void 0;const r=i(4428),n=new r.Vector3(0,0,1),s=[0,1,2,1,3,2],o=[0,1,3,3,1,2,0,3,4,5,4,3],a=Math.PI/8;function l(e,t,i,r,n,s){const o=n.length/3;n.push(e,t,0);for(let l=0;l<9;++l){const c=a*l+Math.PI/2+i;n.push(e+r*Math.cos(c),t+r*Math.sin(c),0),s.push(o,o+l+1,o+(l+1)%9+1)}}t.numCirclePoints=function(e){return 9},t.triangulateLine=function(e,t,i,a,c=!0,h=c){if(e.length<3)return;const d=new r.Vector2;if(c){const r=3!==e.length?d.set(e[3]-e[0],e[4]-e[1]).angle():0;l(e[0],e[1],r,t,i,a)}const u=i.length/3,m=new r.Vector3,p=new r.Vector3,f=new r.Vector3,g=new r.Vector3,v=new r.Vector3,_=new r.Vector3,y=new r.Vector3,x=new r.Vector3,b=new r.Vector3,T=e.length/3;let w=0;for(let r=0;r<T;++r){let l=!1;if(p.set(e[3*r],e[3*r+1],e[3*r+2]),r+1<T){if(f.set(e[3*(r+1)],e[3*(r+1)+1],e[3*(r+1)+2]),g.copy(f).sub(p).normalize().cross(n),v.copy(g),r>0&&(v.add(m).multiplyScalar(1-.5*g.dot(m)),l=m.angleTo(g)>Math.PI/2,l)){const e=t/Math.cos(g.angleTo(m)/2);_.copy(g).add(m).normalize().multiplyScalar(-e).add(p),y.copy(m).multiplyScalar(t).add(p),x.copy(g).add(m).normalize().multiplyScalar(e).add(p),b.copy(g).multiplyScalar(t).add(p)}l?i.push(_.x,_.y,_.z,y.x,y.y,y.z,x.x,x.y,x.z,b.x,b.y,b.z):(_.copy(v).multiplyScalar(-t).add(p),y.copy(v).multiplyScalar(t).add(p),i.push(_.x,_.y,_.z,y.x,y.y,y.z)),m.copy(g)}else _.copy(m).multiplyScalar(-t).add(p),y.copy(m).multiplyScalar(t).add(p),i.push(_.x,_.y,_.z,y.x,y.y,y.z);r!==T-1&&((l?o:s).forEach((e=>a.push(u+w+e))),w+=l?4:2)}if(h){const r=2!==e.length?d.set(e[3*(T-3)]-e[3*(T-2)],e[3*(T-3)+1]-e[3*(T-2)+1]).angle():Math.PI;l(e[3*(T-2)],e[3*(T-2)+1],r,t,i,a)}},t.reconstructLine=function(e,t){const i=new Float32Array(e.length/2);for(let r=3*t,n=2*r;r<i.length;r+=3,n+=6)i[r]=e[n]+.5*(e[n+3]-e[n]),i[r+1]=e[n+1]+.5*(e[n+3+1]-e[n+1]),i[r+2]=e[n+2]+.5*(e[n+3+2]-e[n+2]);return i},t.reconstructLineWidth=function(e,t){const i=e[2*t+3]-e[2*t],r=e[2*t+3+1]-e[2*t+1],n=e[2*t+3+2]-e[2*t+2];return.5*Math.sqrt(i*i+r*r+n*n)}},7197:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=t.Entry=void 0;const r=i(2183);class n{constructor(e,t,i,r,n){this.key=e,this.value=t,this.size=i,this.newer=r,this.older=n}}t.Entry=n,t.LRUCache=class{constructor(e,t=(()=>1)){this.m_size=0,this.m_map=new Map,this.m_newest=null,this.m_oldest=null,this.m_capacity=e,this.m_sizeFunction=t}forEach(e,t){let i=this.m_newest;for(;null!==i;){const r=i.older;e.call(t,i.value,i.key,this),i=r}}get size(){return this.m_size}get capacity(){return this.m_capacity}get map(){return this.m_map}get newest(){return this.m_newest}get oldest(){return this.m_oldest}setCapacity(e){this.m_capacity=e,this.evict()}setCapacityAndMeasure(e,t=(()=>1)){this.m_capacity=e,this.m_sizeFunction=t,this.shrinkToCapacity()}shrinkToCapacity(){let e=0;const t=this.m_sizeFunction;let i=this.m_newest;for(;null!==i;){const r=t(i.value);i.size=r,e+=r,i=i.older}this.m_size=e,this.evict()}set(e,t){const i=this.m_sizeFunction(t);let s=this.m_map.get(e);if(void 0!==s)this.m_size=this.m_size-s.size+i,s.value=t,s.size=i,this.promoteEntry(s),this.evict();else{if(i>this.m_capacity)return;if(s=new n(e,t,i,null,null),0===this.m_map.size)this.m_newest=this.m_oldest=s;else{r.assert(null!==this.m_newest);const e=this.m_newest;s.older=this.m_newest,e.newer=s,this.m_newest=s}this.m_map.set(e,s),this.m_size+=i,this.evict()}}get(e){const t=this.m_map.get(e);if(void 0!==t)return this.promoteEntry(t),t.value}has(e){return this.m_map.has(e)}clear(){this.m_newest=this.m_oldest=null,this.m_size=0,this.m_map.clear()}evictAll(){const e=this.evictionCallback;void 0!==e&&this.forEach(((t,i)=>e(i,t))),this.clear()}evictSelected(e,t){const i=this.evictionCallback;let r=this.m_newest;for(;null!==r;){const n=r.older;e.call(t,r.value,r.key)&&(void 0!==i&&i(r.key,r.value),this.deleteEntry(r),this.m_map.delete(r.key)),r=n}}delete(e){const t=this.m_map.get(e);return void 0!==t&&(this.deleteEntry(t),this.m_map.delete(e))}evict(){for(;null!==this.m_oldest&&this.m_size>this.m_capacity;)if(void 0===this.evictOldest())return}evictOldest(){r.assert(null!==this.m_oldest);const e=this.m_oldest;r.assert(null===e.older);let t=e;if(void 0!==this.canEvict)for(;!this.canEvict(t.key,t.value);){if(null===t.newer)return;t=t.newer}if(t===e)this.m_oldest=t.newer,null!==t.newer&&(r.assert(t.newer.older===t),t.newer.older=null);else{if(null===t.newer)return;r.assert(t.newer.older===t),t.newer.older=t.older,null!==t.older&&(t.older.newer=t.newer)}const i=this.m_map.delete(t.key);return r.assert(!0===i),i&&void 0!==this.evictionCallback&&this.evictionCallback(t.key,t.value),this.m_size-=t.size,t}deleteEntry(e){e===this.m_newest?this.m_newest=e.older:e.newer?e.newer.older=e.older:r.assert(!1),e===this.m_oldest?this.m_oldest=e.newer:e.older?e.older.newer=e.newer:r.assert(!1),this.m_size-=e.size}promoteEntry(e){if(e===this.m_newest)return;e.newer&&(r.assert(e.newer.older===e),e.newer.older=e.older),e.older&&(r.assert(e.older.newer===e),e.older.newer=e.newer),e===this.m_oldest&&(this.m_oldest=e.newer),e.newer=null,e.older=this.m_newest,r.assert(null!==this.m_newest);const t=this.m_newest;r.assert(null===t.newer),t.newer=e,this.m_newest=e}}},4765:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapControls=t.EventNames=t.TiltState=void 0;const r=i(3139),n=i(2530),s=i(4428),o=i(4920);var a,l,c;!function(e){e[e.NONE=0]="NONE",e[e.PAN=1]="PAN",e[e.ROTATE=2]="ROTATE",e[e.ORBIT=3]="ORBIT",e[e.TOUCH=4]="TOUCH"}(a||(a={})),function(e){e[e.Tilted=0]="Tilted",e[e.Down=1]="Down"}(l=t.TiltState||(t.TiltState={})),function(e){e.Update="update",e.BeginInteraction="begin-interaction",e.EndInteraction="end-interaction"}(c=t.EventNames||(t.EventNames={}));const h={type:c.Update},d={type:c.BeginInteraction},u={type:c.EndInteraction},m=s.MathUtils.degToRad(89),p=.01;class f extends n.EventDispatcher{constructor(e,t=!0){super(),this.mapView=e,this.rotationMouseDeltaFactor=.1,this.orbitingMouseDeltaFactor=.1*s.MathUtils.DEG2RAD,this.orbitingTouchDeltaFactor=.1*s.MathUtils.DEG2RAD,this.enabled=!0,this.zoomEnabled=!0,this.panEnabled=!0,this.tiltEnabled=!0,this.rotateEnabled=!0,this.inertiaEnabled=!0,this.zoomInertiaDampingDuration=.5,this.panInertiaDampingDuration=1,this.tiltToggleDuration=.5,this.tiltAngle=Math.PI/4,this.northResetAnimationDuration=1.5,this.zoomLevelDeltaOnMouseWheel=.2,this.zoomLevelDeltaOnControl=1,this.minZoomLevel=0,this.maxZoomLevel=20,this.minCameraHeight=3,this.zoomLevelDeltaOnDoubleClick=1,this.doubleTapTime=.3,this.m_currentViewDirection=new s.Vector3,this.m_lastMousePosition=new s.Vector2(0,0),this.m_initialMousePosition=new s.Vector2(0,0),this.m_mouseDelta=new s.Vector2(0,0),this.m_needsRenderLastFrame=!0,this.m_panIsAnimated=!1,this.m_panDistanceFrameDelta=new s.Vector3,this.m_panAnimationTime=0,this.m_panAnimationStartTime=0,this.m_lastAveragedPanDistanceOrAngle=0,this.m_currentInertialPanningSpeed=0,this.m_lastPanVector=new s.Vector3,this.m_rotateGlobeQuaternion=new s.Quaternion,this.m_lastRotateGlobeAxis=new s.Vector3,this.m_lastRotateGlobeAngle=0,this.m_lastRotateGlobeFromVector=new s.Vector3,this.m_recentPanDistancesOrAngles=[0,0,0,0,0],this.m_currentPanDistanceOrAngleIndex=0,this.m_zoomIsAnimated=!1,this.m_zoomDeltaRequested=0,this.m_zoomTargetNormalizedCoordinates=new s.Vector2,this.m_zoomAnimationTime=0,this.m_zoomAnimationStartTime=0,this.m_startZoom=0,this.m_tiltIsAnimated=!1,this.m_tiltRequested=void 0,this.m_tiltAnimationTime=0,this.m_tiltAnimationStartTime=0,this.m_startTilt=0,this.m_state=a.NONE,this.m_tmpVector2=new s.Vector2,this.m_tmpVector3=new s.Vector3,this.m_tapStartTime=0,this.m_lastSingleTapTime=0,this.m_fingerMoved=!1,this.m_isDoubleTap=!1,this.m_resetNorthStartTime=0,this.m_resetNorthIsAnimated=!1,this.m_resetNorthAnimationDuration=0,this.m_currentAzimuth=0,this.m_lastAzimuth=0,this.m_startAzimuth=0,this.m_maxTiltAngle=m,this.m_touchState={touches:[],currentRotation:0,initialRotation:0},this.dispose=()=>{},this.camera=e.camera,this.domElement=e.renderer.domElement,this.maxZoomLevel=e.maxZoomLevel,this.minZoomLevel=e.minZoomLevel,this.minCameraHeight=e.minCameraHeight,this.bindInputEvents(this.domElement),this.handleZoom=this.handleZoom.bind(this),this.handlePan=this.handlePan.bind(this),this.tilt=this.tilt.bind(this),this.resetNorth=this.resetNorth.bind(this),this.assignZoomAfterTouchZoomRender=this.assignZoomAfterTouchZoomRender.bind(this),t&&e.addEventListener(n.MapViewEventNames.Dispose,(()=>{this.dispose()}))}static create(e,t=!0){return new f(e,t)}get attitude(){const e=n.MapViewUtils.extractAttitude(this.mapView,this.camera);return{yaw:s.MathUtils.radToDeg(e.yaw),pitch:s.MathUtils.radToDeg(e.pitch),roll:s.MathUtils.radToDeg(e.roll)}}pointToNorth(){this.m_startAzimuth=Math.PI+n.MapViewUtils.extractSphericalCoordinatesFromLocation(this.mapView,this.camera,this.mapView.target).azimuth,this.m_startAzimuth=Math.atan2(Math.sin(this.m_startAzimuth),Math.cos(this.m_startAzimuth)),0!==this.m_startAzimuth&&(this.stopExistingAnimations(),this.m_resetNorthAnimationDuration=this.northResetAnimationDuration,this.m_currentAzimuth=this.m_startAzimuth,this.m_resetNorthStartTime=performance.now(),this.resetNorth())}zoomOnTargetPosition(e,t,i){n.MapViewUtils.zoomOnTargetPosition(this.mapView,e,t,i,this.m_maxTiltAngle)}setZoomLevel(e,t={x:0,y:0}){this.enabled&&this.zoomEnabled&&(this.dispatchEvent(d),this.m_startZoom=this.currentZoom,this.m_zoomDeltaRequested=e-this.zoomLevelTargeted,this.stopExistingAnimations(),this.m_zoomAnimationStartTime=performance.now(),this.m_zoomTargetNormalizedCoordinates.set(t.x,t.y),this.handleZoom(),this.dispatchEvent(u))}toggleTilt(){if(!this.enabled||!this.tiltEnabled)return;this.stopExistingAnimations(),this.m_startTilt=this.currentTilt;const e=this.m_startTilt<p;this.m_tiltRequested=e?this.tiltAngle:0,this.m_tiltState=e?l.Tilted:l.Down,this.m_tiltAnimationStartTime=performance.now(),this.tilt()}set cameraHeight(e){this.camera.position.setZ(e),this.camera.matrixWorldNeedsUpdate=!0}get cameraHeight(){return this.mapView.camera.position.z}set maxTiltAngle(e){this.m_maxTiltAngle=Math.max(0,Math.min(m,s.MathUtils.degToRad(e)))}get maxTiltAngle(){return s.MathUtils.radToDeg(this.m_maxTiltAngle)}get zoomLevelTargeted(){return void 0===this.m_targetedZoom?this.currentZoom:this.m_targetedZoom}get tiltState(){return void 0===this.m_tiltState&&(this.m_tiltState=this.currentTilt<p||this.m_tiltState===l.Down?l.Tilted:l.Down),this.m_tiltState}set currentZoom(e){this.m_currentZoom=e}get currentZoom(){return void 0!==this.m_currentZoom?this.m_currentZoom:this.mapView.zoomLevel}set currentTilt(e){this.m_currentTilt=e}get currentTilt(){return s.MathUtils.degToRad(this.mapView.tilt)}get targetedTilt(){return void 0===this.m_targetedTilt?void 0===this.m_currentTilt?this.currentTilt:this.m_currentTilt:this.m_targetedTilt}assignZoomAfterTouchZoomRender(){this.m_currentZoom=this.mapView.zoomLevel,this.m_targetedZoom=this.mapView.zoomLevel,this.mapView.removeEventListener(n.MapViewEventNames.AfterRender,this.assignZoomAfterTouchZoomRender)}stopExistingAnimations(){this.stopResetNorth(),this.stopZoom(),this.stopPan(),this.stopTilt()}resetNorth(){const e=(performance.now()-this.m_resetNorthStartTime)/1e3;this.inertiaEnabled&&(this.m_resetNorthIsAnimated||(this.m_resetNorthIsAnimated=!0,this.mapView.addEventListener(n.MapViewEventNames.AfterRender,this.resetNorth)),e>this.m_resetNorthAnimationDuration?this.m_needsRenderLastFrame&&(this.m_needsRenderLastFrame=!1,this.stopResetNorth()):this.m_needsRenderLastFrame=!0),this.m_lastAzimuth=this.m_currentAzimuth,this.m_currentAzimuth=this.inertiaEnabled?this.easeOutCubic(this.m_startAzimuth,0,Math.min(1,e/this.m_resetNorthAnimationDuration)):0;const t=this.m_currentAzimuth-this.m_lastAzimuth;n.MapViewUtils.orbitAroundScreenPoint(this.mapView,0,0,t,0,this.m_maxTiltAngle),this.updateMapView()}stopResetNorth(){this.mapView.removeEventListener(n.MapViewEventNames.AfterRender,this.resetNorth),this.m_resetNorthIsAnimated=!1}tilt(){void 0!==this.m_tiltRequested&&(this.m_targetedTilt=Math.max(Math.min(this.m_tiltRequested,this.maxTiltAngle),0),this.m_tiltRequested=void 0);let e=!1;if(this.inertiaEnabled){this.m_tiltIsAnimated||(this.m_tiltIsAnimated=!0,this.mapView.addEventListener(n.MapViewEventNames.AfterRender,this.tilt));const t=performance.now();this.m_tiltAnimationTime=(t-this.m_tiltAnimationStartTime)/1e3,this.m_tiltAnimationTime>=this.tiltToggleDuration?this.m_needsRenderLastFrame&&(this.m_needsRenderLastFrame=!1,this.m_tiltAnimationTime=this.tiltToggleDuration,e=!0):this.m_needsRenderLastFrame=!0}this.m_currentTilt=this.inertiaEnabled?this.easeOutCubic(this.m_startTilt,this.targetedTilt,Math.min(1,this.m_tiltAnimationTime/this.tiltToggleDuration)):this.targetedTilt;const t=this.currentTilt,i=this.m_currentTilt-t;n.MapViewUtils.orbitAroundScreenPoint(this.mapView,0,0,0,i,this.m_maxTiltAngle),this.updateMapView(),e&&this.stopTilt()}stopTilt(){this.mapView.removeEventListener(n.MapViewEventNames.AfterRender,this.tilt),this.m_tiltIsAnimated=!1,this.m_targetedTilt=this.m_currentTilt=void 0}easeOutCubic(e,t,i){return e+(t-e)*(--i*i*i+1)}handleZoom(){let e=!1;if(0!==this.m_zoomDeltaRequested&&(this.m_targetedZoom=Math.max(Math.min(this.zoomLevelTargeted+this.m_zoomDeltaRequested,this.maxZoomLevel),this.minZoomLevel),this.m_zoomDeltaRequested=0),this.inertiaEnabled&&this.zoomInertiaDampingDuration>0){this.m_zoomIsAnimated||(this.m_zoomIsAnimated=!0,this.mapView.addEventListener(n.MapViewEventNames.AfterRender,this.handleZoom));const t=performance.now();this.m_zoomAnimationTime=(t-this.m_zoomAnimationStartTime)/1e3,this.m_zoomAnimationTime>this.zoomInertiaDampingDuration?this.m_needsRenderLastFrame&&(this.m_needsRenderLastFrame=!1,this.m_zoomAnimationTime=this.zoomInertiaDampingDuration,e=!0,this.stopZoom()):this.m_needsRenderLastFrame=!0}this.currentZoom=!this.inertiaEnabled||Math.abs(this.zoomLevelTargeted-this.m_startZoom)<p?this.zoomLevelTargeted:this.easeOutCubic(this.m_startZoom,this.zoomLevelTargeted,Math.min(1,this.m_zoomAnimationTime/this.zoomInertiaDampingDuration));const t=n.MapViewUtils.zoomOnTargetPosition(this.mapView,this.m_zoomTargetNormalizedCoordinates.x,this.m_zoomTargetNormalizedCoordinates.y,this.currentZoom,this.m_maxTiltAngle);!e&&t||(this.m_targetedZoom=void 0,this.m_currentZoom=void 0),this.updateMapView()}stopZoom(){this.mapView.removeEventListener(n.MapViewEventNames.AfterRender,this.handleZoom),this.m_zoomIsAnimated=!1}handlePan(){if(this.m_state===a.NONE&&0===this.m_lastAveragedPanDistanceOrAngle)return;this.inertiaEnabled&&!this.m_panIsAnimated&&(this.m_panIsAnimated=!0,this.mapView.addEventListener(n.MapViewEventNames.AfterRender,this.handlePan));const e=this.inertiaEnabled&&this.panInertiaDampingDuration>0&&this.m_state===a.NONE&&this.m_lastAveragedPanDistanceOrAngle>0;if(e){const e=performance.now();this.m_panAnimationTime=(e-this.m_panAnimationStartTime)/1e3,this.m_panAnimationTime>this.panInertiaDampingDuration?this.m_needsRenderLastFrame&&(this.m_needsRenderLastFrame=!1,this.m_panAnimationTime=this.panInertiaDampingDuration,this.mapView.removeEventListener(n.MapViewEventNames.AfterRender,this.handlePan),this.m_panIsAnimated=!1):this.m_needsRenderLastFrame=!0;const t=this.m_panAnimationTime/this.panInertiaDampingDuration;this.m_currentInertialPanningSpeed=this.easeOutCubic(this.m_lastAveragedPanDistanceOrAngle,0,Math.min(1,t)),0===this.m_currentInertialPanningSpeed&&(this.m_lastAveragedPanDistanceOrAngle=0),this.mapView.projection.type===r.ProjectionType.Planar?this.m_panDistanceFrameDelta.copy(this.m_lastPanVector).setLength(this.m_currentInertialPanningSpeed):this.mapView.projection.type===r.ProjectionType.Spherical&&this.m_rotateGlobeQuaternion.setFromAxisAngle(this.m_lastRotateGlobeAxis,this.m_currentInertialPanningSpeed).normalize()}else{let e=0;this.mapView.projection.type===r.ProjectionType.Planar?e=this.m_lastPanVector.copy(this.m_panDistanceFrameDelta).length():this.mapView.projection.type===r.ProjectionType.Spherical&&(e=this.m_lastRotateGlobeAngle,this.m_rotateGlobeQuaternion.setFromAxisAngle(this.m_lastRotateGlobeAxis,this.m_lastRotateGlobeAngle),this.m_rotateGlobeQuaternion.normalize()),this.m_currentPanDistanceOrAngleIndex=(this.m_currentPanDistanceOrAngleIndex+1)%5,this.m_recentPanDistancesOrAngles[this.m_currentPanDistanceOrAngleIndex]=e,this.m_lastAveragedPanDistanceOrAngle=this.m_recentPanDistancesOrAngles.reduce(((e,t)=>e+t))/5}this.mapView.projection.type===r.ProjectionType.Planar?n.MapViewUtils.panCameraAboveFlatMap(this.mapView,this.m_panDistanceFrameDelta.x,this.m_panDistanceFrameDelta.y):this.mapView.projection.type===r.ProjectionType.Spherical&&n.MapViewUtils.panCameraAroundGlobe(this.mapView,this.m_lastRotateGlobeFromVector,this.m_tmpVector3.copy(this.m_lastRotateGlobeFromVector).applyQuaternion(this.m_rotateGlobeQuaternion)),e||(this.m_panDistanceFrameDelta.set(0,0,0),this.m_lastRotateGlobeAngle=0),this.updateMapView()}stopPan(){this.m_panDistanceFrameDelta.set(0,0,0),this.m_lastAveragedPanDistanceOrAngle=0}bindInputEvents(e){const t=this.contextMenu.bind(this),i=this.mouseDown.bind(this),r=this.mouseWheel.bind(this),n=this.touchStart.bind(this),s=this.touchEnd.bind(this),o=this.touchMove.bind(this),a=this.mouseDoubleClick.bind(this);e.addEventListener("dblclick",a,!1),e.addEventListener("contextmenu",t,!1),e.addEventListener("mousedown",i,!1),e.addEventListener("wheel",r,!1),e.addEventListener("touchstart",n,!1),e.addEventListener("touchend",s,!1),e.addEventListener("touchmove",o,!1),this.dispose=()=>{e.removeEventListener("dblclick",a,!1),e.removeEventListener("contextmenu",t,!1),e.removeEventListener("mousedown",i,!1),e.removeEventListener("wheel",r,!1),e.removeEventListener("touchstart",n,!1),e.removeEventListener("touchend",s,!1),e.removeEventListener("touchmove",o,!1)}}updateMapView(){this.dispatchEvent(h),this.mapView.update()}mouseDoubleClick(e){if(!this.enabled||!this.zoomEnabled)return;const t=this.getPointerPosition(e);this.zoomOnDoubleClickOrTap(t.x,t.y)}mouseDown(e){if(!1===this.enabled)return;if(e.shiftKey)return;if(e.stopPropagation(),this.m_state!==a.NONE)return;if(0===e.button&&!e.ctrlKey&&this.panEnabled)this.m_state=a.PAN;else if(1===e.button)this.m_state=a.ROTATE;else{if(2!==e.button&&!e.ctrlKey||!this.tiltEnabled)return;this.m_state=a.ORBIT}this.dispatchEvent(d);const t=this.getPointerPosition(e);if(this.m_lastMousePosition.copy(t),!0===e.altKey){const{width:e,height:i}=o.getWidthAndHeightFromCanvas(this.domElement);this.m_initialMousePosition.copy(o.calculateNormalizedDeviceCoordinates(t.x,t.y,e,i))}else this.m_initialMousePosition.set(0,0);const i=this.mouseMove.bind(this),r=this.mouseUp.bind(this);window.addEventListener("mousemove",i,!1),window.addEventListener("mouseup",r,!1),this.m_cleanupMouseEventListeners=()=>{window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",r)}}mouseMove(e){if(!1===this.enabled)return;const t=this.getPointerPosition(e);if(this.m_mouseDelta.set(t.x-this.m_lastMousePosition.x,t.y-this.m_lastMousePosition.y),this.m_state===a.PAN){const e=this.getWorldPositionWithElevation(this.m_lastMousePosition.x,this.m_lastMousePosition.y,t.x,t.y);if(void 0===e)return;const{fromWorld:i,toWorld:r}=e;this.panFromTo(i,r)}else this.m_state===a.ROTATE?(this.stopExistingAnimations(),n.MapViewUtils.rotate(this.mapView,-this.rotationMouseDeltaFactor*this.m_mouseDelta.x,this.rotationMouseDeltaFactor*this.m_mouseDelta.y,this.m_maxTiltAngle)):this.m_state===a.ORBIT&&(this.stopExistingAnimations(),n.MapViewUtils.orbitAroundScreenPoint(this.mapView,this.m_initialMousePosition.x,this.m_initialMousePosition.y,this.orbitingMouseDeltaFactor*this.m_mouseDelta.x,-this.orbitingMouseDeltaFactor*this.m_mouseDelta.y,this.m_maxTiltAngle));this.m_lastMousePosition.set(t.x,t.y),this.m_zoomAnimationStartTime=performance.now(),this.updateMapView(),e.preventDefault(),e.stopPropagation()}mouseUp(e){!1!==this.enabled&&(this.updateMapView(),e.preventDefault(),e.stopPropagation(),this.m_state=a.NONE,this.m_cleanupMouseEventListeners&&this.m_cleanupMouseEventListeners(),this.dispatchEvent(u))}mouseWheel(e){if(!this.enabled||!this.zoomEnabled)return;const{width:t,height:i}=o.getWidthAndHeightFromCanvas(this.domElement),r=o.calculateNormalizedDeviceCoordinates(e.offsetX,e.offsetY,t,i);this.setZoomLevel(this.zoomLevelTargeted+this.zoomLevelDeltaOnMouseWheel*(e.deltaY>0?-1:1),r),e.preventDefault(),e.stopPropagation()}updateCurrentRotation(){if(this.m_touchState.touches.length<2||0===this.m_touchState.touches[1].currentWorldPosition.length()||0===this.m_touchState.touches[0].currentWorldPosition.length())return;let e=0,t=0;this.mapView.projection.type===r.ProjectionType.Planar?(e=this.m_touchState.touches[1].currentWorldPosition.x-this.m_touchState.touches[0].currentWorldPosition.x,t=this.m_touchState.touches[1].currentWorldPosition.y-this.m_touchState.touches[0].currentWorldPosition.y):this.mapView.projection.type===r.ProjectionType.Spherical&&(e=this.m_touchState.touches[1].currentTouchPoint.x-this.m_touchState.touches[0].currentTouchPoint.x,t=this.m_touchState.touches[0].currentTouchPoint.y-this.m_touchState.touches[1].currentTouchPoint.y,this.m_touchState.initialRotation=this.m_touchState.currentRotation),this.m_touchState.currentRotation=Math.atan2(t,e)}calculatePinchDistanceInWorldSpace(){if(this.m_touchState.touches.length<2)return 0;const e=this.m_tmpVector3.subVectors(this.m_touchState.touches[0].initialWorldPosition,this.m_touchState.touches[1].initialWorldPosition).length();return this.m_tmpVector3.subVectors(this.m_touchState.touches[0].currentWorldPosition,this.m_touchState.touches[1].currentWorldPosition).length()-e}convertTouchPoint(e,t){const i=this.getPointerPosition(e);if(void 0!==t){const e=t.currentTouchPoint,r=this.getWorldPositionWithElevation(e.x,e.y,i.x,i.y),n=void 0===r?new s.Vector3:r.toWorld;return 0!==n.length()||3===this.m_touchState.touches.length&&this.tiltEnabled?(this.m_state!==a.TOUCH&&this.dispatchEvent(d),this.m_state=a.TOUCH,{currentTouchPoint:i,lastTouchPoint:i,currentWorldPosition:n,initialWorldPosition:n}):(this.setTouchState([]),this.m_state=a.NONE,void this.dispatchEvent(u))}{const{width:e,height:t}=o.getWidthAndHeightFromCanvas(this.domElement),r=o.calculateNormalizedDeviceCoordinates(i.x,i.y,e,t),l=n.MapViewUtils.rayCastWorldCoordinates(this.mapView,r.x,r.y),c=null===l?new s.Vector3:l;return 0!==c.length()||3===this.m_touchState.touches.length&&this.tiltEnabled?(this.m_state!==a.TOUCH&&this.dispatchEvent(d),this.m_state=a.TOUCH,{currentTouchPoint:i,lastTouchPoint:i,currentWorldPosition:c,initialWorldPosition:c}):(this.setTouchState([]),this.m_state=a.NONE,void this.dispatchEvent(u))}}setTouchState(e){this.m_touchState.touches=[];for(let t=0;t<e.length;++t){const i=this.convertTouchPoint(e[t]);void 0!==i&&this.m_touchState.touches.push(i)}0!==this.m_touchState.touches.length&&(this.updateCurrentRotation(),this.m_touchState.initialRotation=this.m_touchState.currentRotation)}updateTouches(e){const t=Math.min(e.length,this.m_touchState.touches.length);for(let i=0;i<t;++i){const t=this.m_touchState.touches[i],r=this.convertTouchPoint(e[i],t);void 0!==r&&void 0!==t&&(r.initialWorldPosition=t.initialWorldPosition,r.lastTouchPoint=t.currentTouchPoint,this.m_touchState.touches[i]=r)}}zoomOnDoubleClickOrTap(e,t){if(0===this.zoomLevelDeltaOnDoubleClick)return;const{width:i,height:r}=o.getWidthAndHeightFromCanvas(this.domElement),n=o.calculateNormalizedDeviceCoordinates(e,t,i,r);this.setZoomLevel(this.currentZoom+this.zoomLevelDeltaOnDoubleClick,n)}touchStart(e){!1!==this.enabled&&(this.m_tapStartTime=performance.now(),this.m_fingerMoved=!1,this.m_state=a.TOUCH,this.dispatchEvent(d),this.setTouchState(e.touches),this.updateTouches(e.touches),e.preventDefault(),e.stopPropagation())}touchMove(e){if(!1!==this.enabled){if(this.m_fingerMoved=!0,this.updateTouches(e.touches),this.panEnabled&&this.m_touchState.touches.length<=2&&void 0!==this.m_touchState.touches[0]&&this.panFromTo(this.m_touchState.touches[0].initialWorldPosition,this.m_touchState.touches[0].currentWorldPosition),2===this.m_touchState.touches.length){const e=this.m_touchState.touches,t=new s.Vector2;if(!0===this.zoomEnabled||!0===this.rotateEnabled){const{width:i,height:r}=o.getWidthAndHeightFromCanvas(this.domElement);e.forEach((e=>{const n=o.calculateNormalizedDeviceCoordinates(e.currentTouchPoint.x,e.currentTouchPoint.y,i,r);t.add(n)})),t.divideScalar(e.length)}if(this.zoomEnabled){const e=this.calculatePinchDistanceInWorldSpace();if(Math.abs(e)<p)return;const i=n.MapViewUtils.calculateZoomLevelFromDistance(this.mapView,this.mapView.targetDistance-e);n.MapViewUtils.zoomOnTargetPosition(this.mapView,t.x,t.y,i,this.m_maxTiltAngle)}if(this.rotateEnabled){this.updateCurrentRotation();const e=this.m_touchState.currentRotation-this.m_touchState.initialRotation;this.stopExistingAnimations(),n.MapViewUtils.orbitAroundScreenPoint(this.mapView,t.x,t.y,e,0,this.m_maxTiltAngle)}}if(3===this.m_touchState.touches.length&&this.tiltEnabled){const e=this.m_touchState.touches[0],t=this.m_tmpVector2.subVectors(e.currentTouchPoint,e.lastTouchPoint);this.stopExistingAnimations(),n.MapViewUtils.orbitAroundScreenPoint(this.mapView,0,0,this.orbitingTouchDeltaFactor*t.x,-this.orbitingTouchDeltaFactor*t.y,this.m_maxTiltAngle)}this.m_zoomAnimationStartTime=performance.now(),this.updateMapView(),e.preventDefault(),e.stopPropagation()}}touchEnd(e){!1!==this.enabled&&(this.m_state=a.NONE,this.handleDoubleTap(),this.setTouchState(e.touches),this.dispatchEvent(u),this.updateMapView(),e.preventDefault(),e.stopPropagation())}handleDoubleTap(){if(this.m_fingerMoved||!this.zoomEnabled)return;const e=performance.now();return e-this.m_tapStartTime>120?void 0:this.m_isDoubleTap?(e-this.m_lastSingleTapTime>1e3*this.doubleTapTime||this.zoomOnDoubleClickOrTap(this.m_touchState.touches[0].currentTouchPoint.x,this.m_touchState.touches[0].currentTouchPoint.y),void(this.m_isDoubleTap=!1)):(this.m_isDoubleTap=!0,void(this.m_lastSingleTapTime=e))}contextMenu(e){e.preventDefault()}getWorldPositionWithElevation(e,t,i,r){const{width:s,height:a}=o.getWidthAndHeightFromCanvas(this.domElement),l=o.calculateNormalizedDeviceCoordinates(e,t,s,a),c=o.calculateNormalizedDeviceCoordinates(i,r,s,a);let h,d,u;if(void 0!==this.mapView.elevationProvider&&(u=this.mapView.elevationProvider.rayCast(e,t)),void 0===u)d=n.MapViewUtils.rayCastWorldCoordinates(this.mapView,l.x,l.y),h=n.MapViewUtils.rayCastWorldCoordinates(this.mapView,c.x,c.y);else{d=u;const e=this.mapView.projection.unprojectAltitude(d);h=n.MapViewUtils.rayCastWorldCoordinates(this.mapView,c.x,c.y,e)}if(null!==d&&null!==h)return{fromWorld:d,toWorld:h}}panFromTo(e,t){this.stopExistingAnimations(),this.m_panAnimationStartTime=performance.now(),this.mapView.projection.type===r.ProjectionType.Planar?this.m_panDistanceFrameDelta.subVectors(e,t):this.mapView.projection.type===r.ProjectionType.Spherical&&(this.m_lastRotateGlobeFromVector.copy(e),this.m_lastRotateGlobeAxis.crossVectors(e,t).normalize(),this.m_lastRotateGlobeAngle=e.angleTo(t),isNaN(this.m_lastRotateGlobeAngle)&&(this.m_lastRotateGlobeAngle=0)),this.handlePan()}getPointerPosition(e){const t=o.getWidthAndHeightFromCanvas(this.domElement),i=this.domElement.getBoundingClientRect(),r=Math.round(i.width)/t.width,n=Math.round(i.height)/t.height;return new s.Vector2((e.clientX-Math.floor(i.left))*r,(e.clientY-Math.floor(i.top))*n)}}t.MapControls=f},5335:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapControlsUI=void 0;const r=i(3139),n=i(2530);t.MapControlsUI=class{constructor(e,t={}){this.controls=e,this.domElement=document.createElement("div"),this.m_buttonsElement=document.createElement("div"),this.m_zoomLevelElement=null,this.m_projectionSwitchElement=null,this.m_onMapViewRenderEvent=()=>{if(null===this.m_zoomLevelElement)return;const e=this.controls.zoomLevelTargeted.toFixed(1);"INPUT"===this.m_zoomLevelElement.tagName?this.m_zoomLevelElement.value=e:this.m_zoomLevelElement.innerHTML=e},this.m_onWindowClick=e=>{const t=this.m_zoomLevelElement;e&&e.target&&e.target.contains&&e.target!==t&&!e.target.contains(t)&&t.blur()};const i=document.createElement("span");i.className="harp-gl_v-align",this.domElement.appendChild(i),this.m_buttonsElement=document.createElement("div"),this.m_buttonsElement.className="harp-gl_v-aligned",this.domElement.appendChild(this.m_buttonsElement);const s=document.createElement("button");s.innerText="+",s.className="harp-gl_controls_button-top",s.classList.add("harp-gl_controls-button");const o=document.createElement("button");o.innerText="-",o.className="harp-gl_controls_button-bottom",o.classList.add("harp-gl_controls-button");const a=document.createElement("button");a.innerText="3D",a.id="harp-gl_controls_tilt-button-ui",a.title="Toggle tilt",a.classList.add("harp-gl_controls-button"),a.classList.add("harp-gl_controls_button-bottom");const l=document.createElement("button");l.id="harp-gl_controls-button_compass",l.title="Reset North",l.classList.add("harp-gl_controls-button"),l.classList.add("harp-gl_controls_button-top");const c=document.createElement("span");if(c.id="harp-gl_controls_compass",l.appendChild(c),"show"===t.zoomLevel)this.m_zoomLevelElement=document.createElement("div"),e.mapView.addEventListener(n.MapViewEventNames.Render,this.m_onMapViewRenderEvent);else if("input"===t.zoomLevel){const t=document.createElement("input");t.type="number",t.step="0.1",e.mapView.addEventListener(n.MapViewEventNames.Render,this.m_onMapViewRenderEvent);const i=i=>{e.setZoomLevel(parseFloat(t.value)),i.preventDefault()};t.addEventListener("blur",i),t.addEventListener("keypress",(e=>{"Enter"===e.key&&i(e)})),window.addEventListener("click",this.m_onWindowClick),this.m_zoomLevelElement=t}if(t.projectionSwitch){const e=document.createElement("button");e.id="harp-gl_controls_switch_projection",e.classList.add("harp-gl_controls-button");const t=()=>`Switch to ${this.controls.mapView.projection.type===r.ProjectionType.Spherical?"flat":"globe"} projection`;e.title=t();const i='\n    <svg style="margin-top:5px;" stroke-width="2" class="harp-gl_controls_switch_svg" width="50" height="50" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">\n        <ellipse ry="9.79855" rx="4.56139" id="svg_6" cy="11.99798" cx="11.99798" fill="none"/>\n        <line id="svg_8" y2="8.16866" x2="21.12086" y1="8.16866" x1="3.10044"/>\n        <line id="svg_9" y2="16.10887" x2="21.0645" y1="16.10887" x1="3.04409"/>\n        <ellipse id="svg_11" ry="9.79855" rx="9.82671" cy="11.94167" cx="12.02614" fill="none"/>\n    </svg>',n='\n    <svg style="margin-top:5px;" class="harp-gl_controls_switch_svg" width="25" height="25" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">\n        <rect id="svg_1" stroke-width="2" height="13.51524" width="18.35821" y="5.80349" x="3.21307" fill="none"/>\n        <path id="svg_14" d="m9.52018,7.71815l1.2357,-0.0032l-0.61945,1.18258l-0.61625,-1.17938z"/>\n        <path id="svg_15" d="m4.11409,7.32396l3.65718,-0.0032l0.28156,2.13991l-2.59042,1.57678l0.50682,1.80203l2.25254,0.8447l-0.90101,2.0836l0.28157,2.25254l-3.26619,-3.04093l0.67576,-2.02728l-0.61945,-1.97097l-1.01364,-3.15356l0.73528,-0.50362z"/>\n        <path id="svg_17" d="m13.23688,7.4929l2.02409,-0.0032l0.78839,1.29521l2.47779,-1.35152l2.75936,0.78839l0,1.57678l-0.73208,0.61945l-0.28157,1.97097c0,0 -0.67256,0.8479 -0.72888,0.90422c-0.05631,0.05631 0.28157,1.06996 0.33788,1.18258c0.05631,0.11263 -1.68941,-1.35152 -1.6926,-1.35472c-0.0032,-0.0032 -0.16574,1.29841 -0.16894,1.29521c-0.0032,-0.0032 -1.57358,-1.34832 -1.57678,-1.35152c-0.0032,-0.0032 -0.72888,0.67896 -0.73208,0.67576c-0.0032,-0.0032 -0.8415,-0.67256 -0.8447,-0.67576c-0.0032,-0.0032 0.73528,2.0868 0.79159,2.0868c0.05631,0 -0.50682,3.20987 -0.51002,3.20667c-0.0032,-0.0032 -1.2357,-0.16574 -1.34832,-0.16574c-0.11263,0 -0.95733,-1.52046 -0.90102,-1.57678c0.05631,-0.05631 0,-1.80203 -0.0032,-1.80523c-0.0032,-0.0032 -1.40464,-0.33468 -1.40784,-0.33788c-0.0032,-0.0032 -0.05311,-1.74252 -0.05631,-1.74572c-0.0032,-0.0032 1.18578,-0.8415 1.18258,-0.8447c-0.0032,-0.0032 1.69261,-0.16574 1.74892,-0.16574c0.05631,0 1.2389,-1.06996 1.2357,-1.07316c-0.0032,-0.0032 -1.91146,-0.10943 -1.91466,-0.11263c-0.0032,-0.0032 -1.96777,0.17214 -1.97097,0.16894c-0.0032,-0.0032 1.52366,-3.20667 1.52366,-3.20667z"/>\n    </svg>';e.innerHTML=this.controls.mapView.projection.type===r.ProjectionType.Spherical?n:i,e.addEventListener("click",(()=>{this.controls.mapView.projection=this.controls.mapView.projection.type===r.ProjectionType.Spherical?r.mercatorProjection:r.sphereProjection,e.title=t(),e.innerHTML=this.controls.mapView.projection.type===r.ProjectionType.Spherical?n:i})),this.m_projectionSwitchElement=e}return this.m_buttonsElement.appendChild(s),null!==this.m_zoomLevelElement&&this.m_buttonsElement.appendChild(this.m_zoomLevelElement),this.m_buttonsElement.appendChild(o),this.m_buttonsElement.appendChild(l),this.m_buttonsElement.appendChild(a),null!==this.m_projectionSwitchElement&&this.m_buttonsElement.appendChild(this.m_projectionSwitchElement),s.addEventListener("click",(t=>{const i=e.zoomLevelTargeted+e.zoomLevelDeltaOnControl;e.setZoomLevel(i)})),s.addEventListener("dblclick",(e=>{e.stopPropagation()})),o.addEventListener("click",(t=>{const i=e.zoomLevelTargeted-e.zoomLevelDeltaOnControl;e.setZoomLevel(i)})),o.addEventListener("dblclick",(e=>{e.stopPropagation()})),a.addEventListener("click",(t=>{e.toggleTilt()})),l.addEventListener("click",(t=>{e.pointToNorth()})),e.mapView.addEventListener(n.MapViewEventNames.AfterRender,(()=>{c.style.transform=`rotate(${e.mapView.heading}deg)`})),this.domElement.className="harp-gl_controls",null!==this.m_zoomLevelElement&&this.m_zoomLevelElement.classList.add("harp-gl_controls_zoom-level"),!0!==t.disableDefaultStyle&&(this.initStyle(),this.domElement.style.cssText="\n                position: absolute;\n                right: 5px;\n                top: 0;\n                height: 100%; /* Vertical alignment is done dynamically, in the rest of the CSS. */\n                pointer-events: none; /* Allows to click the map even though height is 100%. */\n            "),this}get projectionSwitchElement(){return this.m_projectionSwitchElement}dispose(){null!==this.m_zoomLevelElement&&"INPUT"===this.m_zoomLevelElement.tagName&&window.removeEventListener("click",this.m_onWindowClick),this.controls.mapView.removeEventListener(n.MapViewEventNames.Render,this.m_onMapViewRenderEvent),this.domElement.remove()}initStyle(){if(null!==document.getElementById("here-harp-controls.map-controls-ui-styles"))return;const e=document.createElement("style");e.id="here-harp-controls.map-controls-ui-styles",e.appendChild(document.createTextNode('\n        /* CSS trick to align another div dynamically. */\n        .harp-gl_v-align{\n            height: 100%;\n            display: inline-block;\n            vertical-align: middle;\n        }\n        /* The target element to align vertically with vertical-align. */\n        .harp-gl_v-aligned{\n            pointer-events: all;\n            vertical-align: middle;\n            display: inline-block;\n        }\n        .harp-gl_controls-button {\n            display: block;\n            background-color: #272d37;\n            width: 40px;\n            height: 40px;\n            font-size: 22px;\n            font-weight: bold;\n            outline: none;\n            margin:0;\n            border: none;\n            color: rgba(255, 255, 255, 0.8);\n            cursor: pointer;\n            border-radius: 4px;\n            box-shadow: 0px 0px 5px 0 hsl(220, 4%, 40%);\n            transition: all 0.1s;\n            padding: 0 0 1px 1px;\n            user-select: none;\n            position:relative;\n        }\n        #harp-gl_controls_tilt-button-ui {\n            font-size: 16px;\n        }\n        .harp-gl_controls-button:active {\n            background-color: #37afaa;\n            color: #eee;\n        }\n        .harp-gl_controls-button:focus {\n            outline:none;\n        }\n        .harp-gl_controls_button-top{\n            margin-bottom:0;\n            border-bottom-right-radius:0;\n            border-bottom-left-radius:0;\n        }\n        .harp-gl_controls_button-bottom{\n            margin-top:1px;\n            border-top-right-radius:0;\n            border-top-left-radius:0;\n        }\n        .harp-gl_controls_zoom-level {\n            display: block;\n            background-color: #fff;\n            width: 40px;\n            height: 20px;\n            font-size: 12px;\n            font-weight: bold;\n            outline: none;\n            border: none;\n            color: #555;\n            opacity: 0.87;\n            box-shadow: 0px 0px 4px #aaa;\n            padding: 2px 0 0;\n            text-align: center;\n            user-select: text;\n        }\n        input.harp-gl_controls_zoom-level::-webkit-outer-spin-button,\n        input.harp-gl_controls_zoom-level::-webkit-inner-spin-button {\n            /* display: none; <- Crashes Chrome on hover */\n            -webkit-appearance: none;\n            margin: 0; /* <-- Apparently some margin are still there even though it\'s hidden */\n        }\n        input.harp-gl_controls_zoom-level[type=number] {\n            -moz-appearance:textfield; /* Firefox */\n        }\n        #harp-gl_controls-button_compass{\n            overflow: hidden;\n            margin: 5px 0 0 0;\n        }\n        #harp-gl_controls_compass{\n            pointer-events:none;\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            margin:0\n        }\n        #harp-gl_controls_compass::after{\n            content: " ";\n            position:absolute;\n            left:50%;\n            margin-left:-3px;\n            top:50%;\n            margin-top: -18px;\n            border:solid 3px rgba(0,0,0,0);\n            border-bottom:solid 15px #a34f2e;\n        }\n        #harp-gl_controls_compass::before{\n            content: " ";\n            position:absolute;\n            left:50%;\n            margin-left:-3px;\n            top:50%;\n            margin-top:0px;\n            border:solid 3px rgba(0,0,0,0);\n            border-top:solid 15px #eee;\n        }\n        #harp-gl_controls_switch_projection{\n            margin-top:5px;\n        }\n        .harp-gl_controls_switch_svg{\n            width: 25px;\n            height: 25px;\n            stroke: #d4d5d7;\n            fill: #d4d5d7;\n        }\n    ')),document.head.appendChild(e)}}},4920:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWidthAndHeightFromCanvas=t.safeParseDecimalInt=t.azimuthAltitudeToDirection=t.calculateNormalizedDeviceCoordinates=void 0;const r=i(4428);function n(e,t){if(null==e||""===e)return t;if(!e.match(s))return t;const i=Number.parseInt(e,10);return isNaN(i)?t:i}t.calculateNormalizedDeviceCoordinates=function(e,t,i,n){return new r.Vector2(e/i*2-1,-t/n*2+1)},t.azimuthAltitudeToDirection=function(e,t){e=e,t=t;const i=new r.Vector3,n=Math.cos(t);return i.setX(Math.sin(e)*n),i.setY(Math.cos(e)*n),i.setZ(Math.sin(t)),i},t.safeParseDecimalInt=n;const s=/^\d+$/;t.getWidthAndHeightFromCanvas=function(e){return{width:n(e.style.width,e.clientWidth),height:n(e.style.height,e.clientHeight)}}},6422:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataProvider=void 0,i(4456);const r=i(4428);class n extends r.EventDispatcher{constructor(){super(...arguments),this.m_clients=new Set}register(e){return 0===this.m_clients.size&&(this.m_connectPromise=this.connect()),this.m_clients.add(e),this.m_connectPromise}unregister(e){this.m_clients.delete(e)&&0===this.m_clients.size&&this.dispose()}}t.DataProvider=n},2476:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileDataSource=t.TileFactory=void 0;const r=i(2530),n=i(3119),s=i(2183),o=i(7476);t.TileFactory=class{constructor(e){this.m_modelConstructor=e}create(e,t){const i=new this.m_modelConstructor(e,t);return i.tileLoader=new o.TileLoader(e,t,e.dataProvider(),e.decoder),i}};class a extends r.DataSource{constructor(e,t){var i,n;if(super(t),this.m_tileFactory=e,this.m_options=t,this.logger=s.LoggerManager.instance.create("TileDataSource"),this.m_isReady=!1,t.decoder)this.m_decoder=t.decoder;else{if(!t.concurrentDecoderServiceName)throw new Error(`TileDataSource[${this.name}]: unable to create, missing decoder or concurrentDecoderServiceName`);this.m_decoder=r.ConcurrentDecoderFacade.getTileDecoder(t.concurrentDecoderServiceName,t.concurrentDecoderScriptUrl,t.concurrentDecoderWorkerCount)}this.useGeometryLoader=!0,this.cacheable=!0,this.m_unregisterClearTileCache=null===(n=(i=this.dataProvider()).onDidInvalidate)||void 0===n?void 0:n.call(i,(()=>this.mapView.markTilesDirty(this)))}dispose(){var e;null===(e=this.m_unregisterClearTileCache)||void 0===e||e.call(this),this.decoder.dispose(),this.dataProvider().unregister(this)}ready(){return this.m_isReady&&this.m_options.dataProvider.ready()}get decoder(){return this.m_decoder}async connect(){await Promise.all([this.m_options.dataProvider.register(this),this.m_decoder.connect()]),this.m_isReady=!0;let e={};void 0!==this.m_options.storageLevelOffset&&(e={storageLevelOffset:this.m_options.storageLevelOffset}),this.m_decoder.configure({languages:this.languages},e)}setLanguages(e){this.languages=e,this.m_decoder.configure({languages:this.languages}),this.mapView.clearTileCache(this.name)}async setTheme(e,t){let i;e=await n.ThemeLoader.load(e),void 0!==this.styleSetName&&void 0!==e.styles&&(i=e.styles[this.styleSetName]),void 0!==t&&(this.languages=t),void 0!==i&&(this.m_decoder.configure({styleSet:i,definitions:e.definitions,priorities:e.priorities,labelPriorities:e.labelPriorities,languages:t}),this.mapView.clearTileCache(this.name))}dataProvider(){return this.m_options.dataProvider}getTilingScheme(){return this.m_options.tilingScheme}getTile(e,t=!1){const i=this.m_tileFactory.create(this,e);return i.copyrightInfo=this.m_options.copyrightInfo,void 0!==this.m_options.copyrightProvider&&this.m_options.copyrightProvider.getCopyrights(i.geoBox,e.level).then((e=>{i.copyrightInfo=void 0===i.copyrightInfo?e:[...i.copyrightInfo,...e],this.requestUpdate()})),t||i.load(),i}getTileInfo(e){return new Promise(((t,i)=>{const n=new o.TileInfoLoader(this,e,this.m_options.dataProvider,this.decoder);n.loadAndDecode().then((e=>{e===r.TileLoaderState.Ready?t(n.tileInfo):i(new Error(`TileDataSource#getInfoTile wrong final state: ${e}`))}))}))}}t.TileDataSource=a},7476:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileInfoLoader=t.TileLoader=void 0,i(4456);const r=i(3187),n=i(2530),s=i(1679),o=i(2183).LoggerManager.instance.create("TileLoader");class a extends n.BaseTileLoader{constructor(e,t,i,r){super(e,t),this.dataSource=e,this.tileKey=t,this.dataProvider=i,this.tileDecoder=r}get priority(){return this.m_priority}set priority(e){this.m_priority=e,void 0!==this.requestController&&(this.requestController.priority=e)}loadImpl(e,t,i){this.dataProvider.getTile(this.tileKey,e).then((r=>{if(e.aborted){const e=new Error("Aborted");throw e.name="AbortError",e}this.onLoaded(r,t,i)})).catch((e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&i(e)}))}cancelImpl(){this.state===s.TileLoaderState.Decoding&&this.requestController&&(this.requestController.abort(),this.requestController=void 0)}startDecodeTile(e,t){const i=this.payload;if(void 0===i)return void o.error("TileLoader#startDecodeTile: Cannot decode without payload");this.state=s.TileLoaderState.Decoding,this.payload=void 0;const n=new r.RequestController(this.priority);this.requestController=n;const a=this.dataSource;this.tileDecoder.decodeTile(i,this.tileKey,a.projection,n).then((t=>{n.signal.aborted||this.onDecoded(t,e)})).catch((e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&t(e)}))}onLoaded(e,t,i){this.state=s.TileLoaderState.Loaded,this.payload=e,0===e.byteLength||e.constructor===Object&&0===Object.keys(e).length?this.onDecoded({geometries:[],techniques:[]},t):this.startDecodeTile(t,i)}onDecoded(e,t){this.decodedTile=e,t(s.TileLoaderState.Ready)}}t.TileLoader=a,t.TileInfoLoader=class extends a{startDecodeTile(e,t){const i=this.payload;if(void 0===i)return void o.error("TileInfoLoader#startDecodeTile: Cannot decode without payload");this.state=s.TileLoaderState.Decoding,this.payload=void 0;const n=new r.RequestController(this.priority);this.requestController=n;const a=this.dataSource;this.tileDecoder.getTileInfo(i,this.tileKey,a.projection,n).then((t=>{n.signal.aborted||(this.tileInfo=t,e(s.TileLoaderState.Ready))})).catch((e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&t(e)}))}}},4502:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnimatedExtrusionHandler=t.AnimatedExtrusionState=void 0;const r=i(3187),n=i(284),s=i(2183);var o;!function(e){e[e.None=0]="None",e[e.Started=1]="Started",e[e.Finished=2]="Finished"}(o=t.AnimatedExtrusionState||(t.AnimatedExtrusionState={})),t.AnimatedExtrusionHandler=class{constructor(e){this.m_mapView=e,this.enabled=!0,this.duration=750,this.m_minZoomLevel=1,this.m_forceEnabled=!1,this.m_dataSourceMap=new Map,this.m_state=o.None,this.m_startTime=-1}get forceEnabled(){return this.m_forceEnabled}set forceEnabled(e){this.m_forceEnabled=e,this.duration=750}get minZoomLevel(){return this.m_minZoomLevel}setAnimationProperties(e,t){if(!r.isExtrudedPolygonTechnique(e))return!1;if(e.hasOwnProperty("minZoomLevel")&&(this.m_minZoomLevel=e.minZoomLevel),this.forceEnabled)return this.enabled;void 0!==e.animateExtrusionDuration&&(this.duration=e.animateExtrusionDuration);const i=r.getPropertyValue(e.animateExtrusion,t);return null===i?this.enabled:"boolean"==typeof i?i:"number"==typeof i&&0!==i}update(e){const t=this.m_dataSourceMap.size>0&&e>=this.m_minZoomLevel;this.m_state===o.None&&t?this.m_state=o.Started:this.m_state===o.None||t||this.resetAnimation(!0),this.animateExtrusion()}add(e,t){e.addDisposeCallback(this.removeTile.bind(this));let i=!1;this.m_state!==o.None&&(i=this.skipAnimation(e),i?this.setTileExtrusionRatio(t,1):this.m_state===o.Finished&&this.resetAnimation(!1)),this.getOrCreateTileMap(e.dataSource).set(e.tileKey.mortonCode(),{materials:t,animated:i})}get isAnimating(){return this.m_state!==o.Finished&&this.m_state!==o.None}getTileMap(e,t=!1){return this.m_dataSourceMap.get(e)}getOrCreateTileMap(e){let t=this.m_dataSourceMap.get(e);return t||(t=new Map,this.m_dataSourceMap.set(e,t)),t}skipAnimation(e){return this.wasAnyAncestorAnimated(e)||this.wasAnyDescendantAnimated(e)}wasAnyAncestorAnimated(e){var t,i;const r=e.dataSource.getDataZoomLevel(this.m_minZoomLevel),n=Math.max(0,e.tileKey.level-r),s=Math.min(n,this.m_mapView.visibleTileSet.options.quadTreeSearchDistanceUp),o=this.getTileMap(e.dataSource);if(!o)return!1;let a=e.tileKey;for(let e=1;e<=s;++e)if(a=a.parent(),null!==(i=null===(t=o.get(a.mortonCode()))||void 0===t?void 0:t.animated)&&void 0!==i&&i)return!0;return!1}wasAnyDescendantAnimated(e){var t,i;const r=e.dataSource.maxDataLevel-e.tileKey.level,n=Math.min(r,this.m_mapView.visibleTileSet.options.quadTreeSearchDistanceDown),s=this.getTileMap(e.dataSource);if(!s)return!1;const o=e.dataSource.getTilingScheme();let a=[e.tileKey],l=[];for(let e=1;e<=n;++e){l.length=0;for(const e of a)for(const r of o.getSubTileKeys(e)){if(null!==(i=null===(t=s.get(r.mortonCode()))||void 0===t?void 0:t.animated)&&void 0!==i&&i)return!0;l.push(r)}[a,l]=[l,a]}return!1}removeTile(e){const t=this.getTileMap(e.dataSource);t&&(t.delete(e.tileKey.mortonCode()),0===t.size&&this.m_dataSourceMap.delete(e.dataSource))}animateExtrusion(){if(this.m_state!==o.Started)return;const e=Date.now();this.m_startTime<0&&(this.m_startTime=e);const t=this.duration,i=Math.min(e-this.m_startTime,t),r=s.MathUtils.easeInOutCubic(n.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN,n.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX,i/t);this.setExtrusionRatio(r),i>=t&&(this.m_state=o.Finished),this.m_mapView.update()}resetAnimation(e){this.m_state=o.None,this.m_startTime=-1,e&&this.m_dataSourceMap.forEach((e=>{e.forEach((e=>{e.animated=!1}))}))}setExtrusionRatio(e){this.m_dataSourceMap.forEach((t=>{t.forEach((t=>{t.animated||(this.setTileExtrusionRatio(t.materials,e),e>=1&&(t.animated=!0))}))}))}setTileExtrusionRatio(e,t){e.forEach((e=>{e.extrusionRatio=t}))}}},783:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundDataSource=void 0;const r=i(3139),n=i(5532),s=i(8944),o=i(2315);class a extends n.DataSource{constructor(){super({name:"background"}),this.m_tilingScheme=a.DEFAULT_TILING_SCHEME,this.cacheable=!0,this.addGroundPlane=!0,this.enablePicking=!1}updateStorageLevelOffset(){let e;this.mapView.dataSources.forEach((t=>{t!==this&&t.getTilingScheme()===this.m_tilingScheme&&(e=void 0===e?t.storageLevelOffset:Math.max(e,t.storageLevelOffset))})),void 0===e&&(e=0),e!==this.storageLevelOffset&&(this.storageLevelOffset=e,this.mapView.clearTileCache(this.name))}async setTheme(e,t){this.mapView.clearTileCache(this.name)}setTilingScheme(e){const t=null!=e?e:a.DEFAULT_TILING_SCHEME;t!==this.m_tilingScheme&&(this.m_tilingScheme=t,this.updateStorageLevelOffset(),this.mapView.clearTileCache(this.name))}getTilingScheme(){return this.m_tilingScheme}getTile(e){const t=new o.Tile(this,e);return t.forceHasGeometry(!0),s.addGroundPlane(t,a.GROUND_RENDER_ORDER),t}}t.BackgroundDataSource=a,a.GROUND_RENDER_ORDER=Number.MIN_SAFE_INTEGER,a.DEFAULT_TILING_SCHEME=r.webMercatorTilingScheme},1761:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseTileLoader=void 0;const r=i(2183),n=i(1679),s=r.LoggerManager.instance.create("BaseTileLoader");t.BaseTileLoader=class{constructor(e,t){this.dataSource=e,this.tileKey=t,this.state=n.TileLoaderState.Initialized,this.m_priority=0,this.loadAbortController=new AbortController}get priority(){return this.m_priority}set priority(e){this.m_priority=e}loadAndDecode(){switch(this.state){case n.TileLoaderState.Loading:case n.TileLoaderState.Loaded:case n.TileLoaderState.Decoding:return this.donePromise;case n.TileLoaderState.Ready:case n.TileLoaderState.Failed:case n.TileLoaderState.Initialized:case n.TileLoaderState.Canceled:return this.load(),this.donePromise}}waitSettled(){return this.donePromise?this.donePromise:Promise.resolve(this.state)}cancel(){this.state===n.TileLoaderState.Loading&&(this.loadAbortController.abort(),this.loadAbortController=new AbortController),this.cancelImpl(),this.onDone(n.TileLoaderState.Canceled)}get isFinished(){return this.state===n.TileLoaderState.Ready||this.state===n.TileLoaderState.Canceled||this.state===n.TileLoaderState.Failed}cancelImpl(){}load(){this.loadImpl(this.loadAbortController.signal,this.onDone.bind(this),this.onError.bind(this)),void 0===this.donePromise&&(this.donePromise=new Promise(((e,t)=>{this.resolveDonePromise=e,this.rejectedDonePromise=t}))),this.state=n.TileLoaderState.Loading}onDone(e){this.resolveDonePromise&&e===n.TileLoaderState.Ready?this.resolveDonePromise(e):this.rejectedDonePromise&&this.rejectedDonePromise(e),this.resolveDonePromise=void 0,this.rejectedDonePromise=void 0,this.donePromise=void 0,this.state=e}onError(e){if(this.state===n.TileLoaderState.Canceled)return;const t=this.dataSource;s.error(`[${t.name}]: failed to load tile ${this.tileKey.mortonCode()}`,e),this.error=e,this.onDone(n.TileLoaderState.Failed)}}},2859:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BoundsGenerator=void 0;const r=i(3139),n=i(2183),s=i(4428),o=i(8008),a=i(8730);function l(e){return(e+1)%4}function c(e){return(e+3)%4}const h=[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}];t.BoundsGenerator=class{constructor(e,t,i=!1){this.m_camera=e,this.m_projection=t,this.tileWrappingEnabled=i,this.m_groundPlaneNormal=new s.Vector3(0,0,1),this.m_groundPlane=new s.Plane(this.m_groundPlaneNormal.clone())}set projection(e){this.m_projection=e}generate(){return this.m_projection.type===r.ProjectionType.Planar?this.generateOnPlane():this.generateOnSphere()}createPolygon(e,t,i=!1){if(e.length>2)return new r.GeoPolygon(e,t,i)}addSideSegmentSubdivisionsOnSphere(e,t,i,r,n){e.push(r);const o=function(e,t){const i=Math.abs(t.latitude-e.latitude),r=e.minLongitudeSpanTo(t);return Math.ceil(Math.max(i/20,r/5))}(r,n);if(o<=1)return;const l=new s.Vector2(i.x-t.x,i.y-t.y).multiplyScalar(1/o),c=new s.Vector2(t.x,t.y);for(let t=0;t<o-1;t++){c.add(l);const t=a.MapViewUtils.rayCastWorldCoordinates({camera:this.m_camera,projection:this.m_projection},c.x,c.y);t&&e.push(this.m_projection.unprojectPoint(t))}}addSideIntersectionsOnSphere(e,t,i,s,o){n.assert(this.m_projection.type===r.ProjectionType.Spherical);const a=h[t],d=h[l(t)];if(i&&s)return void this.addSideSegmentSubdivisionsOnSphere(e,a,d,i,s);if(!o)return;const u=o.getSideIntersections(t);if(0!==u.length){if(i){const t=o.getPoint(u[u.length-1]),r=this.m_projection.unprojectPoint(t);this.addSideSegmentSubdivisionsOnSphere(e,a,t.project(this.m_camera),i,r)}else{const i=c(t);let r=o.getSideIntersections(i);0===r.length&&(r=o.getSideIntersections(c(i))),n.assert(r.length>0),o.getDivisionPoints((t=>{e.push(this.m_projection.unprojectPoint(t))}),r[r.length-1],u[0])}if(u.length>1){const t=o.getPoint(u[0]),i=o.getPoint(u[1]),r=this.m_projection.unprojectPoint(t),n=this.m_projection.unprojectPoint(i);this.addSideSegmentSubdivisionsOnSphere(e,t.project(this.m_camera),i.project(this.m_camera),r,n)}if(s){const t=o.getPoint(u[0]),i=this.m_projection.unprojectPoint(t);this.addSideSegmentSubdivisionsOnSphere(e,t.project(this.m_camera),d,i,s)}}}findBoundsIntersectionsOnSphere(){n.assert(this.m_projection.type===r.ProjectionType.Spherical);const e=[],t=[];this.addCanvasCornerIntersection(e);const i=e.length<4?new o.SphereHorizon(this.m_camera):void 0;if(0===e.length&&i.isFullyVisible)return i.getDivisionPoints((e=>{t.push(this.m_projection.unprojectPoint(e))})),t;e.length=4;for(let r=o.CanvasSide.Bottom;r<4;r++){const n=e[r],s=e[l(r)];this.addSideIntersectionsOnSphere(t,r,n,s,i)}return t}wrapAroundPoles(e){const t=new s.Vector3(0,0,r.EarthConstants.EQUATORIAL_RADIUS),i=new s.Vector3(0,0,-r.EarthConstants.EQUATORIAL_RADIUS),n=a.MapViewUtils.closeToFrustum(t,this.m_camera),o=a.MapViewUtils.closeToFrustum(i,this.m_camera);if(!n&&!o)return;const l=this.m_projection.unprojectPoint(this.m_camera.position).lng,c=n?90:-90,h=n?l+180:l-180,d=new r.GeoCoordinates(c,h),u=d.normalized(),m=u.lng;let p=e[e.length-1].lng,f=!1;const g=e.findIndex((e=>{const t=r.isAntimeridianCrossing(p,e.lng);return Math.sign(m-e.lng)===Math.sign(m-p)===t?(f=t,!0):(p=e.lng,!1)}));if(g<0)return;const v=n?90:-90,_=n?1e-5:-1e-5,y=new r.GeoCoordinates(c,l+v).normalized(),x=new r.GeoCoordinates(c,l).normalized(),b=new r.GeoCoordinates(c,l-v).normalized(),T=new r.GeoCoordinates(c,h+_).normalized(),w=e[(g+e.length-1)%e.length],S=e[g];let M=r.GeoCoordinates.lerp(w,S,.01,f);f&&n?M.longitude-=360:M=M.normalized(),e.splice(g,0,h<-180?d:u,y,x,b,T,M)}generateOnSphere(){n.assert(this.m_projection.type===r.ProjectionType.Spherical);const e=this.findBoundsIntersectionsOnSphere();return this.wrapAroundPoles(e),this.createPolygon(e,!1,!0)}generateOnPlane(){const e=[];if(this.addCanvasCornerIntersection(e),4===e.length)return this.createPolygon(e,!0);this.addHorizonIntersection(e);const t=(new s.Frustum).setFromProjectionMatrix((new s.Matrix4).multiplyMatrices(this.m_camera.projectionMatrix,this.m_camera.matrixWorldInverse)),i=this.getWorldConers(this.m_projection);if(this.tileWrappingEnabled||[i.ne,i.nw,i.se,i.sw].forEach((i=>{this.addPointInFrustum(i,t,e)})),this.tileWrappingEnabled){const r=(new s.Vector3).subVectors(i.sw,i.se).normalize(),n=(new s.Vector3).subVectors(i.se,i.sw).normalize();[new s.Ray(i.se,r),new s.Ray(i.se,n),new s.Ray(i.ne,r),new s.Ray(i.ne,n)].forEach((i=>{this.addFrustumIntersection(i,t,e)}))}else[new s.Line3(i.sw,i.se),new s.Line3(i.ne,i.nw),new s.Line3(i.se,i.ne),new s.Line3(i.nw,i.sw)].forEach((i=>{this.addFrustumIntersection(i,t,e)}));return this.createPolygon(e,!0)}getWorldConers(e){if(e.type!==r.ProjectionType.Planar)return;const t=e.worldExtent(0,0);return{sw:t.min,se:new s.Vector3(t.max.x,t.min.y,0),nw:new s.Vector3(t.min.x,t.max.y,0),ne:t.max}}addNDCRayIntersection(e,t){e.forEach((e=>{const i=a.MapViewUtils.rayCastWorldCoordinates({camera:this.m_camera,projection:this.m_projection},e[0],e[1]);i&&this.validateAndAddToGeoPolygon(i,t)}))}addHorizonIntersection(e){if(this.m_projection.type===r.ProjectionType.Planar){const t=this.getVerticalHorizonPositionInNDC();if(!t)return;this.addNDCRayIntersection([[-1,t],[1,t]],e)}}addCanvasCornerIntersection(e){this.addNDCRayIntersection([[-1,-1],[1,-1],[1,1],[-1,1]],e)}validateAndAddToGeoPolygon(e,t){this.isInVisibleMap(e)&&t.push(this.m_projection.unprojectPoint(e))}isInVisibleMap(e){if(this.m_projection.type===r.ProjectionType.Planar){if(e.y<0||e.y>r.EarthConstants.EQUATORIAL_CIRCUMFERENCE)return!1;if(!this.tileWrappingEnabled&&(e.x<0||e.x>r.EarthConstants.EQUATORIAL_CIRCUMFERENCE))return!1}return!0}addPointInFrustum(e,t,i){if(t.containsPoint(e)){const t=this.m_projection.unprojectPoint(e);t.altitude=0,i.push(t)}}addFrustumIntersection(e,t,i){t.planes.forEach((t=>{let r=null;const n=new s.Vector3;if(e instanceof s.Ray&&e.intersectsPlane(t)?r=e.intersectPlane(t,n):e instanceof s.Line3&&t.intersectsLine(e)&&(r=t.intersectLine(e,n)),r&&a.MapViewUtils.closeToFrustum(r,this.m_camera)){const e=this.m_projection.unprojectPoint(r);e.altitude=0,i.push(e)}}))}getVerticalHorizonPositionInNDC(){if(this.m_projection.type!==r.ProjectionType.Planar)return;const e=new s.Vector3(-1,-1,1).unproject(this.m_camera).add(new s.Vector3(1,-1,1).unproject(this.m_camera)).multiplyScalar(.5),t=new s.Vector3(-1,1,1).unproject(this.m_camera).add(new s.Vector3(1,1,1).unproject(this.m_camera)).multiplyScalar(.5),i=new s.Line3(e,t),n=new s.Vector3;return this.m_groundPlane.intersectLine(i,n)?n.project(this.m_camera).y:void 0}}},3076:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraMovementDetector=void 0;const r=i(4428),n=i(8730);t.CameraMovementDetector=class{constructor(e,t,i){this.m_throttlingTimeout=e,this.m_movementStartedFunc=t,this.m_movementFinishedFunc=i,this.m_lastCameraPos=new r.Vector3,this.m_newCameraPos=new r.Vector3,this.m_throttlingTimerId=void 0,this.m_movementDetectorDeadline=0,this.onDeadlineTimer=()=>{this.m_throttlingTimerId=void 0;const e=performance.now();e>=this.m_movementDetectorDeadline?this.movementFinished():this.startMovementFinishedTimer(e)},void 0===this.m_throttlingTimeout&&(this.m_throttlingTimeout=300)}checkCameraMoved(e,t){const i=n.MapViewUtils.extractAttitude(e,e.camera),r=e.camera.getWorldPosition(this.m_newCameraPos);if(void 0===this.m_lastAttitude)return this.m_lastCameraPos.copy(r),this.m_lastAttitude=i,!1;const s=!this.m_lastCameraPos.equals(r)||i.yaw!==this.m_lastAttitude.yaw||i.pitch!==this.m_lastAttitude.pitch||i.roll!==this.m_lastAttitude.roll;return s&&(this.m_lastCameraPos.copy(r),this.m_lastAttitude=i),s!==this.m_cameraMovedLastFrame&&(s&&this.movementStarted(),this.m_cameraMovedLastFrame=s),s&&(this.m_movementDetectorDeadline=t+this.m_throttlingTimeout,this.startMovementFinishedTimer(t)),this.m_cameraMovedLastFrame}clear(e){const t=e.camera.getWorldPosition(this.m_newCameraPos);this.m_lastCameraPos.set(t.x,t.y,t.z);const i=n.MapViewUtils.extractAttitude(e,e.camera);this.m_lastAttitude=i}forceMoved(){this.m_lastCameraPos.set(Number.NaN,Number.NaN,Number.NaN)}get cameraIsMoving(){return void 0!==this.m_throttlingTimerId}dispose(){this.removeMovementFinishedTimer(),this.m_movementStartedFunc=void 0,this.m_movementFinishedFunc=void 0}get cameraMovedLastFrame(){return!0===this.m_cameraMovedLastFrame}movementStarted(){void 0!==this.m_movementStartedFunc&&this.m_movementStartedFunc()}movementFinished(){this.removeMovementFinishedTimer(),void 0!==this.m_movementFinishedFunc&&this.m_movementFinishedFunc()}startMovementFinishedTimer(e){if(void 0===this.m_throttlingTimerId){const t=Math.max(0,this.m_movementDetectorDeadline-e);this.m_throttlingTimerId=setTimeout(this.onDeadlineTimer,t)}}removeMovementFinishedTimer(){void 0!==this.m_throttlingTimerId&&(clearTimeout(this.m_throttlingTimerId),this.m_throttlingTimerId=void 0)}}},3547:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDefaultClipPlanesEvaluator=t.FixedClipPlanesEvaluator=t.TiltViewClipPlanesEvaluator=t.TopViewClipPlanesEvaluator=t.ElevationBasedClipPlanesEvaluator=t.InterpolatedClipPlanesEvaluator=void 0;const r=i(3139),n=i(2183),s=i(4428),o=i(8730),a=1e-6;t.InterpolatedClipPlanesEvaluator=class{constructor(e=.1,t=.1,i=50,r=200){this.nearMin=e,this.nearMultiplier=t,this.nearFarMultiplier=i,this.farOffset=r,this.m_tmpVectors=[new s.Vector3,new s.Vector3,new s.Vector3],this.m_tmpQuaternion=new s.Quaternion,n.assert(e>0),n.assert(i>=0),n.assert(r>=0),this.farMin=e*i+r}set minElevation(e){}get minElevation(){return 0}set maxElevation(e){}get maxElevation(){return 0}evaluateClipPlanes(e,t,i){let s=this.nearMin,o=this.farMin;if(t.type===r.ProjectionType.Spherical){const i=r.EarthConstants.EQUATORIAL_RADIUS,n=e.position.length(),a=Math.asin(i/n);e.matrixWorld.extractBasis(this.m_tmpVectors[0],this.m_tmpVectors[1],this.m_tmpVectors[2]),this.m_tmpQuaternion.setFromAxisAngle(this.m_tmpVectors[0],a);const l=this.m_tmpVectors[2].negate(),c=this.m_tmpVectors[1].copy(l).applyQuaternion(this.m_tmpQuaternion),h=this.m_tmpVectors[0].copy(e.position);h.addScaledVector(c,Math.sqrt(n*n-i*i)),o=h.sub(e.position).dot(l)+this.farOffset,s=Math.max(this.nearMin,t.groundDistance(e.position)*this.nearMultiplier)}else if(t.type===r.ProjectionType.Planar){const i=t.groundDistance(e.position);s=Math.max(this.nearMin,i*this.nearMultiplier),o=s*this.nearFarMultiplier+this.farOffset}else n.assert(!1,"Unsupported projection type");return{near:s,far:o,minimum:this.nearMin,maximum:o}}};class l{constructor(e,t){n.assert(e>=t),this.m_minElevation=t,this.m_maxElevation=e}set maxElevation(e){this.m_maxElevation=e,this.m_minElevation=Math.min(e,this.m_minElevation)}get maxElevation(){return this.m_maxElevation}set minElevation(e){this.m_minElevation=e,this.m_maxElevation=Math.max(e,this.m_maxElevation)}get minElevation(){return this.m_minElevation}}t.ElevationBasedClipPlanesEvaluator=l;class c extends l{constructor(e=r.EarthConstants.MAX_BUILDING_HEIGHT,t=0,i=1,o=.05,l=6){super(e,t),this.nearMin=i,this.nearFarMarginRatio=o,this.farMaxRatio=l,this.m_tmpVectors=[new s.Vector3,new s.Vector3,new s.Vector3],this.m_tmpQuaternion=new s.Quaternion,n.assert(i>0),n.assert(o>a),n.assert(l>1);const c=o*i;this.m_minimumViewRange={near:i,far:i+c,minimum:this.nearMin,maximum:Math.max(i*l,i+c)},this.m_sphere=new s.Sphere(new s.Vector3,r.EarthConstants.EQUATORIAL_RADIUS)}evaluateClipPlanes(e,t,i){return t.type===r.ProjectionType.Spherical?this.evaluateDistanceSphericalProj(e,t,i):t.type===r.ProjectionType.Planar?this.evaluateDistancePlanarProj(e,t,i):(n.assert(!1,"Unsupported projection type"),Object.assign({},this.minimumViewRange))}get minimumViewRange(){return this.m_minimumViewRange}getCameraAltitude(e,t){return t.groundDistance(e.position)}evaluateDistancePlanarProj(e,t,i){n.assert(t.type!==r.ProjectionType.Spherical);let s=this.nearMin,o=this.nearMin*this.farMaxRatio;const a=this.getCameraAltitude(e,t),l=a*this.farMaxRatio;s=a-this.maxElevation,o=a-this.minElevation,s=Math.max(s,this.nearMin),o=Math.min(o,l);const c=this.nearFarMarginRatio*(s+o)/2;return s=Math.max(s-c/2,this.nearMin),o=Math.max(o+c/2,s+c),{near:s,far:o,minimum:this.nearMin,maximum:Math.max(l,o)}}evaluateDistanceSphericalProj(e,t,i){n.assert(t.type===r.ProjectionType.Spherical);let l=this.nearMin,c=this.nearMin*this.farMaxRatio;const h=this.getCameraAltitude(e,t);l=h-this.maxElevation;const d=r.EarthConstants.EQUATORIAL_RADIUS;let u=e.position.length();if(u=0===u?a:u,"PerspectiveCamera"===e.type){const i=Math.asin(d/u),r=e;let n=s.MathUtils.degToRad(r.fov/2);r.aspect>1&&(n=o.MapViewUtils.calculateHorizontalFovByVerticalFov(s.MathUtils.degToRad(r.fov),r.aspect));const a=this.getTangentBasedFarPlane(r,u,d,i);c=n>i?a:this.getFovBasedFarPlane(r,u,d,2*n,t)}else c=this.getOrthoBasedFarPlane(u,d);const m=h-this.minElevation,p=h*this.farMaxRatio;l=Math.max(l,this.nearMin),c=Math.max(c,m);const f=this.nearFarMarginRatio*(l+c)/2;return l=Math.max(l-f/2,this.nearMin),c=Math.max(c+f/2,l+f),{near:l,far:c,minimum:this.nearMin,maximum:p}}getTangentDistance(e,t){return e-t<a?0:Math.sqrt(e*e-t*t)}getTangentBasedFarPlane(e,t,i,r){const n=this.getTangentDistance(t,i),s=this.getTangentDistance(i+this.maxElevation,i);return Math.cos(r)*(n+s)}getFovBasedFarPlane(e,t,i,r,s){const o=e.position;e.matrixWorld.extractBasis(this.m_tmpVectors[0],this.m_tmpVectors[1],this.m_tmpVectors[2]),this.m_tmpQuaternion.setFromAxisAngle(this.m_tmpVectors[0],r/2);const a=this.m_tmpVectors[2],l=this.m_tmpVectors[1].copy(a).applyQuaternion(this.m_tmpQuaternion),c=o.dot(l);if(c<0)return this.getCameraAltitude(e,s)*this.farMaxRatio;const h=o.dot(o)-c*c,d=i*i;return n.assert(h<=d,"Please use this evaluator only for top view camera poses."),c-Math.sqrt(d-h)}getOrthoBasedFarPlane(e,t){return e+(this.maxElevation<a?0:Math.sqrt(t+this.maxElevation)*(t+this.maxElevation)-t*t)}}t.TopViewClipPlanesEvaluator=c;class h extends c{constructor(){super(...arguments),this.m_ray=new s.Ray}getFrustumGroundIntersectionDist(e,t){n.assert(t.type!==r.ProjectionType.Spherical);const i=Math.PI/2-a,l=this.getCameraAltitude(e,t),c=o.MapViewUtils.extractCameraTilt(e,t);let h,d,u,m;if("PerspectiveCamera"===e.type){const t=e,r=s.MathUtils.degToRad(t.fov/2);h=s.MathUtils.clamp(c+r,-i,i),d=s.MathUtils.clamp(c-r,-i,i),u=m=l}else{const t=e;h=d=c;const i=Math.sin(c);m=l+i*t.top,u=l-i*t.bottom}const p=(m-this.minElevation)/Math.cos(h),f=(u-this.maxElevation)/Math.cos(d);return{top:Math.max(p,0),bottom:Math.max(f,0)}}evaluateDistancePlanarProj(e,t,i){n.assert(t.type!==r.ProjectionType.Spherical);const a=Object.assign({},this.minimumViewRange),l=this.getFrustumGroundIntersectionDist(e,t);if("PerspectiveCamera"===e.type){const t=e,i=s.MathUtils.degToRad(t.fov/2),r=Math.cos(i);a.near=l.bottom*r,a.far=l.top*r}else a.near=l.bottom,a.far=l.top;const{distance:c}=o.MapViewUtils.getTargetAndDistance(t,e,i),h=c*this.farMaxRatio;a.near=Math.max(a.near,this.nearMin),a.far=Math.min(a.far,h);const d=this.nearFarMarginRatio*(a.near+a.far)/2;return a.near=Math.max(a.near-d/2,this.nearMin),a.far=Math.max(a.far+d/2,a.near+d),a.minimum=this.nearMin,a.maximum=h,a}evaluateDistanceSphericalProj(e,t,i){n.assert(t.type===r.ProjectionType.Spherical);const a=Object.assign({},this.minimumViewRange),l=this.getCameraAltitude(e,t);a.near=l-this.maxElevation;const c=this.m_tmpVectors[0].copy(e.position).negate(),h=r.EarthConstants.EQUATORIAL_RADIUS,d=c.length();let u;if(e instanceof s.PerspectiveCamera){const t=s.MathUtils.degToRad(e.fov/2),i=1/Math.tan(t),r=this.m_tmpVectors[2];r.set(e.aspect,1,-i),a.near*=Math.cos(t);const n=Math.asin(h/d),o=this.getCameraPitch(c,e),l=Math.abs(n-o);r.applyMatrix4(e.matrixWorld),r.sub(e.position),r.normalize(),this.m_ray.set(e.position,r);const m=this.m_ray.intersectSphere(this.m_sphere,this.m_tmpVectors[0]);u=null===m?this.getTangentBasedFarPlane(e,d,h,l):this.getFarPlaneBasedOnFovIntersection(m,e)}else u=this.getOrthoBasedFarPlane(d,h);a.far=u;const{distance:m}=o.MapViewUtils.getTargetAndDistance(t,e,i),p=l-this.minElevation,f=m*this.farMaxRatio;a.near=Math.max(a.near,this.nearMin),a.far=s.MathUtils.clamp(a.far,p,f);const g=this.nearFarMarginRatio*(a.near+a.far)/2;return a.near=Math.max(a.near-g/2,this.nearMin),a.far=Math.max(a.far+g/2,a.near+g),a.minimum=this.nearMin,a.maximum=f,a}getFarPlaneBasedOnFovIntersection(e,t){const i=this.m_tmpVectors[1];i.copy(e),i.sub(t.position);const r=this.m_tmpVectors[2];return t.getWorldDirection(r),r.normalize(),i.dot(r)}getCameraPitch(e,t){e.normalize();const i=t.getWorldDirection(this.m_tmpVectors[1]).normalize(),r=e.dot(i);return Math.acos(s.MathUtils.clamp(r,-1,1))}}t.TiltViewClipPlanesEvaluator=h,t.FixedClipPlanesEvaluator=class{constructor(e=1,t=10){this.minNear=e,this.minFarOffset=t,this.minFar=e+t,this.m_nearPlane=e,this.m_farPlane=this.minFar}get nearPlane(){return this.m_nearPlane}set nearPlane(e){this.invalidatePlanes(e,this.m_farPlane)}get farPlane(){return this.m_farPlane}set farPlane(e){this.invalidatePlanes(this.m_nearPlane,e)}set minElevation(e){}get minElevation(){return 0}set maxElevation(e){}get maxElevation(){return 0}evaluateClipPlanes(e,t,i){return{near:this.m_nearPlane,far:this.m_farPlane,minimum:this.minNear,maximum:this.m_farPlane}}invalidatePlanes(e,t){const i=Math.max(this.minNear,e),r=Math.max(this.minFar,t,i+this.minFarOffset);this.m_nearPlane=i,this.m_farPlane=r}},t.createDefaultClipPlanesEvaluator=()=>new h},7365:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorCache=void 0;const r=i(4428);class n{constructor(){this.m_map=new Map}static get instance(){return this.m_instance}getColor(e){"number"==typeof e&&(e="#"+e.toString(16).padStart(6,"0"));let t=this.m_map.get(e);return void 0!==t||(t=new r.Color(e),this.m_map.set(e,t)),t}get size(){return this.m_map.size}clear(){this.m_map.clear()}}t.ColorCache=n,n.m_instance=new n},2712:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConcurrentDecoderFacade=void 0;const r=i(7720),n=i(4756);class s{static getTileDecoder(e,t,i){const r=this.getWorkerSet(t,i);return new n.WorkerBasedDecoder(r,e)}static getWorkerSet(e,t){void 0===e&&(e=this.defaultScriptUrl);let i=this.workerSets[e];return void 0===i&&(i=new r.ConcurrentWorkerSet({scriptUrl:e,workerCount:void 0===t?this.defaultWorkerCount:t}),this.workerSets[e]=i),i}static destroyWorkerSet(e){const t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])}static destroy(){Object.keys(this.workerSets).forEach((e=>{this.workerSets[e].destroy()})),this.workerSets={}}static destroyIfTerminated(){let e=!0;Object.keys(this.workerSets).forEach((t=>{this.workerSets[t].terminated||(e=!1)})),e&&s.destroy()}}t.ConcurrentDecoderFacade=s,s.defaultScriptUrl="./decoder.bundle.js",s.defaultWorkerCount=void 0,s.workerSets={}},4088:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConcurrentTilerFacade=void 0;const r=i(7720),n=i(1931);class s{static getTiler(e,t,i){const r=this.getWorkerSet(t,i);return new n.WorkerBasedTiler(r,e)}static getWorkerSet(e,t){void 0===e&&(e=this.defaultScriptUrl);let i=this.workerSets[e];return void 0===i&&(i=new r.ConcurrentWorkerSet({scriptUrl:e,workerCount:void 0===t?this.defaultWorkerCount:t}),this.workerSets[e]=i),i}static destroyWorkerSet(e){const t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])}static destroy(){Object.keys(this.workerSets).forEach((e=>{this.workerSets[e].destroy()})),this.workerSets={}}static destroyIfTerminated(){let e=!0;Object.keys(this.workerSets).forEach((t=>{this.workerSets[t].terminated||(e=!1)})),e&&s.destroy()}}t.ConcurrentTilerFacade=s,s.defaultScriptUrl="./decoder.bundle.js",s.defaultWorkerCount=1,s.workerSets={}},7720:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConcurrentWorkerSet=t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT=t.isLoggingMessage=void 0;const r=i(3187),n=i(2183),s=i(4428),o=i(2235),a=n.LoggerManager.instance.create("ConcurrentWorkerSet");function l(e){return e&&"number"==typeof e.level&&e.type===n.WORKERCHANNEL_MSG_TYPE}t.isLoggingMessage=l,t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT=1e4,t.ConcurrentWorkerSet=class{constructor(e){this.m_options=e,this.m_workerChannelLogger=n.LoggerManager.instance.create("WorkerChannel"),this.m_eventListeners=new Map,this.m_workers=new Array,this.m_availableWorkers=new Array,this.m_workerPromises=new Array,this.m_readyPromises=new Map,this.m_requests=new Map,this.m_workerRequestQueue=[],this.m_nextMessageId=0,this.m_stopped=!0,this.m_referenceCount=0,this.onWorkerMessage=(e,t)=>{if(r.WorkerServiceProtocol.isResponseMessage(t.data)){const i=t.data;if(null===i.messageId)return void a.error(`[${this.m_options.scriptUrl}]: Bad ResponseMessage: no messageId`);const r=this.m_requests.get(i.messageId);if(void 0===r)return void a.error(`[${this.m_options.scriptUrl}]: Bad ResponseMessage: invalid messageId`);if(e>=0&&e<this.m_workers.length){const t=this.m_workers[e];this.m_availableWorkers.push(t),this.checkWorkerRequestQueue()}else a.error(`[${this.m_options.scriptUrl}]: onWorkerMessage: invalid workerId`);if(void 0!==i.errorMessage){const e=new Error(i.errorMessage);void 0!==i.errorStack&&(e.stack=i.errorStack),r.resolver(e)}else r.resolver(void 0,i.response)}else if(r.WorkerServiceProtocol.isInitializedMessage(t.data)){const e=this.getReadyPromise(t.data.service);++e.count===this.m_workerPromises.length&&e.resolve()}else if(l(t.data))switch(t.data.level){case n.LogLevel.Trace:this.m_workerChannelLogger.trace(...t.data.message);break;case n.LogLevel.Debug:this.m_workerChannelLogger.debug(...t.data.message);break;case n.LogLevel.Log:this.m_workerChannelLogger.log(...t.data.message);break;case n.LogLevel.Info:this.m_workerChannelLogger.info(...t.data.message);break;case n.LogLevel.Warn:this.m_workerChannelLogger.warn(...t.data.message);break;case n.LogLevel.Error:this.m_workerChannelLogger.error(...t.data.message)}else this.eventHandler(t)},this.start()}addReference(){this.m_referenceCount+=1,1===this.m_referenceCount&&this.m_stopped&&this.start()}removeReference(){this.m_referenceCount-=1,0===this.m_referenceCount&&this.destroy()}start(e){if(void 0!==e&&(this.m_options=e),!this.m_stopped)throw new Error("ConcurrentWorker set already started");this.m_workerCount=n.getOptionValue(this.m_options.workerCount,"undefined"!=typeof navigator&&void 0!==navigator.hardwareConcurrency?s.MathUtils.clamp(navigator.hardwareConcurrency-1,1,2):void 0,2);const i=n.getOptionValue(this.m_options.workerConnectionTimeout,t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT);for(let e=0;e<this.m_workerCount;++e){const t=o.WorkerLoader.startWorker(this.m_options.scriptUrl,i).then((t=>{const i=t=>{this.onWorkerMessage(e,t)};return t.addEventListener("message",i),this.m_workers.push(t),this.m_availableWorkers.push(t),{worker:t,listener:i}}));this.m_workerPromises.push(t)}this.m_stopped=!1}get workerCount(){return this.m_workerCount}async stop(){this.m_stopped=!0,await this.waitForAllResponses().then((()=>{this.terminateWorkers()}))}destroy(){this.m_stopped=!0,this.m_requests.forEach((e=>{e.resolver(new Error("worker destroyed"))})),this.m_requests.clear(),this.m_workerRequestQueue=[],this.terminateWorkers(),this.m_eventListeners.clear()}get terminated(){return 0===this.m_workers.length}async connect(e){return this.ensureStarted(),await Promise.all(this.m_workerPromises),await this.getReadyPromise(e).promise}addEventListener(e,t){this.m_eventListeners.set(e,t)}removeEventListener(e){this.m_eventListeners.delete(e)}invokeRequest(e,t,i,n){this.ensureStarted();const s=this.m_nextMessageId++;let o;const a=new Promise(((e,t)=>{o=(i,r)=>{this.m_requests.delete(s),void 0!==i?t(i):e(r)}}));this.m_requests.set(s,{promise:a,resolver:o});const l={service:e,type:r.WorkerServiceProtocol.ServiceMessageName.Request,messageId:s,request:t};return this.postRequestMessage(l,i,n),a}broadcastRequest(e,t,i){const n=[];for(const s of this.m_workers){const o=this.m_nextMessageId++;let a;const l=new Promise(((e,t)=>{a=(i,r)=>{this.m_requests.delete(o),void 0!==i?t(i):e(r)}}));n.push(l),this.m_requests.set(o,{promise:l,resolver:a});const c={service:e,type:r.WorkerServiceProtocol.ServiceMessageName.Request,messageId:o,request:t};void 0!==i?s.postMessage(c,i):s.postMessage(c)}return Promise.all(n)}broadcastMessage(e,t){this.ensureStarted(),void 0!==t?this.m_workers.forEach((i=>i.postMessage(e,t))):this.m_workers.forEach((t=>t.postMessage(e)))}get requestQueueSize(){return this.m_workerRequestQueue.length}get numWorkers(){return this.m_workers.length}get numIdleWorkers(){return this.m_availableWorkers.length}eventHandler(e){"string"==typeof e.data.type&&this.dispatchEvent(e.data.type,e)}postRequestMessage(e,t,i){if(this.ensureStarted(),0===this.m_workers.length)throw new Error("ConcurrentWorkerSet#postMessage: no workers started");if(void 0!==i&&i.signal.aborted){const t=this.m_requests.get(e.messageId);if(void 0===t)return void a.error(`[${this.m_options.scriptUrl}]: Bad RequestMessage: invalid messageId`);const i=new Error("Aborted");return i.name="AbortError",void t.resolver(i,void 0)}if(this.m_availableWorkers.length>0){const i=this.m_availableWorkers.pop();void 0!==t?i.postMessage(e,t):i.postMessage(e)}else void 0===i&&(i=new r.RequestController(0)),0===i.priority&&(i.priority=-this.m_nextMessageId),this.m_workerRequestQueue.unshift({message:e,buffers:t,requestController:i})}ensureStarted(){if(this.m_stopped)throw new Error("ConcurrentWorkerSet stopped")}async waitForAllResponses(){const e=new Array;this.m_requests.forEach((t=>{e.push(t.promise)})),await Promise.all(e)}dispatchEvent(e,t){const i=this.m_eventListeners.get(e);void 0!==i&&i(t)}terminateWorkers(){this.m_workerPromises.forEach((e=>{e.then((e=>{void 0!==e&&(e.worker.removeEventListener("message",e.listener),e.worker.terminate())}))})),this.m_workers=[],this.m_workerPromises=[],this.m_availableWorkers=[],this.m_readyPromises.clear()}getReadyPromise(e){const t=this.m_readyPromises.get(e);if(void 0!==t)return t;const i={count:0,promise:void 0,resolve:()=>{},reject:e=>{i.error=e},error:void 0};return i.promise=new Promise(((e,t)=>{const r=i;void 0!==r.error?t(r.error):r.count===this.m_workerPromises.length&&e(),r.resolve=e,r.reject=t})),this.m_readyPromises.set(e,i),i}checkWorkerRequestQueue(){if(0!==this.m_workerRequestQueue.length&&0!==this.m_availableWorkers.length)for(this.m_workerRequestQueue.sort(((e,t)=>e.requestController.priority-t.requestController.priority));this.m_availableWorkers.length>0&&this.m_workerRequestQueue.length>0;){const e=this.m_workerRequestQueue.pop();this.postRequestMessage(e.message,e.buffers,e.requestController)}}}},5532:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataSource=void 0;const r=i(2475),n=i(2183),s=i(4428),o=n.LoggerManager.instance.create("DataSource");class a extends s.EventDispatcher{constructor(e={}){super(),this.UPDATE_EVENT={type:"update"},this.enabled=!0,this.cacheable=!1,this.useGeometryLoader=!1,this.addGroundPlane=!1,this.minDataLevel=1,this.maxDataLevel=20,this.minDisplayLevel=1,this.maxDisplayLevel=20,this.allowOverlappingTiles=!0,this.enablePicking=!0,this.dataSourceOrder=0,this.exprPool=new r.ExprPool,this.m_maxGeometryHeight=0,this.m_minGeometryHeight=0,this.m_storageLevelOffset=0,this.m_featureStateMap=new Map;let{name:t}=e;const{styleSetName:i,languages:n,minZoomLevel:s,maxZoomLevel:o,minDataLevel:l,maxDataLevel:c,minDisplayLevel:h,maxDisplayLevel:d,storageLevelOffset:u,allowOverlappingTiles:m,enablePicking:p,minGeometryHeight:f,maxGeometryHeight:g,dataSourceOrder:v}=e;void 0!==t&&0!==t.length||(t="anonymous-datasource#"+ ++a.uniqueNameCounter),this.name=t,this.styleSetName=i,void 0!==n&&(this.languages=n),void 0!==l&&(this.minDataLevel=l),void 0!==c&&(this.maxDataLevel=c),void 0!==s&&(this.minZoomLevel=s),void 0!==o&&(this.maxZoomLevel=o),void 0!==h&&(this.minDisplayLevel=h),void 0!==d&&(this.maxDisplayLevel=d),void 0!==u&&(this.m_storageLevelOffset=u),void 0!==m&&(this.allowOverlappingTiles=m),void 0!==p&&(this.enablePicking=p),void 0!==f&&(this.minGeometryHeight=f),void 0!==g&&(this.maxGeometryHeight=g),v&&(this.dataSourceOrder=v)}getFeatureState(e){return this.m_featureStateMap.get(e)}clearFeatureState(){this.m_featureStateMap.clear()}setFeatureState(e,t){this.m_featureStateMap.set(e,t)}removeFeatureState(e){this.m_featureStateMap.delete(e)}get styleSetName(){return this.m_styleSetName}set styleSetName(e){e!==this.m_styleSetName&&(this.m_styleSetName=e,this.clearCache(),this.requestUpdate())}dispose(){}clearCache(){}isFullyCovering(){return this.addGroundPlane}ready(){return!0}get mapView(){if(void 0===this.m_mapView)throw new Error("This DataSource was not added to MapView");return this.m_mapView}get projection(){return this.mapView.projection}async connect(){}attach(e){this.m_mapView=e}detach(e){n.assert(this.m_mapView===e),this.m_mapView=void 0}isDetached(){return void 0===this.m_mapView}async setTheme(e,t){}setLanguages(e){this.languages=e}setPoliticalView(e){}updateTile(e){}shouldPreloadTiles(){return!1}get minZoomLevel(){return o.warn("DataSource.minZoomLevel is deprecated. Use minDataLevel and maxDataLevel instead."),this.minDataLevel}set minZoomLevel(e){o.warn("DataSource.minZoomLevel is deprecated. Use minDataLevel and minDisplayLevel instead."),this.minDataLevel=e}get maxZoomLevel(){return o.warn("DataSource.maxZoomLevel is deprecated. Use maxDataLevel and maxDisplayLevel instead."),this.maxDataLevel}set maxZoomLevel(e){o.warn("DataSource.maxZoomLevel is deprecated. Use maxDataLevel and maxDisplayLevel instead."),this.maxDataLevel=e}get maxGeometryHeight(){return this.m_maxGeometryHeight}set maxGeometryHeight(e){this.m_maxGeometryHeight=e}get minGeometryHeight(){return this.m_minGeometryHeight}set minGeometryHeight(e){this.m_minGeometryHeight=e}get storageLevelOffset(){return this.m_storageLevelOffset}set storageLevelOffset(e){this.m_storageLevelOffset=e}setEnableElevationOverlay(e){}getDataZoomLevel(e){return s.MathUtils.clamp(e+this.m_storageLevelOffset,this.minDataLevel,this.maxDataLevel)}isVisible(e){return e>=this.minDisplayLevel&&e<=this.maxDisplayLevel}canGetTile(e,t){return t.level<=e}shouldSubdivide(e,t){return t.level<=e}shouldRenderText(e,t){return!0}requestUpdate(){this.dispatchEvent(this.UPDATE_EVENT)}}t.DataSource=a,a.uniqueNameCounter=0},8601:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debugContext=t.DebugContext=void 0;const r=i(4428),n="undefined"==typeof window;class s extends r.EventDispatcher{constructor(e){super(),this.value=e}set(e,t){this.value=e,this.dispatchEvent({type:s.SET_EVENT_TYPE,name:t,value:e})}}s.SET_EVENT_TYPE="set";class o{constructor(){this.m_optionsMap=new Map,!n&&"undefined"!=typeof window&&window&&(window.__debugContext=this)}setValue(e,t){let i=this.m_optionsMap.get(e);i?i.set(t,e):(i=new s(t),this.m_optionsMap.set(e,i))}getValue(e){const t=this.m_optionsMap.get(e);return t?t.value:void 0}hasOption(e){return void 0!==this.m_optionsMap.get(e)}addEventListener(e,t){const i=this.m_optionsMap.get(e);if(!i)throw Error("Unknown option: "+e);i.addEventListener(s.SET_EVENT_TYPE,t)}hasEventListener(e,t){const i=this.m_optionsMap.get(e);if(i)return i.hasEventListener(s.SET_EVENT_TYPE,t);throw Error("Unknown option: "+e)}removeEventListener(e,t){const i=this.m_optionsMap.get(e);if(!i)throw Error("Unknown option: "+e);i.removeEventListener(s.SET_EVENT_TYPE,t)}get options(){return this.m_optionsMap}clear(){this.m_optionsMap.forEach((e=>{e.set(void 0,"")}))}}t.DebugContext=o,t.debugContext=new o},2084:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateColorProperty=t.applyBaseColorToMaterial=t.applySecondaryColorToMaterial=t.evaluateBaseColorProperty=t.buildMetricValueEvaluator=t.getMaterialConstructor=t.BASE_TECHNIQUE_NON_MATERIAL_PROPS=t.buildObject=t.usesObject3D=t.getBufferAttribute=t.createMaterial=void 0;const r=i(3187),n=i(6671),s=i(284),o=i(2183),a=i(4428),l=i(4800),c=i(8121),h=i(3220),d=i(8309),u=i(5393),m=o.LoggerManager.instance.create("DecodedTileHelpers");function p(e,t){if(void 0!==e.name)switch(e.name){case"extruded-line":if(!r.isExtrudedLineTechnique(e))throw new Error("Invalid extruded-line technique");return"standard"===e.shading?s.MapMeshStandardMaterial:s.MapMeshBasicMaterial;case"standard":case"terrain":case"extruded-polygon":return s.MapMeshStandardMaterial;case"dashed-line":case"solid-line":return s.SolidLineMaterial;case"fill":return t?s.MapMeshStandardMaterial:s.MapMeshBasicMaterial;case"squares":return a.PointsMaterial;case"circles":return s.CirclePointsMaterial;case"line":case"segments":return a.LineBasicMaterial;case"shader":return a.ShaderMaterial;case"text":case"labeled-icon":case"line-marker":case"label-rejection-line":return}}function f(e,t){return null==e?e:("string"==typeof e&&(e.endsWith("px")?(t="Pixel",e=Number.parseFloat(e)):e.endsWith("m")&&(e=Number.parseFloat(e))),"Pixel"===t?t=>{var i;return(null!==(i=t.env.lookup("$pixelToMeters"))&&void 0!==i?i:1)*r.getPropertyValue(e,t.env)}:e)}function g(e,t,i){let n=y(t,i);void 0!==n&&(r.ColorUtils.hasAlphaInHex(n)&&(m.warn("Used RGBA value for technique color without transparency support!"),n=r.ColorUtils.removeAlphaFromHex(n)),e.setHex(n))}function v(e,t,i,n,o){const l=y(n,o);if(void 0===l)return;const{r:c,g:h,b:d,a:u}=r.ColorUtils.getRgbaFromHex(l),m=i;let p=u;void 0!==m.opacity&&(p*=_(m.opacity,o)),p=a.MathUtils.clamp(p,0,1),e instanceof s.RawShaderMaterial?e.setOpacity(p):e.opacity=p,t.setRGB(c,h,d),p>=1?s.disableBlending(e):s.enableBlending(e)}function _(e,t){return void 0!==t&&r.Expr.isExpr(e)&&(e=r.getPropertyValue(e,t)),e}function y(e,t){if(null!=(e=_(e,t))){if("number"==typeof e)return e;if("string"==typeof e){const t=r.parseStringEncodedColor(e);if(void 0!==t)return t}m.error(`Unsupported color format: '${e}'`)}}function x(e){var t;return null===(t=n.getTechniqueDescriptor(e))||void 0===t?void 0:t.attrTransparencyColor}t.createMaterial=function(e,t,i){const l=t.technique,c=p(l,!0===t.shadowsEnabled),d={};if(void 0===c)return;c.prototype instanceof s.RawShaderMaterial&&(d.rendererCapabilities=e,c!==s.HighPrecisionLineMaterial&&(d.fog=t.fog)),!0===t.shadowsEnabled&&"fill"===l.name&&(d.removeDiffuseLight=!0);const y=new c(d);return void 0!==l.id&&(y.name=l.id),r.isExtrudedPolygonTechnique(l)&&(y.flatShading=!0),y.depthTest=r.isExtrudedPolygonTechnique(l)&&!1!==l.depthTest,(r.isStandardTechnique(l)||r.isTerrainTechnique(l)||r.isExtrudedPolygonTechnique(l))&&r.TEXTURE_PROPERTY_KEYS.forEach((e=>{const t=l[e];if(void 0===t)return;const n=t=>{const r=l[e+"Properties"];void 0!==r&&(void 0!==r.wrapS&&(t.wrapS=u.toWrappingMode(r.wrapS)),void 0!==r.wrapT&&(t.wrapT=u.toWrappingMode(r.wrapT)),void 0!==r.magFilter&&(t.magFilter=u.toTextureFilter(r.magFilter)),void 0!==r.minFilter&&(t.minFilter=u.toTextureFilter(r.minFilter)),void 0!==r.flipY&&(t.flipY=r.flipY),void 0!==r.repeatU&&(t.repeat.x=r.repeatU),void 0!==r.repeatV&&(t.repeat.y=r.repeatV)),y[e]=t,t.needsUpdate=!0,y.needsUpdate=!0,i&&i(t)},s=e=>{m.error("#createMaterial: Failed to load texture: ",e)};let o;if("string"==typeof t)o=t;else if(r.isTextureBuffer(t))if("image/raw"===t.type){const e=t.dataTextureProperties;if(void 0!==e){const i=e.type?u.toTextureDataType(e.type):void 0,r=function(e,t){if(void 0===t)return new Uint8Array(e);switch(t){case a.UnsignedByteType:return new Uint8Array(e);case a.ByteType:return new Int8Array(e);case a.ShortType:return new Int16Array(e);case a.UnsignedShortType:return new Uint16Array(e);case a.IntType:return new Int32Array(e);case a.UnsignedIntType:return new Uint32Array(e);case a.FloatType:return new Float32Array(e);case a.HalfFloatType:return new Uint16Array(e)}throw new Error("Unsupported texture data type")}(t.buffer,i);n(new a.DataTexture(r,e.width,e.height,e.format?u.toPixelFormat(e.format):void 0,i))}else s("no data texture properties provided.")}else{const e=new Blob([t.buffer],{type:t.type});o=URL.createObjectURL(e)}o&&(new a.TextureLoader).load(o,n,void 0,s)})),r.isShaderTechnique(l)?function(e,t){e.transparent?s.enableBlending(t):s.disableBlending(t);const i=e.params,n=x(e),o=n&&n in e.params;if(Object.getOwnPropertyNames(i).filter((e=>!(n===e||o&&r.TRANSPARENCY_PROPERTY_KEYS.includes(e))&&"name"!==e)).forEach((e=>{!function(e,t,i,r){const n=e;if(n[t]instanceof a.Color)g(e[t],i,r);else{const e=_(i,r);null!==e&&(n[t]=e)}}(t,e,i[e])})),o){const r=n;v(t,t[r],e,i[r])}}(l,y):h.MapMaterialAdapter.create(y,function(e){var t;const i=n.getTechniqueAutomaticAttrs(e);switch(e.name){case"dashed-line":case"solid-line":{const r=o.pick(e,i);return r.lineWidth=f(null!==(t=e.lineWidth)&&void 0!==t?t:0,e.metricUnit),r.outlineWidth=f(e.outlineWidth,e.metricUnit),r.dashSize=f(e.dashSize,e.metricUnit),r.gapSize=f(e.gapSize,e.metricUnit),r.offset=f(e.offset,e.metricUnit),r}case"fill":return o.pick(e,i);case"standard":case"terrain":case"extruded-polygon":{const t=o.pick(e,i);return!0!==e.vertexColors&&(t.color=e.color),t}case"circles":case"squares":return o.pick(e,i);case"extruded-line":return o.pick(e,["color","wireframe","transparent","opacity","polygonOffset","polygonOffsetFactor","polygonOffsetUnits",...i]);case"line":case"segments":return o.pick(e,i);default:return{}}}(l)),y},t.getBufferAttribute=function(e){switch(e.type){case"float":return new a.BufferAttribute(new Float32Array(e.buffer),e.itemCount);case"uint8":return new a.BufferAttribute(new Uint8Array(e.buffer),e.itemCount,e.normalized);case"uint16":return new a.BufferAttribute(new Uint16Array(e.buffer),e.itemCount,e.normalized);case"uint32":return new a.BufferAttribute(new Uint32Array(e.buffer),e.itemCount,e.normalized);case"int8":return new a.BufferAttribute(new Int8Array(e.buffer),e.itemCount,e.normalized);case"int16":return new a.BufferAttribute(new Int16Array(e.buffer),e.itemCount,e.normalized);case"int32":return new a.BufferAttribute(new Int32Array(e.buffer),e.itemCount,e.normalized);default:throw new Error(`unsupported buffer of type ${e.type}`)}},t.usesObject3D=function(e){const t=e.name;return void 0!==t&&"text"!==t&&"labeled-icon"!==t&&"line-marker"!==t&&"label-rejection-line"!==t},t.buildObject=function(e,t,i,n,s){switch(o.assert(void 0!==e.name),e.name){case"extruded-line":case"standard":case"extruded-polygon":case"fill":return s?new l.DisplacedMesh(t,i,(()=>({min:n.elevationRange.minElevation,max:n.elevationRange.maxElevation}))):new a.Mesh(t,i);case"terrain":return new a.Mesh(t,i);case"dashed-line":case"solid-line":return s?new l.DisplacedMesh(t,i,(()=>({min:n.elevationRange.minElevation,max:n.elevationRange.maxElevation})),c.SolidLineMesh.raycast):new c.SolidLineMesh(t,i);case"circles":return new d.Circles(t,i);case"squares":return new d.Squares(t,i);case"line":case"segments":return new a.LineSegments(t,i);case"shader":switch(o.assert(r.isShaderTechnique(e),"Invalid technique"),e.primitive){case"line":return new a.Line(t,i);case"segments":return new a.LineSegments(t,i);case"point":return new a.Points(t,i);case"mesh":return new a.Mesh(t,i)}}return o.assert(!1,"Invalid technique"),new a.Object3D},t.BASE_TECHNIQUE_NON_MATERIAL_PROPS=["name","id","renderOrder","transient"],t.getMaterialConstructor=p,t.buildMetricValueEvaluator=f,t.evaluateBaseColorProperty=function(e,t){const i=function(e){const t=x(e);if(void 0!==t)return r.isShaderTechnique(e)?e.params[t]:e[t]}(e);if(void 0!==i)return y(i,t)},t.applySecondaryColorToMaterial=g,t.applyBaseColorToMaterial=v,t.evaluateColorProperty=y},1233:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setDepthPrePassStencil=t.createDepthPrePassMesh=t.isDepthPrePassMesh=t.createDepthPrePassMaterial=t.isRenderDepthPrePassEnabled=t.DEPTH_PRE_PASS_STENCIL_MASK=void 0;const r=i(4482),n=i(284),s=i(4428),o=i(2084);function a(e){e.depthWrite=!1,e.depthFunc=s.EqualDepth,e.colorWrite=!0,n.enforceBlending(e);const t=e.clone();return t.isDepthPrepassMaterial=!0,t.depthWrite=!0,t.depthTest=!0,t.depthFunc=s.LessDepth,t.colorWrite=!1,t.opacity=1,t.blending=s.NoBlending,t}t.DEPTH_PRE_PASS_STENCIL_MASK=1,t.isRenderDepthPrePassEnabled=function(e,t){if(!1===e.enableDepthPrePass)return!1;let i=void 0!==e.opacity&&e.opacity>0&&e.opacity<1;if(!i){const n=o.evaluateBaseColorProperty(e,t);if(void 0!==n){const e=r.ColorUtils.getAlphaFromHex(n);i=e>0&&e<1}}return i},t.createDepthPrePassMaterial=a,t.isDepthPrePassMesh=function(e){if(!0!==e.isMesh)return!1;const t=e;return t.material instanceof Array?t.material.every((e=>!0===e.isDepthPrepassMaterial)):!0===t.material.isDepthPrepassMaterial},t.createDepthPrePassMesh=function(e){const t=e.geometry;if(!(t instanceof s.BufferGeometry))throw new Error("#createDepthPassMesh only BufferGeometry is supported");const i=t.getAttribute("position");if(!i)throw new Error("#createDepthPassMesh position attribute not found");const r=new s.BufferGeometry;r.setAttribute("position",i);const n=t.getAttribute("uv");n&&r.setAttribute("uv",n);const o=t.getAttribute("normal");o&&r.setAttribute("normal",o);const l=t.getAttribute("extrusionAxis");l&&r.setAttribute("extrusionAxis",l),t.index&&r.setIndex(t.index);for(const e of t.groups){const{start:t,count:i,materialIndex:n}=e;r.addGroup(t,i,n)}const c=e.material instanceof Array?e.material.map(a):a(e.material),h=new s.Mesh(r,c);return h.renderOrder=e.renderOrder-1e-6,h},t.setDepthPrePassStencil=function(e,i){function r(e){const i=e;i.stencilWrite=!0,i.stencilFail=s.KeepStencilOp,i.stencilZFail=s.KeepStencilOp,i.stencilZPass=s.ReplaceStencilOp,i.stencilFunc=s.AlwaysStencilFunc,i.stencilRef=255,i.stencilFuncMask=t.DEPTH_PRE_PASS_STENCIL_MASK}function n(e){const i=e;i.stencilWrite=!0,i.stencilFail=s.KeepStencilOp,i.stencilZFail=s.KeepStencilOp,i.stencilZPass=s.ZeroStencilOp,i.stencilFunc=s.EqualStencilFunc,i.stencilRef=255,i.stencilFuncMask=t.DEPTH_PRE_PASS_STENCIL_MASK}e.material instanceof Array?e.material.map(r):r(e.material),i.material instanceof Array?i.material.map(n):n(i.material)}},5882:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4091:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1683:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.CalculationStatus=void 0,(i=t.CalculationStatus||(t.CalculationStatus={}))[i.PendingApproximate=0]="PendingApproximate",i[i.FinalPrecise=1]="FinalPrecise"},7571:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=void 0,t.EventDispatcher=class{constructor(){this.m_listeners=new Map}dispose(){this.removeAllEventListeners()}hasEventListener(e,t){const i=this.m_listeners.get(e);return void 0!==i&&(void 0===t||i.includes(t))}addEventListener(e,t){let i=this.m_listeners.get(e);void 0===i&&(i=[],this.m_listeners.set(e,i)),i.includes(t)||i.push(t)}removeEventListener(e,t){const i=this.m_listeners.get(e);if(void 0!==i)if(void 0===t)this.m_listeners.delete(e);else{const r=i.indexOf(t);-1!==r&&(i.splice(r,1),0===i.length&&this.m_listeners.delete(e))}}removeAllEventListeners(){const e=Array.from(this.m_listeners.keys());for(const t of e)this.removeEventListener(t)}get eventTypes(){return Array.from(this.m_listeners.keys())}listeners(e){return this.m_listeners.get(e)}dispatchEvent(e){const t=this.m_listeners.get(e.type);if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,r=i.length;t<r;t++)i[t].call(this,e)}}}},3683:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrustumIntersection=t.TileKeyEntry=void 0;const r=i(3139),n=i(2183),s=i(4428),o=i(1683),a=i(302),l=i(8730),c=[new s.Vector3,new s.Vector3],h=new s.Vector4;class d{constructor(e,t,i=0,r,n=0){this.tileKey=e,this.area=t,this.offset=i,this.elevationRange=r,this.distance=n}}t.TileKeyEntry=d,t.FrustumIntersection=class{constructor(e,t,i,r,n,o=256){this.m_camera=e,this.mapView=t,this.m_extendedFrustumCulling=i,this.m_tileWrappingEnabled=r,this.m_enableMixedLod=n,this.m_tilePixelSize=o,this.m_frustum=new s.Frustum,this.m_viewProjectionMatrix=new s.Matrix4,this.m_rootTileKeys=[],this.m_tileKeyEntries=new Map,this.m_mapTileCuller=new a.MapTileCuller(e)}get camera(){return this.m_camera}get projection(){return this.mapView.projection}updateFrustum(e){this.m_viewProjectionMatrix.multiplyMatrices(void 0!==e?e:this.m_camera.projectionMatrix,this.m_camera.matrixWorldInverse),this.m_frustum.setFromProjectionMatrix(this.m_viewProjectionMatrix),this.m_extendedFrustumCulling&&this.m_mapTileCuller.setup(),this.computeRequiredInitialRootTileKeys(this.m_camera.position)}compute(e,t,i,o){this.m_tileKeyEntries.clear(),n.assert(0!==this.mapView.viewportHeight);const a=Math.pow(this.m_tilePixelSize/this.mapView.viewportHeight,2),c=void 0!==t&&t.getTilingScheme()===e,h=this.mapView.projection.type===r.ProjectionType.Spherical||c,d=new Set(i);let u=0,m=0;o.forEach((e=>{u=Math.min(u,e.minGeometryHeight),m=Math.max(m,e.maxGeometryHeight)}));const p={calculationFinal:!0,tileBounds:h?new r.OrientedBox3:new s.Box3};for(const e of d)this.m_tileKeyEntries.set(e,new Map);for(const i of this.m_rootTileKeys){const r=i.tileKey,n=i.offset,s=this.getTileKeyEntry(r,n,e,p,u,m,c?t:void 0);if(void 0!==s)for(const e of d)this.m_tileKeyEntries.get(e).set(l.TileOffsetUtils.getKeyForTileKeyAndOffset(r,n),s)}const f=[...this.m_rootTileKeys.values()];for(;f.length>0;){const r=f.pop();if(void 0===r)break;const n=r.tileKey,s=r.offset;if(!o.some(((e,t)=>e.shouldSubdivide(i[t],n))))continue;if(this.m_enableMixedLod&&r.area<a)continue;const h=l.TileOffsetUtils.getKeyForTileKeyAndOffset(n,s);for(const e of d)n.level>=e||this.m_tileKeyEntries.get(e).delete(h);for(const i of e.getSubTileKeys(n)){const r=this.getTileKeyEntry(i,s,e,p,u,m,c?t:void 0);if(void 0!==r){for(const e of d){if(r.tileKey.level>e)continue;const t=l.TileOffsetUtils.getKeyForTileKeyAndOffset(i,s);this.m_tileKeyEntries.get(e).set(t,r)}f.push(r)}}}return{tileKeyEntries:this.m_tileKeyEntries,calculationFinal:p.calculationFinal}}getTileKeyEntry(e,t,i,r,n,s,a){var l,c;const h=function(e,t,i){const r=e.getGeoBox(t),n=360*i;return r.northEast.longitude+=n,r.southWest.longitude+=n,r}(i,e,t);if(void 0!==a){const t=a.getElevationRange(e);h.southWest.altitude=t.minElevation,h.northEast.altitude=t.maxElevation,r.calculationFinal=r.calculationFinal&&t.calculationStatus===o.CalculationStatus.FinalPrecise}h.southWest.altitude=(null!==(l=h.southWest.altitude)&&void 0!==l?l:0)+n,h.northEast.altitude=(null!==(c=h.northEast.altitude)&&void 0!==c?c:0)+s,this.mapView.projection.projectBox(h,r.tileBounds);const{area:u,distance:m}=this.computeTileAreaAndDistance(r.tileBounds);if(u>0)return new d(e,u,t,{minElevation:h.southWest.altitude,maxElevation:h.northEast.altitude},m)}computeTileAreaAndDistance(e){if(e instanceof s.Box3){if(this.m_extendedFrustumCulling&&!this.m_mapTileCuller.frustumIntersectsTileBox(e)||!this.m_frustum.intersectsBox(e))return{area:0,distance:1/0}}else if(!e.intersects(this.m_frustum))return{area:0,distance:1/0};const t=e.getCenter(c[0]),i=h.set(t.x,t.y,t.z,1).applyMatrix4(this.m_viewProjectionMatrix),r=.5*e.getSize(c[1]).length()/i.w;return{area:r*r,distance:i.z<=-i.w?-1:i.z>=i.w?1:i.z/i.w}}computeRequiredInitialRootTileKeys(e){this.m_rootTileKeys=[];const t=r.TileKey.fromRowColumnLevel(0,0,0);if(this.mapView.projection.type!==r.ProjectionType.Planar||!this.m_tileWrappingEnabled)return void this.m_rootTileKeys.push(new d(t,1/0,0));const i=this.mapView.projection.unprojectPoint(e),n=Math.round(i.longitude/360),o=this.m_camera,a=l.MapViewUtils.extractAttitude(this.mapView,o).pitch,c=o.aspect>1?o.aspect:1/o.aspect,h=s.MathUtils.degToRad(o.fov*c/2)+a,u=Math.tan(h)*o.position.z-Math.tan(a)*o.position.z,m=new s.Vector3(e.x-u,e.y,e.z),p=this.mapView.projection.unprojectPoint(m),f=s.MathUtils.clamp(Math.ceil(Math.abs((i.longitude-p.longitude)/360)*Math.SQRT2),0,7);for(let e=-f+n;e<=f+n;e++)this.m_rootTileKeys.push(new d(t,1/0,e))}}},1679:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.TileLoaderState=void 0,(i=t.TileLoaderState||(t.TileLoaderState={}))[i.Initialized=0]="Initialized",i[i.Loading=1]="Loading",i[i.Loaded=2]="Loaded",i[i.Decoding=3]="Decoding",i[i.Ready=4]="Ready",i[i.Canceled=5]="Canceled",i[i.Failed=6]="Failed"},3978:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapAnchors=void 0;const r=i(3139),n=i(4428);t.MapAnchors=class{constructor(){this.m_anchors=[],this.m_priorities=[]}get children(){return this.m_anchors}add(e){this.m_anchors.push(e)}remove(e){const t=this.m_anchors.findIndex((t=>t===e));t>-1&&this.m_anchors.splice(t,1)}clear(){this.m_anchors.length=0}setPriorities(e){this.m_priorities=e}update(e,t,i,s){const o=new n.Vector3;this.m_anchors.forEach((n=>{var a;if(void 0!==n.styleSet){const e=null===(a=this.m_priorities)||void 0===a?void 0:a.findIndex((e=>e.group===n.styleSet&&e.category===n.category));void 0!==e&&-1!==e&&(n.renderOrder=10*(e+1))}const l=void 0!==n.geoPosition?n.geoPosition:n.anchor;void 0!==l&&(r.isVector3Like(l)?o.set(l.x,l.y,l.z):r.isGeoCoordinatesLike(l)&&e.projectPoint(l,o),n.position.copy(o).sub(t)),!0===n.overlay?s.add(n):i.add(n)}))}}},3220:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMaterialAdapter=void 0;const r=i(3187),n=i(284),s=i(4428),o=i(2084);class a{constructor(e,t){this.m_lastUpdateFrameNumber=-1,this.material=e,this.styledProperties=t,this.currentStyledProperties={},this.m_dynamicProperties=[];for(const e in t){if(!t.hasOwnProperty(e))continue;const i=t[e];r.Expr.isExpr(i)||"function"==typeof i?this.m_dynamicProperties.push([e,i]):this.currentStyledProperties[e]=i}this.setupStaticProperties()}static get(e){var t;const i=null===(t=e.userData)||void 0===t?void 0:t.mapAdapter;return i instanceof a?i:void 0}static install(e){return e.material.userData||(e.material.userData={}),e.material.userData.mapAdapter=e}static create(e,t){return a.install(new a(e,t))}static ensureUpdated(e,t){var i,r;return null!==(r=null===(i=a.get(e))||void 0===i?void 0:i.ensureUpdated(t))&&void 0!==r&&r}toJSON(){return{styledProperties:this.styledProperties}}ensureUpdated(e){return this.m_lastUpdateFrameNumber!==e.frameNumber&&(this.m_lastUpdateFrameNumber=e.frameNumber,this.updateDynamicProperties(e))}setupStaticProperties(){var e,t;let i=!1;for(const e in this.styledProperties){if(!this.styledProperties.hasOwnProperty(e))continue;const t=this.currentStyledProperties[e];null!=t&&("color"===e||"opacity"===e?i=!0:this.applyMaterialGenericProp(e,t))}if(i){const i=null!==(e=this.currentStyledProperties.color)&&void 0!==e?e:16711680,r=null!==(t=this.currentStyledProperties.opacity)&&void 0!==t?t:1;this.applyMaterialBaseColor(i,r)}}updateDynamicProperties(e){var t,i;let n=!1;if(this.m_dynamicProperties.length>0){let s=!1;for(const[t,i]of this.m_dynamicProperties){const o=r.Expr.isExpr(i)?r.getPropertyValue(i,e.env):i(e);o!==this.currentStyledProperties[t]&&(this.currentStyledProperties[t]=o,"color"===t||"opacity"===t?s=!0:(this.applyMaterialGenericProp(t,o),n=!0))}if(s){const e=null!==(t=this.currentStyledProperties.color)&&void 0!==t?t:16711680,r=null!==(i=this.currentStyledProperties.opacity)&&void 0!==i?i:1;this.applyMaterialBaseColor(e,r),n=!0}}return n}applyMaterialGenericProp(e,t){const i=this.material;if(i[e]instanceof s.Color){let n=t;if("number"!=typeof n){const e=o.evaluateColorProperty(n);if(void 0===e)return;n=e}const s=r.ColorUtils.removeAlphaFromHex(n);i[e].set(s)}else i[e]=t}applyMaterialBaseColor(e,t){if("number"!=typeof e){const t=o.evaluateColorProperty(e);if(void 0===t)return;e=t}const{r:i,g:a,b:l,a:c}=r.ColorUtils.getRgbaFromHex(null!=e?e:16711680),h=c*s.MathUtils.clamp(null!=t?t:1,0,1);this.material instanceof n.RawShaderMaterial?this.material.setOpacity(h):this.material.opacity=h,this.material.color.setRGB(i,a,l),h>=1?n.disableBlending(this.material):n.enableBlending(this.material)}}t.MapMaterialAdapter=a},3668:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapObjectAdapter=void 0;const r=i(3187),n=i(3220);class s{constructor(e,t){var i;this.m_lastUpdateFrameNumber=-1,this.m_notCompletlyTransparent=!0,this.object=e,this.technique=t.technique,this.kind=t.kind,this.dataSource=t.dataSource,this.m_pickability=null!==(i=t.pickability)&&void 0!==i?i:r.Pickability.onlyVisible,this.m_notCompletlyTransparent=this.getObjectMaterials().some((e=>e.opacity>0)),this.level=t.level}static get(e){var t;return(null===(t=e.userData)||void 0===t?void 0:t.mapAdapter)instanceof s?e.userData.mapAdapter:void 0}static install(e){return e.object.userData||(e.object.userData={}),e.object.userData.mapAdapter=e}static create(e,t){return s.install(new s(e,t))}static ensureUpdated(e,t){var i,r;return null!==(r=null===(i=s.get(e))||void 0===i?void 0:i.ensureUpdated(t))&&void 0!==r&&r}toJSON(){return{kind:this.kind,technique:this.technique}}ensureUpdated(e){return this.m_lastUpdateFrameNumber!==e.frameNumber&&(this.m_lastUpdateFrameNumber=e.frameNumber,this.updateMaterials(e))}isVisible(){return this.object.visible&&this.m_notCompletlyTransparent}isPickable(){return this.pickability===r.Pickability.onlyVisible&&this.isVisible()||this.m_pickability===r.Pickability.all}get pickability(){return this.m_pickability}updateMaterials(e){let t=!1;const i=this.getObjectMaterials();for(const r of i){const i=n.MapMaterialAdapter.ensureUpdated(r,e);t=t||i}return t&&(this.m_notCompletlyTransparent=i.some((e=>e.opacity>0))),t}getObjectMaterials(){const e=this.object;return Array.isArray(e.material)?e.material:void 0!==e.material?[e.material]:[]}}t.MapObjectAdapter=s},302:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapTileCuller=void 0;const r=i(4428);t.MapTileCuller=class{constructor(e){this.m_camera=e,this.m_globalFrustumMin=new r.Vector3,this.m_globalFrustumMax=new r.Vector3,this.m_frustumCorners=[new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3]}setup(){const e=this.getFrustumCorners(),t=this.m_camera.matrixWorld;this.m_globalFrustumMin.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.m_globalFrustumMax.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(const i of e)i.applyMatrix4(t),this.m_globalFrustumMin.x=Math.min(this.m_globalFrustumMin.x,i.x),this.m_globalFrustumMin.y=Math.min(this.m_globalFrustumMin.y,i.y),this.m_globalFrustumMin.z=Math.min(this.m_globalFrustumMin.z,i.z),this.m_globalFrustumMax.x=Math.max(this.m_globalFrustumMax.x,i.x),this.m_globalFrustumMax.y=Math.max(this.m_globalFrustumMax.y,i.y),this.m_globalFrustumMax.z=Math.max(this.m_globalFrustumMax.z,i.z)}frustumIntersectsTileBox(e){const t=this.m_globalFrustumMin,i=this.m_globalFrustumMax;return!(i.x<e.min.x||i.y<e.min.y||i.z<e.min.z||t.x>e.max.x||t.y>e.max.y||t.z>e.max.z)}getFrustumCorners(){const e=this.m_frustumCorners,t=this.m_camera.projectionMatrixInverse;let i=0;function r(r,n,s){e[i++].set(r,n,s).applyMatrix4(t)}return r(-1,-1,-1),r(1,-1,-1),r(-1,1,-1),r(1,1,-1),r(-1,-1,1),r(1,-1,1),r(-1,1,1),r(1,1,1),e}}},5667:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapView=t.MapViewPowerPreference=t.MapViewEventNames=t.TileTaskGroups=void 0;const r=i(3187),n=i(3139),s=i(2183),o=i(4428),a=i(4502),l=i(3076),c=i(3547),h=i(6906),d=i(2712),u=i(4088),m=i(6450),p=i(7571),f=i(3683),g=i(4111),v=i(2737),_=i(4894),y=i(3978),x=i(6222),b=i(5215),T=i(3167),w=i(6552),S=i(5295),M=i(5237),E=i(4450),P=i(8764),C=i(5005),A=i(3518),L=i(6682),R=i(6295),D=i(8730),O=i(8033);var F,I;s.LoggerManager.instance.setLogLevelForAll(s.LogLevel.Error),(I=t.TileTaskGroups||(t.TileTaskGroups={})).FETCH_AND_DECODE="fetch",I.CREATE="create",function(e){e.Update="update",e.Resize="resize",e.Render="render",e.AfterRender="didrender",e.FirstFrame="first-render",e.FrameComplete="frame-complete",e.ThemeLoaded="theme-loaded",e.AnimationStarted="animation-started",e.AnimationFinished="animation-finished",e.MovementStarted="movement-started",e.MovementFinished="movement-finished",e.DataSourceConnect="datasource-connect",e.CopyrightChanged="copyright-changed",e.ContextLost="webglcontext-lost",e.ContextRestored="webglcontext-restored",e.CameraPositionChanged="camera-changed",e.Dispose="dispose"}(F=t.MapViewEventNames||(t.MapViewEventNames={}));const U=s.LoggerManager.instance.create("MapView"),V={type:"dynamic",fov:40},k=4e6,j=140,N={vector2:[new o.Vector2],vector3:[new o.Vector3,new o.Vector3,new o.Vector3],rayCaster:new o.Raycaster,groundPlane:new o.Plane,groundSphere:new o.Sphere(void 0,n.EarthConstants.EQUATORIAL_RADIUS),matrix4:[new o.Matrix4,new o.Matrix4],transform:[{position:new o.Vector3,xAxis:new o.Vector3,yAxis:new o.Vector3,zAxis:new o.Vector3}],color:new o.Color};var B;!function(e){e.Default="default",e.LowPower="low-power",e.HighPerformance="high-performance"}(B=t.MapViewPowerPreference||(t.MapViewPowerPreference={}));const z={projection:n.mercatorProjection,addBackgroundDatasource:!0,maxVisibleDataSourceTiles:100,extendedFrustumCulling:!0,tileCacheSize:200,resourceComputationType:O.ResourceComputationType.EstimationInMb,quadTreeSearchDistanceUp:3,quadTreeSearchDistanceDown:2,pixelRatio:"undefined"!=typeof window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1,target:new n.GeoCoordinates(25,0),zoomLevel:5,tilt:0,heading:0,theme:{},maxTilesPerFrame:0};class G extends p.EventDispatcher{constructor(e){var t,i;super(),this.UPDATE_EVENT={type:F.Update},this.RENDER_EVENT={type:F.Render},this.DID_RENDER_EVENT={type:F.AfterRender},this.FIRST_FRAME_EVENT={type:F.FirstFrame},this.FRAME_COMPLETE_EVENT={type:F.FrameComplete},this.THEME_LOADED_EVENT={type:F.ThemeLoaded},this.ANIMATION_STARTED_EVENT={type:F.AnimationStarted},this.ANIMATION_FINISHED_EVENT={type:F.AnimationFinished},this.MOVEMENT_STARTED_EVENT={type:F.MovementStarted},this.MOVEMENT_FINISHED_EVENT={type:F.MovementFinished},this.CONTEXT_LOST_EVENT={type:F.ContextLost},this.CONTEXT_RESTORED_EVENT={type:F.ContextRestored},this.COPYRIGHT_CHANGED_EVENT={type:F.CopyrightChanged},this.DISPOSE_EVENT={type:F.Dispose},this.m_renderLabels=!0,this.m_visibleTileSetLock=!1,this.m_tileWrappingEnabled=!0,this.m_zoomLevel=1,this.m_minZoomLevel=1,this.m_maxZoomLevel=20,this.m_minCameraHeight=20,this.m_rteCamera=new o.PerspectiveCamera,this.m_yaw=0,this.m_pitch=0,this.m_roll=0,this.m_focalLength=0,this.m_targetDistance=0,this.m_targetGeoPos=n.GeoCoordinates.fromObject(z.target),this.m_targetWorldPos=new o.Vector3,this.m_viewRanges={near:.1,far:k,minimum:.1,maximum:k},this.m_scene=new o.Scene,this.m_overlayScene=new o.Scene,this.m_sceneRoot=new o.Object3D,this.m_overlaySceneRoot=new o.Object3D,this.m_mapAnchors=new y.MapAnchors,this.m_animationCount=0,this.m_drawing=!1,this.m_updatePending=!1,this.m_frameNumber=0,this.m_forceCameraAspect=void 0,this.m_taskSchedulerTimeout=void 0,this.m_tileDataSources=[],this.m_connectedDataSources=new Set,this.m_failedDataSources=new Set,this.m_enablePolarDataSource=!0,this.m_raycaster=new o.Raycaster,this.m_plane=new o.Plane(new o.Vector3(0,0,1)),this.m_sphere=new o.Sphere(void 0,n.EarthConstants.EQUATORIAL_RADIUS),this.m_firstFrameRendered=!1,this.m_firstFrameComplete=!1,this.m_initialTextPlacementDone=!1,this.m_userImageCache=new _.MapViewImageCache,this.m_env=new r.MapEnv({}),this.m_poiManager=new S.PoiManager(this),this.m_poiTableManager=new M.PoiTableManager(this),this.m_lastTileIds="",this.m_copyrightInfo=[],this.m_disposed=!1,this.onWebGLContextLost=e=>{this.dispatchEvent(this.CONTEXT_LOST_EVENT),U.warn("WebGL context lost",e)},this.onWebGLContextRestored=e=>{this.dispatchEvent(this.CONTEXT_RESTORED_EVENT),void 0!==this.m_renderer&&(this.textElementsRenderer.restoreRenderers(this.m_renderer),this.getTheme().then((e=>{this.m_sceneEnvironment.updateClearColor(e.clearColor,e.clearAlpha),this.update()}))),U.warn("WebGL context restored",e)},this.m_options=Object.assign({},e),this.m_uriResolver=this.m_options.uriResolver,void 0!==this.m_options.minZoomLevel&&(this.m_minZoomLevel=this.m_options.minZoomLevel),void 0!==this.m_options.maxZoomLevel&&(this.m_maxZoomLevel=this.m_options.maxZoomLevel),void 0!==this.m_options.minCameraHeight&&(this.m_minCameraHeight=this.m_options.minCameraHeight),void 0!==this.m_options.maxBounds&&(this.m_geoMaxBounds=this.m_options.maxBounds),void 0!==this.m_options.decoderUrl&&(d.ConcurrentDecoderFacade.defaultScriptUrl=this.m_uriResolver?this.m_uriResolver.resolveUri(this.m_options.decoderUrl):this.m_options.decoderUrl),void 0!==this.m_options.decoderCount&&(d.ConcurrentDecoderFacade.defaultWorkerCount=this.m_options.decoderCount),this.m_visibleTileSetOptions=Object.assign(Object.assign({},z),{clipPlanesEvaluator:void 0!==e.clipPlanesEvaluator?e.clipPlanesEvaluator:c.createDefaultClipPlanesEvaluator()}),void 0!==e.projection&&(this.m_visibleTileSetOptions.projection=e.projection),void 0!==e.extendedFrustumCulling&&(this.m_visibleTileSetOptions.extendedFrustumCulling=e.extendedFrustumCulling),void 0!==e.maxVisibleDataSourceTiles&&(this.m_visibleTileSetOptions.maxVisibleDataSourceTiles=e.maxVisibleDataSourceTiles),void 0!==e.tileCacheSize&&(this.m_visibleTileSetOptions.tileCacheSize=e.tileCacheSize),void 0!==e.resourceComputationType&&(this.m_visibleTileSetOptions.resourceComputationType=e.resourceComputationType),void 0!==e.quadTreeSearchDistanceUp&&(this.m_visibleTileSetOptions.quadTreeSearchDistanceUp=e.quadTreeSearchDistanceUp),void 0!==e.quadTreeSearchDistanceDown&&(this.m_visibleTileSetOptions.quadTreeSearchDistanceDown=e.quadTreeSearchDistanceDown),void 0!==e.enablePolarDataSource&&(this.m_enablePolarDataSource=e.enablePolarDataSource),this.m_pixelRatio=e.pixelRatio,this.m_options.maxFps=null!==(t=this.m_options.maxFps)&&void 0!==t?t:0,this.m_options.enableStatistics=!0===this.m_options.enableStatistics,this.m_languages=this.m_options.languages,this.m_politicalView=this.m_options.politicalView,this.handleRequestAnimationFrame=this.renderLoop.bind(this),void 0!==this.m_options.tileWrappingEnabled&&(this.m_tileWrappingEnabled=this.m_options.tileWrappingEnabled),this.setupStats(this.m_options.enableStatistics),this.canvas.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.m_renderer=new(null!==(i=o.WebGL1Renderer)&&void 0!==i?i:o.WebGLRenderer)({canvas:this.canvas,context:this.m_options.context,antialias:this.nativeWebglAntialiasEnabled,alpha:this.m_options.alpha,preserveDrawingBuffer:!0===this.m_options.preserveDrawingBuffer,powerPreference:void 0===this.m_options.powerPreference?B.Default:this.m_options.powerPreference}),this.m_renderer.autoClear=!1,this.m_renderer.debug.checkShaderErrors=!1,this.m_renderer.info.autoReset=!1,this.m_tileObjectRenderer=new R.TileObjectRenderer(this.m_env,this.m_renderer),this.setupRenderer(this.m_tileObjectRenderer),this.m_options.fovCalculation=void 0===this.m_options.fovCalculation?V:this.m_options.fovCalculation,this.m_options.fovCalculation.fov=o.MathUtils.clamp(this.m_options.fovCalculation.fov,10,j);const{width:u,height:m}=this.getCanvasClientSize(),p=u/m;this.m_camera=new o.PerspectiveCamera(this.m_options.fovCalculation.fov,p,.1,k),this.m_camera.up.set(0,0,1),this.projection.projectPoint(this.m_targetGeoPos,this.m_targetWorldPos),this.m_scene.add(this.m_camera),this.m_screenProjector=new P.ScreenProjector(this.m_camera),this.m_taskScheduler=new b.MapViewTaskScheduler(this.maxFps),this.m_tileGeometryManager=new v.TileGeometryManager(this),void 0!==e.enableMixedLod&&(this.m_enableMixedLod=e.enableMixedLod),void 0!==e.lodMinTilePixelSize&&(this.m_lodMinTilePixelSize=e.lodMinTilePixelSize),this.m_visibleTiles=this.createVisibleTileSet(),this.m_sceneEnvironment=new x.MapViewEnvironment(this,e),this.setupCamera(),this.m_pickHandler=new w.PickHandler(this,this.m_rteCamera,!0===this.m_options.enablePickTechnique),this.m_movementDetector=new l.CameraMovementDetector(this.m_options.movementThrottleTimeout,(()=>this.movementStarted()),(()=>this.movementFinished()));const f=this.m_options.customAntialiasSettings;if(this.mapRenderingManager=new h.MapRenderingManager(u,m,this.m_options.dynamicPixelRatio,f),this.m_animatedExtrusionHandler=new a.AnimatedExtrusionHandler(this),this.m_enablePolarDataSource){const t=void 0!==e.polarStyleSetName?e.polarStyleSetName:"polar";this.m_polarDataSource=new E.PolarTileDataSource({styleSetName:t,geometryLevelOffset:e.polarGeometryLevelOffset}),this.updatePolarDataSource()}this.m_taskScheduler.addEventListener(F.Update,(()=>{this.update()})),void 0!==e.throttlingEnabled&&(this.m_taskScheduler.throttlingEnabled=e.throttlingEnabled),this.m_themeManager=new T.MapViewThemeManager(this,this.m_uriResolver),this.m_textElementsRenderer=this.createTextRenderer(),this.setTheme(s.getOptionValue(this.m_options.theme,z.theme)),this.update()}get lights(){return this.m_sceneEnvironment.lights}get taskQueue(){return this.m_taskScheduler.taskQueue}get renderLabels(){return this.m_renderLabels}set renderLabels(e){this.m_renderLabels=e}get delayLabelsUntilMovementFinished(){return this.textElementsRenderer.delayLabelsUntilMovementFinished}set delayLabelsUntilMovementFinished(e){this.textElementsRenderer.delayLabelsUntilMovementFinished=e}get textElementsRenderer(){return this.m_textElementsRenderer}get cameraMovementDetector(){return this.m_movementDetector}get animatedExtrusionHandler(){return this.m_animatedExtrusionHandler}get tileGeometryManager(){return this.m_tileGeometryManager}get enableMixedLod(){return this.m_enableMixedLod}set enableMixedLod(e){this.m_enableMixedLod!==e&&(this.m_enableMixedLod=e,this.createVisibleTileSet(),this.update())}get tileWrappingEnabled(){return this.m_tileWrappingEnabled}set tileWrappingEnabled(e){this.projection.type!==n.ProjectionType.Spherical?(e!==this.m_tileWrappingEnabled&&(this.m_tileWrappingEnabled=e,this.createVisibleTileSet()),this.update()):U.warn("Setting this with spherical projection has no affect. Was this intended?")}dispose(e=!0){this.DISPOSE_EVENT.time=Date.now(),this.dispatchEvent(this.DISPOSE_EVENT),this.m_disposed=!0,this.m_movementFinishedUpdateTimerId&&(clearTimeout(this.m_movementFinishedUpdateTimerId),this.m_movementFinishedUpdateTimerId=void 0),void 0!==this.m_animationFrameHandle&&(cancelAnimationFrame(this.m_animationFrameHandle),this.m_animationFrameHandle=void 0),this.canvas.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas.removeEventListener("webglcontextrestored",this.onWebGLContextRestored);for(const e of this.m_tileDataSources)e.dispose();this.m_visibleTiles.clearTileCache(),this.m_textElementsRenderer.clearRenderStates(),this.m_renderer.dispose(),e&&this.m_renderer.forceContextLoss(),this.m_themeManager.dispose(),this.m_tileGeometryManager.clear(),this.m_movementDetector.dispose(),d.ConcurrentDecoderFacade.destroyIfTerminated(),u.ConcurrentTilerFacade.destroyIfTerminated(),this.m_taskScheduler.clearQueuedTasks(),super.dispose()}get disposed(){return this.m_disposed}get resourceComputationType(){return this.m_visibleTiles.resourceComputationType}set resourceComputationType(e){this.m_visibleTiles.resourceComputationType=e}getCacheSize(){return this.m_visibleTiles.getDataSourceCacheSize()}setCacheSize(e,t){this.m_visibleTiles.setDataSourceCacheSize(e),t=void 0!==t?t:e/2,this.m_visibleTiles.setNumberOfVisibleTiles(Math.floor(t)),this.m_themeManager.updateCache(),this.m_textElementsRenderer.invalidateCache(),this.update()}get extendedFrustumCulling(){return void 0===this.m_options.extendedFrustumCulling||this.m_visibleTileSetOptions.extendedFrustumCulling}set extendedFrustumCulling(e){this.m_visibleTileSetOptions.extendedFrustumCulling=e}get lockVisibleTileSet(){return this.m_visibleTileSetLock}set lockVisibleTileSet(e){this.m_visibleTileSetLock=e}get pointOfView(){return this.m_pointOfView}set pointOfView(e){this.m_pointOfView=e,this.update()}loadPostEffects(e){fetch(e).then((e=>e.json())).then((e=>{this.m_postEffects=e,this.setPostEffects()}))}get postEffects(){return this.m_postEffects}set postEffects(e){this.m_postEffects=e,this.setPostEffects()}get theme(){return this.m_themeManager.theme}set theme(e){this.setTheme(e)}async setTheme(e){const t=await this.m_themeManager.setTheme(e);return this.THEME_LOADED_EVENT.time=Date.now(),this.dispatchEvent(this.THEME_LOADED_EVENT),this.update(),t}async getTheme(){return await this.m_themeManager.getTheme()}get uriResolver(){return this.m_uriResolver}get forceCameraAspect(){return this.m_forceCameraAspect}set forceCameraAspect(e){this.m_forceCameraAspect=e}get languages(){return this.m_languages}set languages(e){this.m_languages=e,this.m_tileDataSources.forEach((e=>{e.setLanguages(this.m_languages)})),this.update()}get politicalView(){return this.m_politicalView}set politicalView(e){this.m_politicalView!==e&&(this.m_politicalView=e,this.m_tileDataSources.forEach((t=>{t.setPoliticalView(e)})))}get copyrightInfo(){return this.m_copyrightInfo}set disableFading(e){this.m_textElementsRenderer.disableFading=e}get disableFading(){return this.m_textElementsRenderer.disableFading}get frameNumber(){return this.m_frameNumber}resetFrameNumber(){this.m_frameNumber=0,this.m_previousFrameTimeStamp=void 0}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}get canvas(){return this.m_options.canvas}get collisionDebugCanvas(){return this.m_collisionDebugCanvas}get scene(){return this.m_scene}get overlayScene(){return this.m_overlayScene}get sceneEnvironment(){return this.m_sceneEnvironment}get camera(){return this.m_camera}get renderer(){return this.m_renderer}get clearColor(){const e=this.m_renderer.getClearColor(N.color);return void 0!==e?e.getHex():0}set clearColor(e){this.m_renderer.setClearColor(e)}get clearAlpha(){const e=this.m_renderer.getClearAlpha();return void 0!==e?e:0}set clearAlpha(e){this.m_renderer.setClearAlpha(e)}get projection(){return this.m_visibleTileSetOptions.projection}set projection(e){const t=this.tilt,i=this.heading;this.m_visibleTileSetOptions.projection=e,this.updatePolarDataSource(),this.clearTileCache(),this.textElementsRenderer.clearRenderStates(),this.m_visibleTiles=this.createVisibleTileSet(),this.geoMaxBounds=this.geoMaxBounds,this.lookAtImpl({tilt:t,heading:i})}get clipPlanesEvaluator(){return this.m_visibleTileSetOptions.clipPlanesEvaluator}set clipPlanesEvaluator(e){this.m_visibleTileSetOptions.clipPlanesEvaluator=e}get focalLength(){return this.m_focalLength}get target(){return this.m_targetGeoPos}get worldTarget(){return this.m_targetWorldPos}get targetDistance(){return this.m_targetDistance}get viewRanges(){return this.m_viewRanges}get geoCenter(){return this.projection.unprojectPoint(this.m_camera.position).normalized()}set geoCenter(e){if(void 0!==e.altitude)this.projection.projectPoint(e,this.m_camera.position);else{const t=this.geoCenter.altitude;this.projection.projectPoint(new n.GeoCoordinates(e.latitude,e.longitude,t),this.m_camera.position)}this.update()}get mapAnchors(){return this.m_mapAnchors}get worldCenter(){return this.m_camera.position}get pickHandler(){return this.m_pickHandler}get imageCache(){return this.m_themeManager.imageCache}get userImageCache(){return this.m_userImageCache}get poiManager(){return this.m_poiManager}get poiTableManager(){return this.m_poiTableManager}get minCameraHeight(){return this.m_minCameraHeight}get minZoomLevel(){return this.m_minZoomLevel}set minZoomLevel(e){this.m_minZoomLevel=e,this.update()}get maxZoomLevel(){return this.m_maxZoomLevel}set maxZoomLevel(e){this.m_maxZoomLevel=e,this.update()}get geoMaxBounds(){return this.m_geoMaxBounds}set geoMaxBounds(e){this.m_geoMaxBounds=e,this.m_worldMaxBounds=this.m_geoMaxBounds?this.projection.projectBox(this.m_geoMaxBounds,this.projection.type===n.ProjectionType.Planar?new o.Box3:new n.OrientedBox3):void 0}get worldMaxBounds(){return this.m_worldMaxBounds}get zoomLevel(){return this.m_zoomLevel}set zoomLevel(e){this.lookAtImpl({zoomLevel:e})}get tilt(){return o.MathUtils.radToDeg(this.m_pitch)}set tilt(e){this.lookAtImpl({tilt:e})}get heading(){return-o.MathUtils.radToDeg(this.m_yaw)}set heading(e){this.lookAtImpl({heading:e})}get env(){return this.m_env}get storageLevel(){return o.MathUtils.clamp(Math.floor(this.m_zoomLevel),this.m_minZoomLevel,this.m_maxZoomLevel)}get viewportHeight(){return this.canvas.height}get nativeWebglAntialiasEnabled(){return void 0===this.m_options.enableNativeWebglAntialias?this.pixelRatio<2:this.m_options.enableNativeWebglAntialias}get dataSources(){return this.m_tileDataSources}setFovCalculation(e){this.m_options.fovCalculation=e,this.calculateFocalLength(this.m_renderer.getSize(N.vector2[0]).height),this.updateCameras()}getDataSourceByName(e){return this.m_tileDataSources.find((t=>t.name===e))}getDataSourcesByStyleSetName(e){return this.m_tileDataSources.filter((t=>t.styleSetName===e))}isDataSourceEnabled(e){return e.enabled&&e.ready()&&this.m_connectedDataSources.has(e.name)&&e.isVisible(this.zoomLevel)}async addDataSource(e){var t,i;if(void 0!==this.getDataSourceByName(e.name))throw new Error(`A DataSource with the name "${e.name}" already exists in this MapView.`);e.attach(this),e.setEnableElevationOverlay(void 0!==this.m_elevationProvider),this.m_tileDataSources.push(e),null===(t=this.m_sceneEnvironment)||void 0===t||t.updateBackgroundDataSource();try{if(await e.connect(),!this.m_tileDataSources.includes(e))return;e.addEventListener(F.Update,(()=>{this.update()}));const t=await this.getTheme();e.setLanguages(this.m_languages),void 0!==t&&void 0!==t.styles&&await e.setTheme(t),this.m_connectedDataSources.add(e.name),this.dispatchEvent({type:F.DataSourceConnect,dataSourceName:e.name}),this.update()}catch(t){U.error(`Failed to connect to datasource ${e.name}: ${null!==(i=t.message)&&void 0!==i?i:t}`),this.m_failedDataSources.add(e.name),this.dispatchEvent({type:F.DataSourceConnect,dataSourceName:e.name,error:t})}}removeDataSource(e){const t=this.m_tileDataSources.indexOf(e);-1!==t&&(e.detach(this),this.m_visibleTiles.removeDataSource(e),this.m_tileDataSources.splice(t,1),this.m_connectedDataSources.delete(e.name),this.m_failedDataSources.delete(e.name),this.m_sceneEnvironment.updateBackgroundDataSource(),this.update())}get visibleTileSet(){return this.m_visibleTiles}addOverlayText(e){this.m_textElementsRenderer.addOverlayText(e),this.update()}clearOverlayText(){this.m_textElementsRenderer.clearOverlayText()}lookAt(e,t,i,r){if(n.isGeoCoordinatesLike(e)){const n={target:e,zoomLevel:void 0!==t?D.MapViewUtils.calculateZoomLevelFromDistance(this,t):void 0,tilt:i,heading:r};this.lookAtImpl(n)}else"object"==typeof e&&this.lookAtImpl(e)}setCameraGeolocationAndZoom(e,t,i=0,r=0){this.geoCenter=e;let s=Math.min(D.MapViewUtils.MAX_TILT_DEG,r);if(this.projection.type===n.ProjectionType.Spherical){const e=Math.asin(n.EarthConstants.EQUATORIAL_RADIUS/(D.MapViewUtils.calculateDistanceToGroundFromZoomLevel(this,t)+n.EarthConstants.EQUATORIAL_RADIUS)),i=o.MathUtils.radToDeg(e);s=Math.min(s,i)}D.MapViewUtils.zoomOnTargetPosition(this,0,0,t),D.MapViewUtils.setRotation(this,i,s),this.update()}setDynamicProperty(e,t){if(e.startsWith("$"))throw new Error(`failed to update the value of the dynamic property '${e}'`);this.m_env.entries[e]=t,this.update()}removeDynamicProperty(e){if(e.startsWith("$"))throw new Error(`failed to remove the dynamic property '${e}'`);delete this.m_env.entries[e],this.update()}get animating(){return this.m_animationCount>0}beginAnimation(){0==this.m_animationCount++&&(this.update(),this.ANIMATION_STARTED_EVENT.time=Date.now(),this.dispatchEvent(this.ANIMATION_STARTED_EVENT))}endAnimation(){this.m_animationCount>0&&--this.m_animationCount,0===this.m_animationCount&&(this.ANIMATION_FINISHED_EVENT.time=Date.now(),this.dispatchEvent(this.ANIMATION_FINISHED_EVENT))}get cameraIsMoving(){return this.m_movementDetector.cameraIsMoving}get isDynamicFrame(){return this.cameraIsMoving||this.animating||this.m_updatePending||this.m_animatedExtrusionHandler.isAnimating}get pixelToWorld(){if(void 0===this.m_pixelToWorld){s.assert(void 0!==this.m_options.fovCalculation);const e=this.m_targetDistance;this.m_pixelToWorld=D.MapViewUtils.calculateWorldSizeByFocalLength(this.m_focalLength,e,1)}return this.m_pixelToWorld}get worldToPixel(){return 1/this.pixelToWorld}get pixelRatio(){return void 0!==this.m_pixelRatio?this.m_pixelRatio:"undefined"!=typeof window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1}set pixelRatio(e){this.m_pixelRatio=e,this.renderer.getPixelRatio()!==this.pixelRatio&&this.renderer.setPixelRatio(this.pixelRatio)}set maxFps(e){this.m_options.maxFps=e,this.m_taskScheduler.maxFps=e}get maxFps(){return this.m_options.maxFps}set dynamicPixelRatio(e){this.mapRenderingManager.lowResPixelRatio=e}get dynamicPixelRatio(){return this.mapRenderingManager.lowResPixelRatio}getScreenPosition(e){n.isVector3Like(e)?N.vector3[0].copy(e):this.projection.projectPoint(n.GeoCoordinates.fromObject(e),N.vector3[0]);const t=this.m_screenProjector.project(N.vector3[0]);if(void 0!==t){const{width:e,height:i}=this.getCanvasClientSize();t.x=t.x+e/2,t.y=i-(t.y+i/2)}return t}getWorldPositionAt(e,t,i){this.m_raycaster.setFromCamera(this.getNormalizedScreenCoordinates(e,t),this.m_camera);const r=this.projection.type===n.ProjectionType.Spherical?this.m_raycaster.ray.intersectSphere(this.m_sphere,N.vector3[0]):this.m_raycaster.ray.intersectPlane(this.m_plane,N.vector3[0]);if(null===r&&!0===i){const e=this.m_camera.getWorldDirection(N.vector3[0]).dot(this.m_raycaster.ray.direction);return N.vector3[0].copy(this.m_raycaster.ray.direction).multiplyScalar(this.m_camera.far/e).add(this.m_camera.position)}return r}getGeoCoordinatesAt(e,t,i){const r=this.getWorldPositionAt(e,t,i);if(!r)return null;const s=this.projection.unprojectPoint(r);return this.tileWrappingEnabled||this.projection.type!==n.ProjectionType.Planar||(s.longitude=o.MathUtils.clamp(s.longitude,-180,180)),s}getNormalizedScreenCoordinates(e,t){const{width:i,height:r}=this.getCanvasClientSize();return new o.Vector3(e/i*2-1,-t/r*2+1,0)}intersectMapObjects(e,t,i){return this.m_pickHandler.intersectMapObjects(e,t,i)}resize(e,t){this.m_renderer.setSize(e,t,!1),this.m_renderer.getPixelRatio()!==this.pixelRatio&&this.m_renderer.setPixelRatio(this.pixelRatio),void 0!==this.mapRenderingManager&&this.mapRenderingManager.setSize(e,t),void 0!==this.collisionDebugCanvas&&(this.collisionDebugCanvas.width=e,this.collisionDebugCanvas.height=t),this.updateCameras(),this.update(),this.dispatchEvent({type:F.Resize,size:{width:e,height:t}})}renderSync(e){void 0===e&&(e=s.PerformanceTimer.now()),this.render(e)}update(){this.disposed?U.warn("update(): MapView has been disposed of."):(this.dispatchEvent(this.UPDATE_EVENT),this.m_updatePending||(this.m_updatePending=!0,this.startRenderLoop()))}get updatePending(){return this.m_updatePending}requestUpdateIfNeeded(){this.update()}clearTileCache(e,t){if(void 0!==this.m_visibleTiles){if(void 0!==e){const i=this.getDataSourceByName(e);i&&(this.m_visibleTiles.clearTileCache(i,t),i.clearCache())}else this.m_visibleTiles.clearTileCache(void 0,t),this.m_tileDataSources.forEach((e=>e.clearCache()));void 0!==this.m_elevationProvider&&this.m_elevationProvider.clearCache()}}forEachVisibleTile(e){this.m_visibleTiles.forEachVisibleTile(e)}forEachCachedTile(e){this.m_visibleTiles.forEachCachedTile(e)}markTilesDirty(e,t){this.m_visibleTiles.markTilesDirty(e,t),this.update()}async setElevationSource(e,t,i){this.m_elevationSource&&this.m_elevationSource!==e&&this.removeDataSource(this.m_elevationSource),this.m_tileDataSources.includes(e)||await this.addDataSource(e),this.m_elevationSource=e,this.m_elevationRangeSource=t,this.m_elevationRangeSource.ready()||await this.m_elevationRangeSource.connect(),this.m_elevationProvider=i,this.dataSources.forEach((e=>{e.setEnableElevationOverlay(!0)})),this.m_tileGeometryManager.setTileUpdateCallback((e=>{g.overlayOnElevation(e)})),this.clearTileCache()}clearElevationSource(e){this.removeDataSource(e),this.m_elevationSource=void 0,this.m_elevationRangeSource=void 0,this.m_elevationProvider=void 0,this.dataSources.forEach((e=>{e.setEnableElevationOverlay(!1)})),this.m_tileGeometryManager.setTileUpdateCallback(void 0),this.clearTileCache()}get fog(){return this.m_sceneEnvironment.fog}setPostEffects(){this.mapRenderingManager.bloom.enabled=!1,this.mapRenderingManager.outline.enabled=!1,this.mapRenderingManager.vignette.enabled=!1,this.mapRenderingManager.sepia.enabled=!1,void 0!==this.m_postEffects&&(void 0!==this.m_postEffects.bloom&&(this.mapRenderingManager.bloom=this.m_postEffects.bloom),void 0!==this.m_postEffects.outline&&(this.mapRenderingManager.outline.enabled=this.m_postEffects.outline.enabled,this.mapRenderingManager.updateOutline(this.m_postEffects.outline)),void 0!==this.m_postEffects.vignette&&(this.mapRenderingManager.vignette=this.m_postEffects.vignette),void 0!==this.m_postEffects.sepia&&(this.mapRenderingManager.sepia=this.m_postEffects.sepia))}get elevationProvider(){return this.m_elevationProvider}get throttlingEnabled(){return!0===this.m_taskScheduler.throttlingEnabled}set throttlingEnabled(e){this.m_taskScheduler.throttlingEnabled=e}get shadowsEnabled(){return!0===this.m_options.enableShadows}set shadowsEnabled(e){void 0!==this.m_renderer.shadowMap&&e!==this.m_renderer.shadowMap.enabled&&(this.m_options.enableShadows=e,this.m_renderer.shadowMap.enabled=e,this.m_renderer.shadowMap.type=o.PCFSoftShadowMap,this.clearTileCache())}extractAttitude(){const e=this.m_camera,t=this.projection,i=N.vector3[1],r=N.transform[0],n=N.matrix4[1];i.setFromMatrixPosition(e.matrixWorld),t.localTangentSpace(this.m_targetGeoPos,r),n.makeBasis(r.xAxis,r.yAxis,r.zAxis),N.matrix4[0].copy(n).invert().multiply(e.matrixWorld),r.xAxis.setFromMatrixColumn(N.matrix4[0],0),r.yAxis.setFromMatrixColumn(N.matrix4[0],1),r.zAxis.setFromMatrixColumn(N.matrix4[0],2);let s=0,o=0,a=0;const l=r.zAxis.dot(i.set(0,0,1));return l<1-1e-10?l>1e-10-1?(s=Math.atan2(r.zAxis.x,-r.zAxis.y),o=Math.acos(r.zAxis.z),a=Math.atan2(r.xAxis.x,r.yAxis.z)):(s=-Math.atan2(-r.yAxis.x,r.xAxis.x),o=180,a=0):(s=Math.atan2(-r.yAxis.x,r.xAxis.x),o=0,a=0),{yaw:s,pitch:o,roll:a}}lookAtImpl(e){const t=Math.min(s.getOptionValue(e.tilt,this.tilt),D.MapViewUtils.MAX_TILT_DEG),i=s.getOptionValue(e.heading,this.heading),r=void 0!==e.zoomLevel?D.MapViewUtils.calculateDistanceFromZoomLevel(this,o.MathUtils.clamp(e.zoomLevel,this.m_minZoomLevel,this.m_maxZoomLevel)):void 0!==e.distance?e.distance:this.m_targetDistance;let a;if(void 0!==e.bounds){let s;if(e.bounds instanceof n.GeoBox)a=e.target?n.GeoCoordinates.fromObject(e.target):e.bounds.center,s=D.MapViewUtils.geoBoxToGeoPoints(e.bounds);else if(e.bounds instanceof n.GeoPolygon)a=e.bounds.getCentroid(),s=e.bounds.coordinates;else if(n.isGeoBoxExtentLike(e.bounds)){a=e.target?n.GeoCoordinates.fromObject(e.target):this.target;const t=n.GeoBox.fromCenterAndExtents(a,e.bounds);s=D.MapViewUtils.geoBoxToGeoPoints(t)}else{if(!Array.isArray(e.bounds))throw Error("#lookAt: Invalid 'bounds' value");s=e.bounds,void 0!==e.target&&(a=n.GeoCoordinates.fromObject(e.target))}e.bounds instanceof n.GeoBox||e.bounds instanceof n.GeoPolygon||!this.m_tileWrappingEnabled||this.projection.type!==n.ProjectionType.Planar||(s=D.MapViewUtils.wrapGeoPointsToScreen(s,a));const l=s.map((e=>this.projection.projectPoint(n.GeoCoordinates.fromObject(e),new o.Vector3))),c=new o.Vector3;return void 0===a?((new o.Box3).setFromPoints(l).getCenter(c),this.projection.scalePointToSurface(c),a=this.projection.unprojectPoint(c)):this.projection.projectPoint(a,c),void 0!==e.zoomLevel||void 0!==e.distance?this.lookAtImpl({tilt:t,heading:i,distance:r,target:a}):this.lookAtImpl(D.MapViewUtils.getFitBoundsLookAtParams(a,c,l,{tilt:t,heading:i,minDistance:D.MapViewUtils.calculateDistanceFromZoomLevel(this,this.maxZoomLevel),projection:this.projection,camera:this.camera}))}a=void 0!==e.target?n.GeoCoordinates.fromObject(e.target):this.target,D.MapViewUtils.getCameraRotationAtTarget(this.projection,a,-i,t,this.camera.quaternion),D.MapViewUtils.getCameraPositionFromTargetCoordinates(a,r,-i,t,this.projection,this.camera.position),this.camera.updateMatrixWorld(!0),this.updateLookAtSettings(),this.update()}updatePolarDataSource(){const e=this.m_polarDataSource;if(!0===this.m_enablePolarDataSource&&void 0!==e){const t=this.getDataSourceByName(e.name);this.projection.type===n.ProjectionType.Spherical?void 0===t&&this.addDataSource(e):void 0!==t&&this.removeDataSource(e)}}updateCameras(e){var t;this.m_camera.updateMatrixWorld(!1),this.updateLookAtSettings();const{width:i,height:r}=this.m_renderer.getSize(N.vector2[0]);this.m_camera.aspect=void 0!==this.m_forceCameraAspect?this.m_forceCameraAspect:i/r,this.setFovOnCamera(this.m_options.fovCalculation,r);const n=this.projection.getScaleFactor(this.camera.position),s=n*this.m_tileDataSources.reduce(((e,t)=>Math.max(e,t.maxGeometryHeight)),0),o=n*this.m_tileDataSources.reduce(((e,t)=>Math.min(e,t.minGeometryHeight)),0);Object.assign(this.m_viewRanges,void 0===e?this.m_visibleTiles.updateClipPlanes(s,o):e),this.m_camera.near=this.m_viewRanges.near,this.m_camera.far=this.m_viewRanges.far,this.m_camera.updateProjectionMatrix(),this.m_rteCamera.copy(this.m_camera),this.m_rteCamera.position.setScalar(0),this.m_rteCamera.updateMatrixWorld(!0),null===(t=this.m_textElementsRenderer)||void 0===t||t.updateCamera(),this.m_screenProjector.update(this.camera,i,r),this.m_pixelToWorld=void 0,this.m_sceneEnvironment.update()}updateLookAtSettings(){let{target:e,distance:t,final:i}=D.MapViewUtils.getTargetAndDistance(this.projection,this.camera,this.elevationProvider);i||this.update(),this.geoMaxBounds&&({target:e,distance:t}=D.MapViewUtils.constrainTargetAndDistanceToViewBounds(e,t,this)),this.m_targetWorldPos.copy(e),this.m_targetGeoPos=this.projection.unprojectPoint(this.m_targetWorldPos),this.m_targetDistance=t,this.m_zoomLevel=D.MapViewUtils.calculateZoomLevelFromDistance(this,this.m_targetDistance);const{yaw:r,pitch:n,roll:s}=this.extractAttitude();this.m_yaw=r,this.m_pitch=n,this.m_roll=s}updateEnv(){this.m_env.entries.$zoom=this.m_zoomLevel,this.m_env.entries.$pixelToMeters=this.pixelToWorld,this.m_env.entries.$frameNumber=this.m_frameNumber}ndcToView(e,t){return t.set(e.x,e.y,e.z).applyMatrix4(this.camera.projectionMatrixInverse).applyMatrix4(this.m_rteCamera.matrixWorld),t}renderLoop(e){if(!0!==this.m_options.synchronousRendering&&!this.disposed){if(0===this.maxFps)this.render(e);else{const t=3,i=1e3/this.maxFps;e>=(void 0===this.m_previousFrameTimeStamp?0:this.m_previousFrameTimeStamp)+i-t&&this.render(e)}this.m_updatePending||this.animating?this.m_animationFrameHandle=requestAnimationFrame(this.handleRequestAnimationFrame):this.m_animationFrameHandle=void 0}}startRenderLoop(){void 0!==this.m_animationFrameHandle||this.m_options.synchronousRendering||(this.m_animationFrameHandle=requestAnimationFrame(this.handleRequestAnimationFrame))}getEnabledTileDataSources(){const e=[];for(const t of this.m_tileDataSources)this.isDataSourceEnabled(t)&&e.push(t);return e}render(e){if(this.m_drawing)return;if(this.disposed)return void U.warn("render(): MapView has been disposed of.");let t;this.RENDER_EVENT.time=e,this.dispatchEvent(this.RENDER_EVENT),this.m_tileObjectRenderer.prepareRender(),++this.m_frameNumber;const i=C.PerformanceStatistics.instance,r=i.enabled;if(r){if(t=i.currentFrame,void 0!==this.m_previousFrameTimeStamp){const i=e-this.m_previousFrameTimeStamp;t.setValue("render.fps",1e3/i)}i.storeAndClearFrameInfo(),t=t,t.setValue("renderCount.frameNumber",this.m_frameNumber)}let n,o,a,l,c,h;if(this.m_previousFrameTimeStamp=e,this.m_renderer.info.reset(),this.m_updatePending=!1,this.m_thisFrameTilesChanged=void 0,this.m_drawing=!0,this.m_renderer.getPixelRatio()!==this.pixelRatio&&this.m_renderer.setPixelRatio(this.pixelRatio),this.updateCameras(),this.updateEnv(),this.m_renderer.clear(),this.m_sceneRoot.children.length=0,this.m_overlaySceneRoot.children.length=0,r&&(n=s.PerformanceTimer.now()),!this.lockVisibleTileSet){const e=this.m_visibleTiles.updateRenderList(this.storageLevel,Math.floor(this.zoomLevel),this.getEnabledTileDataSources(),this.m_frameNumber,this.m_elevationRangeSource);e.viewRangesChanged&&this.updateCameras(e.viewRanges)}r&&(o=s.PerformanceTimer.now());const d=this.m_visibleTiles.dataSourceTileList;if(d.forEach((({zoomLevel:e,renderedTiles:t})=>{t.forEach((t=>{this.m_tileObjectRenderer.render(t,e,this.zoomLevel,this.m_camera.position,this.m_sceneRoot),t.frameNumLastVisible=this.m_frameNumber}))})),this.m_initialTextPlacementDone||this.m_firstFrameComplete||this.isDynamicFrame||this.m_themeManager.isUpdating()||!this.m_poiTableManager.finishedLoading||!this.m_visibleTiles.allVisibleTilesLoaded||this.m_connectedDataSources.size+this.m_failedDataSources.size!==this.m_tileDataSources.length||this.m_textElementsRenderer.loading||(this.m_initialTextPlacementDone=!0),this.m_mapAnchors.update(this.projection,this.camera.position,this.m_sceneRoot,this.m_overlaySceneRoot),this.m_animatedExtrusionHandler.update(this.zoomLevel),void 0!==t&&(t.addValue("renderCount.numTilesRendered",0),t.addValue("renderCount.numTilesVisible",0),t.addValue("renderCount.numTilesLoading",0),d.forEach((({zoomLevel:e,renderedTiles:i,visibleTiles:r,numTilesLoading:n})=>{t.addValue("renderCount.numTilesRendered",i.size),t.addValue("renderCount.numTilesVisible",r.length),t.addValue("renderCount.numTilesLoading",n)}))),this.m_movementDetector.checkCameraMoved(this,e)){const{latitude:e,longitude:t,altitude:i}=this.geoCenter;this.dispatchEvent({type:F.CameraPositionChanged,latitude:e,longitude:t,altitude:i,yaw:this.m_yaw,pitch:this.m_pitch,roll:this.m_roll,tilt:this.tilt,heading:this.heading,zoom:this.zoomLevel})}const u=void 0!==this.m_pointOfView?this.m_pointOfView:this.m_rteCamera;if(this.renderLabels&&!this.m_pointOfView&&this.m_textElementsRenderer.placeText(d,e),r&&(a=s.PerformanceTimer.now()),this.mapRenderingManager.render(this.m_renderer,this.m_scene,u,!this.isDynamicFrame),r&&(l=s.PerformanceTimer.now()),this.renderLabels&&!this.m_pointOfView&&this.m_textElementsRenderer.renderText(this.m_viewRanges.maximum),this.m_overlaySceneRoot.children.length>0&&this.m_renderer.render(this.m_overlayScene,u),r&&(c=s.PerformanceTimer.now()),this.m_firstFrameRendered||(this.m_firstFrameRendered=!0,r&&i.appResults.set("firstFrame",e),this.FIRST_FRAME_EVENT.time=e,this.dispatchEvent(this.FIRST_FRAME_EVENT)),this.m_visibleTiles.disposePendingTiles(),this.m_drawing=!1,this.checkCopyrightUpdates(),void 0!==this.m_taskSchedulerTimeout&&clearTimeout(this.m_taskSchedulerTimeout),this.m_taskSchedulerTimeout=setTimeout((()=>{this.m_taskSchedulerTimeout=void 0,this.m_taskScheduler.processPending(e)}),0),void 0!==t){h=s.PerformanceTimer.now();const r=h-e;t.setValue("render.setupTime",n-e),t.setValue("render.cullTime",o-n),t.setValue("render.textPlacementTime",a-o),t.setValue("render.drawTime",l-a),t.setValue("render.textDrawTime",c-l),t.setValue("render.cleanupTime",h-c),t.setValue("render.frameRenderTime",r),t.setValue("render.fullFrameTime",r),t.setValue("render.geometryCreationTime",0),i.addWebGLInfo(this.m_renderer.info),i.addMemoryInfo()}this.DID_RENDER_EVENT.time=e,this.dispatchEvent(this.DID_RENDER_EVENT),!this.textElementsRenderer.loading&&this.m_visibleTiles.allVisibleTilesLoaded&&this.m_initialTextPlacementDone&&!this.m_animatedExtrusionHandler.isAnimating&&(!1===this.m_firstFrameComplete&&(this.m_firstFrameComplete=!0,r&&i.appResults.set("firstFrameComplete",e)),this.FRAME_COMPLETE_EVENT.time=e,this.dispatchEvent(this.FRAME_COMPLETE_EVENT))}setupCamera(){s.assert(void 0!==this.m_visibleTiles);const{width:e,height:t}=this.getCanvasClientSize();this.calculateFocalLength(t),this.m_options.target=n.GeoCoordinates.fromObject(s.getOptionValue(this.m_options.target,z.target)),this.m_options.target.altitude=0,this.m_options.tilt=s.getOptionValue(this.m_options.tilt,z.tilt),this.m_options.heading=s.getOptionValue(this.m_options.heading,z.heading),this.m_options.zoomLevel=s.getOptionValue(this.m_options.zoomLevel,z.zoomLevel),this.lookAtImpl(this.m_options),this.resize(e,t)}createVisibleTileSet(){s.assert(void 0!==this.m_tileGeometryManager),this.m_visibleTiles&&(this.m_visibleTiles.clearTileCache(),this.m_visibleTiles.disposePendingTiles());const e=void 0===this.m_enableMixedLod?this.projection.type===n.ProjectionType.Spherical:this.m_enableMixedLod;return this.m_visibleTiles=new O.VisibleTileSet(new f.FrustumIntersection(this.m_camera,this,this.m_visibleTileSetOptions.extendedFrustumCulling,this.m_tileWrappingEnabled,e,this.m_lodMinTilePixelSize),this.m_tileGeometryManager,this.m_visibleTileSetOptions,this.taskQueue),this.m_visibleTiles}movementStarted(){this.m_textElementsRenderer.movementStarted(),this.MOVEMENT_STARTED_EVENT.time=Date.now(),this.dispatchEvent(this.MOVEMENT_STARTED_EVENT)}movementFinished(){this.m_textElementsRenderer.movementFinished(),this.MOVEMENT_FINISHED_EVENT.time=Date.now(),this.dispatchEvent(this.MOVEMENT_FINISHED_EVENT),this.animating||(void 0!==this.m_movementFinishedUpdateTimerId&&clearTimeout(this.m_movementFinishedUpdateTimerId),this.m_movementFinishedUpdateTimerId=setTimeout((()=>{this.m_movementFinishedUpdateTimerId=void 0,this.update()}),0))}checkIfTilesChanged(){if(void 0!==this.m_thisFrameTilesChanged)return this.m_thisFrameTilesChanged;const e=this.m_visibleTiles.dataSourceTileList,t=[];t.length=0,e.forEach((({dataSource:e,renderedTiles:i})=>{i.forEach((i=>{t.push(e.name+"-"+i.tileKey.mortonCode())}))})),t.sort();const i=t.join("#");return i!==this.m_lastTileIds?(this.m_lastTileIds=i,this.m_thisFrameTilesChanged=!0):this.m_thisFrameTilesChanged=!1,this.m_thisFrameTilesChanged}checkCopyrightUpdates(){if(!this.checkIfTilesChanged())return;const e=this.getRenderedTilesCopyrightInfo();if(e!==this.m_copyrightInfo){if(e.length===this.m_copyrightInfo.length){let t=!0;for(let i=0;i<e.length;i++){const r=e[i],n=this.m_copyrightInfo[i];if(r.label!==n.label){t=!1;break}}if(t)return}this.m_copyrightInfo=e,this.dispatchEvent(this.COPYRIGHT_CHANGED_EVENT)}}getRenderedTilesCopyrightInfo(){let e=[];for(const t of this.m_visibleTiles.dataSourceTileList)for(const i of t.renderedTiles.values()){const t=i.copyrightInfo;void 0!==t&&0!==t.length&&(e=m.CopyrightInfo.mergeArrays(e,t))}return e}setupStats(e){new C.PerformanceStatistics(e,1e3)}setupRenderer(e){var t;this.m_scene.add(this.m_sceneRoot),this.m_overlayScene.add(this.m_overlaySceneRoot),this.shadowsEnabled=null!==(t=this.m_options.enableShadows)&&void 0!==t&&t,e.setupRenderer()}createTextRenderer(){return new L.TextElementsRenderer(new A.MapViewState(this,this.checkIfTilesChanged.bind(this)),(()=>{this.update()}),this.m_screenProjector,this.m_poiManager,this.m_renderer,[this.imageCache,this.userImageCache],this.m_options)}async resetTextRenderer(e,t,i){await this.m_textElementsRenderer.updateFontCatalogs(e),await this.m_textElementsRenderer.updateTextStyles(t,i),this.update()}limitFov(e,t){e=o.MathUtils.clamp(e,10,j);let i=o.MathUtils.radToDeg(D.MapViewUtils.calculateHorizontalFovByVerticalFov(o.MathUtils.degToRad(e),t));return(i>j||i<10)&&(i=o.MathUtils.clamp(i,10,j),e=o.MathUtils.radToDeg(D.MapViewUtils.calculateVerticalFovByHorizontalFov(o.MathUtils.degToRad(i),t))),e}setFovOnCamera(e,t){let i=0;"fixed"===e.type?(this.calculateFocalLength(t),i=e.fov):(s.assert(0!==this.m_focalLength),i=D.MapViewUtils.calculateFovByFocalLength(this.m_focalLength,t)),this.m_camera.fov=this.limitFov(i,this.m_camera.aspect)}calculateFocalLength(e){s.assert(void 0!==this.m_options.fovCalculation),this.m_focalLength=D.MapViewUtils.calculateFocalLengthByVerticalFov(o.MathUtils.degToRad(this.m_options.fovCalculation.fov),e)}getCanvasClientSize(){const{clientWidth:e,clientHeight:t}=this.canvas;if(0===e||0===t||"number"!=typeof e||"number"!=typeof t){const e=this.m_renderer.getPixelRatio();return{width:Math.round(this.canvas.width/e),height:Math.round(this.canvas.height/e)}}return{width:e,height:t}}}t.MapView=G},771:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewAtmosphere=t.AtmosphereLightMode=void 0;const r=i(3139),n=i(284),s=i(2183),o=i(4428),a=i(3547);var l,c,h;!function(e){e[e.Ground=1]="Ground",e[e.Sky=2]="Sky",e[e.SkyAndGround=3]="SkyAndGround"}(l||(l={})),function(e){e[e.ScatteringShader=0]="ScatteringShader",e[e.SimpleColor=1]="SimpleColor",e[e.Wireframe=2]="Wireframe"}(c||(c={})),function(e){e[e.LightOverhead=0]="LightOverhead",e[e.LightDynamic=1]="LightDynamic"}(h=t.AtmosphereLightMode||(t.AtmosphereLightMode={}));const d={clipPlanes:{near:0,far:0}};class u{constructor(e,t,i,n,s,h=l.SkyAndGround,d=c.ScatteringShader){this.m_mapAnchors=e,this.m_sceneCamera=t,this.m_projection=i,this.m_rendererCapabilities=n,this.m_updateCallback=s,this.m_atmosphereVariant=h,this.m_materialVariant=d,this.m_enabled=!0,this.m_clipPlanesEvaluator=new a.TiltViewClipPlanesEvaluator(.025*r.EarthConstants.EQUATORIAL_RADIUS,0,1,.05,1e7),this.m_lightDirection=new o.Vector3(0,1,0),this.m_atmosphereVariant&l.Sky&&this.createSkyGeometry(),this.m_atmosphereVariant&l.Ground&&this.createGroundGeometry(),this.addToMapAnchors(this.m_mapAnchors)}static isPresent(e){for(const t of e.children)if(t.name===u.SkyAtmosphereUserName||t.name===u.GroundAtmosphereUserName)return!0;return!1}get skyMesh(){return this.m_skyMesh}get groundMesh(){return this.m_groundMesh}set enabled(e){if(this.disposed)return;if(this.m_enabled===e)return;this.m_enabled=e;const t=u.isPresent(this.m_mapAnchors);e&&!t?this.addToMapAnchors(this.m_mapAnchors):!e&&t&&this.removeFromMapAnchors(this.m_mapAnchors)}get enabled(){return this.m_enabled}set lightMode(e){if(this.m_materialVariant!==c.ScatteringShader)return;const t=e===h.LightDynamic;void 0!==this.m_groundMaterial&&this.m_groundMaterial.setDynamicLighting(t),void 0!==this.m_skyMaterial&&this.m_skyMaterial.setDynamicLighting(t)}dispose(){var e,t,i,r;this.enabled&&(this.enabled=!1),null===(e=this.m_skyMaterial)||void 0===e||e.dispose(),null===(t=this.m_groundMaterial)||void 0===t||t.dispose(),null===(i=this.m_skyGeometry)||void 0===i||i.dispose(),null===(r=this.m_groundGeometry)||void 0===r||r.dispose(),this.m_skyGeometry=void 0,this.m_groundGeometry=void 0,this.m_skyMaterial=void 0,this.m_groundMaterial=void 0,this.m_skyMesh=void 0,this.m_groundMesh=void 0}reset(e){}get disposed(){return void 0===this.m_skyMesh&&void 0===this.m_groundMesh}addToMapAnchors(e){s.assert(!u.isPresent(e),"Atmosphere already added"),void 0!==this.m_skyMesh&&e.add(m(this.m_skyMesh,Number.MIN_SAFE_INTEGER)),void 0!==this.m_groundMesh&&e.add(m(this.m_groundMesh,Number.MAX_SAFE_INTEGER)),this.m_updateCallback&&this.m_updateCallback()}removeFromMapAnchors(e){if(!u.isPresent(e))return;let t=!1;void 0!==this.m_skyMesh&&(e.remove(this.m_skyMesh),t=!0),void 0!==this.m_groundMesh&&(e.remove(this.m_groundMesh),t=!0),t&&this.m_updateCallback&&this.m_updateCallback()}createSkyGeometry(){switch(this.m_projection.type){case r.ProjectionType.Spherical:this.m_skyGeometry=new o.SphereGeometry(1.025*r.EarthConstants.EQUATORIAL_RADIUS,256,256);break;default:this.m_skyGeometry=new o.PlaneGeometry(200,200)}this.m_skyGeometry.translate(0,0,0),this.m_materialVariant===c.ScatteringShader?this.m_skyMaterial=new n.SkyAtmosphereMaterial({rendererCapabilities:this.m_rendererCapabilities}):this.m_materialVariant===c.SimpleColor?this.m_skyMaterial=new o.MeshBasicMaterial({color:new o.Color(12908781),opacity:.4,transparent:!1,depthTest:!0,depthWrite:!1,side:o.BackSide,blending:o.NormalBlending,fog:!1}):this.m_skyMaterial=new o.MeshStandardMaterial({color:8388607,depthTest:!1,depthWrite:!1,normalScale:new o.Vector2(-1,-1),side:o.BackSide,wireframe:!0}),this.m_skyMesh=new o.Mesh(this.m_skyGeometry,this.m_skyMaterial),this.m_skyMesh.name=u.SkyAtmosphereUserName,this.setupSkyForRendering()}createGroundGeometry(){switch(this.m_projection.type){case r.ProjectionType.Spherical:this.m_groundGeometry=new o.SphereGeometry(1.0001*r.EarthConstants.EQUATORIAL_RADIUS,256,256);break;default:this.m_groundGeometry=new o.PlaneGeometry(200,200)}this.m_groundGeometry.translate(0,0,0),this.m_materialVariant===c.ScatteringShader?this.m_groundMaterial=new n.GroundAtmosphereMaterial({rendererCapabilities:this.m_rendererCapabilities}):this.m_materialVariant===c.SimpleColor?this.m_groundMaterial=new o.MeshBasicMaterial({color:new o.Color(50687),opacity:.4,transparent:!0,depthTest:!1,depthWrite:!1,side:o.FrontSide,blending:o.NormalBlending,fog:!1}):this.m_groundMaterial=new o.MeshStandardMaterial({color:1149338,depthTest:!0,depthWrite:!1,side:o.FrontSide,wireframe:!0}),this.m_groundMesh=new o.Mesh(this.m_groundGeometry,this.m_groundMaterial),this.m_groundMesh.name=u.GroundAtmosphereUserName,this.setupGroundForRendering()}setupSkyForRendering(){if(void 0===this.m_skyMesh)return;let e;e=this.m_materialVariant!==c.ScatteringShader?(e,t)=>{this.overrideClipPlanes(e)}:(e,t)=>{this.overrideClipPlanes(e),s.assert(t instanceof n.SkyAtmosphereMaterial);const i=this.m_skyMaterial;i.updateUniforms(i,this.m_skyMesh,e,this.m_lightDirection)},s.assert(void 0!==this.m_skyMaterial),this.m_skyMesh.onBeforeRender=(t,i,r,n,s,o)=>{e(r,s)},this.m_skyMesh.onAfterRender=(e,t,i,r,n,s)=>{this.revertClipPlanes(i)}}setupGroundForRendering(){void 0!==this.m_groundMesh&&this.m_materialVariant===c.ScatteringShader&&(s.assert(void 0!==this.m_groundMaterial),this.m_groundMesh.onBeforeRender=(e,t,i,r,o,a)=>{s.assert(o instanceof n.GroundAtmosphereMaterial);const l=this.m_groundMaterial;l.updateUniforms(l,this.m_groundMesh,i,this.m_lightDirection)})}overrideClipPlanes(e){const t=this.m_sceneCamera;d.clipPlanes.near=t.near,d.clipPlanes.far=t.far;const i=this.m_clipPlanesEvaluator.evaluateClipPlanes(this.m_sceneCamera,this.m_projection);s.assert(e instanceof o.PerspectiveCamera);const n=e;n.near=i.near,n.far=i.far+.1*r.EarthConstants.EQUATORIAL_RADIUS,n.updateProjectionMatrix()}revertClipPlanes(e){s.assert(e instanceof o.PerspectiveCamera);const t=e;t.near=d.clipPlanes.near,t.far=d.clipPlanes.far,t.updateProjectionMatrix()}}function m(e,t){const i=e;return i.renderOrder=t,i.pickable=!1,i.anchor=new o.Vector3(0,0,0),i}t.MapViewAtmosphere=u,u.SkyAtmosphereUserName="SkyAtmosphere",u.GroundAtmosphereUserName="GroundAtmosphere"},6222:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewEnvironment=t.DEFAULT_CLEAR_COLOR=void 0;const r=i(3139),n=i(2183),s=i(4428),o=i(783),a=i(5259),l=i(3937),c=i(5393),h=n.LoggerManager.instance.create("MapViewEnvironment");t.DEFAULT_CLEAR_COLOR=16777215;const d={vector3:[new s.Vector3,new s.Vector3,new s.Vector3],frustumPoints:[new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3]};t.MapViewEnvironment=class{constructor(e,t){this.m_mapView=e,this.m_fog=new a.MapViewFog(this.m_mapView.scene),!1!==t.addBackgroundDatasource&&(this.m_backgroundDataSource=new o.BackgroundDataSource,this.m_mapView.addDataSource(this.m_backgroundDataSource)),void 0!==t.backgroundTilingScheme&&void 0!==this.m_backgroundDataSource&&this.m_backgroundDataSource.setTilingScheme(t.backgroundTilingScheme),this.updateClearColor()}get lights(){var e;return null!==(e=this.m_createdLights)&&void 0!==e?e:[]}get fog(){return this.m_fog}updateBackgroundDataSource(){this.m_backgroundDataSource&&this.m_backgroundDataSource.updateStorageLevelOffset()}clearBackgroundDataSource(){void 0!==this.m_backgroundDataSource&&this.m_mapView.clearTileCache(this.m_backgroundDataSource.name)}update(){this.m_fog.update(this.m_mapView,this.m_mapView.viewRanges.maximum),void 0!==this.m_skyBackground&&this.m_mapView.projection.type===r.ProjectionType.Planar&&this.m_skyBackground.updateCamera(this.m_mapView.camera),this.updateLights()}updateClearColor(e,i){void 0!==e?this.m_mapView.renderer.setClearColor(new s.Color(e),i):this.m_mapView.renderer.setClearColor(t.DEFAULT_CLEAR_COLOR,i)}updateSkyBackground(e,t){if(this.m_skyBackground instanceof l.SkyBackground&&void 0!==e)this.updateSkyBackgroundColors(e,t);else{if(void 0===this.m_skyBackground&&void 0!==e)return void this.addNewSkyBackground(e,t);this.m_skyBackground instanceof l.SkyBackground&&void 0===e&&this.removeSkyBackGround()}}updateLighting(e){var t;this.m_createdLights&&this.m_createdLights.forEach((e=>{this.m_mapView.scene.remove(e)})),null===(t=this.m_overlayCreatedLights)||void 0===t||t.forEach((e=>{this.m_mapView.overlayScene.remove(e),e instanceof s.DirectionalLight&&this.m_mapView.overlayScene.remove(e.target)})),void 0!==e&&(this.m_createdLights=[],this.m_overlayCreatedLights=[],e.forEach((e=>{const t=c.createLight(e);if(!t)return void h.warn(`MapView: failed to create light ${e.name} of type ${e.type}`);if(this.m_mapView.scene.add(t),t.isDirectionalLight){const e=t;this.m_mapView.scene.add(e.target)}this.m_createdLights.push(t);const i=t.clone();this.m_mapView.overlayScene.add(i),i instanceof s.DirectionalLight&&this.m_mapView.overlayScene.add(i.target.clone())})))}updateLights(){if(!this.m_mapView.shadowsEnabled||this.m_mapView.projection.type===r.ProjectionType.Spherical||void 0===this.m_createdLights||0===this.m_createdLights.length)return;const e=[{x:-1,y:-1,z:-1},{x:1,y:-1,z:-1},{x:-1,y:1,z:-1},{x:1,y:1,z:-1},{x:-1,y:-1,z:1},{x:1,y:-1,z:1},{x:-1,y:1,z:1},{x:1,y:1,z:1}].map(((e,t)=>this.m_mapView.ndcToView(e,d.frustumPoints[t])));this.m_createdLights.forEach((t=>{const i=t;if(!0===i.isDirectionalLight){const t=d.vector3[0];t.copy(i.target.position),t.sub(i.position),t.normalize();const n=d.vector3[1];this.m_mapView.projection.type===r.ProjectionType.Planar&&n.set(0,0,-1);const o=this.m_mapView.tilt,a=this.m_mapView.targetDistance*Math.cos(s.MathUtils.degToRad(o))/n.dot(t);i.target.position.copy(this.m_mapView.worldTarget).sub(this.m_mapView.camera.position),i.position.copy(this.m_mapView.worldTarget),i.position.addScaledVector(t,-a),i.position.sub(this.m_mapView.camera.position),i.updateMatrixWorld(),i.shadow.updateMatrices(i);const l=i.shadow.camera,c=e.map((e=>this.viewToLightSpace(e.clone(),l))),h=new s.Box3;c.forEach((e=>{h.expandByPoint(e)})),l.left=h.min.x,l.right=h.max.x,l.top=h.max.y,l.bottom=h.min.y,l.near=.95*-h.max.z,l.far=-h.min.z,l.updateProjectionMatrix()}}))}addNewSkyBackground(e,t){"gradient"===e.type&&void 0===e.groundColor&&(e.groundColor=n.getOptionValue(t,"#000000")),this.m_skyBackground=new l.SkyBackground(e,this.m_mapView.projection.type,this.m_mapView.camera),this.m_mapView.scene.background=this.m_skyBackground.texture}removeSkyBackGround(){this.m_mapView.scene.background=null,void 0!==this.m_skyBackground&&(this.m_skyBackground.dispose(),this.m_skyBackground=void 0)}updateSkyBackgroundColors(e,t){var i;"gradient"===e.type&&void 0===e.groundColor&&(e.groundColor=n.getOptionValue(t,"#000000")),void 0!==this.m_skyBackground&&(this.m_skyBackground.updateTexture(e,this.m_mapView.projection.type),this.m_mapView.scene.background=null===(i=this.m_skyBackground)||void 0===i?void 0:i.texture)}viewToLightSpace(e,t){return e.applyMatrix4(t.matrixWorldInverse)}}},5259:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewFog=void 0;const r=i(284),n=i(3993),s=i(2183),o=i(4428);t.MapViewFog=class{constructor(e){this.m_scene=e,this.m_enabled=!0,this.m_fog=new o.Fog(0),this.m_fogIsDefined=!1}set enabled(e){this.m_enabled=e,e&&this.m_fogIsDefined&&null===this.m_scene.fog?this.add():e||null===this.m_scene.fog||this.remove()}get enabled(){return this.m_enabled}reset(e){this.m_cachedFog=e,void 0!==e&&void 0!==e.color&&void 0!==e.startRatio?(this.m_fogIsDefined=!0,this.m_fog.color.set(e.color),this.m_enabled&&null===this.m_scene.fog&&this.add()):(this.m_fogIsDefined=!1,null!==this.m_scene.fog&&this.remove())}update(e,t){if(null!==this.m_scene.fog&&void 0!==this.m_cachedFog&&this.m_cachedFog&&void 0!==this.m_cachedFog.startRatio&&(void 0!==e.camera.far||void 0!==t)){const i=void 0!==t?t:e.camera.far,r=1,n=0,a=this.m_cachedFog.startRatio,l=1;s.assert(a<=l);const c=Math.abs(Math.cos(e.tilt)),h=s.MathUtils.smoothStep(r,n,c);this.m_fog.near=o.MathUtils.lerp(i*a,i,1-h),this.m_fog.far=o.MathUtils.lerp(i*l,i,h),this.m_fog.near=Math.min(this.m_fog.near,e.camera.far),this.m_fog.far=Math.min(this.m_fog.far,e.camera.far)}}add(){this.m_scene.fog=this.m_fog,this.setFogInRawShaderMaterials(!0)}remove(){this.m_scene.fog=null,this.setFogInRawShaderMaterials(!1)}setFogInRawShaderMaterials(e){this.m_scene.traverse((t=>{if(t instanceof o.Mesh){const i=t.material;i instanceof o.Material&&!(i instanceof r.HighPrecisionLineMaterial)&&i.fog!==e&&(i.fog=e,i instanceof n.RawShaderMaterial&&i.invalidateFog())}}))}}},8309:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Squares=t.Circles=t.MapViewPoints=void 0;const r=i(4428);class n extends r.Points{constructor(){super(...arguments),this.enableRayTesting=!0}raycast(e,t){if(!this.enableRayTesting)return;const i=this.geometry,n=this.matrixWorld,o=s(e.ray.origin.clone().add(e.ray.direction).project(e.camera),e),a=(i,r)=>{const a=function(e,t,i){const r=e.clone().applyMatrix4(t),n=r.distanceTo(i.ray.origin),o=r.project(i.camera),a=o.x<1&&o.x>-1&&o.y<1&&o.y>-1;return a?{absoluteScreenPosition:s(o,i),pointIsOnScreen:a,distance:n}:{pointIsOnScreen:a}}(i,n,e);a.pointIsOnScreen&&this.testPoint(i,a.absoluteScreenPosition,o,r,a.distance,t)},l=new r.Vector3,c=i.index,h=i.attributes.position.array;if(null!==c){const e=c.array;for(let t=0,i=e.length;t<i;t++)a(l.fromArray(h,3*e[t]),t)}else for(let e=0,t=h.length/3;e<t;e++)a(l.fromArray(h,3*e),e)}}function s(e,t){return new r.Vector2(e.x+1,1-e.y).divideScalar(2).multiply(t.canvasSize).ceil()}t.MapViewPoints=n,t.Circles=class extends n{testPoint(e,t,i,r,n,s){const o=t.x-i.x,a=t.y-i.y;Math.sqrt(o*o+a*a)<=this.material.size/2&&s.push({point:e,distance:n,index:r,object:this})}},t.Squares=class extends n{testPoint(e,t,i,r,n,s){const o=t.x-i.x,a=t.y-i.y,l=this.material.size/2;Math.abs(o)<=l&&Math.abs(a)<=l&&s.push({point:e,distance:n,index:r,object:this})}}},5215:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewTaskScheduler=void 0;const r=i(2183),n=i(4428),s=i(5667),o=i(5005),a={type:"update"};class l extends n.EventDispatcher{constructor(e=60){super(),this.m_maxFps=e,this.m_throttlingEnabled=!1,this.m_taskQueue=new r.TaskQueue({groups:[s.TileTaskGroups.FETCH_AND_DECODE,s.TileTaskGroups.CREATE],prioSortFn:(e,t)=>e.getPriority()-t.getPriority()}),this.maxFps=e}set maxFps(e){this.m_maxFps=e<=0?60:e}get maxFps(){return this.m_maxFps}get taskQueue(){return this.m_taskQueue}get throttlingEnabled(){return!0===this.m_throttlingEnabled}set throttlingEnabled(e){this.m_throttlingEnabled=e}requestUpdate(){this.dispatchEvent(a)}processPending(e){const t=o.PerformanceStatistics.instance,i=t.enabled?t.currentFrame:void 0;let n;t.enabled&&(n=r.PerformanceTimer.now()),this.m_taskQueue.update();let a=this.taskQueue.numItemsLeft();if(null==i||i.setValue("TaskScheduler.numPendingTasks",a),this.throttlingEnabled){let t=this.spaceInFrame(e);t=t>2?t-2:t,null==i||i.setValue("TaskScheduler.estimatedAvailableTime",t);let r=0;for(;t>0&&a>0;){function l(e){var i,n;return t-=null!==(n=null===(i=e.estimatedProcessTime)||void 0===i?void 0:i.call(e))&&void 0!==n?n:2,t>0||1===r}r++,[s.TileTaskGroups.CREATE,s.TileTaskGroups.FETCH_AND_DECODE].forEach((e=>{this.m_taskQueue.numItemsLeft(e)&&this.m_taskQueue.processNext(e,l)})),a=this.m_taskQueue.numItemsLeft()}a=this.m_taskQueue.numItemsLeft(),a>0&&(null==i||i.setValue("TaskScheduler.pendingTasksNotYetProcessed",a),this.requestUpdate())}else this.m_taskQueue.processNext(s.TileTaskGroups.CREATE,void 0,this.m_taskQueue.numItemsLeft(s.TileTaskGroups.CREATE)),this.m_taskQueue.processNext(s.TileTaskGroups.FETCH_AND_DECODE,void 0,this.m_taskQueue.numItemsLeft(s.TileTaskGroups.FETCH_AND_DECODE));t.enabled&&(null==i||i.setValue("TaskScheduler.pendingTasksTime",r.PerformanceTimer.now()-n))}clearQueuedTasks(){this.m_taskQueue.clear()}spaceInFrame(e){const t=(performance||Date).now()-e;return Math.max(1e3/this.m_maxFps-t,0)}}t.MapViewTaskScheduler=l},3167:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewThemeManager=void 0;const r=i(2183),n=i(4894),s=i(3119),o=r.LoggerManager.instance.create("MapViewThemeManager");t.MapViewThemeManager=class{constructor(e,t){this.m_mapView=e,this.m_uriResolver=t,this.m_abortControllers=[],this.m_theme={},this.m_imageCache=new n.MapViewImageCache}async setTheme(e){return this.isUpdating()&&(o.warn("Formerly set Theme is still updating, update will be canceled"),this.cancelThemeUpdate()),this.m_updatePromise=this.loadTheme(e).then((async e=>{await this.updateTheme(e)})),await this.m_updatePromise,this.m_updatePromise=void 0,this.m_theme}async getTheme(){return this.isUpdating()&&await this.m_updatePromise,this.m_theme}isUpdating(){return void 0!==this.m_updatePromise}get theme(){return this.isUpdating()?{}:this.m_theme}async loadTheme(e){let t={};if("string"!=typeof e&&s.ThemeLoader.isThemeLoaded(e))t=e;else try{t=await s.ThemeLoader.load(e,{uriResolver:this.m_uriResolver,signal:this.createAbortController().signal})}catch(e){"AbortError"===e.name?o.warn(`theme loading was aborted due to: ${e}`):o.error(`failed to load theme: ${e}`)}return t}async updateTheme(e){var t,i;const r=this.m_mapView.sceneEnvironment;this.m_theme.fog=e.fog,this.m_theme.sky=e.sky,r.updateSkyBackground(e.sky),r.fog.reset(e.fog),this.m_theme.lights=e.lights,r.updateLighting(e.lights),this.m_theme.clearColor=e.clearColor,this.m_theme.clearAlpha=e.clearAlpha,r.updateClearColor(e.clearColor,e.clearAlpha),this.m_theme.images=e.images,this.m_theme.imageTextures=e.imageTextures,await this.updateImages(e.images,e.imageTextures),this.m_theme.poiTables=e.poiTables,await this.loadPoiTables(e.poiTables),this.m_theme.textStyles=e.textStyles,this.m_theme.defaultTextStyle=e.defaultTextStyle,this.m_theme.fontCatalogs=e.fontCatalogs,await this.m_mapView.resetTextRenderer(e.fontCatalogs,e.textStyles,e.defaultTextStyle),Array.isArray(e.priorities)&&(this.m_theme.priorities=e.priorities),this.m_mapView.mapAnchors.setPriorities(null!==(t=e.priorities)&&void 0!==t?t:[]),Array.isArray(e.labelPriorities)&&(this.m_theme.labelPriorities=e.labelPriorities),void 0===this.m_theme.styles&&(this.m_theme.styles={}),this.m_theme.styles=null!==(i=e.styles)&&void 0!==i?i:{},this.m_theme.definitions=e.definitions,r.clearBackgroundDataSource();for(const e of this.m_mapView.dataSources)await e.setTheme(this.m_theme)}updateCache(){this.updateImages(this.m_theme.images,this.m_theme.imageTextures),this.m_mapView.sceneEnvironment.updateLighting(this.m_theme.lights),this.m_mapView.sceneEnvironment.updateSkyBackground(this.m_theme.sky,this.m_theme.clearColor)}get imageCache(){return this.m_imageCache}dispose(){this.m_imageCache.clear()}async loadPoiTables(e){this.m_mapView.poiTableManager.clear(),await this.m_mapView.poiTableManager.loadPoiTables(e)}cancelThemeUpdate(){for(var e=0;e<this.m_abortControllers.length;e++)this.m_abortControllers[e].abort();this.m_abortControllers=[],this.m_imageCache.clear(),this.m_mapView.poiManager.clear(),this.m_mapView.poiTableManager.clear()}createAbortController(){return this.m_abortControllers.push(new AbortController),this.m_abortControllers[this.m_abortControllers.length-1]}async updateImages(e,t){if(this.m_imageCache.clear(),this.m_mapView.poiManager.clear(),void 0!==e)for(const t of Object.keys(e)){const i=e[t];this.m_imageCache.addImage(t,i.url,!0===i.preload),"string"==typeof i.atlas&&await this.m_mapView.poiManager.addTextureAtlas(t,i.atlas,this.createAbortController().signal)}void 0!==t&&t.forEach((e=>{this.m_mapView.poiManager.addImageTexture(e)}))}}},4073:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PathBlockingElement=void 0;const r=i(4428);t.PathBlockingElement=class{constructor(e){this.points=e,this.screenSpaceLines=new Array(e.length>=2?e.length-1:0);for(let e=0;e<this.screenSpaceLines.length;e++)this.screenSpaceLines[e]=new r.Line3(new r.Vector3,new r.Vector3)}}},6552:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickHandler=t.PickObjectType=void 0;const r=i(3187),n=i(3139),s=i(4428),o=i(8309),a=i(6609),l=i(9960),c=i(8730);var h;!function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.Area=3]="Area",e[e.Text=4]="Text",e[e.Icon=5]="Icon",e[e.Object3D=6]="Object3D"}(h=t.PickObjectType||(t.PickObjectType={}));const d=new s.Vector3,u=new n.OrientedBox3;function m(e,t,i,r,n){for(const s of e.dependencies){const o=s.mortonCode();if(r.has(o))continue;r.add(o);const a=n.visibleTileSet.getCachedTile(e.dataSource,s,e.offset,n.frameNumber);void 0!==a&&i.intersectObjects(a.objects,!0,t)}}t.PickHandler=class{constructor(e,t,i=!1){this.mapView=e,this.camera=t,this.enablePickTechnique=i,this.m_pickingRaycaster=new a.PickingRaycaster(e.renderer.getSize(new s.Vector2))}intersectMapObjects(e,t,i){const r=this.mapView.getNormalizedScreenCoordinates(e,t),n=this.setupRaycaster(e,t),o=new l.PickListener(i);if(void 0!==this.mapView.textElementsRenderer){const{clientWidth:e,clientHeight:t}=this.mapView.canvas,i=r.x*e*.5,n=r.y*t*.5,a=new s.Vector2(i,n);this.mapView.textElementsRenderer.pickTextElements(a,o)}const a=[],c=this.getIntersectedTiles(n),h=new Set;for(const{tile:e,distance:t}of c){if(o.done&&o.furthestResult.distance<t)break;a.length=0,n.intersectObjects(e.objects,!0,a),m(e,a,n,h,this.mapView);for(const e of a)o.addResult(this.createResult(e))}a.length=0;for(const e of this.mapView.mapAnchors.children){n.intersectObject(e,!0,a);for(const e of a)o.addResult(this.createResult(e))}return o.finish(),o.results}raycasterFromScreenPoint(e,t){return this.m_pickingRaycaster.setFromCamera(this.mapView.getNormalizedScreenCoordinates(e,t),this.camera),this.mapView.renderer.getSize(this.m_pickingRaycaster.canvasSize),this.m_pickingRaycaster}createResult(e){var t;const i={type:h.Unspecified,point:e.point,distance:e.distance,intersection:e};if(void 0===e.object.userData||void 0===e.object.userData.feature)return i;this.enablePickTechnique&&(i.technique=e.object.userData.technique),i.renderOrder=null===(t=e.object)||void 0===t?void 0:t.renderOrder;const n=e.object.userData.feature;if(this.addObjInfo(n,e,i),i.userData){const e=r.getFeatureId(i.userData);i.featureId=0===e?void 0:e}let s;switch(n.geometryType){case r.GeometryType.Point:case r.GeometryType.Text:s=h.Point;break;case r.GeometryType.Line:case r.GeometryType.ExtrudedLine:case r.GeometryType.SolidLine:case r.GeometryType.TextPath:s=h.Line;break;case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:s=h.Area;break;case r.GeometryType.Object3D:s=h.Object3D;break;default:s=h.Unspecified}return i.type=s,i}getIntersectedTiles(e){const t=new Array;return this.mapView.visibleTileSet.dataSourceTileList.forEach((i=>{i.dataSource.enablePicking&&i.renderedTiles.forEach((i=>{u.copy(i.boundingBox),u.position.sub(this.mapView.worldCenter);const r=i.computeWorldOffsetX();u.position.x+=r;const n=u.intersectsRay(e.ray);void 0!==n&&t.push({tile:i,distance:n})}))})),t.sort(((e,t)=>e.distance-t.distance)),t}addObjInfo(e,t,i){if(void 0===e.objInfos)return;if(i.intersection.object instanceof o.MapViewPoints)return void(i.userData=e.objInfos[t.index]);if(void 0===e.starts||0===e.starts.length||void 0===t.faceIndex&&void 0===t.index)return void(1===e.objInfos.length&&(i.userData=e.objInfos[0]));if(1===e.starts.length)return void(i.userData=e.objInfos[0]);const r=void 0!==t.faceIndex?3*t.faceIndex:t.index;let n=0;for(const t of e.starts){if(t>r)break;n++}i.userData=e.objInfos[n-1]}setupRaycaster(e,t){const i=this.mapView.camera,r=this.raycasterFromScreenPoint(e,t),n=this.mapView.getWorldPositionAt(e,t,!0),s=i.position.distanceTo(n)/this.mapView.camera.getWorldDirection(d).dot(r.ray.direction);return r.params.Line.threshold=c.MapViewUtils.calculateWorldSizeByFocalLength(this.mapView.focalLength,s,1),r}}},9960:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickListener=void 0;const r=i(2183);function n(e,t){const i=e.distance-t.distance,r=void 0!==e.renderOrder&&void 0!==t.renderOrder;return 0===i&&r?t.renderOrder-e.renderOrder:i}t.PickListener=class{constructor(e){this.m_parameters=e,this.m_results=[],this.m_sorted=!0,this.m_finished=!0}addResult(e){const t=this.m_results.findIndex((t=>{var i,r,n,s;const o=t.type===e.type,a=null===(r=null===(i=e.intersection)||void 0===i?void 0:i.object.userData)||void 0===r?void 0:r.dataSource,l=a&&(null===(s=null===(n=t.intersection)||void 0===n?void 0:n.object.userData)||void 0===s?void 0:s.dataSource)===a,c=void 0!==e.featureId&&t.featureId===e.featureId,h=void 0===e.featureId&&void 0===t.featureId,d=e.userData&&t.userData===e.userData;return o&&l&&(c||h&&d)}));if(t<0)return this.m_sorted=!1,this.m_finished=!1,void this.m_results.push(e);const i=this.m_results[t];n(e,i)<0&&(this.m_results[t]=e,this.m_sorted=!1,this.m_finished=!1)}get done(){return!!this.maxResults&&this.m_results.length>=this.maxResults}finish(){this.sortResults(),this.maxResults&&this.m_results.length>this.maxResults&&(this.m_results.length=this.maxResults),this.m_finished=!0}get results(){return r.assert(this.m_finished,"finish() was not called before getting the results"),this.m_results}get closestResult(){return this.sortResults(),this.m_results.length>0?this.m_results[0]:void 0}get furthestResult(){return this.sortResults(),this.m_results.length>0?this.m_results[this.m_results.length-1]:void 0}get maxResults(){var e,t;const i=null!==(t=null===(e=this.m_parameters)||void 0===e?void 0:e.maxResultCount)&&void 0!==t?t:0;return i>0?i:void 0}sortResults(){this.m_sorted||(this.m_results.sort(n),this.m_sorted=!0)}}},6609:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PickingRaycaster=void 0;const r=i(4428),n=i(3668);function s(e,t,i,r){if(e.layers.test(t.layers)&&e.visible){const r=n.MapObjectAdapter.get(e);r&&!r.isPickable()||e.raycast(t,i)}if(!0===r)for(const r of e.children)s(r,t,i,!0)}class o extends r.Raycaster{constructor(e){super(),this.canvasSize=e}intersectObject(e,t,i){const r=null!=i?i:[];return s(e,this,r,t),r}intersectObjects(e,t,i){const r=null!=i?i:[];for(const i of e)s(i,this,r,t);return r}}t.PickingRaycaster=o},4450:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolarTileDataSource=void 0;const r=i(3187),n=i(5263),s=i(3139),o=i(4428),a=i(5532),l=i(2084),c=i(3668),h=i(3119),d=i(2315);class u extends a.DataSource{constructor({name:e="polar",styleSetName:t="polar",minDataLevel:i,maxDataLevel:r,minDisplayLevel:n,maxDisplayLevel:a,storageLevelOffset:l=-2,geometryLevelOffset:c=1,debugTiles:h=!1}){super({name:e,styleSetName:t,minDataLevel:i,maxDataLevel:r,minDisplayLevel:n,maxDisplayLevel:a,storageLevelOffset:l}),this.m_tilingScheme=s.polarTilingScheme,this.m_maxLatitude=o.MathUtils.radToDeg(s.MercatorConstants.MAXIMUM_LATITUDE),this.m_geometryLevelOffset=c,this.m_debugTiles=h,this.cacheable=!1,this.enablePicking=!1}dispose(){this.m_northPoleEntry&&(this.m_northPoleEntry.material.dispose(),delete this.m_northPoleEntry),this.m_southPoleEntry&&(this.m_southPoleEntry.material.dispose(),delete this.m_southPoleEntry),this.m_styleSetEvaluator&&delete this.m_styleSetEvaluator}createTechiqueEntry(e){if(!this.m_styleSetEvaluator)return;const t=new n.MapEnv({$geometryType:"polygon",$layer:"earth",kind:e}),i=this.m_styleSetEvaluator.getMatchingTechniques(t);if(0===i.length)return;const r=i[0],s=l.createMaterial(this.mapView.renderer.capabilities,{technique:r,env:this.mapView.env});return s?{material:s,technique:r}:void 0}async setTheme(e){let t;e=await h.ThemeLoader.load(e),void 0!==this.styleSetName&&void 0!==e.styles&&(t=e.styles[this.styleSetName]),this.m_styleSetEvaluator=new n.StyleSetEvaluator({styleSet:null!=t?t:[],definitions:e.definitions,priorities:e.priorities,labelPriorities:e.labelPriorities}),this.m_northPoleEntry=this.createTechiqueEntry("north_pole"),this.m_southPoleEntry=this.createTechiqueEntry("south_pole"),this.mapView.markTilesDirty(this)}canGetTile(e,t){if(e!==t.level||t.level<1)return!1;const{north:i,south:r}=this.m_tilingScheme.getGeoBox(t);return i>this.m_maxLatitude||r<-this.m_maxLatitude}shouldSubdivide(e,t){if(e<=t.level)return!1;const{north:i,south:r}=this.m_tilingScheme.getGeoBox(t);return i>this.m_maxLatitude||r<-this.m_maxLatitude}getTilingScheme(){return this.m_tilingScheme}getTile(e){const t=new d.Tile(this,e);return this.createTileGeometry(t),t}get geometryLevelOffset(){return this.m_geometryLevelOffset}set geometryLevelOffset(e){this.m_geometryLevelOffset=e}intersectEdge(e,t,i){const r=t.latitude,n=i.latitude;let o=t.longitude,a=i.longitude;90===Math.abs(r)&&(o=a),90===Math.abs(n)&&(a=o);const l=a-o,c=(e-r)/(n-r);return new s.GeoCoordinates(e,o+l*c,0)}createTileGeometry(e){const{north:t,south:i}=e.geoBox,n=t>0&&i>=0,a=n?this.m_northPoleEntry:this.m_southPoleEntry;if(void 0===a)return void e.forceHasGeometry(!0);const l=this.m_tilingScheme.projection,h=this.projection,d=this.m_maxLatitude,u=n?d:-d,m=this.m_tilingScheme.boundingBoxGenerator.getWorldBox(e.tileKey),p=l.unprojectPoint(new o.Vector3(m.min.x,m.min.y,0)),f=l.unprojectPoint(new o.Vector3(m.max.x,m.min.y,0)),g=l.unprojectPoint(new o.Vector3(m.max.x,m.max.y,0)),v=l.unprojectPoint(new o.Vector3(m.min.x,m.max.y,0));let _,y=!1;if(1===e.tileKey.level){const e=0===m.min.x,t=e?m.max.x:m.min.x,i=(m.max.y+m.min.y)/2,r=l.unprojectPoint(new o.Vector3(t,i,0)),s=e?p:f;_=n?e?[r,g,s,f]:[r,p,s,v]:e?[r,f,s,g]:[r,v,s,p],y=!0}else{_=n?[p,f,g,v]:[p,v,g,f];const e=_.map((e=>e.latitude)),t=Math.max(...e),i=Math.min(...e);if(n?t<u:i>u)return;if(y=n?i<u:t>u,y){const r=e.indexOf(n?t:i);if(0!==r)for(let e=0;e<r;e++)_.push(_.shift())}}if(y){const t=(m.min.x+m.max.x)/2,i=(m.min.y+m.max.y)/2,r=l.unprojectPoint(new o.Vector3(t,i,0));s.TransverseMercatorUtils.alignLongitude(_,r);const n=_[0],a=_[1],c=_[2],h=_[3],p=Math.abs(a.latitude)>=d,f=Math.abs(h.latitude)>=d,g=p?this.intersectEdge(u,a,c):this.intersectEdge(u,n,a),v=f?this.intersectEdge(u,h,c):this.intersectEdge(u,n,h);_.splice(p?2:1,4,g);const y=e.tileKey.level-this.storageLevelOffset+this.m_geometryLevelOffset,x=360/(1<<Math.max(0,y)),b=Math.floor((g.longitude+180)/x),T=Math.ceil((v.longitude+180)/x);for(let e=b+1;e<T;e++)_.push(new s.GeoCoordinates(u,e*x-180,0));_.push(v),f&&_.push(h)}const x=new o.BufferGeometry,b=_.map((t=>{const i=h.projectPoint(t,new o.Vector3);return i.sub(e.center),i}));x.setFromPoints(b);const T=[];for(let e=1;e<b.length-1;e++)n?T.push(0,e,e+1):T.push(0,e+1,e);x.setIndex(T);const w=new o.Mesh(x,a.material);if(w.userData={dataSource:this.name,tileKey:e.tileKey},this.m_debugTiles){const t=Math.round(16777215*Math.abs(Math.sin(11*e.tileKey.mortonCode())));w.material=new o.MeshBasicMaterial({color:t,transparent:!0,opacity:.5}),e.objects.push(new o.Mesh(x,new o.MeshBasicMaterial({color:t,wireframe:!0})))}c.MapObjectAdapter.create(w,{dataSource:this,technique:a.technique,kind:[n?r.StandardGeometryKind.Water:r.StandardGeometryKind.Background]}),e.objects.push(w)}}t.PolarTileDataSource=u},6758:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenCollisionsDebug=t.ScreenCollisions=t.isLineWithBound=t.DetailedCollisionBox=t.CollisionBox=void 0;const r=i(2183),n=i(4428),s=i(8601),o=i(2519),a=r.LoggerManager.instance.create("ScreenCollissions");class l extends r.Math2D.Box{constructor(e){super(),void 0!==e&&this.copy(e)}copy(e){return e instanceof r.Math2D.Box?this.set(e.x,e.y,e.w,e.h):e instanceof n.Box2?this.set(e.min.x,e.min.y,e.max.x-e.min.x,e.max.y-e.min.y):this.set(e.minX,e.minY,e.maxX-e.minX,e.maxY-e.minY),this}get minX(){return this.x}set minX(e){this.x=e}get maxX(){return this.x+this.w}set maxX(e){this.w=e-this.x}get minY(){return this.y}set minY(e){this.y=e}get maxY(){return this.y+this.h}set maxY(e){this.h=e-this.y}}t.CollisionBox=l;class c extends l{constructor(e,t){super(e),this.detailBoxes=t}}function h(e){return void 0!==e.line}t.DetailedCollisionBox=c,t.isLineWithBound=h;const d=new l;class u{constructor(){this.screenBounds=new r.Math2D.Box,this.rtree=new o}reset(){this.rtree.clear()}update(e,t){this.screenBounds.set(e/-2,t/-2,e,t),this.reset()}allocate(e){const t=e instanceof l?e:new l(e);this.rtree.insert(t)}allocateIBoxes(e){this.rtree.load(e)}search(e){return this.rtree.search(e)}isAllocated(e){const t=e instanceof l?e:d.copy(e),i=this.search(t);return this.intersectsDetails(t,i)}isVisible(e){return this.screenBounds.intersects(e)}isFullyVisible(e){return this.screenBounds.containsBox(e)}intersectsDetails(e,t){for(const i of t)if(i instanceof c){for(const t of i.detailBoxes)if(t.intersects(e))return!0}else{if(!h(i))return!0;{const t=i;if(this.intersectsLine(e,t))return!0}}return!1}intersectsLine(e,t){const i=t.line,r=i.end.x-i.start.x;let n,s,o,a;if(0!==r){const t=i.end.y-i.start.y,l=t,c=-r,h=i.start.y-t/r*i.start.x;n=Math.sign(e.minX*l+(e.minY-h)*c),s=Math.sign(e.maxX*l+(e.minY-h)*c),o=Math.sign(e.minX*l+(e.maxY-h)*c),a=Math.sign(e.maxX*l+(e.maxY-h)*c)}else n=Math.sign(e.minX-i.start.x),s=Math.sign(e.maxX-i.start.x),o=Math.sign(e.minX-i.start.x),a=Math.sign(e.maxX-i.start.x);return n!==s||n!==o||n!==a}}t.ScreenCollisions=u,t.ScreenCollisionsDebug=class extends u{constructor(e){super(),this.m_renderContext=null,this.m_renderingEnabled=!1,this.m_numAllocations=0,this.m_numSuccessfulTests=0,this.m_numFailedTests=0,this.m_numSuccessfulVisibilityTests=0,this.m_numFailedVisibilityTests=0,null!=e&&(this.m_renderContext=e.getContext("2d"))}reset(){super.reset(),this.m_numAllocations=0,this.m_numSuccessfulTests=0,this.m_numFailedTests=0,this.m_numSuccessfulVisibilityTests=0,this.m_numFailedVisibilityTests=0}update(e,t){this.m_renderingEnabled&&a.log(`Allocations: ${this.m_numAllocations} Successful Tests: ${this.m_numSuccessfulTests} Failed Tests: ${this.m_numFailedTests}  Successful Visibility Tests: ${this.m_numSuccessfulVisibilityTests}  Failed Visibility Tests: ${this.m_numFailedVisibilityTests} `),super.update(e,t),null!==this.m_renderContext&&(this.m_renderContext.canvas.width=e,this.m_renderContext.canvas.height=t),this.m_renderingEnabled=s.debugContext.getValue("DEBUG_SCREEN_COLLISIONS")}allocate(e){super.allocate(e),this.m_numAllocations++,this.m_renderingEnabled&&null!==this.m_renderContext&&(this.m_renderContext.strokeStyle="#6666ff",this.m_renderContext.strokeRect(e.x-this.screenBounds.x,this.screenBounds.y+this.screenBounds.h-e.y,e.w,-e.h))}allocateIBoxes(e){for(const t of e)this.m_numAllocations++,this.m_renderingEnabled&&null!==this.m_renderContext&&(this.m_renderContext.strokeStyle="#aa2222",this.m_renderContext.strokeRect(t.minX-this.screenBounds.x,this.screenBounds.y+this.screenBounds.h-t.minY,t.maxX-t.minX,-(t.maxY-t.minY)));super.allocateIBoxes(e)}intersectsDetails(e,t){const i=super.intersectsDetails(e,t);if(this.m_renderingEnabled&&null!==this.m_renderContext){const t=i?2:1;this.m_renderContext.strokeStyle=i?"#FF0000":"#00ff00",this.m_renderContext.strokeRect(e.x-this.screenBounds.x-t,this.screenBounds.y+this.screenBounds.h-e.y+t,e.w+2*t,-e.h-2*t)}return i?this.m_numFailedTests++:this.m_numSuccessfulTests++,i}isVisible(e){const t=super.isVisible(e);return t?this.m_numSuccessfulVisibilityTests++:this.m_numFailedVisibilityTests++,t}}},8764:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenProjector=void 0;const r=i(4428);function n(e){return e.z>-1&&e.z<1}class s{constructor(e){this.m_camera=e,this.m_width=0,this.m_height=0}get width(){return this.m_width}get height(){return this.m_height}project(e,t=new r.Vector2){const i=this.projectVector(e,s.tempV3);return this.ndcToScreen(i,t)}projectToScreen(e,t=new r.Vector2){const i=this.projectVector(e,s.tempV3);if(n(i))return this.ndcToScreen(i,t)}projectAreaToScreen(e,t,i,o=new r.Vector2){t*=2,i*=2;const a=this.projectVector(e,s.tempV3);if(n(a)&&a.x+t>=-1&&a.x-t<=1&&a.y+i>=-1&&a.y-i<=1)return this.ndcToScreen(a,o)}project3(e,t=new r.Vector3){const i=this.projectVector(e,s.tempV3);if(i.z>-1&&i.z<1)return t.set(i.x*this.m_width/2,i.y*this.m_height/2,i.z),t}projectVector(e,t){return t.set(e.x,e.y,e.z).project(this.m_camera),t}onScreen(e){return(t=this.projectVector(e,s.tempV3)).z>-1&&t.z<1&&t.x>=-1&&t.x<=1&&t.y>=-1&&t.y<=1;var t}update(e,t,i){this.m_camera=e,this.m_width=t,this.m_height=i}ndcToScreen(e,t){return t.set(e.x*this.m_width/2,e.y*this.m_height/2)}}t.ScreenProjector=s,s.tempV2=new r.Vector2,s.tempV3=new r.Vector3},3937:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyBackground=void 0;const r=i(6811),n=i(9516);t.SkyBackground=class{constructor(e,t,i){switch(this.m_sky=e,this.m_projectionType=t,this.m_sky.type){case"gradient":this.m_skyTexture=new n.SkyGradientTexture(this.m_sky,this.m_projectionType),this.updateCamera(i);break;case"cubemap":this.m_skyTexture=new r.SkyCubemapTexture(this.m_sky)}}dispose(){this.m_skyTexture.dispose()}get texture(){return this.m_skyTexture.texture}updateCamera(e){"gradient"===this.m_sky.type&&this.m_skyTexture.update(e)}updateTexture(e,t){const i=this.m_sky.type===e.type&&this.m_projectionType===t;switch(e.type){case"gradient":i?this.m_skyTexture.updateTexture(e):this.m_skyTexture=new n.SkyGradientTexture(e,t);break;case"cubemap":i?this.m_skyTexture.updateTexture(e):this.m_skyTexture=new r.SkyCubemapTexture(e)}this.m_projectionType=t,this.m_sky=e}}},6811:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyCubemapTexture=t.SkyCubemapFaceId=t.SKY_CUBEMAP_FACE_COUNT=void 0;const r=i(2183),n=i(4428),s=r.LoggerManager.instance.create("SkyCubemapTexture");var o;t.SKY_CUBEMAP_FACE_COUNT=6,function(e){e[e.positiveX=0]="positiveX",e[e.negativeX=1]="negativeX",e[e.positiveY=2]="positiveY",e[e.negativeY=3]="negativeY",e[e.positiveZ=4]="positiveZ",e[e.negativeZ=5]="negativeZ"}(o=t.SkyCubemapFaceId||(t.SkyCubemapFaceId={})),t.SkyCubemapTexture=class{constructor(e){const t=this.createCubemapFaceArray(e);this.m_skybox=void 0!==t?(new n.CubeTextureLoader).load(t):new n.CubeTexture}dispose(){this.m_skybox.dispose()}get texture(){return this.m_skybox}updateTexture(e){const t=this.createCubemapFaceArray(e);void 0!==t&&(this.m_skybox=(new n.CubeTextureLoader).load(t))}createCubemapFaceArray(e){const i=[void 0,void 0,void 0,void 0,void 0,void 0];for(let r=0;r<t.SKY_CUBEMAP_FACE_COUNT;++r){const t=e[o[r]];if(void 0===t)return void s.error(`Face "${o[r]}" was not defined.`);i[r]=t}return i}}},9516:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyGradientTexture=t.DEFAULT_MONOMIAL_POWER=t.DEFAULT_TEXTURE_SIZE=void 0;const r=i(3139),n=i(2183),s=i(4428);t.DEFAULT_TEXTURE_SIZE=512,t.DEFAULT_MONOMIAL_POWER=1;const o=[new s.Vector3(1,0,0),new s.Vector3(-1,0,0),new s.Vector3(0,-1,0),new s.Vector3(0,1,0),new s.Vector3(0,0,1),new s.Vector3(0,0,-1)],a=[new s.Vector3(0,0,-1),new s.Vector3(0,0,1),new s.Vector3(1,0,0),new s.Vector3(1,0,0),new s.Vector3(1,0,0),new s.Vector3(-1,0,0)],l=[new s.Vector3(0,1,0),new s.Vector3(0,1,0),new s.Vector3(0,0,1),new s.Vector3(0,0,-1),new s.Vector3(0,1,0),new s.Vector3(0,1,0)];t.SkyGradientTexture=class{constructor(e,i,n=t.DEFAULT_TEXTURE_SIZE){this.m_projectionType=i,this.m_height=n;const o=new s.Color(e.topColor),a=new s.Color(e.bottomColor),l=new s.Color(e.groundColor);this.m_width=this.m_projectionType===r.ProjectionType.Planar?1:this.m_height,this.m_faceCount=this.m_projectionType===r.ProjectionType.Planar?1:6,this.m_faces=[];for(let t=0;t<this.m_faceCount;++t){const i=new Uint8Array(3*this.m_width*this.m_height);this.fillTextureData(i,t,o,a,l,e.monomialPower);const r=new s.DataTexture(i,this.m_width,this.m_height,s.RGBFormat);r.needsUpdate=!0,r.unpackAlignment=1,this.m_faces.push(r)}this.m_projectionType===r.ProjectionType.Spherical?(this.m_skybox=new s.CubeTexture(this.m_faces),this.m_skybox.needsUpdate=!0):(this.m_farClipPlaneDividedVertically=new s.Line3,this.m_groundPlane=new s.Plane(new s.Vector3(0,0,1)),this.m_bottomMidFarPoint=new s.Vector3,this.m_topMidFarPoint=new s.Vector3,this.m_horizonPosition=new s.Vector3,this.m_farClipPlaneCorners=[new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3])}dispose(){for(let e=0;e<this.m_faceCount;++e)this.m_faces[e].dispose();this.m_projectionType===r.ProjectionType.Spherical&&this.m_skybox.dispose()}get texture(){return this.m_projectionType===r.ProjectionType.Planar?this.m_faces[0]:this.m_skybox}update(e){this.m_projectionType===r.ProjectionType.Planar&&(this.setHorizonPosition(e),this.updateTexturePosition())}updateTexture(e){for(let t=0;t<this.m_faceCount;++t)this.fillTextureData(this.m_faces[t].image.data,t,new s.Color(e.topColor),new s.Color(e.bottomColor),new s.Color(e.groundColor),e.monomialPower),this.m_faces[t].needsUpdate=!0;this.m_projectionType===r.ProjectionType.Spherical&&(this.m_skybox.needsUpdate=!0)}fillTextureData(e,i,c,h,d,u){const m=new s.Color,p=new s.Vector3,f=new s.Vector3,g=new s.Vector3,v=new s.Vector3(0,0,1);for(let s=0;s<this.m_height;++s)for(let _=0;_<this.m_width;++_){if(this.m_projectionType===r.ProjectionType.Spherical){const e=f.copy(a[i]).multiplyScalar((_+.5)/this.m_width*2-1),r=g.copy(l[i]).multiplyScalar((s+.5)/this.m_height*2-1);p.copy(o[i]).add(e).add(r).normalize();const y=Math.max(v.dot(p),0);m.copy(d).lerp(h,Math.min(100*y,1)).lerp(c,y**n.getOptionValue(u,t.DEFAULT_MONOMIAL_POWER)).multiplyScalar(255)}else{const e=s/this.m_height;0===s?m.copy(d).multiplyScalar(255):m.copy(h).lerp(c,e**n.getOptionValue(u,t.DEFAULT_MONOMIAL_POWER)).multiplyScalar(255)}e[s*this.m_width*3+3*_]=m.r,e[s*this.m_width*3+3*_+1]=m.g,e[s*this.m_width*3+3*_+2]=m.b}}setHorizonPosition(e){this.m_farClipPlaneCorners[0].set(-1,-1,1).unproject(e),this.m_farClipPlaneCorners[1].set(1,-1,1).unproject(e),this.m_farClipPlaneCorners[2].set(-1,1,1).unproject(e),this.m_farClipPlaneCorners[3].set(1,1,1).unproject(e),this.m_bottomMidFarPoint.copy(this.m_farClipPlaneCorners[0]).add(this.m_farClipPlaneCorners[1]).multiplyScalar(.5),this.m_topMidFarPoint.copy(this.m_farClipPlaneCorners[2]).add(this.m_farClipPlaneCorners[3]).multiplyScalar(.5),this.m_farClipPlaneDividedVertically.set(this.m_bottomMidFarPoint,this.m_topMidFarPoint),this.m_groundPlane.intersectLine(this.m_farClipPlaneDividedVertically,this.m_horizonPosition)||this.m_horizonPosition.set(0,0,0)}updateTexturePosition(){const e=this.m_bottomMidFarPoint.distanceTo(this.m_horizonPosition)/this.m_farClipPlaneDividedVertically.distance(),t=0===this.m_horizonPosition.length()?1:e-2/this.m_height;this.m_faces[0].offset.set(0,this.m_bottomMidFarPoint.z<=0?-t:e)}}},8008:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphereHorizon=t.CanvasSide=void 0;const r=i(3139),n=i(2183),s=i(4428),o=i(8730),a=2*Math.PI;var l;!function(e){e[e.Bottom=0]="Bottom",e[e.Right=1]="Right",e[e.Top=2]="Top",e[e.Left=3]="Left"}(l=t.CanvasSide||(t.CanvasSide={})),t.SphereHorizon=class{constructor(e){this.m_camera=e,this.m_intersections=[],this.m_isFullyVisible=!0;const t=r.EarthConstants.EQUATORIAL_RADIUS*r.EarthConstants.EQUATORIAL_RADIUS,i=(new s.Vector3).setFromMatrixColumn(e.matrixWorld,0).normalize(),n=e.position.clone().normalize(),o=(new s.Vector3).crossVectors(n,i),a=e.position.length();this.m_normalToTangentAngle=Math.asin(r.EarthConstants.EQUATORIAL_RADIUS/a);const l=Math.sqrt(a*a-t);this.m_distanceToHorizonCenter=l*Math.cos(this.m_normalToTangentAngle);const c=a-this.m_distanceToHorizonCenter;this.m_radius=Math.sqrt(t-c*c);const h=(new s.Vector3).copy(n).setLength(c);this.m_matrix=(new s.Matrix4).makeBasis(i,o,n).setPosition(h),this.computeIntersections()}getPoint(e,t=0,i=1,r=new s.Vector3){const n=t*a,o=n+e*((i>=t?i*a:(i+1)*a)-n);return r.set(this.m_radius*Math.cos(o),this.m_radius*Math.sin(o),0),r.applyMatrix4(this.m_matrix),r}getDivisionPoints(e,t=0,i=1,r=10){const n=Math.max(Math.ceil(((i<t?1+i:i)-t)*r),1);for(let r=0;r<n;r++)e(this.getPoint(r/n,t,i))}get isFullyVisible(){return this.m_isFullyVisible}getSideIntersections(e){return this.m_intersections[e]}isTangentVisible(e){if(e===l.Top||e===l.Bottom){const t=e===l.Top?this.m_normalToTangentAngle-this.cameraPitch:this.m_normalToTangentAngle+this.cameraPitch;return this.hFovVertical>=Math.abs(t)}{const e=this.m_normalToTangentAngle;return this.hFovHorizontal>=Math.abs(e)&&this.cameraPitch<=this.hFovVertical}}getTangentOnSide(e){switch(e){case l.Bottom:return.75;case l.Right:return 0;case l.Top:return.25;case l.Left:return.5}}computeIntersections(){const e=this.m_radius*this.m_radius,t=this.m_distanceToHorizonCenter*Math.tan(this.cameraPitch-this.hFovVertical);let i,r;for(let s=l.Bottom;s<4;s++){const o=[];if(this.isTangentVisible(s))o.push(this.getTangentOnSide(s));else switch(this.m_isFullyVisible=!1,s){case l.Bottom:{const i=Math.sqrt(e-t*t),r=Math.atan2(t,i)/a;o.push(.5-r,r>0?r:1+r);break}case l.Right:{const e=this.m_distanceToHorizonCenter/Math.cos(this.cameraPitch),s=this.m_distanceToHorizonCenter*Math.tan(this.cameraPitch),l=e*Math.tan(this.hFovHorizontal),c=l*(this.m_distanceToHorizonCenter*Math.cos(this.hFovVertical)/Math.cos(this.cameraPitch-this.hFovVertical))/e,h=t,d=n.Math2D.intersectLineAndCircle(c,h,l,s,this.m_radius);if(!d)break;-d.y1>=t&&void 0!==d.x2&&(r=Math.atan2(d.y2,d.x2)/a,o.push(1+r)),i=Math.atan2(d.y1,d.x1)/a,o.push(i);break}case l.Top:{const t=this.m_distanceToHorizonCenter*Math.tan(this.cameraPitch+this.hFovVertical),i=Math.sqrt(e-t*t),r=Math.atan2(t,i)/a;o.push(r,.5-r);break}case l.Left:void 0!==i&&o.push(.5-i),void 0!==r&&o.push(.5-r)}this.m_intersections.push(o)}}get cameraPitch(){return void 0===this.m_cameraPitch&&(this.m_cameraPitch=o.MapViewUtils.extractAttitude({projection:r.sphereProjection},this.m_camera).pitch),this.m_cameraPitch}get hFovVertical(){return void 0===this.m_hFovVertical&&(this.m_hFovVertical=r.MathUtils.degToRad(this.m_camera.fov/2)),this.m_hFovVertical}get hFovHorizontal(){return void 0===this.m_hFovHorizontal&&(this.m_hFovHorizontal=o.MapViewUtils.calculateHorizontalFovByVerticalFov(2*this.hFovVertical,this.m_camera.aspect)/2),this.m_hFovHorizontal}}},5005:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceStatistics=t.FrameStatsArray=t.FrameStats=t.Statistics=t.MultiStageTimer=t.computeArrayAverage=t.computeArrayStats=t.SampledTimer=t.SimpleTimer=t.RingBuffer=void 0;const r=i(2183),n=r.LoggerManager.instance.create("Statistics");class s{constructor(e){this.capacity=e,this.buffer=new Array(e),this.capacity=e,this.head=this.tail=this.size=0}clear(){this.head=this.tail=this.size=0}enqOne(e){let t=this.head+1;t>=this.capacity&&(t=0),this.size<this.capacity&&this.size++,this.buffer[this.head]=e,this.head=t,this.size===this.capacity&&(this.tail=this.head)}enq(...e){for(const t of e)this.enqOne(t)}deq(){if(0===this.size)throw new Error("Ringbuffer underrun");const e=this.buffer[this.tail];let t=this.tail+1;return t>=this.capacity&&(t=0),this.size>0&&this.size--,this.tail=t,e}get top(){if(0===this.size)throw new Error("Ringbuffer underrun");return this.buffer[this.tail]}get bottom(){if(0===this.size)throw new Error("Ringbuffer underrun");let e=this.head-1;return e<0&&(e=this.capacity-1),this.buffer[e]}iterator(){return new s.Iterator(this)}asArray(){const e=new Array;for(let t=0;t<this.size;t++)e.push(this.buffer[(this.tail+t)%this.capacity]);return e}}t.RingBuffer=s,function(e){e.Iterator=class{constructor(e,t=0){this.m_buffer=e,this.m_index=t}get value(){return this.m_buffer.buffer[(this.m_buffer.tail+this.m_index)%this.m_buffer.capacity]}next(){return this.m_index++,this.m_index<this.m_buffer.size}}}(s=t.RingBuffer||(t.RingBuffer={}));class o{constructor(e,t){this.statistics=e,this.name=t,this.running=!1}get value(){return this.m_currentValue}setValue(e){this.m_currentValue=e}reset(){this.m_currentValue=void 0}start(){if(!this.statistics.enabled)return-1;if(this.running)throw new Error("Timer '"+this.name+"' is already running");return this.running=!0,this.m_currentValue=r.PerformanceTimer.now()}stop(){var e;if(!this.statistics.enabled)return-1;if(this.running){const t=r.PerformanceTimer.now()-(null!==(e=this.m_currentValue)&&void 0!==e?e:0);return this.m_currentValue=t,this.setValue(t),this.running=!1,t}throw new Error("Timer '"+this.name+"' has not been started")}now(){var e;if(!this.statistics.enabled)return-1;if(this.running)return r.PerformanceTimer.now()-(null!==(e=this.m_currentValue)&&void 0!==e?e:0);throw new Error("Timer '"+this.name+"' has not been started")}}t.SimpleTimer=o;class a extends o{constructor(e,t){super(e,t),this.statistics=e,this.name=t,this.numResets=0,this.maxNumSamples=1e3,this.samples=new s(this.maxNumSamples)}reset(){super.reset(),this.getStats(),this.samples.clear(),this.numResets++}setValue(e){super.setValue(e),void 0!==e&&this.samples.enqOne(e)}getStats(){return l(this.samples.asArray())}}function l(e){if(0===e.length)return;e.sort(((e,t)=>e-t));const t=e[0],i=e[e.length-1];let r,n,s,o,a,l,c;if(1===e.length)n=s=o=a=l=c=r=e[0];else if(2===e.length)r=.5*e[0]+.5*e[1],n=s=o=a=l=c=e[1];else{const t=Math.floor(e.length/2);r=e.length%2==0?.5*e[t-1]+.5*e[t]:e[t],n=e[Math.round(.75*e.length)-1],s=e[Math.round(.9*e.length)-1],o=e[Math.round(.95*e.length)-1],a=e[Math.round(.97*e.length)-1],l=e[Math.round(.99*e.length)-1],c=e[Math.round(.999*e.length)-1]}let h=0;for(let t=0,i=e.length;t<i;t++)h+=e[t];return{min:t,max:i,avg:h/e.length,median:r,median75:n,median90:s,median95:o,median97:a,median99:l,median999:c,numSamples:e.length}}t.SampledTimer=a,t.computeArrayStats=l,t.computeArrayAverage=function(e){if(0===e.length)return;let t=0;for(let i=0,r=e.length;i<r;i++)t+=e[i];return t/e.length},t.MultiStageTimer=class{constructor(e,t,i){if(this.statistics=e,this.name=t,this.stages=i,i.length<1)throw new Error("MultiStageTimer needs stages");i.forEach((t=>{if(!e.hasTimer(t))throw new Error("Unknown timer: "+t)}))}get value(){return this.statistics.getTimer(this.stages[this.stages.length-1]).value}reset(){this.statistics.enabled&&this.stages.forEach((e=>{this.statistics.getTimer(e).reset()}))}start(){var e;return this.stage=this.stages[0],null!==(e=this.statistics.getTimer(this.stages[0]).value)&&void 0!==e?e:-1}stop(){return this.stage=void 0,void 0!==this.value?this.value:-1}get stage(){return this.currentStage}set stage(e){this.currentStage!==e&&(this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).stop(),this.currentStage=e,this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).start())}},t.Statistics=class{constructor(e,t=!1){this.name=e,this.enabled=t,this.timers=new Map,this.nullTimer=new o(this,"<null>")}createTimer(e,t=!0){const i=t?new a(this,e):new o(this,e);return this.addTimer(i)}addTimer(e){if(void 0!==this.timers.get(e.name))throw new Error("Duplicate timer name: '"+e.name+"'");return this.timers.set(e.name,e),e}getTimer(e){if(!this.enabled)return this.nullTimer;const t=this.timers.get(e);return void 0===t?this.nullTimer:t}hasTimer(e){return void 0!==this.timers.get(e)}reset(){this.timers.forEach((e=>{e.reset()}))}log(e,t){void 0===e&&void 0===this.name||n.log(void 0!==e?e:this.name);let i=0;this.timers.forEach((e=>{i=Math.max(i,e.name.length)}));const r=e=>void 0!==e?e.toFixed(5):"?";this.timers.forEach((e=>{let t=e.name+": "+" ".repeat(i-e.name.length);if(t+=r(e.value),e instanceof a){const i=e.getStats();void 0!==i&&(t+=`  [ min=${r(i.min)}, max=${r(i.max)}, avg=${r(i.avg)}, med=${r(i.median)}, med95=${r(i.median95)}, med99=${r(i.median99)}, N=${r(i.numSamples)} ]`)}n.log(t)})),void 0!==t&&n.log(t)}};class c{constructor(){this.entries=new Map,this.messages=void 0}getValue(e){return this.entries.get(e)}setValue(e,t){this.entries.set(e,t)}addValue(e,t){const i=this.entries.get(e);this.entries.set(e,t+(void 0===i?0:i))}addMessage(e){void 0===this.messages&&(this.messages=[]),this.messages.push(e)}reset(){this.entries.forEach(((e,t)=>{this.entries.set(t,0)})),this.messages=void 0}}t.FrameStats=c;class h{constructor(e=0){this.capacity=e,this.frameEntries=new Map,this.messages=new s(e)}get length(){return this.messages.size}reset(){this.frameEntries.forEach(((e,t)=>{e.clear()})),this.messages.clear()}addFrame(e){const t=this.length,i=this.frameEntries;e.entries.forEach(((e,r)=>{let n=i.get(r);if(void 0===n){n=new s(this.capacity);for(let e=0;e<t;e++)n.enqOne(0);this.frameEntries.set(r,n)}n.enqOne(e)})),this.messages.enq(e.messages)}log(){let e=0;this.frameEntries.forEach(((t,i)=>{e=Math.max(e,i.length)}));const t=e=>void 0!==e?e.toFixed(5):"?";this.frameEntries.forEach(((i,r)=>{let s=r+": "+" ".repeat(e-r.length);const o=l(i.asArray());void 0!==o&&(s+=`  [ min=${t(o.min)}, max=${t(o.max)}, avg=${t(o.avg)}, med=${t(o.median)}, med95=${t(o.median95)}, med99=${t(o.median99)}, N=${t(o.numSamples)} ]`),n.log(s)}))}}t.FrameStatsArray=h;class d{constructor(e=!0,t=1e3){this.enabled=e,this.maxNumFrames=t,this.currentFrame=new c,this.appResults=new Map,this.configs=new Map,d.m_instance=this,this.m_frameEvents=new h(t)}get isFull(){return this.m_frameEvents.length>=this.maxNumFrames}static get instance(){return void 0===d.m_instance&&(d.m_instance=new d(!1,0)),d.m_instance}get frameEvents(){return this.m_frameEvents}clear(){this.clearFrames(),this.configs.clear(),this.appResults.clear()}clearFrames(){this.m_frameEvents.reset(),this.currentFrame.reset()}addWebGLInfo(e){void 0!==e.render&&(this.currentFrame.setValue("gl.numCalls",null===e.render.calls?0:e.render.calls),this.currentFrame.setValue("gl.numPoints",null===e.render.points?0:e.render.points),this.currentFrame.setValue("gl.numLines",null===e.render.lines?0:e.render.lines),this.currentFrame.setValue("gl.numTriangles",null===e.render.triangles?0:e.render.triangles)),void 0!==e.memory&&(this.currentFrame.setValue("gl.numGeometries",null===e.memory.geometries?0:e.memory.geometries),this.currentFrame.setValue("gl.numTextures",null===e.memory.textures?0:e.memory.textures)),void 0!==e.programs&&this.currentFrame.setValue("gl.numPrograms",null===e.programs?0:e.programs.length)}addMemoryInfo(){if(void 0!==window&&void 0!==window.performance){const e=window.performance.memory;void 0!==e&&(this.currentFrame.setValue("memory.totalJSHeapSize",e.totalJSHeapSize),this.currentFrame.setValue("memory.usedJSHeapSize",e.usedJSHeapSize),this.currentFrame.setValue("memory.jsHeapSizeLimit",e.jsHeapSizeLimit))}}storeAndClearFrameInfo(){return!(this.m_frameEvents.length>=this.maxNumFrames||(this.m_frameEvents.addFrame(this.currentFrame),this.currentFrame.reset(),0))}log(e,t){n.log(void 0!==e?e:"PerformanceStatistics"),this.appResults.forEach(((e,t)=>{n.log(t,e)})),this.configs.forEach(((e,t)=>{n.log(t,e)})),this.m_frameEvents.log(),void 0!==t&&n.log(t)}getAsPlainObject(e=!1){const t={},i={},r={},n={configs:i,appResults:t,frames:r};if(this.appResults.forEach(((e,i)=>{t[i]=e})),this.configs.forEach(((e,t)=>{i[t]=e})),e)for(const[e,t]of this.m_frameEvents.frameEntries)r[e]=t.bottom;else for(const[e,t]of this.m_frameEvents.frameEntries)r[e]=t.asArray();return n.messages=this.m_frameEvents.messages.asArray(),n}getLastFrameStatistics(){return this.getAsPlainObject(!0)}getAsSimpleFrameStatistics(e=!1){const t=new Map,i=new Map,r=new Map,n={configs:t,appResults:i,frames:r,messages:this.m_frameEvents.messages.asArray()};if(this.appResults.forEach(((e,t)=>{i.set(t,e)})),this.configs.forEach(((e,i)=>{t.set(i,e)})),e)for(const[e,t]of this.m_frameEvents.frameEntries)r.set(e,t.bottom);else for(const[e,t]of this.m_frameEvents.frameEntries)r.set(e,t.asArray());return n}}t.PerformanceStatistics=d,d.m_instance=void 0},6569:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureLoader=void 0;const r=i(4428);t.TextureLoader=class{constructor(){this.m_textureLoader=new r.TextureLoader}async load(e,t,i,n=!0){if(void 0===t)return await this.loadWithThreeLoader(e);const s=await fetch(e,{headers:t,signal:i,mode:n?"cors":"no-cors"}),o=await s.blob(),a=await this.loadWithThreeLoader(URL.createObjectURL(o)),l="image/jpeg/"===o.type||e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);return a.format=l?r.RGBFormat:r.RGBAFormat,a}loadWithThreeLoader(e){return new Promise(((t,i)=>{this.m_textureLoader.setCrossOrigin(""),this.m_textureLoader.load(e,(e=>t(e)),void 0,(()=>i(new Error("failed to load texture"))))}))}}},5393:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLight=t.toTextureFilter=t.toWrappingMode=t.toTextureDataType=t.toPixelFormat=void 0;const r=i(4428);t.toPixelFormat=function(e){switch(e){case"Alpha":return r.AlphaFormat;case"RGB":return r.RGBFormat;case"RGBA":return r.RGBAFormat;case"Luminance":return r.LuminanceFormat;case"LuminanceAlpha":return r.LuminanceAlphaFormat;case"RGBE":return r.RGBEFormat;case"Depth":return r.DepthFormat;case"DepthStencil":return r.DepthStencilFormat;case"Red":return r.RedFormat;default:throw new Error(`invalid pixel format: ${e}`)}},t.toTextureDataType=function(e){switch(e){case"UnsignedByte":return r.UnsignedByteType;case"Byte":return r.ByteType;case"Short":return r.ShortType;case"UnsignedShort":return r.UnsignedShortType;case"Int":return r.IntType;case"UnsignedInt":return r.UnsignedIntType;case"Float":return r.FloatType;case"HalfFloat":return r.HalfFloatType;default:throw new Error(`invalid texture data type: ${e}`)}},t.toWrappingMode=function(e){switch(e){case"clamp":return r.ClampToEdgeWrapping;case"repeat":return r.RepeatWrapping;case"mirror":return r.MirroredRepeatWrapping;default:throw new Error(`invalid wrapping mode: ${e}`)}},t.toTextureFilter=function(e){switch(e){case"nearest":return r.NearestFilter;case"nearestMipMapNearest":return r.NearestMipMapNearestFilter;case"nearestMipMapLinear":return r.NearestMipMapLinearFilter;case"linear":return r.LinearFilter;case"linearMipMapNearest":return r.LinearMipMapNearestFilter;case"linearMipMapLinear":return r.LinearMipMapLinearFilter;default:throw new Error(`invalid texture filter: ${e}`)}},t.createLight=function(e){switch(e.type){case"ambient":{const t=new r.AmbientLight(e.color,e.intensity);return t.name=e.name,t}case"directional":{const t=new r.DirectionalLight(e.color,e.intensity);return t.name=e.name,void 0!==e.castShadow&&(t.castShadow=e.castShadow),t.castShadow&&(t.shadow.bias=1e-5,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024),t.position.set(e.direction.x,e.direction.y,e.direction.z),t.position.normalize(),t}}}},3119:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeLoader=t.DEFAULT_MAX_THEME_INTHERITANCE_DEPTH=void 0,i(4456);const r=i(3187),n=i(172),s=i(2183),o=i(6811);t.DEFAULT_MAX_THEME_INTHERITANCE_DEPTH=4;class a{static async load(e,t){var i;if(t=null!=t?t:{},"string"==typeof e){const i=t.uriResolver,r=void 0!==i?i.resolveUri(e):e,n=await fetch(r,{signal:t.signal});if(!n.ok)throw new Error(`ThemeLoader#load: cannot load theme: ${n.statusText}`);(e=await n.json()).url=s.resolveReferenceUri(s.getAppBaseUrl(),r),e=this.resolveUrls(e,t)}else void 0===e.url?(e.url=s.getAppBaseUrl(),e=this.resolveUrls(e,t)):e=this.convertFlatTheme(e);if(null==e)throw new Error("ThemeLoader#load: loaded resource is not valid JSON");a.checkTechniqueSupport(e);const r=s.getOptionValue(t.resolveDefinitions,!1);if(e=await a.resolveBaseThemes(e,t),r){const r=new s.ContextLogger(null!==(i=t.logger)&&void 0!==i?i:console,`when processing Theme ${e.url}:`);a.resolveThemeReferences(e,r)}return e}static isThemeLoaded(e){return void 0===e.extends&&!Array.isArray(e.styles)}static async loadAsync(e){return await a.load(e)}static resolveUrls(e,t){if(void 0===(e=a.convertFlatTheme(e)).url)return e;const i=s.composeUriResolvers(null==t?void 0:t.uriResolver,new s.RelativeUriResolver(e.url)),r=void 0===t||!(!1===t.resolveIncludeUris);return e.extends&&r&&(e.extends=(Array.isArray(e.extends)?e.extends:[e.extends]).map((r=>"string"==typeof r?i.resolveUri(r):void 0!==r.url?r:(r.url=e.url,this.resolveUrls(r,t))))),a.convertFlatTheme(e)?((void 0===t||!(!1===t.resolveResourceUris))&&a.resolveResources(e,i),e):e}static checkTechniqueSupport(e){if(void 0!==e.styles)for(const t in e.styles)if(e.styles.hasOwnProperty(t))for(const i of e.styles[t])i.technique}static resolveThemeReferences(e,t){if(void 0!==e.styles)for(const i in e.styles)e.styles.hasOwnProperty(i)&&(t.pushAttr("styles"),t.pushAttr(i),e.styles[i]=a.resolveStyleSet(e.styles[i],e.definitions,t),t.pop(),t.pop());return e}static resolveStyleSet(e,t,i){const r=[];for(let n=0;n<e.length;++n){const s=e[n];i.pushIndex(n);const o=a.resolveStyle(s,t,i);void 0!==o?r.push(o):i.warn("invalid style, ignored"),i.pop()}return r}static resolveStyle(e,t,i){if(Array.isArray(e.when)){i.pushAttr("when");const r=this.resolveExpressionReferences(e.when,t,i);if(i.pop(),void 0===r)return;e.when=r}if(void 0!==e.attr){const r=e.attr;i.pushAttr("attr");for(const e in r){if(!r.hasOwnProperty(e))continue;const n=r[e];if(!Array.isArray(n))continue;i.pushAttr(e);const s=this.resolveExpressionReferences(n,t,i);i.pop(),void 0!==s?r[e]=s:delete r[e]}i.pop()}return e}static resolveExpressionReferences(e,t,i){let s=!1;const o=function e(o){if(n.isJsonExprReference(o)){const e=o[1],n=t&&t[e];return void 0===n?(i.warn(`invalid reference '${e}' - not found`),void(s=!0)):r.isJsonExpr(n)?n:n.value}if(Array.isArray(o)){const t=[...o];for(let i=1;i<t.length;++i)t[i]=e(t[i]);return t}return o}(e);if(!s)return o}static async resolveBaseThemes(e,i){if(i=null!=i?i:{},void 0===e.extends)return e;const r=s.getOptionValue(i.maxInheritanceDepth,t.DEFAULT_MAX_THEME_INTHERITANCE_DEPTH);if(r<=0)throw new Error("maxInheritanceDepth reached when attempting to load base theme");const n=Array.isArray(e.extends)?e.extends:[e.extends];delete e.extends;let o={};for(const e of n){const t=await a.load(e,Object.assign(Object.assign({},i),{resolveDefinitions:!1,maxInheritanceDepth:r-1}));o=a.mergeThemes(t,o)}return a.mergeThemes(e,o)}static mergeThemes(e,t){const i=Object.assign(Object.assign({},t.definitions),e.definitions);let r;if(t.styles&&e.styles){const i=Object.keys(t.styles),n=Object.keys(e.styles);r={},i.forEach((i=>{const s=n.indexOf(i);if(-1!==s){const o=t.styles[i],a=[],l=new Map;o.forEach((e=>{"string"==typeof e.id&&l.set(e.id,a.length),a.push(e)})),e.styles[i].forEach((e=>{if("string"==typeof e.extends&&l.has(e.extends)){const t=l.get(e.extends),i=a[t];return a[t]=Object.assign(Object.assign({},i),e),void(a[t].extends=void 0)}if("string"==typeof e.id&&l.has(e.id)){const t=l.get(e.id);a[t]=e}else a.push(e)})),r[i]=a,n.splice(s,1)}else r[i]=t.styles[i]})),n.forEach((t=>{r[t]=e.styles[t]}))}else t.styles?r=Object.assign({},t.styles):e.styles&&(r=Object.assign({},e.styles));return Object.assign(Object.assign(Object.assign({},t),e),{definitions:i,styles:r})}static convertFlatTheme(e){if(Array.isArray(e.styles)){const t={};e.styles.forEach((e=>{if(r.isJsonExpr(e))throw new Error("invalid usage of theme reference");const i=e.styleSet;if(void 0===i)throw new Error("missing reference to style set");t[i]||(t[i]=[]),t[i].push(e)})),e.styles=t}return e}static resolveResources(e,t){if(e.sky&&"cubemap"===e.sky.type)for(let i=0;i<o.SKY_CUBEMAP_FACE_COUNT;++i){const r=e.sky[o.SkyCubemapFaceId[i]];void 0!==r&&(e.sky[o.SkyCubemapFaceId[i]]=t.resolveUri(r))}if(e.images)for(const i of Object.keys(e.images)){const r=e.images[i];r.url=t.resolveUri(r.url),void 0!==r.atlas&&(r.atlas=t.resolveUri(r.atlas))}if(e.fontCatalogs)for(const i of e.fontCatalogs)i.url=t.resolveUri(i.url);if(e.poiTables)for(const i of e.poiTables)i.url=t.resolveUri(i.url);if(void 0!==e.styles)for(const i in e.styles){if(!e.styles.hasOwnProperty(i))continue;const r=e.styles[i];for(const e of r)e.attr&&["map","normalMap","displacementMap","roughnessMap"].forEach((i=>{const r=e.attr[i];r&&"string"==typeof r&&(e.attr[i]=t.resolveUri(r))}))}}}t.ThemeLoader=a},2315:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tile=t.getFeatureDataSize=void 0;const r=i(3139),n=i(2183),s=i(4428),o=i(9777),a=i(869),l=i(1679),c=i(5005),h=i(3171),d=i(3178),u=i(5267),m=i(3661),p=i(8730),f=n.LoggerManager.instance.create("Tile");t.getFeatureDataSize=function(e){let t=100;return void 0!==e.starts&&(t+=8*e.starts.length),void 0!==e.objInfos&&(t+=16*e.objInfos.length),t},t.Tile=class{constructor(e,t,i=0,n){this.dataSource=e,this.tileKey=t,this.objects=[],this.dependencies=[],this.frameNumLastRequested=-1,this.frameNumVisible=-1,this.frameNumLastVisible=-1,this.numFramesVisible=0,this.visibilityCounter=-1,this.levelOffset=0,this.skipRendering=!1,this.delayRendering=!1,this.m_boundingBox=new r.OrientedBox3,this.m_disposed=!1,this.m_forceHasGeometry=void 0,this.m_textElementGroups=new u.TextElementGroupPriorityList,this.m_pathBlockingElements=[],this.m_worldCenter=new s.Vector3,this.m_visibleArea=0,this.m_elevationRange={minElevation:0,maxElevation:0},this.m_ownedTextures=new WeakSet,this.geoBox=this.dataSource.getTilingScheme().getGeoBox(this.tileKey),this.updateBoundingBox(),this.m_worldCenter.copy(this.boundingBox.position),this.m_localTangentSpace=null!=n&&n,this.m_textStyleCache=new m.TileTextStyleCache(this),this.m_offset=i,this.m_uniqueKey=p.TileOffsetUtils.getKeyForTileKeyAndOffset(this.tileKey,this.offset),e.useGeometryLoader&&(this.m_tileGeometryLoader=new a.TileGeometryLoader(this,this.mapView.taskQueue),this.attachGeometryLoadedCallback())}get isVisible(){try{return this.frameNumLastRequested>=this.dataSource.mapView.frameNumber-1}catch(e){return f.debug(e),!1}}set isVisible(e){this.frameNumLastRequested=e?this.dataSource.mapView.frameNumber:-1,e||!this.m_tileGeometryLoader||this.m_tileGeometryLoader.isSettled||this.m_tileGeometryLoader.cancel()}get projection(){return this.dataSource.projection}get mapView(){return this.dataSource.mapView}get localTangentSpace(){return this.m_localTangentSpace}get memoryUsage(){return void 0===this.m_resourceInfo&&this.computeResourceInfo(),this.m_resourceInfo.heapSize}get center(){return this.m_worldCenter}get uniqueKey(){return this.m_uniqueKey}get offset(){return this.m_offset}set offset(e){this.m_offset!==e&&(this.m_uniqueKey=p.TileOffsetUtils.getKeyForTileKeyAndOffset(this.tileKey,e)),this.m_offset=e}getResourceInfo(){return void 0===this.m_resourceInfo&&this.computeResourceInfo(),this.m_resourceInfo}invalidateResourceInfo(){this.m_resourceInfo=void 0}addOwnedTexture(e){this.m_ownedTextures.add(e)}get userTextElements(){let e=this.m_textElementGroups.groups.get(h.TextElement.HIGHEST_PRIORITY);return void 0===e&&(e=new d.TextElementGroup(h.TextElement.HIGHEST_PRIORITY),this.m_textElementGroups.groups.set(e.priority,e)),e}addUserTextElement(e){e.priority=h.TextElement.HIGHEST_PRIORITY,this.addTextElement(e)}removeUserTextElement(e){return e.priority=h.TextElement.HIGHEST_PRIORITY,this.removeTextElement(e)}addTextElement(e){this.textElementGroups.add(e),!1===this.m_textElementsChanged&&(this.m_textElementGroups=this.textElementGroups.clone()),this.textElementsChanged=!0}addBlockingElement(e){this.m_pathBlockingElements.push(e)}removeTextElement(e){const t=this.textElementGroups;return!!t.remove(e)&&(!1===this.m_textElementsChanged&&(this.m_textElementGroups=t.clone()),this.textElementsChanged=!0,!0)}get textElementGroups(){return this.m_textElementGroups}get textElementsChanged(){var e;return null!==(e=this.m_textElementsChanged)&&void 0!==e&&e}set textElementsChanged(e){this.m_textElementsChanged=e}hasTextElements(){return this.m_textElementGroups.count()>0}get blockingElements(){return this.m_pathBlockingElements}willRender(e){return!this.skipRendering&&!this.delayRendering}didRender(){}get visibleArea(){return this.m_visibleArea}set visibleArea(e){this.m_visibleArea=e,void 0!==this.tileLoader&&(this.tileLoader.priority=e)}get elevationRange(){return this.m_elevationRange}set elevationRange(e){var t;e.minElevation===this.m_elevationRange.minElevation&&e.maxElevation===this.m_elevationRange.maxElevation&&e.calculationStatus===this.m_elevationRange.calculationStatus||(this.m_elevationRange.minElevation=e.minElevation,this.m_elevationRange.maxElevation=e.maxElevation,this.m_elevationRange.calculationStatus=e.calculationStatus,this.elevateGeoBox(),void 0===this.m_maxGeometryHeight&&void 0===this.m_minGeometryHeight||(n.assert(void 0===(null===(t=this.decodedTile)||void 0===t?void 0:t.boundingBox)),this.updateBoundingBox()))}get decodedTile(){return this.m_decodedTile}set decodedTile(e){var t,i;if(this.m_decodedTile=e,this.invalidateResourceInfo(),void 0===e)return;0===e.geometries.length&&this.forceHasGeometry(!0),this.m_maxGeometryHeight=e.boundingBox?void 0:null!==(t=e.maxGeometryHeight)&&void 0!==t?t:0,this.m_minGeometryHeight=e.boundingBox?void 0:null!==(i=e.minGeometryHeight)&&void 0!==i?i:0,this.elevateGeoBox(),this.updateBoundingBox(e.boundingBox);const r=c.PerformanceStatistics.instance;r.enabled&&void 0!==e.decodeTime&&(r.currentFrame.addValue("decode.decodingTime",e.decodeTime),r.currentFrame.addValue("decode.decodedTiles",1)),void 0!==e.copyrightHolderIds&&(this.copyrightInfo=e.copyrightHolderIds.map((e=>({id:e})))),this.dataSource.requestUpdate()}shouldDisposeObjectGeometry(e){return!0}shouldDisposeObjectMaterial(e){return!0}shouldDisposeTexture(e){return this.m_ownedTextures.has(e)}get disposed(){return this.m_disposed}get allGeometryLoaded(){var e,t;return null!==(t=null===(e=this.m_tileGeometryLoader)||void 0===e?void 0:e.isFinished)&&void 0!==t?t:this.hasGeometry}get hasGeometry(){return void 0===this.m_forceHasGeometry?0!==this.objects.length:this.m_forceHasGeometry}forceHasGeometry(e){this.m_forceHasGeometry=e}resetVisibilityCounter(){this.visibilityCounter=-1}get tileLoader(){return this.m_tileLoader}set tileLoader(e){this.m_tileLoader=e}async load(){const e=this.tileLoader;if(void 0===e)return await Promise.resolve();if(this.m_tileGeometryLoader){const e=this.m_tileGeometryLoader.isSettled;this.m_tileGeometryLoader.reset(),e&&this.attachGeometryLoadedCallback()}return await e.loadAndDecode().then((t=>{var i;n.assert(t===l.TileLoaderState.Ready);const s=e.decodedTile;this.decodedTile=s,null===(i=null==s?void 0:s.dependencies)||void 0===i||i.forEach((e=>{this.dependencies.push(r.TileKey.fromMortonCode(e))}))})).catch((e=>{e===l.TileLoaderState.Failed?this.dispose():e!==l.TileLoaderState.Canceled&&f.error("Unknown error"+e)}))}get textStyleCache(){return this.m_textStyleCache}clear(){const e=e=>{Object.getOwnPropertyNames(e).forEach((t=>{const i=e[t];if(void 0!==i&&i instanceof s.Texture){const e=i;this.shouldDisposeTexture(e)&&e.dispose()}})),e.dispose()},t=t=>{if(this.shouldDisposeObjectGeometry(t)&&(void 0!==t.geometry&&t.geometry.dispose(),void 0!==t.geometries))for(const e of t.geometries)e.dispose();void 0!==t.material&&this.shouldDisposeObjectMaterial(t)&&(t.material instanceof Array?t.material.forEach((t=>{void 0!==t&&e(t)})):e(t.material))};this.objects.forEach((e=>{e.traverse((e=>{t(e)})),t(e)})),this.objects.length=0,this.preparedTextPaths&&(this.preparedTextPaths=[]),this.m_textStyleCache.clear(),this.clearTextElements(),this.invalidateResourceInfo()}clearTextElements(){this.hasTextElements()&&(this.textElementsChanged=!0,this.m_pathBlockingElements.splice(0),this.textElementGroups.forEach((e=>{e.dispose()})),this.textElementGroups.clear())}addDisposeCallback(e){this.m_disposeCallback=n.chainCallbacks(this.m_disposeCallback,e)}dispose(){var e;this.m_disposed||(this.m_tileLoader&&(this.m_tileLoader.cancel(),this.m_tileLoader=void 0),this.clear(),this.frameNumLastRequested=0,this.m_disposed=!0,null===(e=this.m_tileGeometryLoader)||void 0===e||e.dispose(),this.m_disposeCallback&&this.m_disposeCallback(this))}computeWorldOffsetX(){return this.projection.worldExtent(0,0).max.x*this.offset}update(e){for(const t of this.objects)t instanceof o.LodMesh&&t.setLevelOfDetail(e-this.tileKey.level)}get boundingBox(){return this.m_boundingBox}updateGeometry(e,t,i){if(!this.m_tileGeometryLoader)return!1;if(this.m_tileGeometryLoader.isSettled)return!0;if(this.dataSource.isDetached())return this.m_tileGeometryLoader.cancel(),!0;if(this.tileLoader){if(!this.tileLoader.isFinished)return!0;if(!this.decodedTile)return this.m_tileGeometryLoader.finish(),!0}return void 0!==e&&(this.m_tileGeometryLoader.priority=e),this.m_tileGeometryLoader.update(t,i),!0}get loadedGeometryKinds(){var e;return null===(e=this.m_tileGeometryLoader)||void 0===e?void 0:e.availableGeometryKinds}loadingFinished(){}attachGeometryLoadedCallback(){n.assert(void 0!==this.m_tileGeometryLoader),this.m_tileGeometryLoader.waitFinished().then((()=>{this.loadingFinished(),this.removeDecodedTile()})).catch((()=>{this.disposed||this.dataSource.isDetached()||this.mapView.visibleTileSet.disposeTile(this)}))}removeDecodedTile(){this.m_decodedTile=void 0,this.invalidateResourceInfo()}updateBoundingBox(e){e?(this.m_boundingBox.copy(e),this.m_worldCenter.copy(this.boundingBox.position)):this.projection.projectBox(this.geoBox,this.boundingBox)}elevateGeoBox(){var e,t;this.geoBox.southWest.altitude=this.m_elevationRange.minElevation+(null!==(e=this.m_minGeometryHeight)&&void 0!==e?e:0),this.geoBox.northEast.altitude=this.m_elevationRange.maxElevation+(null!==(t=this.m_maxGeometryHeight)&&void 0!==t?t:0)}computeResourceInfo(){let e=0,t=0,i=0;const r={heapSize:0,gpuSize:0},n=new Map;for(const e of this.objects)e.visible&&t++,p.MapViewUtils.estimateObject3dSize(e,r,n);for(const e of this.textElementGroups.groups)i+=e[1].elements.length;e+=312*i,void 0!==this.m_decodedTile&&void 0!==this.m_decodedTile.tileInfo&&(r.heapSize+=this.m_decodedTile.tileInfo.numBytes),this.m_resourceInfo={heapSize:r.heapSize+e,gpuSize:r.gpuSize,num3dObjects:t,numTextElements:i,numUserTextElements:0}}}},6295:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileObjectRenderer=void 0;const r=i(3187),n=i(783),s=i(8121),o=i(3668);t.TileObjectRenderer=class{constructor(e,t){this.m_env=e,this.m_renderer=t,this.m_renderOrderStencilValues=new Map,this.m_stencilValue=1}render(e,t,i,r,n){const s=e.computeWorldOffsetX();if(e.willRender(t)){for(const a of e.objects){const l=o.MapObjectAdapter.get(a);this.processTileObject(e,t,i,a,l)&&(this.updateStencilRef(a),a.position.copy(e.center),void 0!==a.displacement&&a.position.add(a.displacement),a.position.x+=s,a.position.sub(r),e.localTangentSpace&&a.setRotationFromMatrix(e.boundingBox.getRotationMatrix()),a.frustumCulled=!1,n.add(a))}e.didRender()}}prepareRender(){this.m_stencilValue=1,this.m_renderOrderStencilValues.clear()}setupRenderer(){const e=(e,t)=>e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.object.userData.tileKey&&t.object.userData.tileKey&&e.object.userData.tileKey.mortonCode()!==t.object.userData.tileKey.mortonCode()?e.object.userData.tileKey.mortonCode()-t.object.userData.tileKey.mortonCode():e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id;this.m_renderer.setOpaqueSort(((t,i)=>{var r,s,a,l;const c=o.MapObjectAdapter.get(t.object),h=o.MapObjectAdapter.get(i.object),d=null===(r=null==c?void 0:c.dataSource)||void 0===r?void 0:r.dataSourceOrder,u=null===(s=null==h?void 0:h.dataSource)||void 0===s?void 0:s.dataSourceOrder;if(void 0!==d&&void 0!==u&&d!==u)return d-u;if(t.renderOrder===n.BackgroundDataSource.GROUND_RENDER_ORDER||i.renderOrder===n.BackgroundDataSource.GROUND_RENDER_ORDER)return e(t,i);if(void 0!==(null==c?void 0:c.level)&&void 0!==(null==h?void 0:h.level)){const r=void 0!==(null===(a=c.kind)||void 0===a?void 0:a.find((e=>"building"===e)))||void 0!==(null===(l=h.kind)||void 0===l?void 0:l.find((e=>"building"===e)));return c.level===h.level||r?e(t,i):c.level-h.level}return e(t,i)}))}updateStencilRef(e){if(void 0!==e.renderOrder&&e instanceof s.SolidLineMesh){const t=e.material;Array.isArray(t)?t.forEach((t=>t.stencilRef=this.getStencilValue(e.renderOrder))):t.stencilRef=this.getStencilValue(e.renderOrder)}}allocateStencilValue(e){const t=this.m_stencilValue++;return this.m_renderOrderStencilValues.set(e,t),t}getStencilValue(e){var t;return null!==(t=this.m_renderOrderStencilValues.get(e))&&void 0!==t?t:this.allocateStencilValue(e)}processTileObject(e,t,i,n,s){return!(!n.visible||!this.processTileObjectFeatures(e,t,i,n)||s&&(s.ensureUpdated(e.mapView),!s.isVisible()&&s.pickability!==r.Pickability.all))}processTileObjectFeatures(e,t,i,n){var s,o;const a=n.userData.technique,l=r.getPropertyValue(null==a?void 0:a.minZoomLevel,this.m_env),c=r.getPropertyValue(null==a?void 0:a.maxZoomLevel,this.m_env);if("number"==typeof l&&i<l)return!1;if("number"==typeof c&&i>=c)return!1;if(void 0===(null==a?void 0:a.enabled))return!0;const h=n.userData.feature;if(!h||!r.Expr.isExpr(a.enabled))return Boolean(r.getPropertyValue(a.enabled,this.m_env));const{starts:d,objInfos:u}=h;if(!Array.isArray(u)||!Array.isArray(d))return!0;const m=n.geometry;if(!m||!m.isBufferGeometry)return!0;const p=null!==(o=null===(s=m.getIndex())||void 0===s?void 0:s.count)&&void 0!==o?o:m.attributes.position.count;let f;return m.clearGroups(),u.forEach(((t,i)=>{var n,s;const o=r.getFeatureId(t);let l=!0;if(r.Expr.isExpr(a.enabled)){const i=e.dataSource.getFeatureState(o),n=i?new r.MapEnv(i):null,s="object"==typeof t?new r.MapEnv(t,this.m_env):this.m_env,c=new r.MapEnv({$state:n},s);l=Boolean(r.getPropertyValue(a.enabled,c))}if(!l)return;const c=null!==(n=d[i])&&void 0!==n?n:0,h=(null!==(s=d[i+1])&&void 0!==s?s:p)-c;c===f?m.groups[m.groups.length-1].count+=h:m.addGroup(c,h),f=c+h})),m.groups.length>0}}},8730:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileOffsetUtils=t.MapViewUtils=void 0;const r=i(3139),n=i(9881),s=i(284),o=i(2183),a=i(4428),l=i(2315),c=o.LoggerManager.instance.create("MapViewUtils"),h=new a.Vector3(0,0,1),d=new a.Plane(h.clone()),u=new a.Sphere(void 0,n.EarthConstants.EQUATORIAL_RADIUS),m=new a.Raycaster,p={x:new a.Vector3,y:new a.Vector3,z:new a.Vector3},f={x:new a.Vector3,y:new a.Vector3,z:new a.Vector3},g={box3:[new a.Box3],obox3:[new r.OrientedBox3],quaternions:[new a.Quaternion,new a.Quaternion],vector2:[new a.Vector2],vector3:[new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3],matrix4:[new a.Matrix4,new a.Matrix4],transforms:[{xAxis:new a.Vector3,yAxis:new a.Vector3,zAxis:new a.Vector3,position:new a.Vector3}]};!function(e){function t(t,i,n,s,o,l){const h=e.rayCastWorldCoordinates(t,i,n);if(null===h)return;const d=0===i&&0===n?h:e.rayCastWorldCoordinates(t,0,0);if(null===d)return;!function(e,t,i){const r=e.camera,n=e.projection.surfaceNormal(t,g.vector3[0]),s=g.quaternions[0].setFromAxisAngle(n,i);r.quaternion.premultiply(s),r.position.sub(t),r.position.applyQuaternion(s),r.position.add(t)}(t,h,-s);const u=new a.Vector3(1,0,0).applyQuaternion(t.camera.quaternion);!function(t,i,r,n){const s=t.camera,o=s.position.clone(),a=s.quaternion.clone(),l=g.quaternions[0].setFromAxisAngle(n,r);s.quaternion.premultiply(l),s.position.sub(i),s.position.applyQuaternion(l),s.position.add(i),null===e.rayCastWorldCoordinates(t,0,0)&&(c.warn("Target got invalidated during rotation."),s.position.copy(o),s.quaternion.copy(a))}(t,h,function(e,t,i,n,s,o,l){const c=e.camera,h=e.projection,d=E(h,c,s,l);if(d+i<0)return-d;if(i<=0)return i;if(s.equals(o)||t<0)return r.MathUtils.clamp(i+d,0,n)-d;const u=E(h,c,o,l),m=a.MathUtils.degToRad(89);if(u>m)return 0;let p=0;if(h===r.sphereProjection){const e=h.surfaceNormal(o,g.vector3[0]).projectOnPlane(l).normalize(),t=h.surfaceNormal(s,g.vector3[1]);p=e.angleTo(t)}const f=a.MathUtils.degToRad(90),v=f+p-(2*f-(2*f-(f+p-u+(f+d)))-f-n);return r.MathUtils.clamp(i+u,0,Math.min(v,m))-u}(t,n,o,l,d,h,u),u)}function i(e,t,i){const s=g.vector3[0].copy(e.position),o=e.getWorldDirection(g.vector3[1]);m.set(s,o),void 0!==i&&(d.constant-=i,u.radius+=i);const l=new a.Vector3,c=t.type===r.ProjectionType.Planar?m.ray.intersectPlane(d,l):m.ray.intersectSphere(u,l);return void 0!==i&&(d.constant=0,u.radius=n.EarthConstants.EQUATORIAL_RADIUS),c}function h(t,i,n){const s={target:t,distance:i},o=n.worldMaxBounds,l=n.camera,c=n.projection;if(!o)return s;const h=o.getSize(g.vector3[1]),d=n.renderer.getSize(g.vector2[0]),u=C(n.focalLength,s.distance,d.height),m=u*l.aspect,p=Math.max(m/h.x,u/h.y),f=new a.Vector3(m/2,u/2,0),v={target:s.target.clone(),distance:s.distance};if(c.type===r.ProjectionType.Planar){if(p>1)v.distance/=p,l.getWorldDirection(l.position).multiplyScalar(-v.distance).add(o.getCenter(v.target));else{if(g.box3[0].copy(o).expandByVector(f.multiplyScalar(-1)).clampPoint(s.target,v.target).setZ(s.target.z),v.target.equals(s.target))return s;l.position.x+=v.target.x-s.target.x,l.position.y+=v.target.y-s.target.y}return v}if(p>1)o.getCenter(v.target),v.target.setLength(s.target.length()),v.distance/=p;else{const e=g.obox3[0];e.copy(o),e.position.setLength(s.target.length()),e.extents.sub(f);const t=e.getRotationMatrix(g.matrix4[0]),i=g.vector3[1].copy(v.target).sub(e.position).applyMatrix4(g.matrix4[1].copy(t).transpose()).setZ(0),r=g.vector3[2].copy(i).clamp(g.vector3[3].copy(e.extents).multiplyScalar(-1),e.extents);if(r.equals(i))return s;v.target.copy(r).applyMatrix4(t).add(e.position);const n=e.position.lengthSq(),a=v.target.distanceToSquared(e.position),l=Math.sqrt(n)-Math.sqrt(n-a);v.target.addScaledVector(e.zAxis,-l),v.target.setLength(s.target.length())}return e.panCameraAroundGlobe(n,g.vector3[1].copy(v.target),g.vector3[2].copy(s.target)),l.getWorldDirection(l.position).multiplyScalar(-v.distance).add(v.target),v}function v(e,t,i,s,o,l=new a.Vector3){const c=a.MathUtils.degToRad(s),h=Math.cos(c)*t,d=a.MathUtils.degToRad(i);o.projectPoint(e,l);const u=t*Math.sin(c);if(o.type===r.ProjectionType.Planar)l.x=l.x+Math.sin(d)*u,l.y=l.y-Math.cos(d)*u,l.z=l.z+h;else if(o.type===r.ProjectionType.Spherical){f.z.copy(l).normalize(),f.y.set(0,0,1).projectOnPlane(f.z).normalize(),g.quaternions[0].setFromAxisAngle(f.z,d-Math.PI),f.y.applyQuaternion(g.quaternions[0]),f.y.setLength(u);const e=t*Math.cos(c);l.add(f.y).add(f.z.setLength(e));const i=n.EarthConstants.EQUATORIAL_RADIUS+h,r=Math.sin(c)*t,s=Math.sqrt(i*i+r*r);l.setLength(s)}return l}function _(e,t){const i=t.clone().normalize();for(const r of e)if(r.angleTo(t)>Math.PI/2){const e=r.length();r.projectOnPlane(i).setLength(e)}}function y(t,i,r){const n=new a.Matrix4;n.extractRotation(r.matrixWorld);const s=new a.Vector3(0,1,0).applyMatrix4(n),o=new a.Vector3(1,0,0).applyMatrix4(n),l=(new a.Plane).setFromCoplanarPoints(r.position,i,i.clone().add(s)),c=(new a.Plane).setFromCoplanarPoints(r.position,i,i.clone().add(o)),h=g.vector3[0];h.copy(r.position);const d=a.MathUtils.degToRad(r.fov/2),u=e.calculateHorizontalFovByVerticalFov(2*d,r.aspect)/2,m=1/Math.tan(d),p=1/Math.tan(u),f=g.vector3[1];f.copy(h).sub(i).negate();const v=(new a.Vector3).copy(f).normalize(),_=new a.Vector3,y=new a.Vector3,x=new a.Vector3;function b(e,t,i,r){t.projectPoint(e,x),y.copy(h).sub(x).negate();const n=f.angleTo(y);if(n<=i)return;const s=y.length(),o=f.length(),a=s*(Math.sin(n)*r-Math.cos(n))+o;_.copy(v).multiplyScalar(o-a),h.add(_),f.sub(_)}for(const e of t)b(e,l,d,m),b(e,c,u,p);return f.length()}function x(e,t,i,s){const o=g.vector3[0].set(t,i,0);e.camera.updateMatrixWorld();const l=g.vector3[1].copy(e.camera.position);g.matrix4[0].extractRotation(e.camera.matrixWorld),g.matrix4[1].multiplyMatrices(g.matrix4[0],g.matrix4[1].copy(e.camera.projectionMatrix).invert());const c=o.applyMatrix4(g.matrix4[1]);m.set(l,c.normalize()),void 0!==s&&(d.constant-=s,u.radius+=s);const h=new a.Vector3,p=e.projection.type===r.ProjectionType.Planar?m.ray.intersectPlane(d,h):m.ray.intersectSphere(u,h);return void 0!==s&&(d.constant=0,u.radius=n.EarthConstants.EQUATORIAL_RADIUS),p}function b(e,t,i){e.camera.position.x+=t,e.camera.position.y+=i}function T(e,t,i){g.quaternions[0].setFromUnitVectors(t.normalize(),i.normalize()).invert(),g.matrix4[0].makeRotationFromQuaternion(g.quaternions[0]),e.camera.applyMatrix4(g.matrix4[0]),e.camera.updateMatrixWorld()}function w(e,t,i,r,n=new a.Quaternion){const s=g.transforms[0];return e.localTangentSpace(t,s),g.matrix4[0].makeBasis(s.xAxis,s.yAxis,s.zAxis),n.setFromRotationMatrix(g.matrix4[0]),g.quaternions[0].setFromAxisAngle(g.vector3[1].set(0,0,1),a.MathUtils.degToRad(i)),g.quaternions[1].setFromAxisAngle(g.vector3[1].set(1,0,0),a.MathUtils.degToRad(r)),n.multiply(g.quaternions[0]),n.multiply(g.quaternions[1]),n}function S(t,i){if(i.type===r.ProjectionType.Planar){const e=t.getWorldDirection(g.vector3[0]).normalize(),r=i.surfaceNormal(t.position,g.vector3[1]).negate(),n=e.dot(r);return Math.acos(a.MathUtils.clamp(n,-1,1))}{o.assert(i.type===r.ProjectionType.Spherical);const n=e.getGeoTargetFromCamera(t,i);return null!==n?e.extractTiltAngleFromLocation(i,t,n):(c.warn("MapView camera is pointing in the void, using maxTilt: ",e.MAX_TILT_RAD),e.MAX_TILT_RAD)}}function M(e,t){g.vector3[1].setFromMatrixPosition(t.matrixWorld),e.projection.localTangentSpace(g.vector3[1],{xAxis:f.x,yAxis:f.y,zAxis:f.z,position:g.vector3[0]}),g.matrix4[1].makeBasis(f.x,f.y,f.z),g.matrix4[0].copy(g.matrix4[1]).invert().multiply(t.matrixWorld),p.x.setFromMatrixColumn(g.matrix4[0],0),p.y.setFromMatrixColumn(g.matrix4[0],1),p.z.setFromMatrixColumn(g.matrix4[0],2);let i=0,r=0,n=0;const s=p.z.dot(g.vector3[1].set(0,0,1));return s<1-Number.EPSILON?s>-1+Number.EPSILON?(i=Math.atan2(p.z.x,-p.z.y),r=Math.acos(p.z.z),n=Math.atan2(p.x.z,p.y.z)):(i=-Math.atan2(-p.y.x,p.x.x),r=180,n=0):(i=Math.atan2(-p.y.x,p.x.x),r=0,n=0),{yaw:i,pitch:r,roll:n}}function E(e,t,i,r){e.localTangentSpace(i,{xAxis:f.x,yAxis:f.y,zAxis:f.z,position:g.vector3[0]});const n=g.vector3[2].copy(t.position).sub(g.vector3[0]);r&&(n.projectOnPlane(r),f.z.projectOnPlane(r).normalize());const s=n.length();if(s<1e-5)return c.error("Can not calculate tilt for the zero length vector!"),0;n.divideScalar(s);const o=n.dot(f.z);return o>=1-Number.EPSILON?0:Math.acos(a.MathUtils.clamp(o,-1,1))}function P(e,t){const i=n.EarthConstants.EQUATORIAL_CIRCUMFERENCE/Math.pow(2,t);return e.focalLength*i/256}function C(e,t,i){return t*i/e}function A(e,t,i){if(null==e||void 0===e.image||null===e.image)return;if(void 0!==e.uuid&&!0===i.get(e.uuid))return;i.set(e.uuid,!0);const r=e.image,n=4*r.width*r.height;t.heapSize+=n,t.gpuSize+=n}function L(e,t,i){if(void 0===e.uuid||!0!==i.get(e.uuid))if(i.set(e.uuid,!0),e instanceof a.RawShaderMaterial||e instanceof a.ShaderMaterial){const r=e;for(const e in r.uniforms)if(void 0!==r.uniforms[e]){const n=r.uniforms[e];n instanceof a.Texture&&A(n,t,i)}}else if(e instanceof a.MeshBasicMaterial||e instanceof s.MapMeshBasicMaterial){const r=e;A(r.map,t,i),A(r.aoMap,t,i),A(r.specularMap,t,i),A(r.alphaMap,t,i),A(r.envMap,t,i)}else if(e instanceof s.MapMeshStandardMaterial){const r=e;A(r.map,t,i),A(r.lightMap,t,i),A(r.aoMap,t,i),A(r.emissiveMap,t,i),A(r.bumpMap,t,i),A(r.normalMap,t,i),A(r.displacementMap,t,i),A(r.roughnessMap,t,i),A(r.metalnessMap,t,i),A(r.alphaMap,t,i),A(r.envMap,t,i)}else e instanceof a.LineBasicMaterial||e instanceof a.LineDashedMaterial||e instanceof a.PointsMaterial||c.warn("estimateMeshSize: unidentified material: ",e)}function R(e,t,i,r){if(void 0===e.uuid&&(e.uuid=a.MathUtils.generateUUID()),!0===r.get(e.uuid))return;r.set(e.uuid,!0);let n=0,s=4;void 0!==e.array.BYTES_PER_ELEMENT&&(s=e.array.BYTES_PER_ELEMENT),e instanceof a.InterleavedBufferAttribute||e instanceof a.BufferAttribute?n=s*e.count*e.itemSize:c.warn("estimateMeshSize: unidentified attribute: ",t),i.heapSize+=n+56,i.gpuSize+=n}function D(e,t,i){if(void 0!==e.uuid&&!0===i.get(e.uuid))return;if(i.set(e.uuid,!0),void 0===e)return;const r=e.attributes;if(void 0!==r){for(const e in r)void 0!==r[e]&&R(r[e],e,t,i);null!==e.index&&R(e.index,"index",t,i)}else c.warn("estimateGeometrySize: unidentified geometry: ",e)}function O(e){return e.substring(0,2)}e.MAX_TILT_DEG=89,e.MAX_TILT_RAD=e.MAX_TILT_DEG*a.MathUtils.DEG2RAD,e.zoomOnTargetPosition=function(i,n,s,o,a=e.MAX_TILT_RAD){const{elevationProvider:l,camera:c,projection:d}=i,u=l?l.getHeight(d.unprojectPoint(c.position),4):void 0,m=x(i,n,s,u),p=e.getTargetAndDistance(d,c,l).target,f=P(i,o);if(i.geoMaxBounds&&h(p,f,i).distance!==f)return o>=i.zoomLevel;if(c.getWorldDirection(c.position).multiplyScalar(-f).add(p),d.type===r.ProjectionType.Spherical){const e=S(c,d)-a;e>0&&t(i,0,0,0,e,a)}const g=x(i,n,s,u);return!m||!g||(d.type===r.ProjectionType.Planar?(m.sub(g),b(i,m.x,m.y)):d.type===r.ProjectionType.Spherical&&T(i,m,g),!0)},e.orbitAroundScreenPoint=t,e.getGeoTargetFromCamera=function(e,t,r){const n=i(e,t,r);return null!==n?t.unprojectPoint(n):null},e.getWorldTargetFromCamera=i,e.constrainTargetAndDistanceToViewBounds=h,e.getTargetAndDistance=function(t,s,o){const a=M({projection:t},s).pitch,l=o?o.getHeight(t.unprojectPoint(s.position),4):void 0,c=!o||void 0!==l,h=a<e.MAX_TILT_RAD?i(s,t,l):null;if(null!==h)return{target:h,distance:s.position.distanceTo(h),final:c};{const i=t.groundDistance(s.position),o=Math.max(i-(null!=l?l:0),0),h=t.type===r.ProjectionType.Planar?o/Math.cos(Math.min(a,e.MAX_TILT_RAD)):Math.sqrt(Math.pow(o+n.EarthConstants.EQUATORIAL_RADIUS,2)-Math.pow(n.EarthConstants.EQUATORIAL_RADIUS,2)),d=s.getWorldDirection(g.vector3[0]);d.multiplyScalar(h);const u=g.vector3[1];return u.copy(s.position).add(d),{target:u,distance:h,final:c}}},e.getCameraPositionFromTargetCoordinates=v,e.wrapGeoPointsToScreen=function(e,t){let i=0;void 0===t&&(t=r.GeoCoordinates.fromObject(e[0]),i=1);let n=t.latitude,s=t.latitude,o=r.MathUtils.normalizeLongitudeDeg(t.longitude),a=0,l=t.longitude,c=t.longitude;const h=[];h.push(new r.GeoCoordinates(n,o));for(let t=i;t<e.length;t++){const i=r.GeoCoordinates.fromObject(e[t]);i.latitude>n?n=i.latitude:i.latitude<s&&(s=i.latitude);let d=r.MathUtils.normalizeLongitudeDeg(i.longitude);const u=r.MathUtils.angleDistanceDeg(o,d);d=o-u,u<0&&-u>a/2?(l=Math.max(l,o-u),a=l-c,o=(l+c)/2):u>0&&u>a/2&&(c=Math.min(c,d),a=l-c,o=(l+c)/2),h.push(new r.GeoCoordinates(i.latitude,d))}return h},e.wrapWorldPointsToView=_,e.geoBoxToGeoPoints=function(e){const t=e.center;return[new r.GeoCoordinates(e.north,e.west),new r.GeoCoordinates(e.north,e.east),new r.GeoCoordinates(t.latitude,e.west),new r.GeoCoordinates(t.latitude,e.east),new r.GeoCoordinates(e.south,e.west),new r.GeoCoordinates(e.south,e.east),new r.GeoCoordinates(e.north,t.longitude),new r.GeoCoordinates(e.south,t.longitude)]},e.getFitBoundsDistance=y,e.getFitBoundsLookAtParams=function(e,t,i,n){const{tilt:s,heading:o,projection:a}=n,l=n.minDistance,c=n.camera.clone();return w(a,e,-o,s,c.quaternion),v(e,l,-o,s,a,c.position),c.updateMatrixWorld(!0),a.type===r.ProjectionType.Spherical&&_(i,c.position),{target:e,distance:y(i,t,c),heading:o,tilt:s}},e.getCameraCoordinatesFromTargetCoordinates=function(e,t,i,r,n){return n.projection.unprojectPoint(v(e,t,i,r,n.projection,g.vector3[1]))},e.rayCastWorldCoordinates=x,e.panCameraAboveFlatMap=b,e.panCameraAroundGlobe=T,e.rotate=function(t,i,s=0,o=Math.PI/4){if(t.camera.rotateOnWorldAxis(t.projection.type===r.ProjectionType.Spherical?g.vector3[0].copy(t.camera.position).normalize():g.vector3[0].set(0,0,1),a.MathUtils.degToRad(-i)),t.camera.updateMatrixWorld(),0===s)return;const l=e.extractAttitude(t,t.camera).pitch;let c=a.MathUtils.clamp(l+a.MathUtils.degToRad(s),0,o);if(t.projection.type===r.ProjectionType.Spherical){const e=Math.asin(n.EarthConstants.EQUATORIAL_RADIUS*Math.sin(Math.PI-o)/t.camera.position.length());c=Math.min(c,e)}t.camera.rotateX(c-l)},e.getCameraRotationAtTarget=w,e.setRotation=function(e,t,i){w(e.projection,e.geoCenter,t,i,e.camera.quaternion)},e.extractCameraTilt=S,e.extractAttitude=M,e.extractSphericalCoordinatesFromLocation=function(e,t,i){e.projection.localTangentSpace(i,{xAxis:f.x,yAxis:f.y,zAxis:f.z,position:g.vector3[0]});let r=0,n=0;return g.vector3[1].copy(t.position).sub(g.vector3[0]).normalize(),g.vector3[1].dot(f.z)>1-Number.EPSILON?(n=Math.PI-M(e,t).yaw,n=Math.atan2(Math.sin(n),Math.cos(n)),r=0,{tilt:r,azimuth:n}):(r=g.vector3[1].angleTo(f.z),g.vector3[1].copy(t.position).sub(g.vector3[0]).projectOnPlane(f.z).normalize(),n=g.vector3[1].angleTo(f.y),g.vector3[1].cross(f.y).dot(f.z)<0&&(n=-n),{tilt:r,azimuth:n})},e.extractTiltAngleFromLocation=E,e.getCameraFrustumPlanes=function(e){const t=e.near,i=e.far;let r=t*Math.tan(a.MathUtils.degToRad(.5*e.fov))/e.zoom,n=2*r,s=e.aspect*n,o=-.5*s;const l=e.view;if(null!==l&&l.enabled){const e=l.fullWidth,t=l.fullHeight;o+=l.offsetX*s/e,r-=l.offsetY*n/t,s*=l.width/e,n*=l.height/t}return o+=0!==e.filmOffset?t*e.filmOffset/e.getFilmWidth():0,{left:o,right:o+s,top:r,bottom:r-n,near:t,far:i}},e.rayCastGeoCoordinates=function(e,t,i){const r=x(e,t,i);return r?e.projection.unprojectPoint(r):null},e.calculateDistanceToGroundFromZoomLevel=function(e,t){const i=M(e,e.camera).pitch,r=n.EarthConstants.EQUATORIAL_CIRCUMFERENCE/Math.pow(2,t);return e.focalLength*r/256*Math.cos(i)},e.calculateDistanceFromZoomLevel=P,e.calculateZoomLevelFromDistance=function(e,t){const i=256*t/e.focalLength;return function(e){const t=Math.ceil(e);return t-e<1e-6?t:e}(a.MathUtils.clamp(Math.log2(n.EarthConstants.EQUATORIAL_CIRCUMFERENCE/i),e.minZoomLevel,e.maxZoomLevel))},e.calculateDepthFromClipDistance=function(e,t){const i=t,r=i.far-i.near,n=e*i.far;return(1-i.near/n)*(i.far/r)},e.cameraToWorldDistance=function(e,t){return e*t.far},e.calculateVerticalFovByHorizontalFov=function(e,t){return 2*Math.atan(Math.tan(e/2)/t)},e.calculateHorizontalFovByVerticalFov=function(e,t){return 2*Math.atan(Math.tan(e/2)*t)},e.calculateFocalLengthByVerticalFov=function(e,t){return t/2/Math.tan(e/2)},e.calculateFovByFocalLength=function(e,t){return a.MathUtils.radToDeg(2*Math.atan(t/2/e))},e.calculateScreenSizeByFocalLength=function(e,t,i){return e*i/t},e.calculateWorldSizeByFocalLength=C,e.estimateObject3dSize=function e(t,i,r){const n=void 0!==i?i:{heapSize:0,gpuSize:0};if(void 0===r&&(r=new Map),function(e,t,i){if(e.isObject3D&&!(e instanceof a.Scene)&&(void 0===e.uuid||!0!==i.get(e.uuid)))if(i.set(e.uuid,!0),e.isMesh||e.isLine||e.isPoints){let r=1e3;const n=0,s=e;if(void 0!==s.material)if(Array.isArray(s.material)){const e=s.material;for(const r of e)L(r,t,i)}else L(s.material,t,i);if(void 0!==s.geometries)for(const e of s.geometries)D(e,t,i);else void 0!==s.geometry&&D(s.geometry,t,i);const o=void 0!==e.userData?e.userData.feature:void 0;void 0!==o&&(r+=l.getFeatureDataSize(o)),t.heapSize+=r,t.gpuSize+=n}else c.warn("estimateMeshSize: unidentified object",e)}(t,n,r),t.children.length>0)for(const i of t.children)e(i,n,r);return n},e.mapViewIsLoading=function(e){let t=0;for(const i of e.visibleTileSet.dataSourceTileList){t+=i.numTilesLoading;for(const e of i.visibleTiles)e.allGeometryLoaded||t++}let i=t>0;return void 0!==e.textElementsRenderer&&(i=i||e.textElementsRenderer.loading),i=i||!e.poiTableManager.finishedLoading||!e.visibleTileSet.allVisibleTilesLoaded,i},e.closeToFrustum=function(e,t,i=1e-13){const r=(new a.Vector3).copy(e).project(t);return Math.abs(r.x)-i<1&&Math.abs(r.y)-i<1&&Math.abs(r.z)-i<1},e.getBrowserLanguages=function(){if(void 0!==navigator.languages&&navigator.languages.length>0){const e=[];for(const t of navigator.languages)e.push(O(t));return e}if(void 0!==navigator.language)return[O(navigator.language)]}}(t.MapViewUtils||(t.MapViewUtils={}));const v=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,0x4000000000000,0x8000000000000,4503599627370496];!function(e){function t(e,t,i=4){const r=function(e,t=4){let i=0;const r=v[t];for(e+=r/2;e<0;)e+=r;for(;e>=r;)e-=r;for(let r=0;r<t&&e>0;r++)1&e&&(i+=v[53-t+r]),e>>>=1;return o.assert(0===e),i}(t,i);return e.mortonCode()+r}function i(e,t=4){let i=0,r=e,n=0;for(;n<t;n++){const e=v[52-n];r>=e&&(r-=e,i+=v[t-1-n])}return i-=v[t-1],{offset:i,mortonCode:r}}e.getKeyForTileKeyAndOffset=t,e.extractOffsetAndMortonKeyFromKey=i,e.getParentKeyFromKey=function(e,n=4){const{offset:s,mortonCode:o}=i(e,n);return t(r.TileKey.fromMortonCode(r.TileKey.parentMortonCode(o)),s,n)}}(t.TileOffsetUtils||(t.TileOffsetUtils={}))},8033:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisibleTileSet=t.ResourceComputationType=void 0;const r=i(3139),n=i(3844),s=i(2183),o=i(4428),a=i(783),l=i(3683),c=i(5667),h=i(8730);var d,u;!function(e){e[e.EstimationInMb=0]="EstimationInMb",e[e.NumberOfTiles=1]="NumberOfTiles"}(d=t.ResourceComputationType||(t.ResourceComputationType={})),function(e){e[e.NONE=0]="NONE",e[e.UP=1]="UP",e[e.DOWN=2]="DOWN",e[e.BOTH=3]="BOTH"}(u||(u={}));const m=1/1048576;class p{constructor(e,t=d.EstimationInMb){this.m_disposedTiles=[],this.m_resourceComputationType=t,this.m_tileCache=new n.LRUCache(e,(e=>this.m_resourceComputationType===d.EstimationInMb?e.memoryUsage*m:1)),this.m_tileCache.evictionCallback=(e,t)=>{void 0!==t.tileLoader&&t.tileLoader.cancel(),this.m_disposedTiles.push(t)},this.m_tileCache.canEvict=(e,t)=>!t.isVisible}static getKey(e,t,i){return`${i.name}_${e}_${t}`}static getKeyForTile(e){return p.getKey(e.tileKey.mortonCode(),e.offset,e.dataSource)}get resourceComputationType(){return this.m_resourceComputationType}get capacity(){return this.m_tileCache.capacity}get size(){return this.m_tileCache.size}setCapacity(e,t){this.m_resourceComputationType=t,this.m_tileCache.setCapacityAndMeasure(e,(e=>this.m_resourceComputationType===d.EstimationInMb?e.memoryUsage*m:1))}get(e,t,i){return this.m_tileCache.get(p.getKey(e,t,i))}set(e,t,i,r){this.m_tileCache.set(p.getKey(e,t,i),r)}delete(e){const t=p.getKeyForTile(e);this.deleteByKey(t)}deleteByKey(e){this.m_tileCache.delete(e)}disposeTiles(){this.m_disposedTiles.forEach((e=>{e.dispose()})),this.m_disposedTiles.length=0}shrinkToCapacity(){this.m_tileCache.shrinkToCapacity()}evictAll(){this.m_tileCache.evictAll()}evictSelected(e){this.m_tileCache.evictSelected(e)}forEach(e,t){this.m_tileCache.forEach(((i,r)=>{void 0!==t&&i.dataSource!==t||e(i,r)}))}}const f=(e,t)=>{const i=e.distance-t.distance,r=1e-6*(e.distance+t.distance);return Math.abs(i)<r?e.tileKey.mortonCode()-t.tileKey.mortonCode():i};t.VisibleTileSet=class{constructor(e,t,i,r){var n;this.m_frustumIntersection=e,this.m_tileGeometryManager=t,this.options=i,this.m_taskQueue=r,this.dataSourceTileList=[],this.allVisibleTilesLoaded=!1,this.m_cameraOverride=new o.PerspectiveCamera,this.m_viewRange={near:.1,far:1/0,minimum:.1,maximum:1/0},this.m_coveringMap=new Map,this.m_resourceComputationType=d.EstimationInMb,this.options=i,this.options.maxTilesPerFrame=Math.floor(null!==(n=this.options.maxTilesPerFrame)&&void 0!==n?n:0),this.m_resourceComputationType=void 0===i.resourceComputationType?d.EstimationInMb:i.resourceComputationType,this.m_dataSourceCache=new p(this.options.tileCacheSize,this.m_resourceComputationType)}getDataSourceCacheSize(){return this.options.tileCacheSize}setDataSourceCacheSize(e,t=d.EstimationInMb){this.options.tileCacheSize=e,this.resourceComputationType=t}getNumberOfVisibleTiles(){return this.options.maxVisibleDataSourceTiles}setNumberOfVisibleTiles(e){this.options.maxVisibleDataSourceTiles=e}get maxTilesPerFrame(){return this.options.maxTilesPerFrame}set maxTilesPerFrame(e){if(e<0)throw new Error("Invalid value, this will result in no tiles ever showing");this.options.maxTilesPerFrame=Math.floor(e)}get resourceComputationType(){return this.m_resourceComputationType}set resourceComputationType(e){this.m_resourceComputationType=e,this.m_dataSourceCache.setCapacity(this.options.tileCacheSize,e)}updateClipPlanes(e,t){void 0!==e&&(this.options.clipPlanesEvaluator.maxElevation=e),void 0!==t&&(this.options.clipPlanesEvaluator.minElevation=t);const{camera:i,projection:r,elevationProvider:n}=this.m_frustumIntersection.mapView;return this.m_viewRange=this.options.clipPlanesEvaluator.evaluateClipPlanes(i,r,n),this.m_viewRange}updateRenderList(e,t,i,r,n){let o=!0;const a=this.getVisibleTileKeysForDataSources(t,i,n);this.dataSourceTileList=[],this.m_coveringMap.clear();for(const{dataSource:i,visibleTileKeys:n}of a.tileKeys){n.sort(f);const s=i.getDataZoomLevel(t),a=this.processVisibleTiles(n,i,r,{newTilesPerFrame:0},!0),l=this.processVisibleTiles(a.dependentTiles,i,r,{newTilesPerFrame:0},!1);this.m_tileGeometryManager.updateTiles(a.visibleTiles),this.m_tileGeometryManager.updateTiles(l.visibleTiles),this.dataSourceTileList.push({dataSource:i,storageLevel:e,zoomLevel:s,allVisibleTileLoaded:a.allDataSourceTilesLoaded&&l.allDataSourceTilesLoaded,numTilesLoading:a.numTilesLoading+l.numTilesLoading,visibleTiles:[...a.visibleTiles,...l.visibleTiles],renderedTiles:new Map}),o=o&&a.allDataSourceTilesLoaded}let l,c;this.allVisibleTilesLoaded=o&&a.allBoundingBoxesFinal,this.populateRenderedTiles(),this.forEachCachedTile((e=>{e.isVisible||e.allGeometryLoaded||this.disposeTile(e)})),this.m_dataSourceCache.shrinkToCapacity(),this.dataSourceTileList.forEach((e=>{e.renderedTiles.forEach((t=>{t.update(e.zoomLevel),l=s.MathUtils.min2(l,t.geoBox.minAltitude),c=s.MathUtils.max2(c,t.geoBox.maxAltitude)}))})),void 0===l&&(l=0),void 0===c&&(c=0);let h=!1;const d=this.m_viewRange,u=this.updateClipPlanes(c,l);var m,p;return h=0==(p=d,(m=u).far===p.far&&m.maximum===p.maximum&&m.minimum===p.minimum&&m.near===p.near),{viewRanges:u,viewRangesChanged:h}}getTile(e,t,i,r){return this.getTileImpl(e,t,i,!1,r)}getCachedTile(e,t,i,r){return s.assert(e.cacheable),this.getTileImpl(e,t,i,!0,r)}getRenderedTile(e,t,i=0){const r=this.dataSourceTileList.find((t=>t.dataSource===e));if(void 0!==r)return r.renderedTiles.get(h.TileOffsetUtils.getKeyForTileKeyAndOffset(t,i))}getRenderedTileAtLocation(e,t,i=0){const n=this.dataSourceTileList.find((t=>t.dataSource===e));if(void 0===n)return;const s=e.getTilingScheme(),o=n.zoomLevel,a=s.getTileKey(t,o);if(!a)return;let l=n.renderedTiles.get(h.TileOffsetUtils.getKeyForTileKeyAndOffset(a,i));if(void 0!==l)return l;const{searchLevelsUp:c,searchLevelsDown:d}=this.getSearchDirection(e,o);let u=a;for(let e=1;e<=c;++e)if(u=u.parent(),l=n.renderedTiles.get(h.TileOffsetUtils.getKeyForTileKeyAndOffset(u,i)),void 0!==l)return l;const m=s.projection.projectPoint(t);for(let e=1;e<=d;++e){const t=o+e,a=r.TileKeyUtils.worldCoordinatesToTileKey(s,m,t);if(a&&(l=n.renderedTiles.get(h.TileOffsetUtils.getKeyForTileKeyAndOffset(a,i)),void 0!==l))return l}}removeDataSource(e){this.clearTileCache(e),this.dataSourceTileList=this.dataSourceTileList.filter((t=>t.dataSource!==e))}clearTileCache(e,t){void 0!==e?this.m_dataSourceCache.evictSelected(((i,r)=>i.dataSource===e&&(void 0===t||t(i)))):void 0!==t?this.m_dataSourceCache.evictSelected(t):this.m_dataSourceCache.evictAll()}markTilesDirty(e,t){if(void 0===e)this.dataSourceTileList.forEach((e=>{this.markDataSourceTilesDirty(e,t)}));else{const i=this.dataSourceTileList.find((t=>t.dataSource===e));if(void 0===i)return;this.markDataSourceTilesDirty(i,t)}}disposePendingTiles(){this.m_dataSourceCache.disposeTiles()}forEachVisibleTile(e){for(const t of this.dataSourceTileList)t.renderedTiles.forEach(e)}forEachCachedTile(e,t){this.m_dataSourceCache.forEach(((t,i)=>e(t)),t)}disposeTile(e){this.m_dataSourceCache.delete(e),e.dispose()}processVisibleTiles(e,t,i,r,n){var s;let o=!0,a=0;const c=[],h=[];for(let d=0;d<e.length&&c.length<this.options.maxVisibleDataSourceTiles;d++){const u=e[d],m=this.getTile(t,u.tileKey,u.offset,i);if(void 0!==m&&(c.push(m),o=o&&m.allGeometryLoaded,m.allGeometryLoaded?(this.skipOverlappedTiles(t,m),this.processDelayTileRendering(m,r.newTilesPerFrame,i)&&r.newTilesPerFrame++):a++,m.visibleArea=u.area,m.elevationRange=null!==(s=u.elevationRange)&&void 0!==s?s:{minElevation:0,maxElevation:0},n))for(const t of m.dependencies)void 0===e.find((e=>e.tileKey.mortonCode()===t.mortonCode()))&&h.push(new l.TileKeyEntry(t,0))}return{allDataSourceTilesLoaded:o,numTilesLoading:a,visibleTiles:c,dependentTiles:h}}processDelayTileRendering(e,t,i){let r=!1;return 0!==this.options.maxTilesPerFrame&&t>this.options.maxTilesPerFrame&&e.frameNumLastVisible!==i-1?(e.delayRendering=!0,e.mapView.update()):(e.frameNumVisible<0&&(e.frameNumVisible=i,r=!0),e.numFramesVisible++,e.delayRendering=!1),r}skipOverlappedTiles(e,t){if(this.options.projection.type!==r.ProjectionType.Spherical&&e.isFullyCovering()){const i=t.uniqueKey,r=this.m_coveringMap.get(i);void 0===r?(t.skipRendering=!1,this.m_coveringMap.set(i,t)):r.dataSource instanceof a.BackgroundDataSource?r.skipRendering=!0:e instanceof a.BackgroundDataSource&&(t.skipRendering=!0)}}getSearchDirection(e,t){const i=Math.min(this.options.quadTreeSearchDistanceUp,Math.max(0,t-e.minDataLevel)),r=Math.min(this.options.quadTreeSearchDistanceDown,Math.max(0,e.maxDataLevel-t));return{searchDirection:r>0&&i>0?u.BOTH:r>0?u.DOWN:i>0?u.UP:u.NONE,searchLevelsUp:i,searchLevelsDown:r}}populateRenderedTiles(){this.dataSourceTileList.forEach((e=>{const t=e.renderedTiles,i=[];e.visibleTiles.forEach((e=>{e.levelOffset=0,e.hasGeometry&&!e.delayRendering?t.set(e.uniqueKey,e):i.push(e.uniqueKey)}));const r=e.dataSource;if(0===i.length||!1===r.allowOverlappingTiles)return;const n=e.zoomLevel,{searchDirection:s}=this.getSearchDirection(r,n),o=new Map;for(const e of i)(s!==u.BOTH&&s!==u.UP||!this.findUp(e,n,t,o,r))&&(s!==u.BOTH&&s!==u.DOWN||this.findDown(e,n,t,r))}))}findDown(e,t,i,n){const{offset:s,mortonCode:o}=h.TileOffsetUtils.extractOffsetAndMortonKeyFromKey(e),a=r.TileKey.fromMortonCode(o),l=n.getTilingScheme();for(const e of l.getSubTileKeys(a)){const r=h.TileOffsetUtils.getKeyForTileKeyAndOffset(e,s),o=this.m_dataSourceCache.get(e.mortonCode(),s,n),a=Math.abs(e.level-t);void 0===o||!o.hasGeometry||o.delayRendering?a<this.options.quadTreeSearchDistanceDown&&this.findDown(r,t,i,n):(i.set(r,o),o.levelOffset=a)}}findUp(e,t,i,n,s){const o=h.TileOffsetUtils.getParentKeyFromKey(e);if(void 0!==i.get(o))return!0;const a=n.get(o);if(void 0!==a)return a;const{offset:l,mortonCode:c}=h.TileOffsetUtils.extractOffsetAndMortonKeyFromKey(o),d=this.m_dataSourceCache.get(c,l,s),u=d?d.tileKey:r.TileKey.fromMortonCode(c),m=Math.abs(t-u.level);if(void 0!==d&&d.hasGeometry&&!d.delayRendering)return n.set(o,!0),i.set(o,d),d.levelOffset=-m,!0;if(n.set(o,!1),m<this.options.quadTreeSearchDistanceUp&&0!==u.level){const e=this.findUp(o,t,i,n,s);if(n.set(o,e),e)return!0}return!1}getTileImpl(e,t,i,r,n){function s(e){e.frameNumLastRequested=n}if(!e.cacheable&&!r){const i=e.getTile(t,!0);return void 0!==i&&(this.addToTaskQueue(i),s(i)),i}const o=this.m_dataSourceCache;let a=o.get(t.mortonCode(),i,e);return void 0!==a&&a.offset===i?(s(a),a):r?void 0:(a=e.getTile(t,!0),void 0!==a&&(this.addToTaskQueue(a),a.offset=i,s(a),o.set(t.mortonCode(),i,e,a)),a)}addToTaskQueue(e){this.m_taskQueue.add({execute:e.load.bind(e),group:c.TileTaskGroups.FETCH_AND_DECODE,getPriority:()=>{var t,i;return null!==(i=null===(t=null==e?void 0:e.tileLoader)||void 0===t?void 0:t.priority)&&void 0!==i?i:0},isExpired:()=>!(null==e?void 0:e.isVisible),estimatedProcessTime:()=>1})}markDataSourceTilesDirty(e,t){const i=this.m_dataSourceCache,r=new Set,n=e=>{const t=p.getKeyForTile(e);r.has(t)||(r.add(t),this.addToTaskQueue(e))};e.visibleTiles.forEach((e=>{(void 0===t||t(e))&&n(e)})),e.renderedTiles.forEach((e=>{(void 0===t||t(e))&&n(e)})),i.forEach(((e,n)=>{void 0!==t&&!t(e)||r.has(n)||(i.deleteByKey(n),e.dispose())}),e.dataSource)}getVisibleTileKeysForDataSources(e,t,i){const r=Array();let n=!0;if(0===t.length)return{tileKeys:r,allBoundingBoxesFinal:n};const s=new Map;t.forEach((e=>{const t=e.getTilingScheme(),i=s.get(t);void 0===i?s.set(t,[e]):i.push(e)})),void 0!==i?(this.m_cameraOverride.copy(this.m_frustumIntersection.camera),this.m_cameraOverride.near=Math.min(this.m_cameraOverride.near,this.m_viewRange.minimum),this.m_cameraOverride.far=Math.max(this.m_cameraOverride.far,this.m_viewRange.maximum),this.m_cameraOverride.updateProjectionMatrix(),this.m_frustumIntersection.updateFrustum(this.m_cameraOverride.projectionMatrix)):this.m_frustumIntersection.updateFrustum();for(const[t,o]of s){const s=o.map((t=>t.getDataZoomLevel(e))),a=this.m_frustumIntersection.compute(t,i,s,o);n=n&&a.calculationFinal;for(const t of o){const i=[],n=t.getDataZoomLevel(e);for(const e of a.tileKeyEntries.get(n).values())t.canGetTile(n,e.tileKey)&&i.push(e);r.push({dataSource:t,visibleTileKeys:i})}}return{tileKeys:r,allBoundingBoxesFinal:n}}}},4756:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerBasedDecoder=void 0;const r=i(3187);let n=0;t.WorkerBasedDecoder=class{constructor(e,t){this.workerSet=e,this.decoderServiceType=t,this.m_serviceCreated=!1,this.workerSet.addReference(),this.serviceId=`${this.decoderServiceType}-${n++}`}dispose(){this.m_serviceCreated&&this.workerSet.broadcastRequest(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:r.WorkerServiceProtocol.Requests.DestroyService,targetServiceId:this.serviceId}).catch((()=>{})),this.workerSet.removeReference()}async connect(){await this.workerSet.connect(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID),this.m_serviceCreated||(await this.workerSet.broadcastRequest(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:r.WorkerServiceProtocol.Requests.CreateService,targetServiceType:this.decoderServiceType,targetServiceId:this.serviceId}),this.m_serviceCreated=!0)}decodeTile(e,t,i,n){const s=t.mortonCode(),o={type:r.WorkerDecoderProtocol.Requests.DecodeTileRequest,tileKey:s,data:e,projection:r.getProjectionName(i)},a=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,o,a,n)}getTileInfo(e,t,i,n){const s=t.mortonCode(),o={type:r.WorkerDecoderProtocol.Requests.TileInfoRequest,tileKey:s,data:e,projection:r.getProjectionName(i)},a=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,o,a,n)}configure(e,t){const i=Object.assign(Object.assign({service:this.serviceId,type:r.WorkerDecoderProtocol.DecoderMessageName.Configuration},e),{options:t});this.workerSet.broadcastMessage(i)}get workerCount(){return this.workerSet.workerCount}}},1931:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerBasedTiler=void 0;const r=i(3187);let n=0;t.WorkerBasedTiler=class{constructor(e,t){this.workerSet=e,this.tilerServiceType=t,this.m_serviceCreated=!1,this.workerSet.addReference(),this.serviceId=`${this.tilerServiceType}-${n++}`}dispose(){this.m_serviceCreated&&this.workerSet.broadcastRequest(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:r.WorkerServiceProtocol.Requests.DestroyService,targetServiceId:this.serviceId}).catch((()=>{})),this.workerSet.removeReference()}async connect(){await this.workerSet.connect(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID),this.m_serviceCreated||(await this.workerSet.broadcastRequest(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:r.WorkerServiceProtocol.Requests.CreateService,targetServiceType:this.tilerServiceType,targetServiceId:this.serviceId}),this.m_serviceCreated=!0)}registerIndex(e,t){const i={type:r.WorkerTilerProtocol.Requests.RegisterIndex,id:e,input:t instanceof URL?t.href:t};return this.workerSet.invokeRequest(this.serviceId,i)}updateIndex(e,t){const i={type:r.WorkerTilerProtocol.Requests.UpdateIndex,id:e,input:t instanceof URL?t.href:t};return this.workerSet.invokeRequest(this.serviceId,i)}getTile(e,t){const i=t.mortonCode(),n={type:r.WorkerTilerProtocol.Requests.TileRequest,index:e,tileKey:i};return this.workerSet.invokeRequest(this.serviceId,n)}}},2263:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LowResRenderPass=void 0;const r=i(284),n=i(4428),s=i(9445);class o extends s.Pass{constructor(e){super(),this.lowResPixelRatio=e,this.m_renderTarget=null,this.m_localCamera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.m_quadScene=new n.Scene,this.m_quadUniforms=r.CopyShader.uniforms,this.m_quadMaterial=new r.CopyMaterial(this.m_quadUniforms),this.m_quad=new n.Mesh(new n.PlaneBufferGeometry(2,2),this.m_quadMaterial),this.m_savedWidth=0,this.m_savedHeight=0,this.m_quad.frustumCulled=!1,this.m_quadScene.add(this.m_quad),this.m_pixelRatio=e}dispose(){this.m_quadMaterial.dispose(),this.m_quad.geometry.dispose(),null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)}set pixelRatio(e){this.m_pixelRatio=e,this.m_renderTarget&&void 0!==this.pixelRatio&&this.m_renderTarget.setSize(Math.floor(this.m_savedWidth*this.pixelRatio),Math.floor(this.m_savedHeight*this.pixelRatio))}get pixelRatio(){return this.m_pixelRatio}render(e,t,i,r,s){if(!this.enabled||void 0===this.pixelRatio)return;null===this.m_renderTarget&&(this.m_savedWidth=s.width,this.m_savedHeight=s.height,this.m_renderTarget=new n.WebGLRenderTarget(Math.floor(this.m_savedWidth*this.pixelRatio),Math.floor(this.m_savedHeight*this.pixelRatio),{minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat,depthBuffer:!0,stencilBuffer:!0}),this.m_renderTarget.texture.name="LowResRenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture,this.m_quadUniforms.opacity.value=1;const o=e.getRenderTarget();e.setRenderTarget(this.m_renderTarget),e.clear(),e.render(t,i),e.setRenderTarget(this.renderToScreen?null:r),e.clear(),e.render(this.m_quadScene,this.m_localCamera),e.setRenderTarget(o)}setSize(e,t){this.m_savedWidth=e,this.m_savedHeight=t,this.m_renderTarget&&void 0!==this.pixelRatio&&this.m_renderTarget.setSize(Math.floor(e*this.pixelRatio),Math.floor(t*this.pixelRatio))}}t.LowResRenderPass=o},7233:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MSAARenderPass=t.MSAASampling=void 0;const r=i(284),n=i(4428),s=i(9445);var o;!function(e){e[e.Level_0=0]="Level_0",e[e.Level_1=1]="Level_1",e[e.Level_2=2]="Level_2",e[e.Level_3=3]="Level_3",e[e.Level_4=4]="Level_4",e[e.Level_5=5]="Level_5"}(o=t.MSAASampling||(t.MSAASampling={}));class a extends s.Pass{constructor(){super(),this.samplingLevel=o.Level_1,this.m_renderTarget=null,this.m_localCamera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.m_quadScene=new n.Scene,this.m_quadUniforms=r.CopyShader.uniforms,this.m_quadMaterial=new r.MSAAMaterial(this.m_quadUniforms),this.m_quad=new n.Mesh(new n.PlaneBufferGeometry(2,2),this.m_quadMaterial),this.m_tmpColor=new n.Color,this.m_quad.frustumCulled=!1,this.m_quadScene.add(this.m_quad)}dispose(){null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)}render(e,t,i,r,s){if(!this.enabled)return;null===this.m_renderTarget&&(this.m_renderTarget=new n.WebGLRenderTarget(s.width,s.height,{minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat}),this.m_renderTarget.texture.name="MSAARenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture;const o=a.OffsetVectors[this.samplingLevel],l=e.getClearColor(this.m_tmpColor),c=void 0!==l?l.getHex():0,h={enabled:null!==i.view&&i.view.enabled,fullWidth:s.width,fullHeight:s.height,x:0,y:0,width:s.width,height:s.height};h.enabled&&null!==i.view&&(h.fullWidth=i.view.fullWidth,h.fullHeight=i.view.fullHeight,h.x=i.view.offsetX,h.y=i.view.offsetY,h.width=i.view.width,h.height=i.view.height);const d=e.getRenderTarget();for(let n=0;n<o.length;n++){const s=o[n];i.setViewOffset(h.fullWidth,h.fullHeight,h.x+s[0]/16,h.y+s[1]/16,h.width,h.height);const a=(n+.5)/o.length-.5,d=1/o.length+a/32;this.m_quadUniforms.opacity.value=d,e.setRenderTarget(this.m_renderTarget),e.clear(),e.render(t,i),e.setRenderTarget(this.renderToScreen?null:r),0===n&&(e.setClearColor(0),e.clear()),e.render(this.m_quadScene,this.m_localCamera),0===n&&void 0!==l&&e.setClearColor(c)}e.setRenderTarget(d),null!==i.view&&(i.view.enabled=h.enabled,i.view.offsetX=h.x,i.view.offsetY=h.y)}setSize(e,t){this.m_renderTarget&&this.m_renderTarget.setSize(e,t)}}t.MSAARenderPass=a,a.OffsetVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]]},9034:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapRenderingManager=void 0;const r=i(284),n=i(4428),s=i(2263),o=i(7233),a=i(7315),l=i(9445),c=i(5607),h=o.MSAASampling.Level_1,d=o.MSAASampling.Level_4;t.MapRenderingManager=class{constructor(e,t,i,a={msaaEnabled:!1}){this.bloom={enabled:!1,strength:1.5,radius:.4,threshold:.85},this.outline={enabled:!1,thickness:.005,color:"#000000",ghostExtrudedPolygons:!1,needsUpdate:!1},this.vignette={enabled:!1,offset:1,darkness:1},this.sepia={enabled:!1,amount:.5},this.m_width=1,this.m_height=1,this.m_renderPass=new l.RenderPass,this.m_target1=new n.WebGLRenderTarget(1,1),this.m_target2=new n.WebGLRenderTarget(1,1),this.m_sepiaPass=new l.ShaderPass(r.SepiaShader),this.m_vignettePass=new l.ShaderPass(r.VignetteShader),this.m_readBuffer=new n.WebGLRenderTarget(e,t),this.m_msaaPass=new o.MSAARenderPass,this.m_msaaPass.enabled=void 0!==a&&!0===a.msaaEnabled,this.m_dynamicMsaaSamplingLevel=void 0===a.dynamicMsaaSamplingLevel?h:a.dynamicMsaaSamplingLevel,this.m_staticMsaaSamplingLevel=void 0===a.staticMsaaSamplingLevel?d:a.staticMsaaSamplingLevel,this.m_lowResPass=new s.LowResRenderPass(i),this.m_lowResPass.enabled=void 0!==i}updateOutline(e){this.outline.color=e.color,this.outline.thickness=e.thickness,this.outline.ghostExtrudedPolygons=e.ghostExtrudedPolygons,this.outline.needsUpdate=!0}render(e,t,i,r){if(!r&&void 0!==this.m_lowResPass.pixelRatio)return this.m_lowResPass.renderToScreen=!0,void this.m_lowResPass.render(e,t,i,null,this.m_readBuffer);const s=this.bloom.enabled||this.outline.enabled||this.vignette.enabled||this.sepia.enabled;let o=null;if((this.bloom.enabled||this.vignette.enabled||this.sepia.enabled)&&(e.setRenderTarget(this.m_target1),e.clearDepth()),this.m_msaaPass.enabled?(this.m_msaaPass.samplingLevel=r?this.m_staticMsaaSamplingLevel:this.m_dynamicMsaaSamplingLevel,this.m_msaaPass.renderToScreen=!s,this.m_msaaPass.render(e,t,i,null,this.m_readBuffer)):this.bloom.enabled||this.vignette.enabled||this.sepia.enabled?(o=this.m_target1,this.m_renderPass.render(e,t,i,this.m_target1,null)):(!this.outline.enabled||this.outline.enabled&&!this.bloom.enabled)&&e.render(t,i),this.outline.enabled){void 0===this.m_outlineEffect&&(this.m_outlineEffect=new a.OutlineEffect(e)),this.outline.needsUpdate&&(this.m_outlineEffect.color=this.outline.color,this.m_outlineEffect.thickness=this.outline.thickness,this.m_outlineEffect.ghostExtrudedPolygons=this.outline.ghostExtrudedPolygons,this.outline.needsUpdate=!1);const r=this.bloom.enabled||this.vignette.enabled||this.sepia.enabled;r&&(o=this.m_target1),e.setRenderTarget(r?o:null),this.m_outlineEffect.render(t,i)}if(this.bloom.enabled){void 0===this.m_bloomPass&&(this.m_bloomPass=new c.BloomPass(new n.Vector2(this.m_width,this.m_height),this.bloom.strength,this.bloom.radius,this.bloom.threshold));const r=this.vignette.enabled||this.sepia.enabled;this.m_bloomPass.renderToScreen=!r,this.m_bloomPass.radius=this.bloom.radius,this.m_bloomPass.strength=this.bloom.strength,this.m_bloomPass.threshold=this.bloom.threshold,this.m_bloomPass.render(e,t,i,null,o)}else void 0!==this.m_bloomPass&&(this.m_bloomPass.dispose(),this.m_bloomPass=void 0);if(this.vignette.enabled){const r=o,n=this.sepia.enabled;this.m_vignettePass.uniforms.offset.value=this.vignette.offset,this.m_vignettePass.uniforms.darkness.value=this.vignette.darkness,this.m_vignettePass.renderToScreen=!n,n&&(o=o===this.m_target1?this.m_target2:this.m_target1),this.m_vignettePass.render(e,t,i,o,r)}this.sepia.enabled&&(this.m_sepiaPass.renderToScreen=!0,this.m_sepiaPass.uniforms.amount.value=this.sepia.amount,this.m_sepiaPass.render(e,t,i,null,o))}setSize(e,t){this.m_readBuffer.setSize(e,t),this.m_msaaPass.setSize(e,t),void 0!==this.m_bloomPass&&this.m_bloomPass.setSize(e,t),this.m_lowResPass.setSize(e,t),this.m_target1.setSize(e,t),this.m_target2.setSize(e,t),this.m_width=e,this.m_height=t}get lowResPixelRatio(){return this.m_lowResPass.pixelRatio}set lowResPixelRatio(e){this.m_lowResPass.pixelRatio=e,this.m_lowResPass.enabled=void 0!==e}set dynamicMsaaSamplingLevel(e){this.m_dynamicMsaaSamplingLevel=e}get dynamicMsaaSamplingLevel(){return this.m_dynamicMsaaSamplingLevel}set msaaEnabled(e){this.m_msaaPass.enabled=e}get msaaEnabled(){return this.m_msaaPass.enabled}set staticMsaaSamplingLevel(e){this.m_staticMsaaSamplingLevel=e}get staticMsaaSamplingLevel(){return this.m_staticMsaaSamplingLevel}}},7315:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutlineEffect=void 0;const r=i(284),n=i(2183),s=i(4428);t.OutlineEffect=class{constructor(e){this.m_renderer=e,this.enabled=!0,this.m_defaultThickness=.02,this.m_defaultColor=new s.Color(0,0,0),this.m_defaultAlpha=1,this.m_defaultKeepAlive=!1,this.m_ghostExtrudedPolygons=!1,this.m_cache={},this.m_removeThresholdCount=60,this.m_originalMaterials={},this.m_originalOnBeforeRenders={},this.m_shaderIDs={MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical"},this.m_uniformsChunk={outlineThickness:{value:this.m_defaultThickness},outlineColor:{value:this.m_defaultColor},outlineAlpha:{value:this.m_defaultAlpha}},this.autoClear=e.autoClear,this.domElement=e.domElement,this.shadowMap=e.shadowMap}set thickness(e){this.m_defaultThickness=e,this.m_uniformsChunk.outlineThickness.value=e,this.m_cache={}}set color(e){this.m_defaultColor.set(e),this.m_cache={}}set ghostExtrudedPolygons(e){this.m_ghostExtrudedPolygons=e}clear(e,t,i){this.m_renderer.clear(e,t,i)}getPixelRatio(){return this.m_renderer.getPixelRatio()}setPixelRatio(e){this.m_renderer.setPixelRatio(e)}getSize(e){return this.m_renderer.getSize(e)}setSize(e,t,i){this.m_renderer.setSize(e,t,i)}setViewport(e,t,i,r){this.m_renderer.setViewport(e,t,i,r)}setScissor(e,t,i,r){this.m_renderer.setScissor(e,t,i,r)}setScissorTest(e){this.m_renderer.setScissorTest(e)}setRenderTarget(e){this.m_renderer.setRenderTarget(e)}render(e,t){if(this.m_ghostExtrudedPolygons){if(!this.enabled)return void this.m_renderer.render(e,t);const i=this.m_renderer.autoClear;this.m_renderer.autoClear=this.autoClear,this.m_renderer.render(e,t),this.m_renderer.autoClear=i}this.renderOutline(e,t)}renderOutline(e,t){const i=this.m_renderer.autoClear,r=e.autoUpdate,n=e.background,s=this.m_renderer.shadowMap.enabled;e.autoUpdate=!1,e.background=null,this.m_renderer.autoClear=!1,this.m_renderer.shadowMap.enabled=!1,e.traverse(this.setOutlineMaterial.bind(this)),this.m_renderer.render(e,t),e.traverse(this.restoreOriginalMaterial.bind(this)),this.cleanupCache(),e.autoUpdate=r,e.background=n,this.m_renderer.autoClear=i,this.m_renderer.shadowMap.enabled=s}createInvisibleMaterial(){return new s.ShaderMaterial({name:"invisible",visible:!1})}createMaterial(e){if(e instanceof r.EdgeMaterial||!0===e.isDepthPrepassMaterial)return this.createInvisibleMaterial();const t=this.m_shaderIDs[e.type];let i,n=void 0!==e.shaderUniforms?e.shaderUniforms:e.uniforms;if(void 0!==t){const e=s.ShaderLib[t];n=e.uniforms,i=e.vertexShader}else if(!0===e.isRawShaderMaterial){if(i=e.vertexShader,!/attribute\s+vec3\s+position\s*;/.test(i)||!/attribute\s+vec3\s+normal\s*;/.test(i))return this.createInvisibleMaterial()}else{if(!0!==e.isShaderMaterial)return this.createInvisibleMaterial();i=e.vertexShader}const o=void 0!==e.shaderUniforms&&void 0!==e.shaderUniforms.extrusionRatio,a=r.FadingFeature.isDefined(e),l=Object.assign(Object.assign({},n),this.m_uniformsChunk),c=i.replace(/void\s+main\s*\(\s*\)/,"\n#ifdef USE_EXTRUSION\n  #ifndef HAS_EXTRUSION_PARS_VERTEX\n    #include <extrusion_pars_vertex>\n  #endif\n#endif\n\n#ifdef USE_FADING\n  #include <fading_pars_vertex>\n#endif\n\nuniform float outlineThickness;\n\nvec4 calculateOutline( vec4 pos, vec3 objectNormal, vec4 skinned ) {\n    float thickness = outlineThickness;\n    const float ratio = 1.0;\n    vec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + objectNormal, 1.0 );\n    vec4 norm = normalize( pos - pos2 );\n    return pos + norm * thickness * pos.w * ratio;\n}\nvoid main()").replace(/\}\s*$/,"\n#if ! defined( LAMBERT ) && ! defined( PHONG ) && ! defined( TOON ) && ! defined( STANDARD )\n    #ifndef USE_ENVMAP\n        vec3 objectNormal = normalize( normal );\n    #endif\n#endif\n\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n\n#ifdef DECLARE_TRANSFORMED\n    vec3 transformed = vec3( position );\n#endif\n\n#ifdef USE_EXTRUSION\n #ifndef HAS_EXTRUSION_VERTEX\n  #include <extrusion_vertex>\n #endif\n#endif\n\n#ifdef USE_FADING\n  #include <fading_vertex>\n#endif\n\n#ifdef USE_EXTRUSION\n  gl_Position = calculateOutline( projectionMatrix * modelViewMatrix * vec4( transformed, 1.0 ),\n      objectNormal, vec4( transformed, 1.0 ) );\n#else\n  gl_Position = calculateOutline( gl_Position, objectNormal, vec4( transformed, 1.0 ) );\n#endif\n\n#include <fog_vertex>\n}").replace(/#include\s+<[\w_]*light[\w_]*>/g,""),h={};return/vec3\s+transformed\s*=/.test(i)||/#include\s+<begin_vertex>/.test(i)||(h.DECLARE_TRANSFORMED=!0),o&&(l.extrusionRatio={value:r.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN},h.USE_EXTRUSION=1),a&&(l.fadeNear={value:void 0!==n.fadeNear?n.fadeNear.value:r.FadingFeature.DEFAULT_FADE_NEAR},l.fadeFar={value:void 0!==n.fadeFar?n.fadeFar.value:r.FadingFeature.DEFAULT_FADE_FAR},h.USE_FADING=1),new s.ShaderMaterial({defines:h,uniforms:l,vertexShader:c,fragmentShader:"\n#include <common>\n#include <fog_pars_fragment>\n\n#ifdef USE_EXTRUSION\n  #include <extrusion_pars_fragment>\n#endif\n\n#ifdef USE_FADING\n  #include <fading_pars_fragment>\n#endif\n\nuniform vec3 outlineColor;\nuniform float outlineAlpha;\n\nvoid main() {\n\n    gl_FragColor = vec4( outlineColor, outlineAlpha );\n\n    #include <fog_fragment>\n\n    #ifdef USE_EXTRUSION\n      #include <extrusion_fragment>\n    #endif\n\n    #ifdef USE_FADING\n      #include <fading_fragment>\n    #endif\n}",side:s.BackSide,skinning:!1,morphTargets:!1,morphNormals:!1,fog:!1,blending:s.CustomBlending,blendSrc:s.SrcAlphaFactor,blendDst:s.OneMinusSrcAlphaFactor,blendSrcAlpha:s.OneFactor,blendDstAlpha:s.OneMinusSrcAlphaFactor,transparent:!0,polygonOffset:!0,polygonOffsetFactor:10,polygonOffsetUnits:30})}getOutlineMaterialFromCache(e){let t=this.m_cache[e.uuid];return void 0===t&&(t={material:this.createMaterial(e),used:!0,keepAlive:this.m_defaultKeepAlive,count:0},this.m_cache[e.uuid]=t),t.used=!0,t.material}getOutlineMaterial(e){const t=this.getOutlineMaterialFromCache(e);return this.m_originalMaterials[t.uuid]=e,this.updateOutlineMaterial(t,e),t}setOutlineMaterial(e){if(void 0!==e.material){if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)e.material[t]=this.getOutlineMaterial(e.material[t]);else e.material=this.getOutlineMaterial(e.material);this.m_originalOnBeforeRenders[e.uuid]=e.onBeforeRender,e.onBeforeRender=n.chainCallbacks(e.onBeforeRender,this.onBeforeRender.bind(this))}}restoreOriginalMaterial(e){if(void 0!==e.material){if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)e.material[t]=this.m_originalMaterials[e.material[t].uuid];else e.material=this.m_originalMaterials[e.material.uuid];e.onBeforeRender=this.m_originalOnBeforeRenders[e.uuid]}}onBeforeRender(e,t,i,r,n,s){const o=this.m_originalMaterials[n.uuid];void 0!==o&&this.updateUniforms(n,o)}updateUniforms(e,t){var i;const n=t.userData.outlineParameters,s=e.uniforms;s.outlineAlpha.value=t.opacity;const o=void 0!==t.shaderUniforms?t.shaderUniforms:t.uniforms;if(void 0!==n&&(void 0!==n.thickness&&(s.outlineThickness.value=n.thickness),void 0!==n.color&&s.outlineColor.value.fromArray(n.color),void 0!==n.alpha&&(s.outlineAlpha.value=n.alpha)),void 0!==o&&void 0!==o.extrusionRatio){const i=t.shaderUniforms.extrusionRatio.value;e.extrusionRatio=i,e.uniforms.extrusionRatio.value=void 0!==i?i:r.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN}void 0!==(null===(i=e.defines)||void 0===i?void 0:i.USE_FADING)&&void 0!==o.fadeNear&&void 0!==o.fadeFar&&o.fadeFar.value>=0&&(s.fadeNear.value=o.fadeNear.value,s.fadeFar.value=o.fadeFar.value)}updateOutlineMaterial(e,t){if("invisible"===e.name)return;const i=t.userData.outlineParameters;e.skinning=t.skinning,e.morphTargets=t.morphTargets,e.morphNormals=t.morphNormals,e.fog=t.fog,void 0!==i?(e.visible=!1!==t.visible&&(void 0===i.visible||i.visible),void 0!==i.keepAlive&&(this.m_cache[t.uuid].keepAlive=i.keepAlive)):e.visible=t.visible,!0!==t.wireframe&&!1!==t.depthTest||(e.visible=!1)}cleanupCache(){let e;e=Object.keys(this.m_originalMaterials);for(let t=0,i=e.length;t<i;t++)this.m_originalMaterials[e[t]]=void 0;e=Object.keys(this.m_originalOnBeforeRenders);for(let t=0,i=e.length;t<i;t++)this.m_originalOnBeforeRenders[e[t]]=void 0;e=Object.keys(this.m_cache);for(const t of e)!1===this.m_cache[t].used?(this.m_cache[t].count++,!1===this.m_cache[t].keepAlive&&this.m_cache[t].count>this.m_removeThresholdCount&&delete this.m_cache[t]):(this.m_cache[t].used=!1,this.m_cache[t].count=0)}}},9445:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderPass=t.RenderPass=t.Pass=void 0;const r=i(4428);class n{constructor(){this.enabled=!1,this.renderToScreen=!1}setSize(e,t){}render(e,t,i,r,n,s){}}t.Pass=n,t.RenderPass=class extends n{constructor(){super()}render(e,t,i,r,n){e.setRenderTarget(this.renderToScreen?null:r),e.render(t,i)}},t.ShaderPass=class extends n{constructor(e,t="tDiffuse"){super(),this.textureID=t,e instanceof r.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=r.UniformsUtils.clone(e.uniforms),this.material=new r.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new s(this.material)}render(e,t,i,r,n,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,e.setRenderTarget(this.renderToScreen?null:r),this.fsQuad.render(e)}};class s{constructor(e){this.m_camera=new r.OrthographicCamera(-1,1,1,-1,0,1);const t=new r.PlaneBufferGeometry(2,2);this.m_mesh=new r.Mesh(t,e)}get material(){return this.m_mesh.material}set material(e){this.m_mesh.material=e}render(e){e.render(this.m_mesh,this.m_camera)}}},5607:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BloomPass=void 0;const r=i(284),n=i(4428),s=i(9445),o=new n.Vector2(1,0),a=new n.Vector2(0,1);class l extends s.Pass{constructor(e,t,i,s){super(),this.resolution=new n.Vector2(256,256),this.m_renderTargetsHorizontal=[],this.m_renderTargetsVertical=[],this.m_nMips=5,this.m_separableBlurMaterials=[],this.m_camera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.m_scene=new n.Scene,this.m_basic=new n.MeshBasicMaterial,this.m_quad=new n.Mesh(new n.PlaneBufferGeometry(2,2)),this.m_bloomTintColors=[new n.Vector3(1,1,1),new n.Vector3(1,1,1),new n.Vector3(1,1,1),new n.Vector3(1,1,1),new n.Vector3(1,1,1)],this.strength=t,this.radius=i,this.threshold=s,this.resolution=e,this.m_quad.frustumCulled=!1,this.m_scene.add(this.m_quad);const o={minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat};let a=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);this.m_renderTargetBright=new n.WebGLRenderTarget(a,l,o),this.m_renderTargetBright.texture.name="UnrealBloomPass.bright",this.m_renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this.m_nMips;e++){const t=new n.WebGLRenderTarget(a,l,o);t.texture.name="UnrealBloomPass.h"+e,t.texture.generateMipmaps=!1,this.m_renderTargetsHorizontal.push(t);const i=new n.WebGLRenderTarget(a,l,o);i.texture.name="UnrealBloomPass.v"+e,i.texture.generateMipmaps=!1,this.m_renderTargetsVertical.push(i),a=Math.round(a/2),l=Math.round(l/2)}this.m_highPassUniforms=n.UniformsUtils.clone(r.LuminosityHighPassShader.uniforms),this.m_highPassUniforms.luminosityThreshold.value=s,this.m_highPassUniforms.smoothWidth.value=.01,this.m_materialHighPassFilter=new n.ShaderMaterial({uniforms:this.m_highPassUniforms,vertexShader:r.LuminosityHighPassShader.vertexShader,fragmentShader:r.LuminosityHighPassShader.fragmentShader,defines:{}});const c=[3,5,7,9,11];a=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);for(let e=0;e<this.m_nMips;e++)this.m_separableBlurMaterials.push(this.getSeperableBlurMaterial(c[e])),this.m_separableBlurMaterials[e].uniforms.texSize.value=new n.Vector2(a,l),a=Math.round(a/2),l=Math.round(l/2);this.m_compositeMaterial=this.getCompositeMaterial(this.m_nMips),this.m_compositeMaterial.uniforms.blurTexture1.value=this.m_renderTargetsVertical[0].texture,this.m_compositeMaterial.uniforms.blurTexture2.value=this.m_renderTargetsVertical[1].texture,this.m_compositeMaterial.uniforms.blurTexture3.value=this.m_renderTargetsVertical[2].texture,this.m_compositeMaterial.uniforms.blurTexture4.value=this.m_renderTargetsVertical[3].texture,this.m_compositeMaterial.uniforms.blurTexture5.value=this.m_renderTargetsVertical[4].texture,this.m_compositeMaterial.uniforms.bloomStrength.value=t,this.m_compositeMaterial.uniforms.bloomRadius.value=.1,this.m_compositeMaterial.needsUpdate=!0,this.m_compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.m_compositeMaterial.uniforms.bloomTintColors.value=this.m_bloomTintColors,this.m_copyUniforms=n.UniformsUtils.clone(r.CopyShader.uniforms),this.m_copyUniforms.opacity.value=1,this.m_materialCopy=new n.ShaderMaterial({uniforms:this.m_copyUniforms,vertexShader:r.CopyShader.vertexShader,fragmentShader:r.CopyShader.fragmentShader,blending:n.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}dispose(){for(const e of this.m_renderTargetsHorizontal)e.dispose();for(const e of this.m_renderTargetsVertical)e.dispose();this.m_renderTargetBright.dispose()}setSize(e,t){let i=Math.round(e/2),r=Math.round(t/2);this.m_renderTargetBright.setSize(i,r);for(let e=0;e<this.m_nMips;e++)this.m_renderTargetsHorizontal[e].setSize(i,r),this.m_renderTargetsVertical[e].setSize(i,r),this.m_separableBlurMaterials[e].uniforms.texSize.value=new n.Vector2(i,r),i=Math.round(i/2),r=Math.round(r/2)}render(e,t,i,r,n){this.renderToScreen&&(this.m_quad.material=this.m_basic,this.m_basic.map=n.texture,e.setRenderTarget(null),e.clear(),e.render(this.m_scene,this.m_camera)),this.m_highPassUniforms.tDiffuse.value=n.texture,this.m_highPassUniforms.luminosityThreshold.value=this.threshold,this.m_quad.material=this.m_materialHighPassFilter,e.setRenderTarget(this.m_renderTargetBright),e.clear(),e.render(this.m_scene,this.m_camera);let s=this.m_renderTargetBright;for(let t=0;t<this.m_nMips;t++)this.m_quad.material=this.m_separableBlurMaterials[t],this.m_separableBlurMaterials[t].uniforms.colorTexture.value=s.texture,this.m_separableBlurMaterials[t].uniforms.direction.value=o,e.setRenderTarget(this.m_renderTargetsHorizontal[t]),e.clear(),e.render(this.m_scene,this.m_camera),this.m_separableBlurMaterials[t].uniforms.colorTexture.value=this.m_renderTargetsHorizontal[t].texture,this.m_separableBlurMaterials[t].uniforms.direction.value=a,e.setRenderTarget(this.m_renderTargetsVertical[t]),e.clear(),e.render(this.m_scene,this.m_camera),s=this.m_renderTargetsVertical[t];this.m_quad.material=this.m_compositeMaterial,this.m_compositeMaterial.uniforms.bloomStrength.value=this.strength,this.m_compositeMaterial.uniforms.bloomRadius.value=this.radius,this.m_compositeMaterial.uniforms.bloomTintColors.value=this.m_bloomTintColors,e.setRenderTarget(this.m_renderTargetsHorizontal[0]),e.clear(),e.render(this.m_scene,this.m_camera),this.m_quad.material=this.m_materialCopy,this.m_copyUniforms.tDiffuse.value=this.m_renderTargetsHorizontal[0].texture,this.renderToScreen?(e.setRenderTarget(null),e.render(this.m_scene,this.m_camera)):(e.setRenderTarget(n),e.render(this.m_scene,this.m_camera))}getSeperableBlurMaterial(e){return new n.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new n.Vector2(.5,.5)},direction:{value:new n.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n            void main() {\n                vUv = uv;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n            }",fragmentShader:"#include <common>\n            varying vec2 vUv;\n            uniform sampler2D colorTexture;\n            uniform vec2 texSize;\n            uniform vec2 direction;\n\n            float gaussianPdf(in float x, in float sigma) {\n                return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n            }\n            void main() {\n                vec2 invSize = 1.0 / texSize;\n                float fSigma = float(SIGMA);\n                float weightSum = gaussianPdf(0.0, fSigma);\n                vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n                for( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n                    float x = float(i);\n                    float w = gaussianPdf(x, fSigma);\n                    vec2 uvOffset = direction * invSize * x;\n                    vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n                    vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n                    diffuseSum += (sample1 + sample2) * w;\n                    weightSum += 2.0 * w;\n                }\n                gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n            }"})}getCompositeMaterial(e){return new n.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                }",fragmentShader:"varying vec2 vUv;\n                uniform sampler2D blurTexture1;\n                uniform sampler2D blurTexture2;\n                uniform sampler2D blurTexture3;\n                uniform sampler2D blurTexture4;\n                uniform sampler2D blurTexture5;\n                uniform sampler2D dirtTexture;\n                uniform float bloomStrength;\n                uniform float bloomRadius;\n                uniform float bloomFactors[NUM_MIPS];\n                uniform vec3 bloomTintColors[NUM_MIPS];\n\n                float lerpBloomFactor(const in float factor) {\n                    float mirrorFactor = 1.2 - factor;\n                    return mix(factor, mirrorFactor, bloomRadius);\n                }\n\n                void main() {\n                    gl_FragColor = bloomStrength * (\nlerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\nlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\nlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\nlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\nlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n                }"})}}t.BloomPass=l},6906:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MSAASampling=t.MSAARenderPass=t.Pass=t.MapRenderingManager=void 0;var r=i(9034);Object.defineProperty(t,"MapRenderingManager",{enumerable:!0,get:function(){return r.MapRenderingManager}});var n=i(9445);Object.defineProperty(t,"Pass",{enumerable:!0,get:function(){return n.Pass}});var s=i(7233);Object.defineProperty(t,"MSAARenderPass",{enumerable:!0,get:function(){return s.MSAARenderPass}}),Object.defineProperty(t,"MSAASampling",{enumerable:!0,get:function(){return s.MSAASampling}})},1115:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyrightCoverageProvider=void 0;const r=i(2183),n=i(2519);t.CopyrightCoverageProvider=class{constructor(){this.logger=r.LoggerManager.instance.create("CopyrightCoverageProvider")}getTree(){return void 0!==this.m_cachedTreePromise||(this.m_cachedTreePromise=this.getCopyrightCoverageData().then((e=>this.initRBush(e))).catch((e=>(this.logger.error(e),new n)))),this.m_cachedTreePromise}async getCopyrights(e,t){const i=[],n=(await this.getTree()).search({minX:e.west,minY:e.south,maxX:e.east,maxY:e.north});for(const e of n){const n=r.getOptionValue(e.minLevel,0),s=r.getOptionValue(e.maxLevel,1/0);t>=n&&t<=s&&void 0===i.find((t=>t.id===e.label))&&i.push({id:e.label})}return i}initRBush(e){const t=new n;if(!e)return this.logger.warn("No copyright coverage data provided"),t;for(const i of e){const{minLevel:e,maxLevel:r,label:n,alt:s}=i;if(i.boxes)for(const o of i.boxes){const[i,a,l,c]=o;t.insert({minX:a,minY:i,maxX:c,maxY:l,minLevel:e,maxLevel:r,label:n,alt:s})}else t.insert({minX:-180,minY:-90,maxX:180,maxY:180,minLevel:e,maxLevel:r,label:n,alt:s})}return t}}},6636:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyrightElementHandler=void 0;const r=i(2183),n=i(5667),s=i(6450);class o{constructor(e,t){if(this.m_defaults=new Map,this.m_mapViews=[],this.update=()=>{var e;const t=this.m_mapViews.map((e=>e.copyrightInfo)).reduce(s.CopyrightInfo.mergeArrays,null!==(e=this.staticInfo)&&void 0!==e?e:[]);if(0===t.length)return void(this.m_element.style.display="none");if(this.m_element.style.display="block",0!==this.m_defaults.size)for(const e of t){const t=this.m_defaults.get(e.id);void 0!==t&&(e.year=r.getOptionValue(e.year,t.year),e.label=r.getOptionValue(e.label,t.label),e.link=r.getOptionValue(e.link,t.link))}const i=s.CopyrightInfo.mergeArrays(t);this.m_element.innerHTML=s.CopyrightInfo.formatAsHtml(i)},"string"==typeof e){const t=document.getElementById(e);if(!t)throw new Error(`CopyrightElementHandler: unable to find DOM element #${e}`);this.m_element=t}else this.m_element=e;void 0!==t&&this.attach(t)}static install(e,t){return new o(e,t)}destroy(){for(const e of this.m_mapViews)e.removeEventListener(n.MapViewEventNames.CopyrightChanged,this.update)}attach(e){return this.m_mapViews.push(e),e.addEventListener(n.MapViewEventNames.CopyrightChanged,this.update),this.update(),this}detach(e){return e.removeEventListener(n.MapViewEventNames.CopyrightChanged,this.update),this.m_mapViews=this.m_mapViews.filter((t=>t!==e)),this.update(),this}setDefaults(e){if(this.m_defaults.clear(),void 0!==e)for(const t of e)this.m_defaults.set(t.id,t);return this}setStaticCopyightInfo(e){return this.staticInfo=e,this}}t.CopyrightElementHandler=o},6450:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyrightInfo=void 0;const r=i(2183);var n;(n=t.CopyrightInfo||(t.CopyrightInfo={})).mergeArrays=function(e,t){const i=[];for(const n of[e,t])if(void 0!==n)for(const e of n){const t=i.find((t=>t.id===e.id||void 0!==t.label&&t.label===e.label));void 0===t?i.push(Object.assign({},e)):(t.year=r.MathUtils.max2(e.year,t.year),t.label=r.getOptionValue(e.label,t.label),t.link=r.getOptionValue(e.link,t.link))}return i},n.formatAsHtml=function(e){if(0===e.length)return"";const t=e.filter((e=>""!==e.label));return 0===t.length?"":"© "+t.map((e=>{var t;const i=null!==(t=e.label)&&void 0!==t?t:e.id,r=void 0!==e.year?`${e.year} ${i}`:i,n=e.link;return n?`<a href="${n}" target="_blank" rel="noreferrer noopener">${r}</a>`:`${r}`})).join(", ")}},8663:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6101:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UrlCopyrightProvider=void 0;const r=i(6919),n=i(1115);class s extends n.CopyrightCoverageProvider{constructor(e,t,i,n=r.TransferManager.instance()){super(),this.m_fetchURL=e,this.m_baseScheme=t,this.m_requestHeaders=i,this.m_transferManager=n}setRequestHeaders(e){this.m_requestHeaders=e}getCopyrightCoverageData(e){return void 0!==this.m_cachedCopyrightResponse||(this.m_cachedCopyrightResponse=this.m_transferManager.downloadJson(this.m_fetchURL,{headers:this.m_requestHeaders,signal:e}).then((e=>e[this.m_baseScheme])).catch((e=>(this.logger.error(e),[])))),this.m_cachedCopyrightResponse}}t.UrlCopyrightProvider=s},8944:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addGroundPlane=void 0;const r=i(3187),n=i(7771),s=i(7478),o=i(3139),a=i(284),l=i(4428),c=i(9777),h=i(6081),d=i(7339),u=new l.Vector3;function m(e,t,i){const r=e.getAttribute("position"),n=r.array,s=new Float32Array(n.length);for(let e=0;e<r.array.length;e+=1)u.fromBufferAttribute(r,e),i.projection.reprojectPoint(t,u,u).sub(i.center),u.toArray(s,3*e);r.array=s,r.needsUpdate=!0}t.addGroundPlane=function(e,t,i=e.mapView.clearColor,u=1,p=!1,f=e.mapView.shadowsEnabled,g=!1!==e.mapView.enableMixedLod){const v=function(e,t,i,r,d,u){const{dataSource:p,projection:f}=e,g=p.getTilingScheme().projection,v=f.type===o.ProjectionType.Spherical,_=!v,y="number"==typeof r?function(e,t,i,r){return t?new a.MapMeshStandardMaterial({color:e,visible:!0,depthWrite:i,removeDiffuseLight:!0,opacity:r}):new a.MapMeshBasicMaterial({color:e,visible:!0,depthWrite:i,opacity:r})}(new l.Color(r),i,f.type===o.ProjectionType.Spherical,u):r,x=function(e,t,i,r){const{dataSource:n,projection:s}=e,o=n.getTilingScheme().projection,a=new l.Vector3,c=new l.BufferGeometry,d=h.projectTilePlaneCorners(e,o),u=[d.sw,d.se,d.nw,d.ne];if(t)for(const t of u)s.reprojectPoint(o,t,t).sub(e.center);const m=t?new Float32Array(12):new Float64Array(12),p=new l.BufferAttribute(m,3).copyVector3sArray(u);if(c.setAttribute("position",p),r){o.surfaceNormal(d.sw,a).negate();const e=new l.BufferAttribute(new Float32Array(12),3).copyVector3sArray(Array(4).fill(a));c.setAttribute("normal",e)}if(c.setIndex(new l.BufferAttribute(new Uint16Array([0,1,2,2,1,3]),1)),i){const e=new l.BufferAttribute(new Float32Array([0,0,1,0,0,1,1,1]),2);c.setAttribute("uv",e)}return c}(e,_,t,i);if(!v)return new l.Mesh(x,y);const b=[],T=new s.SphericalGeometrySubdivisionModifier(l.MathUtils.degToRad(10),g);if(!d)return T.modify(x),m(x,g,e),new l.Mesh(x,y);for(let t=0;t<4;++t){const i=Math.pow(2,t),r=x.clone();i>1&&new n.EdgeLengthGeometrySubdivisionModifier(i,e.geoBox,n.SubdivisionMode.All,g).modify(r),T.modify(r),m(r,g,e),b.push(r)}return new c.LodMesh(b,y)}(e,p,f,i,g,u);return v.receiveShadow=f,v.renderOrder=t,d.registerTileObject(e,v,r.GeometryKind.Background,{pickability:r.Pickability.transient}),e.objects.push(v),v}},1419:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacedBufferAttribute=void 0;const r=i(2183),n=i(4428),s=i(5646);class o extends n.BufferAttribute{constructor(e,t,i,r){super(e.array,e.itemSize,e.normalized),this.originalAttribute=e,this.m_normals=t,this.m_uvs=i,this.m_textureWidth=0,this.m_textureHeight=0,this.m_cache=new s.VertexCache(o.MAX_CACHE_SIZE),this.m_lastPos=new n.Vector3,this.m_tmpNormal=new n.Vector3,this.resetTexture(r)}reset(e,t,i,r){this.array=e.array,this.itemSize=e.itemSize,this.count=this.array.length/this.itemSize,this.normalized=e.normalized,this.originalAttribute=e,this.m_normals=t,this.m_uvs=i,this.m_cache.clear(),this.m_lastBufferIndex=void 0,this.resetTexture(r)}getX(e){return this.getDisplacedCoordinate(e).x}getY(e){return this.getDisplacedCoordinate(e).y}getZ(e){return this.getDisplacedCoordinate(e).z}resetTexture(e){this.m_texture=new Float32Array(e.image.data.buffer),this.m_textureWidth=e.image.width,this.m_textureHeight=e.image.height}getDisplacedCoordinate(e){return e===this.m_lastBufferIndex||(this.m_lastBufferIndex=e,this.m_cache.get(e,this.m_lastPos)||(this.displacePosition(e),this.m_cache.set(e,this.m_lastPos))),this.m_lastPos}displacePosition(e){this.m_lastPos.fromBufferAttribute(this.originalAttribute,e);const t=this.m_normals;this.m_tmpNormal.fromBufferAttribute(t,e);const i=this.m_uvs,s=n.MathUtils.clamp(i.getX(e),0,1),o=n.MathUtils.clamp(i.getY(e),0,1),a=r.sampleBilinear(this.m_texture,this.m_textureWidth,this.m_textureHeight,s,o);this.m_lastPos.add(this.m_tmpNormal.multiplyScalar(a))}}t.DisplacedBufferAttribute=o,o.MAX_CACHE_SIZE=6},4503:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacedBufferGeometry=t.displaceBox=void 0;const r=i(4428),n=i(1419),s=new r.Vector3,o=new r.Vector3,a=new r.Box3;function l(e,t,i){a.copy(e);const r=s.copy(i),n=o.copy(r);return e.translate(r.multiplyScalar(t.min)).union(a.translate(n.multiplyScalar(t.max))),e}t.displaceBox=l;class c extends r.BufferGeometry{constructor(e,t,i,s){super(),this.originalGeometry=e,this.displacementRange=i,this.m_originalBoundingBox=new r.Box3,this.m_displacedPositions=s||new n.DisplacedBufferAttribute(e.attributes.position,e.attributes.normal,e.attributes.uv,t),this.resetAttributes()}reset(e,t,i){this.originalGeometry=e;const r=e.attributes.position,n=e.attributes.normal,s=e.attributes.uv;this.m_displacedPositions.reset(r,n,s,t);const o=this.displacementRange.min!==i.min||this.displacementRange.max!==i.max;this.displacementRange=i,this.resetAttributes(),this.resetBoundingVolumes(o)}computeBoundingBox(){null===this.originalGeometry.boundingBox&&this.originalGeometry.computeBoundingBox();const e=this.m_originalBoundingBox.copy(this.originalGeometry.boundingBox);null===this.boundingBox?this.boundingBox=e.clone():this.boundingBox.copy(e),l(this.boundingBox,this.displacementRange,s.fromBufferAttribute(this.attributes.normal,0))}computeBoundingSphere(){null===this.boundingBox&&this.computeBoundingBox(),null===this.boundingSphere&&(this.boundingSphere=new r.Sphere),this.boundingBox.getBoundingSphere(this.boundingSphere)}needsBoundingBoxUpdate(e){return e||null!==this.boundingBox&&(!this.originalGeometry.boundingBox||!this.m_originalBoundingBox.equals(this.originalGeometry.boundingBox))}resetBoundingVolumes(e){this.needsBoundingBoxUpdate(e)&&(this.computeBoundingBox(),this.boundingSphere&&this.computeBoundingSphere())}resetAttributes(){this.index=this.originalGeometry.index,this.groups=this.originalGeometry.groups,this.drawRange=this.originalGeometry.drawRange,this.attributes=Object.assign({},this.originalGeometry.attributes),this.attributes.position=this.m_displacedPositions}}t.DisplacedBufferGeometry=c},4800:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisplacedMesh=void 0;const r=i(284),n=i(2183),s=i(4428),o=i(1419),a=i(4503);class l extends s.Mesh{constructor(e,t,i,r){super(e,t),this.m_getDisplacementRange=i,this.m_raycastStrategy=r}static getDisplacedPositionAttribute(e,t){return l.displacedPositions?l.displacedPositions.reset(e.attributes.position,e.attributes.normal,e.attributes.uv,t):l.displacedPositions=new o.DisplacedBufferAttribute(e.attributes.position,e.attributes.normal,e.attributes.uv,t),l.displacedPositions}raycast(e,t){const i=this.firstMaterial;if(!function(e){const t=r.hasDisplacementFeature(e);return n.assert(t,"Material does not support displacement maps."),t}(i)||!function(e){if(!e)return!1;const t=e instanceof s.DataTexture;return n.assert(t,"Material does not support displacement maps."),t}(i.displacementMap))return void super.raycast(e,t);const o=i.displacementMap,c=Object.assign({},this.m_getDisplacementRange());n.assert(this.geometry instanceof s.BufferGeometry,"Unsupported geometry type.");const h=this.geometry;this.displacedGeometry?this.displacedGeometry.reset(h,o,c):this.displacedGeometry=new a.DisplacedBufferGeometry(h,o,c,l.getDisplacedPositionAttribute(h,o)),this.geometry=this.displacedGeometry,this.m_raycastStrategy?this.m_raycastStrategy(this,e,t):super.raycast(e,t),super.geometry=this.displacedGeometry.originalGeometry}get firstMaterial(){return Array.isArray(this.material)?this.material[0]:this.material}}t.DisplacedMesh=l},9777:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LodMesh=void 0;const r=i(4428);class n extends r.Mesh{constructor(e,t){super(void 0,t),this.geometries=e}set geometries(e){this.m_geometries!==e&&this.disposeGeometries(),this.m_geometries=e,this.geometries&&this.m_geometries.length>0&&(this.geometry=this.m_geometries[0])}get geometries(){return this.m_geometries}setLevelOfDetail(e){this.m_geometries&&0!==this.m_geometries.length&&(e=r.MathUtils.clamp(e,0,this.m_geometries.length-1),this.geometry=this.m_geometries[e])}disposeGeometries(){if(this.m_geometries)for(const e of this.m_geometries)e.dispose();this.geometry.dispose()}}t.LodMesh=n},6081:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.projectTilePlaneCorners=void 0;const r=i(3139),n=i(4428);t.projectTilePlaneCorners=function(e,t){const{east:i,west:s,north:o,south:a}=e.geoBox;return{sw:t.projectPoint(new r.GeoCoordinates(a,s),new n.Vector3),se:t.projectPoint(new r.GeoCoordinates(a,i),new n.Vector3),nw:t.projectPoint(new r.GeoCoordinates(o,s),new n.Vector3),ne:t.projectPoint(new r.GeoCoordinates(o,i),new n.Vector3)}}},7339:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerTileObject=void 0;const r=i(3668);t.registerTileObject=function(e,t,i,n){const s=i instanceof Set?Array.from(i.values()):Array.isArray(i)?i:[i];r.MapObjectAdapter.create(t,Object.assign({dataSource:e.dataSource,kind:s,level:e.tileKey.level},n)),void 0===t.userData&&(t.userData={});const o=t.userData;o.tileKey=e.tileKey,o.dataSource=e.dataSource.name,o.kind=s,e.resetVisibilityCounter()}},8121:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SolidLineMesh=void 0;const r=i(3139),n=i(284),s=i(2183),o=i(4428),a=i(4503),l=new o.Sphere,c=new o.Matrix4,h=new o.Ray,d=new o.Line3,u=new o.Box3,m=new r.OrientedBox3,p=new o.Plane,f=new o.Vector3,g=new o.Vector3,v=new o.Vector3,_=new o.Vector3;function y(e,t,i){let r;e instanceof a.DisplacedBufferGeometry&&(r=e.displacementRange,e=e.originalGeometry);const n=e.attributes.position,s=e.index.array,l=new o.Sphere,c=u.makeEmpty(),h=f;for(let e=t;e<i;e+=6)c.expandByPoint(h.fromBufferAttribute(n,s[e])),c.expandByPoint(h.fromBufferAttribute(n,s[e+2]));if(r){const t=g;return t.fromBufferAttribute(e.attributes.normal,0),a.displaceBox(c,r,t).getBoundingSphere(l)}return c.getBoundingSphere(l)}function x(e,t,i,r,n,s,a,l){if(a.equals(e.origin)&&0===e.direction.dot(s.normal)){const n=function(e,t,i,r,n){var s;const o=m;return t.getCenter(o.position),t.delta(o.xAxis).normalize(),o.yAxis.copy(i),o.zAxis.copy(r),o.extents.set(t.distance()/2,n,n),o.contains(e.origin)?0:null!==(s=o.intersectsRay(e))&&void 0!==s?s:1/0}(e,t,i,s.normal,r),a=function(e,t,i){const r=new o.Sphere(t.start,i),n=r.containsPoint(e.origin)?0:e.intersectSphere(r,_)?_.sub(e.origin).length():1/0;r.center.copy(t.end);const s=r.containsPoint(e.origin)?0:e.intersectSphere(r,_)?_.sub(e.origin).length():1/0;return Math.min(n,s)}(e,t,r),c=Math.min(n,a);return c!==1/0&&(e.at(c,l),!0)}return!(a.distanceToSquared(t.closestPointToPoint(a,!0,_))>n||(l.copy(a),0))}function b(e,t,i,r,n,s,o,a,c,h){const u=f,m=p,_=g,y=d,b=e.geometry,T=b.attributes,w=T.position,S=T.bitangent,M=b.index.array;if(l.copy(c),l.applyMatrix4(e.matrixWorld),l.radius+=r,t.ray.intersectsSphere(l))for(let r=o;r<a;r+=6){const o=M[r],a=M[r+2];if(y.start.fromBufferAttribute(w,o),y.end.fromBufferAttribute(w,a),u.set(S.getX(o),S.getY(o),S.getZ(o)).normalize(),m.setFromCoplanarPoints(y.start,v.copy(y.start).add(u),y.end),0===m.normal.manhattanLength())continue;if(!i.intersectPlane(m,_))continue;const l=v;if(!x(i,y,u,n,s,m,_,l))continue;const c=l.applyMatrix4(e.matrixWorld),d=t.ray.origin.distanceTo(c);d<t.near||d>t.far||h.push({distance:d,point:c.clone(),index:r,object:e})}}const T=[0],w=.01;function S(e,t,i,r,a,l,c){var h;const d=e.userData.feature.boundingVolumes;s.assert(e.geometry instanceof o.BufferGeometry,"Unsupported geometry type.");const u=e.geometry;s.assert(function(e){return Array.isArray(e)?e.every((e=>e instanceof n.SolidLineMaterial)):e instanceof n.SolidLineMaterial}(t),"Unsupported material type");const m=t,p=(m.lineWidth+m.outlineWidth)/2;s.assert(Math.abs(1-e.scale.x/e.scale.y)<w),s.assert(Math.abs(1-e.scale.x/e.scale.z)<w),s.assert(Math.abs(1-e.scale.y/e.scale.z)<w);const f=p/((e.scale.x+e.scale.y+e.scale.z)/3),g=f*f,v=null!==(h=e.userData.feature.starts)&&void 0!==h?h:T;let _=a,x=v[_];const S=v.length-1;for(;x<l;){const t=_,n=_<S?v[++_]:l;t>=d.length&&d.push(y(u,x,n)),b(e,i,r,p,f,g,x,n,d[t],c),x=n}return _}class M extends o.Mesh{static raycast(e,t,i){s.assert(e.geometry instanceof o.BufferGeometry,"Unsupported geometry type");const r=e.geometry;s.assert(null!==r.index,"Geometry does not have indices");const n=e.matrixWorld;c.copy(n).invert();const a=h.copy(t.ray).applyMatrix4(c);void 0===e.userData.feature&&(e.userData.feature={});const l=r.attributes.position,d=e.userData.feature.attributeInfo;(void 0===d||void 0===e.userData.feature.boundingVolumes||function(e,t){const i=!0===e.isBufferAttribute?e:e.data;return void 0===t||t.data!==i||e.isBufferAttribute&&t.version!==i.version}(l,d))&&(e.userData.feature.boundingVolumes=[],e.userData.feature.attributeInfo=function(e){const t=!0===e.isBufferAttribute?e:e.data;return{data:t,version:t.version}}(l));const u=r.index.array;if(Array.isArray(e.material)){let n=0;for(const s of r.groups)n=S(e,e.material[s.materialIndex],t,a,n,s.start+s.count,i)}else S(e,e.material,t,a,0,u.length,i)}constructor(e,t){super(e,t)}raycast(e,t){M.raycast(this,e,t)}}t.SolidLineMesh=M},4840:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileDataAccessor=void 0;const r=i(3187),n=i(2183),s=i(7180),o=n.LoggerManager.instance.create("TileDataAccessor");t.TileDataAccessor=class{constructor(e,t,i){this.tile=e,this.visitor=t;const r=!0===i.wantsAll;this.m_wantsPoints=r||!(!1===i.wantsPoints),this.m_wantsLines=r||!(!1===i.wantsLines),this.m_wantsAreas=r||!(!1===i.wantsAreas),this.m_wantsObject3D=r||!(!1===i.wantsObject3D)}visitAll(){const e=this.tile.objects;for(const t of e)this.visitObject(t)}visitObject(e){const t=void 0!==e.userData?e.userData.feature:void 0;if(void 0===t||void 0!==t.objInfos&&1===t.objInfos.length&&!this.visitor.wantsFeature(r.getFeatureId(t.objInfos[0])))return;const i=t.geometryType;if(void 0===i)return void o.warn("#visitObject: visiting object failed, no geometryType",e);switch(n.assert(void 0!==t.objInfos,"featureData.ids missing"),n.assert(void 0!==t.starts,"featureData.starts missing"),n.assert(Array.isArray(t.starts),"featureData.starts is not an array"),void 0!==t.objInfos&&void 0!==t.starts&&n.assert(t.objInfos.length===t.starts.length,"featureData.ids and featureData.starts have unequal length"),i){case r.GeometryType.Point:case r.GeometryType.Text:if(!this.m_wantsPoints)return;break;case r.GeometryType.SolidLine:case r.GeometryType.ExtrudedLine:case r.GeometryType.TextPath:if(!this.m_wantsLines)return;break;case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:if(!this.m_wantsAreas)return;break;case r.GeometryType.Object3D:if(!this.m_wantsObject3D)return;break;default:o.warn("#visitObject: invalid geometryType")}if("Mesh"!==e.type)return void o.warn("#visitObject: visiting object failed, not of type 'Mesh'",e);const s=e;this.visitMesh(s,t)}getBufferGeometry(e){const t=e.geometry;if("BufferGeometry"!==t.type)return void o.warn("#visitObject: object does not have BufferGeometry");const i=t;if(i.getAttribute("position"))return i;o.warn("#visitLines: BufferGeometry has no position attribute")}getGeometryAccessor(e,t,i){switch(e){case r.GeometryType.Point:case r.GeometryType.Text:return;case r.GeometryType.SolidLine:case r.GeometryType.ExtrudedLine:case r.GeometryType.TextPath:return new s.BufferedGeometryLineAccessor(t,e,i);case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:return;case r.GeometryType.Object3D:return new s.BufferedGeometryObject3dAccessor(t,e,i);default:o.warn("#getGeometryAccessor: invalid geometryType")}}getIndexedGeometryAccessor(e,t,i){switch(e){case r.GeometryType.Point:case r.GeometryType.Text:return;case r.GeometryType.SolidLine:case r.GeometryType.ExtrudedLine:case r.GeometryType.TextPath:return new s.IndexedBufferedGeometryLineAccessor(t,e,i);case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:case r.GeometryType.Object3D:return;default:o.warn("#getIndexedGeometryAccessor: invalid geometryType")}}visitMesh(e,t){const{objInfos:i,starts:a}=t,l=t.geometryType;if(void 0===i||void 0===a||void 0===l)return;let c;for(let t=0;t<i.length;t++){const h=r.getFeatureId(i[t]);if(!this.visitor.wantsFeature(h))continue;const d=a[t];let u=-1;if(void 0===c){const t=this.getBufferGeometry(e);if(void 0===t)continue;if(c=null!==t.index?this.getIndexedGeometryAccessor(l,e,t):this.getGeometryAccessor(l,e,t),void 0===c){o.warn("#visitObject: no accessor geometryType",l);continue}}switch(u=t<a.length-1?a[t+1]:c.getCount(),c.setRange(d,u),l){case r.GeometryType.Point:case r.GeometryType.Text:this.visitor.visitPoint(h);break;case r.GeometryType.SolidLine:case r.GeometryType.ExtrudedLine:case r.GeometryType.TextPath:n.assert(s.isLineAccessor(c)),this.visitor.visitLine(h,c);break;case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:this.visitor.visitArea(h);break;case r.GeometryType.Object3D:n.assert(s.isObject3dAccessor(c)),this.visitor.visitObject3D(h,c);break;default:o.warn("#visitObject: invalid geometryType")}}}}},7180:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedBufferedGeometryLineAccessor=t.IndexedBufferedGeometryAccessor=t.BufferedGeometryObject3dAccessor=t.BufferedGeometryLineAccessor=t.BufferedGeometryAccessor=t.BufferedGeometryAccessorBase=t.isObject3dAccessor=t.isLineAccessor=void 0;const r=i(3187),n=i(249),s=i(2183),o=s.LoggerManager.instance.create("TileGeometry");t.isLineAccessor=function(e){return"function"==typeof e.isLineAccessor&&!0===e.isLineAccessor()},t.isObject3dAccessor=function(e){return"function"==typeof e.isObject3dAccessor&&!0===e.isObject3dAccessor()};class a{constructor(e,t,i){this.object=e,this.geometryType=t,this.bufferGeometry=i,this.start=-1,this.end=-1,this.startCapSize=0,this.endCapSize=0,s.assert(!!e),"BufferGeometry"!==i.type&&o.error("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),s.assert("BufferGeometry"===i.type,"IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),this.position=this.bufferGeometry.getAttribute("position"),this.itemSize=this.position.itemSize,this.position||o.warn("BufferedGeometryAccessor#constructor: BufferGeometry has no position attribute"),this.position.array.constructor!==Float32Array&&o.warn("BufferedGeometryAccessor#constructor: BufferGeometry.position: unsupported ArrayBuffer")}getCount(){return this.position.count}get renderOrder(){return this.object.renderOrder}setRange(e,t,i=0,r=0){s.assert(e>=0),s.assert(t>=0),s.assert(e<=t),this.start=e,this.end=t,this.startCapSize=i,this.endCapSize=r}get color(){const e=e=>{const t=e;if("MeshBasicMaterial"===t.type||"MeshStandardMaterial"===t.type)return t.color;if("RawShaderMaterial"===t.type){const t=e;if("SolidLineMaterial"===t.name)return t.uniforms.diffuse.value;o.warn("BufferedGeometryAccessor#color: unknown shader material name",t.name)}else o.warn("BufferedGeometryAccessor#color: unknown material type",t.type)};if(Array.isArray(this.object.material)){const t=new Array,i=this.object.material;for(const r of i)t.push(e(r));return t}return e(this.object.material)}}t.BufferedGeometryAccessorBase=a;class l extends a{constructor(e,t,i,r){super(e,t,i),this.object=e,this.geometryType=t,this.bufferGeometry=i,this.stride=r}clear(){s.assert(this.checkSetUp(),"BufferedGeometryAccessor not setup");const e=this.position.array,t=this.start*this.itemSize,i=this.end*this.itemSize;for(let r=t;r<i;r++)e[r]=0;this.position.needsUpdate=!0}getVertices(){s.assert(this.checkSetUp(),"BufferedGeometryAccessor not setup");const e=this.start,t=this.end;return this.position.array.subarray(e*this.itemSize,t*this.itemSize)}checkSetUp(){return void 0!==this.position&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.position.count&&this.start<=this.end}}t.BufferedGeometryAccessor=l,t.BufferedGeometryLineAccessor=class extends l{constructor(e,t,i){super(e,t,i,3),this.object=e,this.geometryType=t,this.bufferGeometry=i}isLineAccessor(){return!0}get width(){s.assert(this.checkSetUp(),"RoBufferedGeometryLineAccessor not setup")}},t.BufferedGeometryObject3dAccessor=class extends l{constructor(e,t,i){super(e,t,i,1),this.object=e,this.geometryType=t,this.bufferGeometry=i}isObject3dAccessor(){return!0}getVertices(){return super.getVertices()}};class c extends a{constructor(e,t,i,r,n){super(e,t,i),this.object=e,this.geometryType=t,this.bufferGeometry=i,this.indices=null!==this.bufferGeometry.index?this.bufferGeometry.index.array:void 0,this.indices?this.indices instanceof Uint32Array||(o.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry index has wrong type"),s.assert(this.indices instanceof Uint32Array)):(o.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has no index"),s.assert(!!this.indices))}getCount(){return this.indices.length}checkSetUp(){return!!this.indices&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.indices.length&&this.start<=this.end}}t.IndexedBufferedGeometryAccessor=c,t.IndexedBufferedGeometryLineAccessor=class extends c{constructor(e,t,i){super(e,t,i,3),this.object=e,this.geometryType=t,this.bufferGeometry=i}isLineAccessor(){return!0}get width(){if(s.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup"),this.geometryType===r.GeometryType.ExtrudedLine){const e=this.start+this.startCapSize,t=this.position.array;return n.reconstructLineWidth(t,e)}}clear(){s.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");const e=this.start,t=this.end;for(let i=e;i<t;i++)this.indices[i]=0;null!==this.bufferGeometry.index&&(this.bufferGeometry.index.needsUpdate=!0)}getVertices(){s.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");const e=this.itemSize,t=this.start,i=this.end,r=new Float32Array((i-t)*e),n=this.position.array;if(2===e)for(let s=t,o=0;s<i;s++,o+=e){const t=this.indices[s];r[o+0]=n[t*e+0],r[o+1]=n[t*e+1]}if(3===e)for(let s=t,o=0;s<i;s++,o+=e){const t=this.indices[s];r[o+0]=n[t*e+0],r[o+1]=n[t*e+1],r[o+2]=n[t*e+2]}else for(let s=t,o=0;s<i;s++,o++){const t=this.indices[s];for(let i=0;i<e;i++)r[o*e+i]=n[t*e+i]}return r}}},4035:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileGeometryCreator=void 0;const r=i(3187),n=i(3139),s=i(284),o=i(2183),a=i(4428),l=i(2084),c=i(1233),h=i(3220),d=i(4073),u=i(8246),m=i(8944),p=i(7339),f=o.LoggerManager.instance.create("TileGeometryCreator"),g=new a.Vector3,v=new a.Vector2;class _{constructor(){this.bufferAttributes=new Map,this.interleavedAttributes=new Map}}class y extends r.CallExpr{constructor(e){super("memo",[e]),this.m_cachedProperties=[],this.m_deps=Array.from(e.dependencies().properties),this.descriptor=this}call(e){let t=!1;return this.m_deps.forEach(((i,r)=>{const n=e.env.lookup(i);t||n===this.m_cachedProperties[r]||(t=!0),t&&(this.m_cachedProperties[r]=n)})),(t||void 0===this.m_cachedValue)&&(this.m_cachedValue=e.evaluate(this.args[0])),this.m_cachedValue}}class x{constructor(e,t,i){this.geometry=e,this.info=t,this.cache=i}getBufferAttribute(e){if(this.cache.bufferAttributes.has(e))return this.cache.bufferAttributes.get(e);const t=l.getBufferAttribute(e);return this.cache.bufferAttributes.set(e,t),t}getInterleavedBufferAttributes(e){const t=this.cache.interleavedAttributes.get(e);if(t)return t;const i=new(r.getArrayConstructor(e.type))(e.buffer),n=new a.InterleavedBuffer(i,e.stride),s=e.attributes.map((e=>{const t=new a.InterleavedBufferAttribute(n,e.itemSize,e.offset,!1);return{name:e.name,attribute:t}}));return this.cache.interleavedAttributes.set(e,s),s}}function b(e,t){if(Array.isArray(e)){const i=e;t.push(...i)}else t.push(e)}class T{constructor(){}static get instance(){return this.m_instance||(this.m_instance=new T)}initDecodedTile(e,t,i){for(const r of e.techniques){const e=r.kind;void 0===e||e instanceof Set&&0===e.size?r._kindState=!0:r._kindState=!(void 0!==i&&i.hasOrIntersects(e))||void 0!==t&&t.hasOrIntersects(e)}for(const t of e.geometries)for(const e of t.groups)e.createdOffsets=[]}createAllGeometries(e,t){const i=e=>!1!==e._kindState;this.createObjects(e,t,i),this.preparePois(e,t),this.createTextElements(e,t,(e=>!!(r.isPoiTechnique(e)||r.isLineMarkerTechnique(e)||r.isTextTechnique(e))&&i(e))),this.createLabelRejectionElements(e,t),e.dataSource.addGroundPlane&&e.projection.type===n.ProjectionType.Planar&&m.addGroundPlane(e,-1)}createLabelRejectionElements(e,t){if(void 0!==t.pathGeometries)for(const i of t.pathGeometries)e.addBlockingElement(new d.PathBlockingElement(i.path))}processTechniques(e,t,i){const n=e.decodedTile;if(void 0===n)return;this.initDecodedTile(n,t,i);const s=e.dataSource.exprPool;n.techniques.forEach((e=>{for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];if(r.isJsonExpr(i)&&"kind"!==t)try{let n=r.Expr.fromJSON(i);!0!==n.dependencies().volatile&&(n=new y(r.Expr.fromJSON(i))),e[t]=n.intern(s)}catch(e){f.error("Failed to compile expression:",e)}}}))}prepareTextPaths(e,t,i){const n=new Array,s=e.slice();for(;s.length>0;){const e=s.pop();if(void 0===e)break;const o=t.techniques[e.technique];r.isTextTechnique(o)&&(void 0===i||i(o))&&n.push(e)}return n}createTextElements(e,t,i){var n;const s=e.mapView,o=e.computeWorldOffsetX(),l=Math.floor(s.zoomLevel),c=new r.MapEnv({$zoom:l},s.env),h=new u.TextElementBuilder(c,e.textStyleCache,e.dataSource.dataSourceOrder);if(void 0!==t.textPathGeometries){const n=this.prepareTextPaths(t.textPathGeometries,t,i);for(const s of n){const n=t.techniques[s.technique];if(!1===n._kindState||!r.isTextTechnique(n)||void 0!==i&&!i(n))continue;const l=[];for(let e=0;e<s.path.length;e+=3)l.push(new a.Vector3(s.path[e]+o,s.path[e+1],s.path[e+2]));const c=h.withTechnique(n).build(s.text,l,e.offset,s.objInfos,s.pathLengthSqr);e.addTextElement(c)}}if(void 0!==t.textGeometries)for(const s of t.textGeometries){if(void 0===s.technique||void 0===s.stringCatalog)continue;const l=t.techniques[s.technique];if(!1===l._kindState||!r.isTextTechnique(l)||void 0!==i&&!i(l))continue;const c=new a.BufferAttribute(new Float32Array(s.positions.buffer),s.positions.itemCount),d=c.count;if(!(d<1)){h.withTechnique(l);for(let t=0;t<d;++t){const i=c.getX(t)+o,r=c.getY(t),l=c.getZ(t),d=s.stringCatalog[s.texts[t]];if(void 0===d)continue;const u=null===(n=s.objInfos)||void 0===n?void 0:n[t],m=new a.Vector3(i,r,l),p=h.build(d,m,e.offset,u);e.addTextElement(p)}}}}createObjects(e,t,i){var d,u,m,f,_,y;const x=e.mapView,T=[],w=[],S=x.animatedExtrusionHandler,M=e.dataSource,E=Math.floor(x.zoomLevel),P=new r.MapEnv({$zoom:E},x.env),C=e.objects,A=x.viewRanges,L=void 0!==x.elevationProvider;for(const E of this.getAttachments(t)){const R=E.geometry,D=E.info.groups,O=D.length;for(let F=0;F<O;){const I=D[F++],U=I.start,V=I.technique,k=t.techniques[V];if(void 0===I.createdOffsets&&(I.createdOffsets=[]),I.createdOffsets.includes(e.offset)||!1===k._kindState||void 0!==i&&!i(k))continue;let j=I.count;for(I.createdOffsets.push(e.offset);F<O&&D[F].technique===V&&U+j===D[F].start;++F)j+=D[F].count,D[F].createdOffsets.push(e.offset);if(!l.usesObject3D(k))continue;const N=null!==(d=null==S?void 0:S.setAnimationProperties(k,P))&&void 0!==d&&d;let B=T[V];if(void 0===B){const t=t=>{M.requestUpdate(),void 0!==t&&e.addOwnedTexture(t)};if(B=l.createMaterial(x.renderer.capabilities,{technique:k,env:x.env,fog:null!==x.scene.fog,shadowsEnabled:x.shadowsEnabled},t),void 0===B)continue;N&&s.hasExtrusionFeature(B)&&b(B,w),T[V]=B}const z=k.kind;r.isTerrainTechnique(k)&&this.setupTerrainMaterial(k,B,e.mapView.clearColor);const G=new a.BufferGeometry;null===(u=R.vertexAttributes)||void 0===u||u.forEach((e=>{const t=E.getBufferAttribute(e);G.setAttribute(e.name,t)})),null===(m=R.interleavedVertexAttributes)||void 0===m||m.forEach((e=>{E.getInterleavedBufferAttributes(e).forEach((({name:e,attribute:t})=>G.setAttribute(e,t)))}));const W=null!==(f=E.info.index)&&void 0!==f?f:R.index;if(W&&G.setIndex(E.getBufferAttribute(W)),!G.getAttribute("normal")&&r.needsVertexNormals(k)&&G.computeVertexNormals(),G.addGroup(U,j),r.isSolidLineTechnique(k)){o.assert(!s.isHighPrecisionLineMaterial(B));const t=B;!0===k.clipping&&e.projection.type===n.ProjectionType.Planar&&(e.boundingBox.getSize(g),v.set(g.x,g.y),t.clipTileSize=v),G.getAttribute("color")&&s.setShaderMaterialDefine(t,"USE_COLOR",!0)}const q=r.isSolidLineTechnique(k)&&void 0!==k.secondaryWidth,H=r.Expr.isExpr(k.enabled)&&R.featureStarts&&R.featureStarts.length>0,K=l.buildObject(k,G,H?[B]:B,e,L);if(K.renderOrder=r.getPropertyValue(k.renderOrder,x.env),void 0!==E.info.uuid&&(K.uuid=E.info.uuid,K.userData.geometryId=E.info.uuid),(r.isCirclesTechnique(k)||r.isSquaresTechnique(k))&&void 0!==k.enablePicking&&(K.enableRayTesting=k.enablePicking),r.isLineTechnique(k)||r.isSegmentsTechnique(k)){const e=this.getFadingParams(P,k);s.FadingFeature.addRenderHelper(K,A,e.fadeNear,e.fadeFar,!1)}if(r.isSolidLineTechnique(k)){const e=this.getFadingParams(P,k);s.FadingFeature.addRenderHelper(K,A,e.fadeNear,e.fadeFar,!1)}if(r.isExtrudedLineTechnique(k)&&void 0!==k.fadeFar){const e=this.getFadingParams(x.env,k);s.FadingFeature.addRenderHelper(K,A,e.fadeNear,e.fadeFar,!0)}if(this.addUserData(e,R,k,K),r.isExtrudedPolygonTechnique(k)?(K.castShadow=x.shadowsEnabled,K.receiveShadow=x.shadowsEnabled):(r.isStandardTechnique(k)||r.isFillTechnique(k))&&(K.receiveShadow=x.shadowsEnabled),(r.isExtrudedPolygonTechnique(k)||r.isStandardTechnique(k)||r.isFillTechnique(k))&&void 0!==k.fadeFar){const e=this.getFadingParams(P,k);s.FadingFeature.addRenderHelper(K,A,e.fadeNear,e.fadeFar,!0)}if(r.isExtrudedPolygonTechnique(k)&&c.isRenderDepthPrePassEnabled(k,P)){const t=c.createDepthPrePassMesh(K);this.addUserData(e,R,k,t),p.registerTileObject(e,t,z,{technique:k,pickability:r.Pickability.transient}),C.push(t),N&&b(t.material,w),c.setDepthPrePassStencil(t,K)}const X=r.transientToPickability(r.getPropertyValue(k.transient,x.env));if(p.registerTileObject(e,K,z,{technique:k,pickability:q?r.Pickability.transient:X}),C.push(K),r.isExtrudedPolygonTechnique(k)&&void 0!==E.info.edgeIndex){const t=r.Expr.isExpr(k.enabled)&&R.edgeFeatureStarts&&R.edgeFeatureStarts.length>0,i=k,n=new a.BufferGeometry;n.setAttribute("position",G.getAttribute("position"));const o=G.getAttribute("color");void 0!==o&&n.setAttribute("color",o);const l=G.getAttribute("extrusionAxis");void 0!==l&&n.setAttribute("extrusionAxis",l);const c=G.getAttribute("normal");void 0!==c&&n.setAttribute("normal",c);const d=G.getAttribute("uv");void 0!==d&&n.setAttribute("uv",d),n.setIndex(E.getBufferAttribute(E.info.edgeIndex));const u=k,m=this.getPolygonFadingParams(P,u),f={color:m.color,colorMix:m.colorMix,fadeNear:m.lineFadeNear,fadeFar:m.lineFadeFar,extrusionRatio:N?0:void 0,vertexColors:!!G.getAttribute("color"),rendererCapabilities:x.renderer.capabilities},g=new s.EdgeMaterial(f),v=new a.LineSegments(n,t?[g]:g);this.addUserData(e,R,k,v),v.renderOrder=K.renderOrder+.1,s.FadingFeature.addRenderHelper(v,A,m.lineFadeNear,m.lineFadeFar,!1),N&&b(v.material,w),p.registerTileObject(e,v,z,{technique:k,pickability:r.Pickability.transient}),h.MapMaterialAdapter.create(g,{color:i.lineColor,objectColor:i.color,opacity:i.opacity,lineWidth:e=>{const t=r.getPropertyValue(i.lineWidth,e.env);return"number"==typeof t?a.MathUtils.clamp(t,0,1):0}}),C.push(v)}if(r.isExtrudedPolygonTechnique(k)&&N&&(K.customDepthMaterial=new s.MapMeshDepthMaterial({depthPacking:a.RGBADepthPacking}),b(K.customDepthMaterial,w)),r.isFillTechnique(k)&&E.info.edgeIndex){const t=r.Expr.isExpr(k.enabled)&&R.edgeFeatureStarts&&R.edgeFeatureStarts.length>0,i=new a.BufferGeometry;i.setAttribute("position",G.getAttribute("position")),i.setIndex(E.getBufferAttribute(E.info.edgeIndex));const n=k,o=this.getPolygonFadingParams(x.env,n),l={color:o.color,colorMix:o.colorMix,fadeNear:o.lineFadeNear,fadeFar:o.lineFadeFar,vertexColors:!!G.getAttribute("color"),rendererCapabilities:x.renderer.capabilities},c=new s.EdgeMaterial(l),d=new a.LineSegments(i,t?[c]:c);d.renderOrder=K.renderOrder+.1,s.FadingFeature.addRenderHelper(d,A,o.lineFadeNear,o.lineFadeFar,!1),this.addUserData(e,R,k,d),p.registerTileObject(e,d,z,{technique:k,pickability:X}),h.MapMaterialAdapter.create(c,{color:n.lineColor,objectColor:n.color,opacity:n.opacity}),C.push(d)}if(q){const t=k,i=B.clone();l.applyBaseColorToMaterial(i,i.color,t,null!==(_=t.secondaryColor)&&void 0!==_?_:0,P),void 0!==t.secondaryCaps&&(i.caps=r.getPropertyValue(t.secondaryCaps,x.env));const n=l.buildObject(k,G,i,e,L);n.renderOrder=(null!==(y=r.getPropertyValue(t.secondaryRenderOrder,x.env))&&void 0!==y?y:0)-1e-7,this.addUserData(e,R,k,n);const o=this.getFadingParams(P,k);s.FadingFeature.addRenderHelper(n,A,o.fadeNear,o.fadeFar,!1);const a=l.buildMetricValueEvaluator(t.secondaryWidth,t.metricUnit);p.registerTileObject(e,n,z,{technique:k});const c=h.MapMaterialAdapter.get(B),d=h.MapMaterialAdapter.create(i,{color:t.secondaryColor,opacity:t.opacity,caps:t.secondaryCaps,lineWidth:e=>{if(!c)return;c.ensureUpdated(e);const t=c.currentStyledProperties.lineWidth,i=r.getPropertyValue(a,x.env),n=d.currentStyledProperties.opacity;return"number"==typeof t&&"number"==typeof i?i<=t&&(null==n||1===n)?0:i:0}});C.push(n)}}}w.length>0&&x.animatedExtrusionHandler.add(e,w)}preparePois(e,t){void 0!==t.poiGeometries&&e.mapView.poiManager.addPois(e,t)}*getAttachments(e){const t=new _;for(const i of e.geometries){const e={index:i.index,edgeIndex:i.edgeIndex,uuid:i.uuid,groups:i.groups};if(yield new x(i,e,t),i.attachments)for(const e of i.attachments)yield new x(i,e,t)}}setupTerrainMaterial(e,t,i){if(!e.map||!e.displacementMap){const e=t;return e.color.set(i),void s.setDisplacementMapToMaterial(null,e)}t.onBeforeCompile=e=>{e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>","#include <map_pars_fragment>\n    uniform sampler2D displacementMap;\n    uniform float displacementScale;\n    uniform float displacementBias;"),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#ifdef USE_MAP\n    float minElevation = ${n.EarthConstants.MIN_ELEVATION.toFixed(1)};\n    float maxElevation = ${n.EarthConstants.MAX_ELEVATION.toFixed(1)};\n    float elevationRange = maxElevation - minElevation;\n\n    float disp = texture2D( displacementMap, vUv ).x * displacementScale + displacementBias;\n    vec4 texelColor = texture2D( map, vec2((disp - minElevation) / elevationRange, 0.0) );\n    texelColor = mapTexelToLinear( texelColor );\n    diffuseColor *= texelColor;\n#endif`),e.vertexShader=e.vertexShader.replace("#include <displacementmap_vertex>","")},t.displacementMap.needsUpdate=!0}addUserData(e,t,i,n){if(r.isTerrainTechnique(i)){o.assert(0===Object.keys(n.userData).length,"Unexpected user data in terrain object"),o.assert("object"==typeof t.objInfos[0],"Wrong attribute map type for terrain geometry");const i=t.objInfos[0],r={tileKey:e.tileKey,texture:new a.DataTexture(i.buffer,i.xCountVertices,i.yCountVertices,a.LuminanceFormat,a.FloatType),displacementMap:i,geoBox:e.geoBox};n.userData=r}else{const e="LineSegments"===n.type&&(r.isExtrudedPolygonTechnique(i)||r.isFillTechnique(i)),s={geometryType:t.type,starts:e?t.edgeFeatureStarts:t.featureStarts,objInfos:t.objInfos};n.userData.feature=s,n.userData.technique=i}}getFadingParams(e,t){return{fadeNear:void 0!==t.fadeNear?r.getPropertyValue(t.fadeNear,e):s.FadingFeature.DEFAULT_FADE_NEAR,fadeFar:void 0!==t.fadeFar?r.getPropertyValue(t.fadeFar,e):s.FadingFeature.DEFAULT_FADE_FAR}}getPolygonFadingParams(e,t){let i,n=s.EdgeMaterial.DEFAULT_COLOR_MIX;if(void 0!==t.lineColor&&(i=r.getPropertyValue(t.lineColor,e),r.isExtrudedPolygonTechnique(t))){const e=t;n=void 0!==e.lineColorMix?e.lineColorMix:s.EdgeMaterial.DEFAULT_COLOR_MIX}const o=void 0!==t.fadeNear?r.getPropertyValue(t.fadeNear,e):s.FadingFeature.DEFAULT_FADE_NEAR,a=void 0!==t.fadeFar?r.getPropertyValue(t.fadeFar,e):s.FadingFeature.DEFAULT_FADE_FAR,l=void 0!==t.lineFadeNear?r.getPropertyValue(t.lineFadeNear,e):o,c=void 0!==t.lineFadeFar?r.getPropertyValue(t.lineFadeFar,e):a;return void 0===i&&(i=s.EdgeMaterial.DEFAULT_COLOR),{color:i,colorMix:n,fadeNear:o,fadeFar:a,lineFadeNear:l,lineFadeFar:c}}}t.TileGeometryCreator=T},869:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileGeometryLoader=t.TileGeometryLoaderState=void 0;const r=i(3187),n=i(2183),s=i(5667),o=i(5005),a=i(4035);function l(e){const t=o.PerformanceStatistics.instance;if(t.enabled){const i=e.dataSource.name,r=e.tileKey.level,n=e.tileKey.column,s=e.tileKey.row,o=e.disposed?"disposed":"invisible";t.currentFrame.addMessage(`Decoded tile: ${i} # lvl=${r} col=${n} row=${s} DISCARDED - ${o}`)}}var c;!function(e){e[e.Initialized=0]="Initialized",e[e.CreationQueued=1]="CreationQueued",e[e.CreatingGeometry=2]="CreatingGeometry",e[e.Finished=3]="Finished",e[e.Canceled=4]="Canceled",e[e.Disposed=5]="Disposed"}(c=t.TileGeometryLoaderState||(t.TileGeometryLoaderState={}));class h{constructor(e,t){this.m_tile=e,this.m_taskQueue=t,this.m_priority=0,this.m_state=c.Initialized,this.m_finishedPromise=new Promise(((e,t)=>{this.m_resolveFinishedPromise=e,this.m_rejectFinishedPromise=t}))}static prepareAvailableGeometryKinds(e){const t=new r.GeometryKindSet;for(const i of e.techniques){const e=h.compileGeometryKind(i);if(e instanceof Set)for(const i of e)t.add(i);else t.add(e)}return t}static compileGeometryKind(e){let t=e.kind;return void 0===t?(t=r.isFillTechnique(e)?r.GeometryKind.Area:r.isLineTechnique(e)||r.isSolidLineTechnique(e)||r.isSegmentsTechnique(e)||r.isExtrudedLineTechnique(e)?r.GeometryKind.Line:r.isExtrudedPolygonTechnique(e)?r.GeometryKind.Building:r.isPoiTechnique(e)||r.isLineMarkerTechnique(e)||r.isTextTechnique(e)?r.GeometryKind.Label:r.GeometryKind.All,e.kind=t):Array.isArray(t)&&(t=e.kind=new r.GeometryKindSet(t)),t}set priority(e){this.m_priority=e}getPriority(){return this.m_priority}get tile(){return this.m_tile}get hasDecodedTile(){return void 0!==this.m_decodedTile}get isFinished(){return this.m_state===c.Finished}get isSettled(){return this.isFinished||this.isCanceled||this.isDisposed}waitFinished(){return this.m_finishedPromise}setDecodedTile(e){return this.m_decodedTile=e,this.hasDecodedTile&&(this.m_availableGeometryKinds=h.prepareAvailableGeometryKinds(this.m_decodedTile)),this.m_decodedTile}get availableGeometryKinds(){return this.m_availableGeometryKinds}update(e,t){const i=this.tile;this.tile.hasGeometry&&!this.compareGeometryKinds(e,t)&&this.reset(),this.m_state!==c.Initialized&&this.m_state!==c.Canceled||void 0===i.decodedTile||(this.m_state===c.Initialized&&(a.TileGeometryCreator.instance.processTechniques(i,e,t),this.setGeometryKinds(e,t),this.setDecodedTile(i.decodedTile)),this.queueGeometryCreation(e,t))}cancel(){var e;l(this.tile),this.m_state=c.Canceled,null===(e=this.m_rejectFinishedPromise)||void 0===e||e.call(this)}dispose(){var e;l(this.tile),this.clear(),this.m_state=c.Disposed,null===(e=this.m_rejectFinishedPromise)||void 0===e||e.call(this)}reset(){this.clear(),this.isSettled&&(this.m_finishedPromise=new Promise(((e,t)=>{this.m_resolveFinishedPromise=e,this.m_rejectFinishedPromise=t}))),this.m_state=c.Initialized}finish(){var e;this.m_decodedTile=void 0,this.m_state=c.Finished,null===(e=this.m_resolveFinishedPromise)||void 0===e||e.call(this)}clear(){var e,t,i;null===(e=this.m_availableGeometryKinds)||void 0===e||e.clear(),null===(t=this.m_enabledKinds)||void 0===t||t.clear(),null===(i=this.m_disabledKinds)||void 0===i||i.clear(),this.m_decodedTile=void 0}queueGeometryCreation(e,t){this.m_state!==c.CreationQueued&&(this.m_taskQueue.add({execute:this.createGeometry.bind(this,e,t),group:s.TileTaskGroups.CREATE,getPriority:this.getPriority.bind(this),isExpired:()=>this.m_state!==c.CreationQueued,estimatedProcessTime:()=>{var e,t;return(null!==(t=null===(e=this.tile.decodedTile)||void 0===e?void 0:e.decodeTime)&&void 0!==t?t:30)/6}}),this.m_state=c.CreationQueued)}createGeometry(e,t){if(this.m_state===c.CreatingGeometry)return;this.m_state=c.CreatingGeometry;const i=this.tile,r=this.m_decodedTile;if(void 0===r)return void this.finish();const s=o.PerformanceStatistics.instance;let l=0;s.enabled&&(l=n.PerformanceTimer.now());const h=a.TileGeometryCreator.instance;i.clear(),h.initDecodedTile(r,e,t),h.createAllGeometries(i,r),s.enabled&&this.addStats(s,l),this.finish(),i.dataSource.requestUpdate()}addStats(e,t){const i=this.tile,r=this.m_decodedTile;if(void 0===r)return;const s=n.PerformanceTimer.now()-t,o=e.currentFrame;o.addValue("render.fullFrameTime",s),o.addValue("render.geometryCreationTime",s),o.addValue("geometry.geometryCreationTime",s),o.addValue("geometryCount.numGeometries",r.geometries.length),o.addValue("geometryCount.numTechniques",r.techniques.length),o.addValue("geometryCount.numPoiGeometries",void 0!==r.poiGeometries?r.poiGeometries.length:0),o.addValue("geometryCount.numTextGeometries",void 0!==r.textGeometries?r.textGeometries.length:0),o.addValue("geometryCount.numTextPathGeometries",void 0!==r.textPathGeometries?r.textPathGeometries.length:0),o.addValue("geometryCount.numPathGeometries",void 0!==r.pathGeometries?r.pathGeometries.length:0),o.addMessage(`Decoded tile: ${i.dataSource.name} # lvl=${i.tileKey.level} col=${i.tileKey.column} row=${i.tileKey.row}`)}setGeometryKinds(e,t){var i,n;void 0!==e&&(this.m_enabledKinds=Object.assign(null!==(i=this.m_enabledKinds)&&void 0!==i?i:new r.GeometryKindSet,e)),void 0!==t&&(this.m_disabledKinds=Object.assign(null!==(n=this.m_disabledKinds)&&void 0!==n?n:new r.GeometryKindSet,t))}compareGeometryKinds(e,t){const i=this.m_enabledKinds===e,r=this.m_disabledKinds===t;if(i&&r)return!0;const n=!(void 0!==this.m_enabledKinds&&0!==this.m_enabledKinds.size||void 0!==e&&0!==e.size),s=!(void 0!==this.m_disabledKinds&&0!==this.m_disabledKinds.size||void 0!==t&&0!==t.size);if(n&&s||i&&s||r&&n)return!0;if(!n){if(void 0===e||void 0===this.m_enabledKinds)return!1;if(!e.has(this.m_enabledKinds))return!1}if(!s){if(void 0===t||void 0===this.m_disabledKinds)return!1;if(!t.has(this.m_disabledKinds))return!1}return!0}get isCanceled(){return this.m_state===c.Canceled}get isDisposed(){return this.m_state===c.Disposed}}t.TileGeometryLoader=h},2737:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileGeometryManager=void 0;const r=i(3187),n=i(3668);t.TileGeometryManager=class{constructor(e){this.mapView=e,this.enableFilterByKind=!0,this.enabledKinds=new r.GeometryKindSet,this.disabledKinds=new r.GeometryKindSet,this.hiddenKinds=new r.GeometryKindSet,this.m_visibilityCounter=1}get enabledGeometryKinds(){return this.enabledKinds}set enabledGeometryKinds(e){this.enabledKinds=e}get disabledGeometryKinds(){return this.disabledKinds}set disabledGeometryKinds(e){this.disabledKinds=e}get hiddenGeometryKinds(){return this.hiddenKinds}set hiddenGeometryKinds(e){this.hiddenKinds=e,this.incrementVisibilityCounter()}get visibilityCounter(){return this.m_visibilityCounter}updateTiles(e){let t=0;for(const i of e){const e=t++;i.updateGeometry(e,this.enableFilterByKind?this.enabledGeometryKinds:void 0,this.enableFilterByKind?this.disabledGeometryKinds:void 0)&&this.m_tileUpdateCallback&&this.m_tileUpdateCallback(i)}this.updateTileObjectVisibility(e)&&this.mapView.update()}clear(){this.enabledKinds.clear(),this.disabledKinds.clear(),this.hiddenKinds.clear()}enableKind(e,t=!0){this.enableDisableKinds(this.enabledKinds,e,t)}disableKind(e,t=!0){this.enableDisableKinds(this.disabledKinds,e,t)}hideKind(e,t=!0){let i=!1;if(Array.isArray(e)||e instanceof Set)for(const r of e){const e=this.addRemove(this.hiddenKinds,r,t);i=i||e}else i=this.addRemove(this.hiddenKinds,e,t);i&&this.incrementVisibilityCounter()}getAvailableKinds(e){const t=new r.GeometryKindSet;for(const i of e){const e=i.loadedGeometryKinds;if(void 0!==e)for(const i of e)t.add(i)}return t}updateTileObjectVisibility(e){let t=!1;for(const i of e)if(0!==i.objects.length&&i.visibilityCounter!==this.visibilityCounter){i.visibilityCounter=this.visibilityCounter;for(const e of i.objects){const i=n.MapObjectAdapter.get(e),r=null==i?void 0:i.kind;if(void 0!==r){const i=!r.some((e=>this.hiddenKinds.has(e)));t=t||e.visible!==i,e.visible=i}}}return t}setTileUpdateCallback(e){this.m_tileUpdateCallback=e}incrementVisibilityCounter(){return++this.m_visibilityCounter}enableDisableKinds(e,t,i){if(Array.isArray(t))for(const r of t)this.addRemove(e,r,i);else if(t instanceof Set){const r=t;for(const t of r)this.addRemove(e,t,i)}else void 0!==t&&this.addRemove(e,t,i)}addRemove(e,t,i){if(i){if(!e.has(t))return e.add(t),!0}else if(e.has(t))return e.delete(t),!0;return!1}}},5646:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VertexCache=void 0;const r=i(2183);var n;!function(e){e[e.VertexId=0]="VertexId",e[e.OlderIdx=1]="OlderIdx",e[e.NewerIdx=2]="NewerIdx",e[e.X=3]="X",e[e.Y=4]="Y",e[e.Z=5]="Z",e[e.Count=6]="Count"}(n||(n={}));const s=-1;t.VertexCache=class{constructor(e){this.maxVertexCount=e,this.m_cache=[],this.m_vertexCount=0,this.m_oldestIdx=0,this.m_newestIdx=0,this.m_cache.length=this.maxVertexCount*n.Count,this.clear()}clear(){this.m_cache.fill(s),this.m_vertexCount=0}get(e,t){const i=this.find(e);return void 0!==i&&(this.promoteEntry(i),this.getVertex(i,t),!0)}set(e,t){let i=s;this.m_vertexCount<this.maxVertexCount?(i=this.m_vertexCount*n.Count,this.m_vertexCount++):i=this.m_oldestIdx,1===this.m_vertexCount?this.m_oldestIdx=this.m_newestIdx=i:this.promoteEntry(i),this.setVertex(i,e,t)}find(e){const t=this.m_cache.length;for(let i=0;i<t;i+=n.Count)if(this.m_cache[i]===e)return i}promoteEntry(e){if(e===this.m_newestIdx)return;const t=this.getNewerIdx(e),i=this.getOlderIdx(e);t!==s&&(r.assert(this.getOlderIdx(t)===e),this.setOlderIdx(t,i)),i!==s&&(r.assert(this.getNewerIdx(i)===e),this.setNewerIdx(i,t)),e===this.m_oldestIdx&&(this.m_oldestIdx=t),this.setNewerIdx(e,s),this.setOlderIdx(e,this.m_newestIdx),r.assert(this.m_newestIdx!==s),r.assert(this.getNewerIdx(this.m_newestIdx)===s),this.setNewerIdx(this.m_newestIdx,e),this.m_newestIdx=e}getOlderIdx(e){return this.m_cache[e+n.OlderIdx]}setOlderIdx(e,t){this.m_cache[e+n.OlderIdx]=t}getNewerIdx(e){return this.m_cache[e+n.NewerIdx]}setNewerIdx(e,t){this.m_cache[e+n.NewerIdx]=t}getVertex(e,t){t.x=this.m_cache[e+n.X],t.y=this.m_cache[e+n.Y],t.z=this.m_cache[e+n.Z]}setVertex(e,t,i){this.m_cache[e]=t,this.m_cache[e+n.X]=i.x,this.m_cache[e+n.Y]=i.y,this.m_cache[e+n.Z]=i.z}}},4111:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.overlayOnElevation=t.overlayTextElement=void 0;const r=i(3187),n=i(284),s=i(2183);function o(e,t){if(!("material"in e))return;const i=n.setDisplacementMapToMaterial.bind(null,t),r=e.material;Array.isArray(r)?r.forEach(i):r&&i(r)}function a(e,t,i,r){const n=r.unprojectPoint(e);if(i.geoBox.contains(n))n.altitude=t.sampleHeight(n,i);else if(n.altitude=t.getHeight(n,i.tileKey.level),void 0===n.altitude)return!1;return r.projectPoint(n,e),!0}t.overlayTextElement=function(e,t,i,r){s.assert(!e.elevated),i&&(e.elevated=e.path?function(e,t,i,r){for(const n of e)if(!a(n,t,i,r))return!1;return!0}(e.path,t,i,r):a(e.position,t,i,r))},t.overlayOnElevation=function(e){const t=e.mapView.elevationProvider;if(void 0===t||0===e.objects.length)return;const i=e.objects[0];if(!i.userData||!i.userData.kind||!i.userData.kind.find((e=>e!==r.GeometryKind.All&&e!==r.GeometryKind.Terrain)))return;const n=t.getDisplacementMap(e.tileKey);if(void 0!==n)for(const t of e.objects)o(t,n.texture)}},7805:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageItem=void 0;const r=i(2183),n=i(4428),s=i(7811),o=r.LoggerManager.instance.create("loadImage"),a=new s.MipMapGenerator;t.ImageItem=class{constructor(e,t){this.url=e,this.image=t}get loaded(){return void 0!==this.image&&void 0!==this.mipMaps}get loading(){return void 0!==this.loadingPromise}loadImage(){return this.loaded?Promise.resolve(this):(this.loading||(this.loadingPromise=new Promise(((e,t)=>{if(this.image){const i=this.image;i instanceof HTMLImageElement&&!i.complete?(i.addEventListener("load",this.finalizeImage.bind(this,i,e)),i.addEventListener("error",t)):this.finalizeImage(this.image,e)}else o.debug(`Loading image: ${this.url}`),!0===this.cancelled?(o.debug(`Cancelled loading image: ${this.url}`),e(void 0)):(new n.ImageLoader).load(this.url,(t=>{if(!0===this.cancelled)return o.debug(`Cancelled loading image: ${this.url}`),void e(void 0);this.finalizeImage(t,e)}),void 0,(e=>{o.error(`... loading image failed: ${this.url} : ${e}`),this.loadingPromise=void 0,t(`... loading image failed: ${this.url} : ${e}`)}))}))),this.loadingPromise)}finalizeImage(e,t){this.image=e,this.mipMaps=a.generateTextureAtlasMipMap(this),this.loadingPromise=void 0,t(this)}}},3714:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageCache=void 0;const r=i(7805);class n{constructor(){this.m_images=new Map}static get instance(){return void 0===n.m_instance&&(n.m_instance=new n),n.m_instance}static dispose(){n.m_instance=void 0}registerImage(e,t,i){let n=this.findImageCacheItem(t);return n?(void 0===e||n.owners.includes(e)||n.owners.push(e),n.imageItem):(n={imageItem:new r.ImageItem(t,i),owners:[e]},this.m_images.set(t,n),n.imageItem)}removeImage(e,t){const i=this.m_images.get(e);return void 0!==i&&(this.unlinkCacheItem(i,t),!0)}findImage(e){const t=this.m_images.get(e);if(void 0!==t)return t.imageItem}clear(e){this.m_images.forEach((t=>{this.unlinkCacheItem(t,e)}))}get size(){return this.m_images.size}findImageCacheItem(e){return this.m_images.get(e)}cancelLoading(e){e.loading&&(e.cancelled=!0)}unlinkCacheItem(e,t){const i=e.owners.indexOf(t);i>=0&&e.owners.splice(i,1),0===e.owners.length&&(this.m_images.delete(e.imageItem.url),this.cancelLoading(e.imageItem))}}t.ImageCache=n},4894:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewImageCache=void 0;const r=i(2183),n=i(3714);t.MapViewImageCache=class{constructor(){this.m_name2Url=new Map,this.m_urlNameCount=new Map}addImage(e,t,i=!0){if("string"==typeof t){const r=t,n=this.registerImage(e,r);return i?n.loadImage():n}const r=t;return this.registerImage(e,void 0,r)}removeImage(e){const t=this.m_name2Url.get(e);if(void 0!==t){this.m_name2Url.delete(e);let i=1;if(e!==t){const e=this.m_urlNameCount.get(t);r.assert(void 0!==e),i=e,r.assert(i>0)}return i>1?this.m_urlNameCount.set(t,i-1):(this.m_urlNameCount.delete(t),n.ImageCache.instance.removeImage(t,this)),!0}return!1}findImageByName(e){const t=this.m_name2Url.get(e);if(void 0!==t)return n.ImageCache.instance.findImage(t)}clear(){n.ImageCache.instance.clear(this),this.m_name2Url.clear(),this.m_urlNameCount.clear()}registerImage(e,t,i){var s;if(this.hasName(e))throw new Error("duplicate name in cache");if(void 0===t&&(r.assert(void 0!==i),t=e),t!==e){const e=null!==(s=this.m_urlNameCount.get(t))&&void 0!==s?s:0;this.m_urlNameCount.set(t,e+1)}return this.m_name2Url.set(e,t),n.ImageCache.instance.registerImage(this,t,i)}hasName(e){return void 0!==this.m_name2Url.get(e)}}},7811:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MipMapGenerator=void 0;const r=i(4428),n="undefined"==typeof window;class s{constructor(){n||(this.m_paddingCanvas=document.createElement("canvas"),this.m_paddingContext=this.m_paddingCanvas.getContext("2d"),this.m_resizeCanvas=document.createElement("canvas"),this.m_resizeContext=this.m_resizeCanvas.getContext("2d"))}static getPaddedSize(e,t){return{width:r.MathUtils.ceilPowerOfTwo(e),height:r.MathUtils.ceilPowerOfTwo(t)}}generateTextureAtlasMipMap(e){if(n)throw new Error("MipMapGenerator only works in browser.");if(void 0===e.image)throw new Error("Can not generate mip maps. Image data not loaded!");const t=e.image,i=[],{width:r,height:o}=s.getPaddedSize(t.width,t.height);this.copyImageWithPadding(t,r,o),i.push(this.m_paddingContext.getImageData(0,0,r,o));let a=.5*r,l=.5*o;for(;a>=1||l>=1;){const e=i[i.length-1];i.push(this.resizeImage(e,Math.max(a,1),Math.max(l,1))),a*=.5,l*=.5}return i}copyImageWithPadding(e,t,i){return this.m_paddingCanvas.width=t,this.m_paddingCanvas.height=i,this.m_paddingContext.clearRect(0,0,t,i),e instanceof ImageData?this.m_paddingContext.putImageData(e,0,0):this.m_paddingContext.drawImage(e,0,0),e.width!==t&&this.m_paddingContext.drawImage(this.m_paddingCanvas,e.width-1,0,1,e.height,e.width,0,t-e.width,e.height),e.height!==i&&this.m_paddingContext.drawImage(this.m_paddingCanvas,0,e.height-1,t,1,0,e.height,t,i-e.height),this.m_paddingCanvas}resizeImage(e,t,i){const r=this.copyImageWithPadding(e,e.width,e.height);return this.m_resizeCanvas.width=t,this.m_resizeCanvas.height=i,this.m_resizeContext.clearRect(0,0,t,i),this.m_resizeContext.drawImage(r,0,0,t,i),this.m_resizeContext.getImageData(0,0,t,i)}}t.MipMapGenerator=s},8063:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BoxBuffer=t.BoxBufferMesh=void 0;const r=i(2183),n=i(4428),s=i(7467);class o extends n.Mesh{constructor(e,t){super(e,t),this.type="BoxBufferMesh"}get isEmpty(){if(void 0===this.geometry)return!0;{const e=this.geometry;return null===e.index||0===e.index.count}}}t.BoxBufferMesh=o;class a{constructor(e,t=0,i=0,r=32768){this.m_material=e,this.m_renderOrder=t,this.m_maxElementCount=r,this.m_size=0,this.resizeBuffer(i),this.m_pickInfos=new Array}clone(){return new a(this.m_material,this.m_renderOrder)}dispose(){void 0!==this.m_geometry&&(this.m_geometry.dispose(),this.m_geometry=void 0),this.m_mesh=void 0}get size(){return this.m_size}reset(){void 0!==this.m_positionAttribute&&(this.m_positionAttribute.count=0,this.m_colorAttribute.count=0,this.m_uvAttribute.count=0,this.m_indexAttribute.count=0,this.m_pickInfos.length=0)}canAddElements(e=1){const t=this.m_indexAttribute;if(t.count+6*e>=t.array.length){if(t.array.length>=6*this.m_maxElementCount)return!1;const e=Math.min(this.m_maxElementCount,0===this.size?256:2*this.size);this.resize(e)}return!0}saveState(){return{positionAttributeCount:this.m_positionAttribute.count,colorAttributeCount:this.m_colorAttribute.count,uvAttributeCount:this.m_uvAttribute.count,indexAttributeCount:this.m_indexAttribute.count,pickInfoCount:this.m_pickInfos.length}}restoreState(e){this.m_positionAttribute.count=e.positionAttributeCount,this.m_colorAttribute.count=e.colorAttributeCount,this.m_uvAttribute.count=e.uvAttributeCount,this.m_indexAttribute.count=e.indexAttributeCount,this.m_pickInfos.length=e.pickInfoCount}addBox(e,t,i,r,n,s){if(!this.canAddElements())return!1;const{s0:o,t0:a,s1:l,t1:c}=t,{x:h,y:d,w:u,h:m}=e,p=Math.round(i.r*r*255),f=Math.round(i.g*r*255),g=Math.round(i.b*r*255),v=Math.round(255*r),_=this.m_positionAttribute,y=this.m_colorAttribute,x=this.m_uvAttribute,b=this.m_indexAttribute,T=_.count,w=b.count;return _.setXYZ(T,h,d,n),_.setXYZ(T+1,h+u,d,n),_.setXYZ(T+2,h,d+m,n),_.setXYZ(T+3,h+u,d+m,n),y.setXYZW(T,p,f,g,v),y.setXYZW(T+1,p,f,g,v),y.setXYZW(T+2,p,f,g,v),y.setXYZW(T+3,p,f,g,v),x.setXY(T,o,a),x.setXY(T+1,l,a),x.setXY(T+2,o,c),x.setXY(T+3,l,c),b.setX(w,T),b.setX(w+1,T+1),b.setX(w+2,T+2),b.setX(w+3,T+2),b.setX(w+4,T+1),b.setX(w+5,T+3),_.count+=4,y.count+=4,x.count+=4,b.count+=6,this.m_pickInfos.push(s),!0}updateBufferGeometry(){const e=this.m_positionAttribute,t=this.m_colorAttribute,i=this.m_uvAttribute,r=this.m_indexAttribute;e.count>0&&(e.needsUpdate=!0,e.updateRange.offset=0,e.updateRange.count=4*e.count),t.count>0&&(t.needsUpdate=!0,t.updateRange.offset=0,t.updateRange.count=4*t.count),i.count>0&&(i.needsUpdate=!0,i.updateRange.offset=0,i.updateRange.count=4*i.count),r.count>0&&(r.needsUpdate=!0,r.updateRange.offset=0,r.updateRange.count=r.count),void 0!==this.m_geometry&&(this.m_geometry.clearGroups(),this.m_geometry.addGroup(0,this.m_indexAttribute.count))}cleanUp(){0===this.m_indexAttribute.count&&this.size>0&&this.clearAttributes()}get isEmpty(){return this.m_mesh.isEmpty}get mesh(){return void 0===this.m_mesh&&this.resize(),this.m_mesh}pickBoxes(e,t,i){const n=this.m_pickInfos.length,s=this.m_pickInfos,o=this.m_positionAttribute,a=e.x,l=e.y;for(let e=0;e<n;e++){const n=4*e,c=o.getX(n);if(a<c)continue;const h=o.getX(n+1);if(a>h)continue;const d=o.getY(n);if(l<d)continue;const u=o.getY(n+2);if(l>u)continue;const m=new r.Math2D.Box(c,d,h-c,u-d);void 0!==i&&void 0!==s[e].poiInfo&&void 0!==s[e].poiInfo.uvBox&&this.isPixelTransparent(i,a,l,m,s[e].poiInfo.uvBox,document.createElement("canvas"))||void 0!==s[e]&&t(s[e])}}resize(e,t){return void 0!==this.m_geometry&&this.m_geometry.dispose(),this.m_geometry=new n.BufferGeometry,void 0!==e&&(!0===t||e>this.size)&&this.resizeBuffer(e),this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setIndex(this.m_indexAttribute),this.m_geometry.addGroup(0,this.m_indexAttribute.count),void 0===this.m_mesh?(this.m_mesh=new o(this.m_geometry,this.m_material),this.m_mesh.renderOrder=this.m_renderOrder):this.m_mesh.geometry=this.m_geometry,this.m_mesh}updateMemoryUsage(e){const t=3*this.m_positionAttribute.count*4+4*this.m_colorAttribute.count+4*this.m_uvAttribute.count*4+4*this.m_indexAttribute.count;e.heapSize+=t,e.gpuSize+=t}isPixelTransparent(e,t,i,r,n,o){const{u:a,v:l}=s.screenToUvCoordinates(t,i,r,n),{width:c,height:h}=e instanceof SVGImageElement?e.getBBox():e,d=c*a,u=h*l,m=s.getPixelFromImage(d,u,e,o);return void 0!==m&&0===m[3]}clearAttributes(){this.m_positionAttribute=void 0,this.m_colorAttribute=void 0,this.m_uvAttribute=void 0,this.m_indexAttribute=void 0,this.resize(0,!0)}resizeBuffer(e){const t=new Float32Array(4*e*3);if(void 0!==this.m_positionAttribute&&this.m_positionAttribute.array.length>0){const e=this.m_positionAttribute.count;t.set(this.m_positionAttribute.array),this.m_positionAttribute.array=t,this.m_positionAttribute.count=e}else this.m_positionAttribute=new n.BufferAttribute(t,3),this.m_positionAttribute.count=0,this.m_positionAttribute.setUsage(n.DynamicDrawUsage);const i=new Uint8Array(4*e*4);if(void 0!==this.m_colorAttribute){const e=this.m_colorAttribute.count;i.set(this.m_colorAttribute.array),this.m_colorAttribute.array=i,this.m_colorAttribute.count=e}else this.m_colorAttribute=new n.BufferAttribute(i,4,!0),this.m_colorAttribute.count=0,this.m_colorAttribute.setUsage(n.DynamicDrawUsage);const r=new Float32Array(4*e*4);if(void 0!==this.m_uvAttribute){const e=this.m_uvAttribute.count;r.set(this.m_uvAttribute.array),this.m_uvAttribute.array=r,this.m_uvAttribute.count=e}else this.m_uvAttribute=new n.BufferAttribute(r,4),this.m_uvAttribute.count=0,this.m_uvAttribute.setUsage(n.DynamicDrawUsage);const s=6*e*1,o=s>65535?new Uint32Array(s):new Uint16Array(s);if(void 0!==this.m_indexAttribute){const e=this.m_indexAttribute.count;o.set(this.m_indexAttribute.array),this.m_indexAttribute.array=o,this.m_indexAttribute.count=e}else this.m_indexAttribute=new n.BufferAttribute(o,1),this.m_indexAttribute.count=0,this.m_indexAttribute.setUsage(n.DynamicDrawUsage);this.m_size=e}}t.BoxBuffer=a},7467:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPixelFromImageData=t.getPixelFromCanvasImageSource=t.screenToUvCoordinates=t.getPixelFromImage=void 0;const r=i(2183);function n(e,t,i,r){const{width:n,height:s}=e instanceof SVGImageElement?e.getBBox():e;if(t>n||t<0||i>s||i<0)return;let o;r.width=n,r.height=s;const a=r.getContext("2d");return null!==a&&(a.drawImage(e,0,0),o=a.getImageData(t,i,1,1).data),o}function s(e,t,i,r){if(!(t>e.width||t<0||i>e.height||i<0))return((e,t,i)=>{const r=t*i,n=e.data,s=new Uint8ClampedArray(i);for(let e=0;e<i;e++)s[0]=n[r+e];return s})(e,i*e.width+t,r)}t.getPixelFromImage=function(e,t,i,r){return i instanceof ImageData?s(i,e,t,i.data.length/(i.height*i.width)):(r||(r=document.createElement("canvas")),n(i,e,t,r))},t.screenToUvCoordinates=function(e,t,i,n){const s=i.x,o=i.x+i.w,a=i.y,l=i.y+i.h;return{u:r.MathUtils.map(e,s,o,n.s0,n.s1),v:r.MathUtils.map(t,a,l,n.t0,n.t1)}},t.getPixelFromCanvasImageSource=n,t.getPixelFromImageData=s},8459:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PoiBuilder=void 0;const r=i(3187),n=i(2183),s=i(7365),o=n.LoggerManager.instance.create("PoiBuilder");t.PoiBuilder=class{constructor(e){this.m_env=e}withTechnique(e){var t,i,n,s,o,a,l,c;return this.m_imageTextureName=function(e,t){return void 0!==e.imageTexture?r.composeTechniqueTextureName(r.getPropertyValue(e.imageTexture,t),e):void 0}(e,this.m_env),this.m_iconMinZoomLevel=null!==(i=r.getPropertyValue(null!==(t=e.iconMinZoomLevel)&&void 0!==t?t:e.minZoomLevel,this.m_env))&&void 0!==i?i:void 0,this.m_iconMaxZoomLevel=null!==(s=r.getPropertyValue(null!==(n=e.iconMaxZoomLevel)&&void 0!==n?n:e.maxZoomLevel,this.m_env))&&void 0!==s?s:void 0,this.m_textMinZoomLevel=null!==(a=r.getPropertyValue(null!==(o=e.textMinZoomLevel)&&void 0!==o?o:e.minZoomLevel,this.m_env))&&void 0!==a?a:void 0,this.m_textMaxZoomLevel=null!==(c=r.getPropertyValue(null!==(l=e.textMaxZoomLevel)&&void 0!==l?l:e.maxZoomLevel,this.m_env))&&void 0!==c?c:void 0,this.m_technique=e,this}withIcon(e,t){return void 0!==e&&(this.m_imageTextureName=e),this.m_shieldGroupIndex=t,this}build(e){var t,i,a,l,c;n.assert(void 0!==this.m_technique);const h=this.m_technique,d=this.m_env,u=this.m_imageTextureName,m=void 0!==h.poiTable?null!==(t=h.poiName)&&void 0!==t?t:u:void 0;if(void 0!==u&&void 0!==m&&o.warn("Possible duplicate POI icon definition via imageTextureName and poiTable!"),void 0===u&&void 0===m)return e.minZoomLevel=null!==(i=e.minZoomLevel)&&void 0!==i?i:this.m_textMinZoomLevel,void(e.maxZoomLevel=null!==(a=e.maxZoomLevel)&&void 0!==a?a:this.m_textMaxZoomLevel);const p=!0===h.textIsOptional,f=!0===h.iconIsOptional,g=!(!1===h.renderTextDuringMovements),v=null!==(l=h.iconMayOverlap)&&void 0!==l?l:h.textMayOverlap,_=null!==(c=h.iconReserveSpace)&&void 0!==c?c:h.textReserveSpace,y=r.getPropertyValue(h.iconColor,d),x=null!==y?s.ColorCache.instance.getColor(y):void 0;return{technique:h,imageTextureName:u,poiTableName:h.poiTable,poiName:m,shieldGroupIndex:this.m_shieldGroupIndex,textElement:e,textIsOptional:p,iconIsOptional:f,renderTextDuringMovements:g,mayOverlap:v,reserveSpace:_,iconBrightness:h.iconBrightness,iconColor:x,iconMinZoomLevel:this.m_iconMinZoomLevel,iconMaxZoomLevel:this.m_iconMaxZoomLevel,textMinZoomLevel:this.m_textMinZoomLevel,textMaxZoomLevel:this.m_textMaxZoomLevel}}}},5295:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PoiManager=void 0;const r=i(3187),n=i(2183),s=i(4428),o=i(8246),a=n.LoggerManager.instance.create("PoiManager");function l(e,t=0){if(e.imageTextures){const i=e.imageTextures[t];if(i>=0)return n.assert(e.imageTextures.length>t),e.stringCatalog[i]}}function c(e,t=0){return e.objInfos?e.objInfos[t]:void 0}function h(e,t,i=0){const r=(new s.Vector3).fromBufferAttribute(e,i);return r.x+=t,r}function d(e,t=0){var i;n.assert(e.texts.length>t);const r=e.texts[t];return n.assert(e.stringCatalog.length>r),null!==(i=e.stringCatalog[r])&&void 0!==i?i:""}class u{constructor(e){this.mapView=e,this.m_imageTextures=new Map,this.m_poiShieldGroups=new Map}static notifyMissingPoiTable(e,t){void 0===e&&(e="undefined"),void 0===u.m_missingPoiTableName.get(e)&&(u.m_missingPoiTableName.set(e,!0),void 0===t||t.loadedOk?a.error(`updatePoiFromPoiTable: No POI table with name '${e}' found!`):a.error(`updatePoiFromPoiTable: Could not load POI table '${e}'!`))}static notifyMissingPoi(e,t){void 0===e&&(e="undefined");const i=`${t}[${e}]`;void 0===u.m_missingPoiName.get(i)&&(u.m_missingPoiName.set(i,!0),a.warn(`updatePoiFromPoiTable: Cannot find POI info for '${e}' in table '${t}'.`))}addPois(e,t){const i=n.assertExists(t.poiGeometries),a=e.computeWorldOffsetX(),l=e.mapView,c=Math.floor(l.zoomLevel),h=new r.MapEnv({$zoom:c},l.env),d=new o.TextElementBuilder(h,e.textStyleCache,e.dataSource.dataSourceOrder);for(const o of i){n.assert(void 0!==o.technique);const i=n.assertExists(o.technique),l=t.techniques[i];if(!1===l._kindState||!r.isLineMarkerTechnique(l)&&!r.isPoiTechnique(l))continue;if(!1===l.showOnMap)continue;const c=new s.BufferAttribute(new Float32Array(o.positions.buffer),o.positions.itemCount);d.withTechnique(l),r.isLineMarkerTechnique(l)&&c.count>0?this.addLineMarker(d,e,o,c,a):r.isPoiTechnique(l)&&this.addPoi(d,e,o,c,a)}}async addTextureAtlas(e,t,i){const r=await fetch(t,{signal:i});if(!r.ok)throw new Error(`addTextureAtlas: Cannot load textureAtlas: ${r.statusText}`);try{const i=await r.json();if(void 0===i)return void a.info(`addTextureAtlas: TextureAtlas empty: ${t}`);a.debug(`addTextureAtlas: Loading textureAtlas '${t}' for image '${e}'`);for(const t of Object.getOwnPropertyNames(i)){const r=i[t],n={name:t,image:e,xOffset:r.x,yOffset:r.y,width:r.width,height:r.height};this.addImageTexture(n)}this.mapView.update()}catch(e){a.error(`addTextureAtlas: Failed to load textureAtlas '${t}' : ${e}`)}}addImageTexture(e){void 0!==e.name?(void 0!==this.m_imageTextures.get(e.name)&&a.warn(`addImageTexture: Name already used: ${e.name} (overriding it)`),this.m_imageTextures.set(e.name,e)):a.error("addImageTexture: Name required",e)}getImageTexture(e){return this.m_imageTextures.get(e)}updatePoiFromPoiTable(e){var t,i,n,s,a,l;const c=e.poiInfo;if(!c||void 0===c.poiTableName||void 0===c.poiName)return!0;const h=c.poiTableName,d=this.mapView.poiTableManager.getPoiTable(h);if(d&&d.isLoading)return!1;if(c.poiTableName=void 0,!d||!d.loadedOk)return u.notifyMissingPoiTable(h,d),!0;const m=c.poiName,p=d.getEntry(m);return p?(void 0!==p.iconName&&p.iconName.length>0&&(c.imageTextureName=r.composeTechniqueTextureName(p.iconName,c.technique)),e.visible=null!==(t=p.visible)&&void 0!==t?t:e.visible,e.priority=null!==(i=p.priority)&&void 0!==i?i:e.priority,c.iconMinZoomLevel=null!==(n=p.iconMinLevel)&&void 0!==n?n:c.iconMinZoomLevel,c.iconMaxZoomLevel=null!==(s=p.iconMaxLevel)&&void 0!==s?s:c.iconMaxZoomLevel,c.textMinZoomLevel=null!==(a=p.textMinLevel)&&void 0!==a?a:c.textMinZoomLevel,c.textMaxZoomLevel=null!==(l=p.textMaxLevel)&&void 0!==l?l:c.textMaxZoomLevel,o.TextElementBuilder.alignZoomLevelRanges(e),!0):(u.notifyMissingPoi(m,h),!0)}clear(){this.m_imageTextures.clear(),this.m_poiShieldGroups.clear()}addLineMarker(e,t,i,r,n){const s=d(i),o=l(i),a=o+"-"+s;let u=this.m_poiShieldGroups.get(a);void 0===u&&(u=this.m_poiShieldGroups.size,this.m_poiShieldGroups.set(a,u));const m=[];for(let e=0;e<r.count;e+=3)m.push(h(r,n,e));const p=e.withIcon(o,u).build(s,m,t.offset,c(i));t.addTextElement(p)}addPoi(e,t,i,r,n){var s,o;for(let a=0;a<r.count;++a){const u=null!==(o=null===(s=i.offsetDirections)||void 0===s?void 0:s[a])&&void 0!==o?o:0,m=e.withIcon(l(i,a)).build(d(i,a),h(r,n,a),t.offset,c(i,a),void 0,u);t.addTextElement(m)}}}t.PoiManager=u,u.m_missingPoiTableName=new Map,u.m_missingPoiName=new Map},9580:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PoiRenderer=t.PoiBatchRegistry=t.PoiBuffer=void 0;const r=i(3187),n=i(284),s=i(2183),o=i(4428),a=i(7811),l=i(8063),c=s.LoggerManager.instance.create("PoiRenderer"),h=new o.Color(1,1,1),d=new o.Color;class u{constructor(e,t,i){this.buffer=e,this.layer=t,this.m_onDispose=i,this.m_refCount=0}increaseRefCount(){return++this.m_refCount,this}decreaseRefCount(){return s.assert(this.m_refCount>0),0==--this.m_refCount&&this.dispose(),this}dispose(){this.layer.scene.remove(this.buffer.mesh),this.buffer.dispose(),this.m_onDispose()}}t.PoiBuffer=u;class m{constructor(e,t,i){this.m_rendererCapabilities=e,this.imageItem=t,this.m_onDispose=i;const r=new o.Texture(this.imageItem.image,o.UVMapping,void 0,void 0,(m.trilinear,o.LinearFilter),m.trilinear?o.LinearMipMapLinearFilter:o.LinearFilter,o.RGBAFormat);m.trilinear&&this.imageItem.mipMaps&&(r.mipmaps=this.imageItem.mipMaps,r.image=r.mipmaps[0]),r.flipY=!1,r.premultiplyAlpha=!0,r.needsUpdate=!0,this.m_material=new n.IconMaterial({rendererCapabilities:this.m_rendererCapabilities,map:r}),this.m_poiBuffers=new Map}getBuffer(e){let t=this.m_poiBuffers.get(e.id);if(t)return t.increaseRefCount();const i=new l.BoxBuffer(this.m_material,e.id),r=i.mesh;return r.frustumCulled=!1,e.scene.add(r),t=new u(i,e,(()=>{this.disposeBuffer(e.id)})),this.m_poiBuffers.set(e.id,t),t.increaseRefCount()}reset(){for(const e of this.m_poiBuffers.values())e.buffer.reset()}update(){for(const e of this.m_poiBuffers.values())e.buffer.updateBufferGeometry()}pickBoxes(e,t,i){for(const r of this.m_poiBuffers.values())r.buffer.pickBoxes(e,t,i)}updateMemoryUsage(e){if(void 0!==this.imageItem.image){const t=this.imageItem.image.width*this.imageItem.image.height*4;e.heapSize+=t,e.gpuSize+=t}for(const t of this.m_poiBuffers.values())t.buffer.updateMemoryUsage(e)}dispose(){this.m_poiBuffers.clear(),this.m_material.map.dispose(),this.m_material.dispose(),this.m_onDispose()}disposeBuffer(e){s.assert(this.m_poiBuffers.size>0),this.m_poiBuffers.delete(e),0===this.m_poiBuffers.size&&this.dispose()}}m.trilinear=!0;class p{constructor(e){this.m_rendererCapabilities=e,this.m_batchMap=new Map}registerPoi(e,t){var i;const{imageItem:r,imageTexture:n}=e;if(!r)return void(e.isValid=!1);s.assert(void 0!==e.imageTextureName);const o=null!==(i=null==n?void 0:n.image)&&void 0!==i?i:e.imageTextureName;let a=this.m_batchMap.get(o);return void 0===a&&(a=new m(this.m_rendererCapabilities,r,(()=>{this.deleteBatch(o)})),this.m_batchMap.set(o,a)),a.getBuffer(t)}addPoi(e,t,i,r){if(!1===e.isValid||!e.buffer)return void c.warn("PoiBatchRegistry: trying to add poiInfo without buffer prepared: ",e.poiName);let n;s.assert(void 0!==e.uvBox),void 0!==e.iconBrightness?(n=d.setScalar(e.iconBrightness),void 0!==e.iconColor&&(n=d.multiply(e.iconColor))):n=void 0!==e.iconColor?e.iconColor:h,e.buffer.buffer.addBox(t,e.uvBox,n,r,i,e.textElement)}reset(){for(const e of this.m_batchMap.values())e.reset()}update(){for(const e of this.m_batchMap.values())e.update()}pickTextElements(e,t){for(const i of this.m_batchMap.values())i.pickBoxes(e,t,i.imageItem.image)}updateMemoryUsage(e){for(const t of this.m_batchMap.values())t.updateMemoryUsage(e)}deleteBatch(e){this.m_batchMap.delete(e)}}t.PoiBatchRegistry=p;const f=new Map;class g{constructor(e,t,i){this.m_renderer=e,this.m_poiManager=t,this.m_imageCaches=i,this.m_tempScreenBox=new s.Math2D.Box,this.m_layers=[],this.m_poiBatchRegistry=new p(this.renderer.capabilities)}static computeIconScreenBox(e,t,i,n,o=new s.Math2D.Box){s.assert(void 0!==e.buffer);const a=e.computedWidth*i,l=e.computedHeight*i,c=e.technique,h=r.getPropertyValue(c.iconXOffset,n),d=r.getPropertyValue(c.iconYOffset,n),u=t.x+("number"==typeof h?h:0)*i,m=t.y+("number"==typeof d?d:0)*i;return o.x=u-a/2,o.y=m-l/2,o.w=a,o.h=l,o}get renderer(){return this.m_renderer}prepareRender(e,t){const i=e.poiInfo;return void 0!==i&&(void 0===i.buffer&&this.preparePoi(e,t),void 0!==i.buffer)}reset(){this.m_poiBatchRegistry.reset()}addPoi(e,t,i,r,n,o,a,l){s.assert(void 0!==e.buffer),g.computeIconScreenBox(e,t,n,l,this.m_tempScreenBox),o&&i.allocate(this.m_tempScreenBox),a>0&&(e.buffer||this.preparePoi(e.textElement,l),this.m_poiBatchRegistry.addPoi(e,this.m_tempScreenBox,r,a))}update(){this.m_poiBatchRegistry.update()}addLayer(e){let t=this.getLayer(e);return void 0===t&&(t={id:e,scene:new o.Scene},this.m_layers.push(t),this.m_layers.sort(((e,t)=>e.id-t.id))),t}getLayer(e){return this.m_layers.find((t=>t.id===e))}get layers(){return this.m_layers}render(e,t){this.m_renderer.render(t.scene,e)}pickTextElements(e,t){this.m_poiBatchRegistry.pickTextElements(e,t)}getMemoryUsage(e){this.m_poiBatchRegistry.updateMemoryUsage(e)}preparePoi(e,t){const i=e.poiInfo;if(!i||!e.visible)return;if(void 0!==i.buffer||!1===i.isValid)return;if(void 0!==i.poiTableName){if(!this.m_poiManager.updatePoiFromPoiTable(e))return;if(!e.visible)return}const r=i.imageTextureName;if(void 0===r)return void(i.isValid=!1);const n=this.m_poiManager.getImageTexture(r),o=function(e,t,i){var r;s.assert(void 0!==e.imageTextureName);const n=e.imageTextureName;let o;for(const e of t)if(o=i?e.findImageByName(i.image):e.findImageByName(n),o)break;return o||(c.error(`init: No imageItem found with name\n            '${null!==(r=null==i?void 0:i.image)&&void 0!==r?r:n}'`),e.isValid=!1,void 0===f.get(n)&&(f.set(n,!0),c.error(`preparePoi: No imageTexture with name '${n}' found`))),o}(i,this.m_imageCaches,n);o&&(o.loaded?this.setupPoiInfo(i,o,t,n):o.loading||o.loadImage().then((e=>{(null==e?void 0:e.image)&&this.setupPoiInfo(i,e,t,n)})).catch((e=>{c.error(`preparePoi: Failed to load imageItem: '${o.url}`,e),i.isValid=!1})))}setupPoiInfo(e,t,i,n){if(s.assert(void 0===e.uvBox),!t.image)return c.error("setupPoiInfo: No imageItem/imageData found"),void(e.isValid=!1);const o=e.technique,l=t.image.width,h=t.image.height,d=a.MipMapGenerator.getPaddedSize(l,h),u=m.trilinear&&t.mipMaps,p=u?d.width:l,f=u?d.height:h,g=void 0!==(null==n?void 0:n.width)?n.width:l,v=void 0!==(null==n?void 0:n.height)?n.height:h,_=void 0!==(null==n?void 0:n.width)?n.width:l,y=void 0!==(null==n?void 0:n.height)?n.height:h,x=void 0!==(null==n?void 0:n.xOffset)?n.xOffset:0,b=void 0!==(null==n?void 0:n.yOffset)?n.yOffset:0,T=x/p,w=(x+_)/p,S=b/f,M=(b+y)/f;let E=void 0!==o.iconScale?o.iconScale:1,P=void 0!==o.iconScale?o.iconScale:1;const C=r.getPropertyValue(o.screenWidth,i);null!=C&&(P=E=C/g);const A=r.getPropertyValue(o.screenHeight,i);null!=A&&(P=A/v,void 0!==C&&(E=P)),e.computedWidth=g*E,e.computedHeight=v*P,e.uvBox={s0:T,t0:M,s1:w,t1:S},e.imageItem=t,e.imageTexture=n,e.buffer=this.m_poiBatchRegistry.registerPoi(e,this.addLayer(e.renderOrder)),e.isValid=!0}}t.PoiRenderer=g},5237:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PoiTableManager=t.PoiTable=void 0;const r=i(3187),n=i(2183).LoggerManager.instance.create("PoiTable");class s{static verifyJSON(e){let t="string"==typeof e.name&&e.name.length>0&&(void 0===e.altNames||Array.isArray(e.altNames))&&(void 0===e.stackMode||"yes"===e.stackMode||"no"===e.stackMode||"parent"===e.stackMode)&&(void 0===e.visible||"boolean"==typeof e.visible)&&(void 0===e.priority||"number"==typeof e.priority)&&(void 0===e.iconMinLevel||"number"==typeof e.iconMinLevel)&&(void 0===e.iconMaxLevel||"number"==typeof e.iconMaxLevel)&&(void 0===e.textMinLevel||"number"==typeof e.textMinLevel)&&(void 0===e.textMaxLevel||"number"==typeof e.textMaxLevel);if(t&&void 0!==e.altNames){const i=e.altNames;for(const e in i)if("string"!=typeof e){t=!1;break}}return t}setup(e){switch(this.name=e.name,this.altNames=e.altNames,this.iconName=e.iconName,this.visible=e.visible,this.priority=e.priority,this.iconMinLevel=e.iconMinLevel,this.iconMaxLevel=e.iconMaxLevel,this.textMinLevel=e.textMinLevel,this.textMaxLevel=e.textMaxLevel,e.stackMode){case"yes":this.stackMode=r.PoiStackMode.Show;break;case"no":this.stackMode=r.PoiStackMode.Hide;break;case"parent":this.stackMode=r.PoiStackMode.ShowParent}}}class o{constructor(e,t){this.name=e,this.useAltNamesForKey=t,this.poiList=new Array,this.poiDict=new Map,this.m_isLoading=!1,this.m_loadedOk=void 0}get isLoading(){return this.m_isLoading}get loadedOk(){return!0===this.m_loadedOk}getEntry(e){const t=this.poiDict.get(e);if(void 0!==t){if(t<this.poiList.length)return this.poiList[t];throw new Error("Poi table entry index out of stored list!")}}async load(e,t){if(void 0!==this.m_loadedOk)return!0;this.m_loadedOk=!1;const i=await fetch(e,{signal:t});if(!i.ok)throw new Error(`load: Cannot load POI table at ${e}: ${i.statusText}`);const r=await i.json();if(void 0===r)return n.info(`load: TextureAtlas empty: ${e}`),!0;this.startLoading();try{if(n.debug(`load: Loading POI table '${e}' for table '${this.name}'`),void 0!==r.poiList&&Array.isArray(r.poiList))for(const t of r.poiList)if(s.verifyJSON(t)){const i=new s;i.setup(t);const r=this.poiList.push(i)-1;if(this.useAltNamesForKey)if(void 0!==i.altNames&&i.altNames.length>0)for(const e of i.altNames)this.poiDict.set(e,r);else n.debug(`load: Invalid entry in POI table '${e}' : No alternative names set in entry: ${JSON.stringify(t)}.`);else void 0===i.name?n.warn(`load: Invalid entry in POI table '${e}' : . No name set in entry: ${t}.`):this.poiDict.set(i.name,r)}else n.warn(`load: Invalid entry in POI table '${e}' : ${JSON.stringify(t)}`);this.m_loadedOk=!0,this.finishedLoading()}catch(t){return n.error(`load: Failed to load POI table '${e}' : ${t}`),this.m_loadedOk=!1,this.finishedLoading(),!1}return!0}startLoading(){this.m_isLoading=!0}finishedLoading(){this.m_isLoading=!1}}t.PoiTable=o,t.PoiTableManager=class{constructor(e){this.mapView=e,this.m_isLoading=!1,this.m_poiTables=new Map,this.m_abortControllers=new Map}async loadPoiTables(e){return new Promise((t=>{if(this.clear(),void 0!==e){this.startLoading();const i=new Array;e.forEach((e=>{var t;if(void 0!==e&&void 0!==e.name&&"string"==typeof e.name){const r=new o(e.name,!1!==e.useAltNamesForKey);void 0!==e.url&&"string"==typeof e.url?(this.addTable(r),this.m_abortControllers.set(e.name,new AbortController),i.push(r.load(e.url,null===(t=this.m_abortControllers.get(e.name))||void 0===t?void 0:t.signal))):n.error(`POI table definition has no valid url: ${e}`)}else n.error(`POI table definition has no valid name: ${e}`)})),i.length>0?Promise.all(i).finally((()=>{this.finishLoading(),t()})):(this.finishLoading(),t())}else this.finishLoading(),t()}))}clear(){this.m_poiTables=new Map,this.m_abortControllers.forEach(((e,t)=>{e.abort(),this.m_abortControllers.delete(t)}))}get poiTables(){return this.m_poiTables}addTable(e){this.m_poiTables.set(e.name,e)}getPoiTable(e){return void 0===e?void 0:this.m_poiTables.get(e)}get finishedLoading(){return!this.m_isLoading}startLoading(){this.m_isLoading=!0}finishLoading(){this.m_isLoading=!1}}},77:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadFontCatalog=void 0;const r=i(5084),n=i(2183).LoggerManager.instance.create("FontCatalogLoader");t.loadFontCatalog=async function(e,t,i){return await r.FontCatalog.load(e.url,1024).then(t.bind(void 0,e.name)).catch((t=>{n.error("Failed to load FontCatalog: ",e.name,t),i&&i(t)}))}},9892:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutState=void 0;const r=i(5084);t.LayoutState=class{constructor(e){this.m_hAlign=r.DefaultTextStyle.DEFAULT_HORIZONTAL_ALIGNMENT,this.m_vAlign=r.DefaultTextStyle.DEFAULT_VERTICAL_ALIGNMENT,this.textPlacement=e}set textPlacement(e){this.m_hAlign=r.hAlignFromPlacement(e.h),this.m_vAlign=r.vAlignFromPlacement(e.v)}get textPlacement(){return{h:r.hPlacementFromAlignment(this.m_hAlign),v:r.vPlacementFromAlignment(this.m_vAlign)}}reset(e){this.m_hAlign=e.horizontalAlignment,this.m_vAlign=e.verticalAlignment}get horizontalAlignment(){return this.m_hAlign}get verticalAlignment(){return this.m_vAlign}}},3518:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapViewState=void 0;const r=i(4428);t.MapViewState=class{constructor(e,t){this.m_mapView=e,this.m_renderedTilesChangeCheck=t,this.m_lookAtVector=new r.Vector3}get worldCenter(){return this.m_mapView.worldCenter}get cameraIsMoving(){return this.m_mapView.cameraIsMoving}get maxVisibilityDist(){return this.m_mapView.viewRanges.maximum}get zoomLevel(){return this.m_mapView.zoomLevel}get env(){return this.m_mapView.env}get frameNumber(){return this.m_mapView.frameNumber}get lookAtVector(){return this.m_mapView.camera.getWorldDirection(this.m_lookAtVector)}get lookAtDistance(){return this.m_mapView.targetDistance}get isDynamic(){return this.m_mapView.isDynamicFrame}get hiddenGeometryKinds(){return void 0===this.m_mapView.tileGeometryManager?void 0:this.m_mapView.tileGeometryManager.hiddenGeometryKinds}get renderedTilesChanged(){return this.m_renderedTilesChangeCheck()}get projection(){return this.m_mapView.projection}get elevationProvider(){return this.m_mapView.elevationProvider}}},8976:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWorldPosition=t.isPathLabelTooSmall=t.placePathLabel=t.placePointLabel=t.placeIcon=t.PlacementResult=t.newPointLabelTextMarginPercent=t.persistentPointLabelTextMargin=t.checkReadyForPlacement=t.PrePlacementResult=t.getMaxViewDistance=t.pointToPlaneDistance=t.computeViewDistance=void 0;const r=i(3187),n=i(3139),s=i(5084),o=i(2183),a=i(4428),l=i(9580),c=i(6758),h=i(3171),d=i(4457),u=new a.Vector3(0,0,0),m=new a.Vector3(0,0,0),p=new a.Vector3(0,0,0);function f(e,t,i,r){let n;const s=e.path;if(s&&s.length>1)if(void 0!==t&&s&&s.length>t)n=g(s[t],i,r);else{const e=g(s[0],i,r),t=g(s[s.length-1],i,r);n=Math.min(e,t)}else n=g(e.position,i,r);return n}function g(e,t,i){return p.copy(e).sub(t).dot(i)}var v;t.computeViewDistance=f,t.pointToPlaneDistance=g,t.getMaxViewDistance=function(e,t){return e.maxVisibilityDist*t},function(e){e[e.Ok=0]="Ok",e[e.NotReady=1]="NotReady",e[e.Invisible=2]="Invisible",e[e.TooFar=3]="TooFar",e[e.Duplicate=4]="Duplicate",e[e.Count=5]="Count"}(v=t.PrePlacementResult||(t.PrePlacementResult={}));const _=new a.Vector3;t.checkReadyForPlacement=function(e,t,i,r,s){let a;return e.visible?r.updatePoiFromPoiTable(e)?e.visible&&i.zoomLevel!==e.maxZoomLevel&&o.MathUtils.isClamped(i.zoomLevel,e.minZoomLevel,e.maxZoomLevel)?(a=void 0===s?f(e,t,i.worldCenter,i.lookAtVector):function(e,t,i,r,s,o){const a=f(e,t,i,r);return s!==n.ProjectionType.Spherical?a<=o?a:void 0:(u.copy(e.position).normalize(),m.copy(i).normalize(),u.dot(m)>.5877852522924731&&a<=o?a:void 0)}(e,t,i.worldCenter,i.lookAtVector,i.projection.type,s),void 0===a?{result:v.TooFar,viewDistance:a}:{result:v.Ok,viewDistance:a}):{result:v.Invisible,viewDistance:a}:{result:v.NotReady,viewDistance:a}:{result:v.Invisible,viewDistance:a}};const y=new a.Box2,x=new a.Box2,b=[],T={},w=[],S=new c.CollisionBox,M=new a.Vector2,E=new a.Vector2,P=new o.Math2D.Box,C=new a.Vector2,A=new a.Vector2;var L;function R(e,i,n,l,c,u,m,p,f){const g=e.element;o.assert(void 0!==g.glyphs),o.assert(void 0!==g.layoutStyle);const v=!g.bounds||p,_=v?x:g.bounds;v&&(D(c,n),T.outputCharacterBounds=void 0,T.path=void 0,T.pathOverflow=!1,T.letterCaseArray=g.glyphCaseArray,c.measureText(g.glyphs,_,T));const b=function(e,t,i,n,l,c=new a.Vector2){switch(o.assert(e.type===d.TextElementType.PoiLabel||e.type===d.TextElementType.LineMarker),o.assert(void 0!==e.layoutStyle),c.x=e.xOffset,c.y=e.yOffset,i.h){case s.HorizontalPlacement.Left:c.x-=t.max.x;break;case s.HorizontalPlacement.Right:c.x-=t.min.x}switch(i.v){case s.VerticalPlacement.Top:c.y-=t.min.y;break;case s.VerticalPlacement.Center:c.y-=.5*(t.max.y+t.min.y);break;case s.VerticalPlacement.Bottom:c.y-=t.max.y}if(void 0!==e.poiInfo&&h.poiIsRenderable(e.poiInfo)){o.assert(void 0!==e.poiInfo.computedWidth),o.assert(void 0!==e.poiInfo.computedHeight),c.x+=e.poiInfo.computedWidth*(.5+i.h),c.y+=e.poiInfo.computedHeight*(.5+i.v);const t=s.hPlacementFromAlignment(e.layoutStyle.horizontalAlignment),n=s.vPlacementFromAlignment(e.layoutStyle.verticalAlignment);if(t!==i.h||n!==i.v){const o=e.poiInfo.technique;let a=r.getPropertyValue(o.iconXOffset,l),h=r.getPropertyValue(o.iconYOffset,l);a="number"==typeof a?a:0,h="number"==typeof h?h:0;const d=t-i.h,u=n-i.v,m=a-e.xOffset,p=h-e.yOffset;t===s.HorizontalPlacement.Center||n===s.VerticalPlacement.Center?(c.x+=2*Math.abs(d)*m,c.y-=2*u*Math.abs(m),c.y+=2*Math.abs(u)*p,c.x-=2*d*Math.abs(p)):(c.x+=2*Math.min(Math.abs(d),.5)*m,c.y-=2*Math.sign(u)*Math.min(Math.abs(u),.5)*Math.abs(m),c.y+=2*Math.min(Math.abs(u),.5)*p,c.x-=2*Math.sign(d)*Math.min(Math.abs(d),.5)*Math.abs(p))}}return c.multiplyScalar(n),c}(g,_,n,l,u,E).add(i);return f.set(b.x,b.y,e.renderDistance),y.copy(_).expandByVector(t.persistentPointLabelTextMargin).translate(b),y.getCenter(C),y.getSize(A),A.multiplyScalar(l),P.set(C.x-A.x/2,C.y-A.y/2,A.x,A.y),m.isVisible(P)?(v&&(y.getSize(A),A.multiplyScalar(l*(1+t.newPointLabelTextMarginPercent)),P.set(C.x-A.x/2,C.y-A.y/2,A.x,A.y)),!g.textMayOverlap&&m.isAllocated(P)?L.Rejected:(g.textReservesSpace&&m.allocate(P),v?(g.textBufferObject=void 0,g.bounds=g.bounds?g.bounds.copy(_):_.clone()):D(c,n),e.textPlacement=n,L.Ok)):L.Invisible}function D(e,t){e.textLayoutStyle.horizontalAlignment=s.hAlignFromPlacement(t.h),e.textLayoutStyle.verticalAlignment=s.vAlignFromPlacement(t.v)}t.persistentPointLabelTextMargin=new a.Vector2(2,2),t.newPointLabelTextMarginPercent=.1,function(e){e[e.Ok=0]="Ok",e[e.Rejected=1]="Rejected",e[e.Invisible=2]="Invisible"}(L=t.PlacementResult||(t.PlacementResult={})),t.placeIcon=function(e,t,i,r,n,s){return l.PoiRenderer.computeIconScreenBox(t,i,r,n,P),s.isVisible(P)?!0!==t.mayOverlap&&s.isAllocated(P)?L.Rejected:L.Ok:L.Invisible},t.placePointLabel=function(e,t,i,r,n,s,a,l=!1){o.assert(void 0!==e.element.layoutStyle);const c=e.element.layoutStyle;return(l=l&&void 0!==c.placements&&c.placements.length>1)?function(e,t,i,r,n,s,a){o.assert(void 0!==e.element.layoutStyle);const l=e.element,c=e.visible,h=e.textPlacement,d=l.layoutStyle.placements,u=d.length,m=d.findIndex((e=>e.h===h.h&&e.v===h.v));o.assert(m>=0);let p=!0;for(let o=m;o<u+m;++o){const l=o===m&&c,h=R(e,t,d[o%u],i,r,n,s,!l,_);if(h===L.Ok)return a.copy(_),L.Ok;l&&a.copy(_),p=p&&h===L.Invisible}return p?L.Invisible:L.Rejected}(e,t,i,r,n,s,a):function(e,t,i,r,n,s,a){return o.assert(void 0!==e.element.layoutStyle),R(e,t,e.textPlacement,i,r,n,s,!e.visible,a)}(e,t,i,r,n,s,a)},t.placePathLabel=function(e,t,i,r,n){if(T.path=t,T.outputCharacterBounds=b,T.letterCaseArray=e.element.glyphCaseArray,!r.measureText(e.element.glyphs,y,T))return L.Rejected;if(S.copy(y.translate(i)),!n.isVisible(S))return L.Invisible;let s,o=!1;e.element.textMayOverlap||(s=n.search(S),o=s.length>0),w.length=b.length;for(let e=0;e<b.length;++e){const t=b[e].translate(i);let r=w[e];if(void 0===r?(r=new c.CollisionBox(t),w[e]=r):r.copy(t),o&&n.intersectsDetails(r,s))return L.Rejected}if(e.element.textReservesSpace){const e=new c.DetailedCollisionBox(S,w.slice());w.length=0,n.allocate(e)}return L.Ok},t.isPathLabelTooSmall=function(e,t,i){o.assert(e.type===d.TextElementType.PathLabel),i.length=0;let r=!1;for(const n of e.points)void 0!==(r?t.project(n,M):t.projectToScreen(n,M))&&(r=!0,i.push(M.clone()));if(!r)return!0;const n=5*e.text.length;return y.setFromPoints(i),y.max.sub(y.min).lengthSq()<n*n&&(e.dbgPathTooSmall=!0,!0)};const O=new n.OrientedBox3;t.getWorldPosition=function(e,t,i,n){var s,o;const l=r.getPropertyValue(null===(o=null===(s=e.poiInfo)||void 0===s?void 0:s.technique)||void 0===o?void 0:o.worldOffset,i);if(null==n||n.copy(e.position),null!=l&&void 0!==e.offsetDirection){t.localTangentSpace(e.position,O);const i=O.yAxis,r=a.MathUtils.degToRad(e.offsetDirection);i.applyAxisAngle(O.zAxis.negate(),r),n.addScaledVector(O.yAxis,l)}return n}},772:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlacementStats=void 0,t.PlacementStats=class{constructor(e){this.m_logger=e,this.totalGroups=0,this.resortedGroups=0,this.total=0,this.uninitialized=0,this.tooFar=0,this.numNotVisible=0,this.numPathTooSmall=0,this.numCannotAdd=0,this.numRenderedPoiIcons=0,this.numRenderedPoiTexts=0,this.numPoiTextsInvisible=0,this.numRenderedTextElements=0}clear(){this.totalGroups=0,this.resortedGroups=0,this.total=0,this.uninitialized=0,this.tooFar=0,this.numNotVisible=0,this.numPathTooSmall=0,this.numCannotAdd=0,this.numRenderedPoiIcons=0,this.numRenderedPoiTexts=0,this.numPoiTextsInvisible=0,this.numRenderedTextElements=0}log(){const e=this.uninitialized+this.numPoiTextsInvisible+this.tooFar+this.numNotVisible+this.numCannotAdd;this.m_logger.debug("Total groups",this.totalGroups),this.m_logger.debug("Resorted groups",this.resortedGroups),this.m_logger.debug("Total labels",this.total),this.m_logger.debug("Rendered labels",this.numRenderedTextElements),this.m_logger.debug("Rejected labels",e),this.m_logger.debug("Unitialized labels",this.uninitialized),this.m_logger.debug("Rendered poi icons",this.numRenderedPoiIcons),this.m_logger.debug("Rendered poi texts",this.numRenderedPoiTexts),this.m_logger.debug("Poi text invisible",this.numPoiTextsInvisible),this.m_logger.debug("Too far",this.tooFar),this.m_logger.debug("Not visible",this.numNotVisible),this.m_logger.debug("Path too small",this.numPathTooSmall),this.m_logger.debug("Rejected, max glyphs reached",this.numCannotAdd)}}},9754:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderState=t.DEFAULT_FADE_TIME=t.FadingState=void 0;const r=i(2183),n=i(4428);var s;!function(e){e[e.Undefined=0]="Undefined",e[e.FadingIn=1]="FadingIn",e[e.FadedIn=2]="FadedIn",e[e.FadingOut=-1]="FadingOut",e[e.FadedOut=-2]="FadedOut"}(s=t.FadingState||(t.FadingState={})),t.DEFAULT_FADE_TIME=800,t.RenderState=class{constructor(e=t.DEFAULT_FADE_TIME){this.fadeTime=e,this.value=0,this.startTime=0,this.opacity=0,this.m_state=s.Undefined}reset(){this.m_state=s.Undefined,this.value=0,this.startTime=0,this.opacity=0}isUndefined(){return this.m_state===s.Undefined}isFading(){return this.m_state===s.FadingIn||this.m_state===s.FadingOut}isFadingIn(){return this.m_state===s.FadingIn}isFadingOut(){return this.m_state===s.FadingOut}isFadedIn(){return this.m_state===s.FadedIn}isFadedOut(){return this.m_state===s.FadedOut}isVisible(){return this.m_state!==s.FadedOut&&this.m_state!==s.Undefined&&this.opacity>0}startFadeIn(e,t){if(this.m_state!==s.FadingIn&&this.m_state!==s.FadedIn){if(!0===t)return this.value=1,this.opacity=1,this.m_state=s.FadedIn,void(this.startTime=e);this.m_state===s.FadingOut?(this.value=1-this.value,this.startTime=e-this.value*this.fadeTime):(this.startTime=e,this.value=0,this.opacity=0),this.m_state=s.FadingIn}}startFadeOut(e){this.m_state!==s.FadingOut&&this.m_state!==s.FadedOut&&this.m_state!==s.Undefined&&(this.m_state===s.FadingIn?(this.startTime=e-this.value*this.fadeTime,this.value=1-this.value):(this.startTime=e,this.value=0,this.opacity=1),this.m_state=s.FadingOut)}updateFading(e,t){if(this.m_state!==s.FadingIn&&this.m_state!==s.FadingOut)return;0===this.startTime&&(this.startTime=e);const i=e-this.startTime,o=this.m_state===s.FadingIn?0:1,a=this.m_state===s.FadingIn?1:0;t||i>=this.fadeTime?(this.value=1,this.opacity=a,this.m_state=this.m_state===s.FadingIn?s.FadedIn:s.FadedOut):(this.value=i/this.fadeTime,this.opacity=n.MathUtils.clamp(r.MathUtils.smootherStep(o,a,this.value),0,1),r.assert(this.isFading()))}}},1878:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimplePath=t.PathParam=t.SimpleLineCurve=void 0;const r=i(4428);class n extends r.LineCurve{constructor(e,t){super(e,t)}getLengths(){return void 0===this.m_lengths&&(this.m_lengths=[0,this.v2.distanceTo(this.v1)]),this.m_lengths}}t.SimpleLineCurve=n;class s{constructor(e,t,i){this.path=e,this.index=t,this.t=i}get curve(){return this.path.curves[this.index]}get point(){return void 0===this.m_point&&(this.m_point=this.curve.getPoint(this.t)),this.m_point}}t.PathParam=s;class o extends r.Path{constructor(){super()}getLengths(){if(this.m_cache)return this.m_cache;let e=0;const t=new Array;return t.push(0),this.curves.forEach((i=>{const r=i;e+=r.v1.distanceTo(r.v2),t.push(e)})),this.m_cache=t,t}getParamAt(e){const t=e*this.getLength(),i=this.getCurveLengths();for(let e=0;e<i.length;++e){if(i[e]<t)continue;const r=i[e]-t,n=this.curves[e].getLength();return new s(this,e,0===n?0:1-r/n)}return null}}t.SimplePath=o},6966:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextCanvasFactory=void 0;const r=i(5084),n=i(2183);t.TextCanvasFactory=class{constructor(e){this.m_renderer=e,this.m_minGlyphCount=0,this.m_maxGlyphCount=0}setGlyphCountLimits(e,t){this.m_minGlyphCount=e,this.m_maxGlyphCount=t}createTextCanvas(e,t){return n.assert(this.m_maxGlyphCount>0),new r.TextCanvas({renderer:this.m_renderer,fontCatalog:e,minGlyphCount:this.m_minGlyphCount,maxGlyphCount:this.m_maxGlyphCount,name:t})}}},3171:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElement=t.LoadingState=t.poiIsRenderable=void 0;const r=i(5084),n=i(4428),s=i(4457);var o;t.poiIsRenderable=function(e){return void 0!==e.buffer},(o=t.LoadingState||(t.LoadingState={}))[o.Requested=0]="Requested",o[o.Loaded=1]="Loaded",o[o.Initialized=2]="Initialized";class a{constructor(e,t,i,o,a=0,l=0,c=0,h,d,u,m,p,f){this.text=e,this.points=t,this.renderParams=i,this.layoutParams=o,this.priority=a,this.xOffset=l,this.yOffset=c,this.featureId=h,this.style=d,this.fadeNear=u,this.fadeFar=m,this.tileOffset=p,this.offsetDirection=f,this.visible=!0,this.distanceScale=.5,this.renderOrder=0,this.elevated=!1,i instanceof r.TextRenderStyle&&(this.renderStyle=i),o instanceof r.TextLayoutStyle&&(this.layoutStyle=o),this.type=t instanceof n.Vector3?s.TextElementType.PoiLabel:s.TextElementType.PathLabel}get position(){return this.points instanceof Array?this.points[0]:this.points}get path(){if(this.points instanceof Array)return this.points}get textMayOverlap(){return!0===this.mayOverlap}set textMayOverlap(e){this.mayOverlap=e}get textReservesSpace(){return!1!==this.reserveSpace}set textReservesSpace(e){this.reserveSpace=e}get poiInfo(){return this.m_poiInfo}set poiInfo(e){if(this.m_poiInfo=e,void 0!==e){void 0!==this.path&&(this.type=s.TextElementType.LineMarker);const t=void 0!==this.renderOrder?this.renderOrder:0;e.renderOrder=t}}get renderStyle(){return this.m_renderStyle}set renderStyle(e){this.m_renderStyle=e}get layoutStyle(){return this.m_layoutStyle}set layoutStyle(e){this.m_layoutStyle=e}hasFeatureId(){return void 0!==this.featureId&&("number"==typeof this.featureId?0!==this.featureId:this.featureId.length>0)}dispose(){var e;const t=null===(e=this.poiInfo)||void 0===e?void 0:e.buffer;t&&t.decreaseRefCount()}}t.TextElement=a,a.HIGHEST_PRIORITY=Number.MAX_SAFE_INTEGER},8246:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementBuilder=void 0;const r=i(3187),n=i(5084),s=i(2183),o=i(8459),a=i(3171),l=i(6682),c=s.LoggerManager.instance.create("TextElementBuilder");class h{constructor(e,t,i){if(this.m_env=e,this.m_styleCache=t,this.m_baseRenderOrder=i,this.m_distanceScale=l.DEFAULT_TEXT_DISTANCE_SCALE,this.m_renderOrder=i,Number.isInteger(i))this.renderOrderUpBound=h.RENDER_ORDER_UP_BOUND;else{const e=Math.abs(i);this.renderOrderUpBound=(e-Math.floor(e))*h.RENDER_ORDER_UP_BOUND}this.isValidRenderOrder(i)||c.warn(`Large base render order (${i}) might cause precision issues.`)}static alignZoomLevelRanges(e){var t,i;if(!e.poiInfo)return;const r=e.poiInfo;e.minZoomLevel=null!==(t=e.minZoomLevel)&&void 0!==t?t:s.MathUtils.min2(r.iconMinZoomLevel,r.textMinZoomLevel),e.maxZoomLevel=null!==(i=e.maxZoomLevel)&&void 0!==i?i:s.MathUtils.max2(r.iconMaxZoomLevel,r.textMaxZoomLevel)}static composeRenderOrder(e,t){return e*h.RENDER_ORDER_UP_BOUND+t}withTechnique(e){var t,i,n,o,a,d,u;this.m_technique=e,this.m_priority=null!==(t=r.getPropertyValue(e.priority,this.m_env))&&void 0!==t?t:0,this.m_fadeNear=null!==(i=r.getPropertyValue(e.fadeNear,this.m_env))&&void 0!==i?i:void 0,this.m_fadeFar=null!==(n=r.getPropertyValue(e.fadeFar,this.m_env))&&void 0!==n?n:void 0,this.m_minZoomLevel=null!==(o=r.getPropertyValue(e.minZoomLevel,this.m_env))&&void 0!==o?o:void 0,this.m_maxZoomLevel=null!==(a=r.getPropertyValue(e.maxZoomLevel,this.m_env))&&void 0!==a?a:void 0,this.m_distanceScale=null!==(d=e.distanceScale)&&void 0!==d?d:l.DEFAULT_TEXT_DISTANCE_SCALE,this.m_renderStyle=this.m_styleCache.getRenderStyle(e),this.m_layoutStype=this.m_styleCache.getLayoutStyle(e),this.m_xOffset=r.getPropertyValue(e.xOffset,this.m_env),this.m_yOffset=r.getPropertyValue(e.yOffset,this.m_env);const m=null!==(u=r.getPropertyValue(e.renderOrder,this.m_env))&&void 0!==u?u:0;if(!this.isValidRenderOrder(m)){const e=`Unsupported large render order (${m})`;c.error(e),s.assert(!1,e)}return this.m_renderOrder=h.composeRenderOrder(this.m_baseRenderOrder,m),r.isTextTechnique(e)?this.withTextTechnique(e):this.withPoiTechnique(e),this}withIcon(e,t){return s.assert(void 0!==this.m_poiBuilder),this.m_poiBuilder.withIcon(e,t),this}build(e,t,i,o,l,c){var d;const u=r.getFeatureId(o);s.assert(void 0!==this.m_technique),s.assert(void 0!==this.m_renderStyle),s.assert(void 0!==this.m_layoutStype);const m=this.m_technique,p=this.m_renderStyle,f=this.m_layoutStype,g=new a.TextElement(n.ContextualArabicConverter.instance.convert(e),t,p,f,this.m_priority,this.m_xOffset,this.m_yOffset,u,m.style,this.m_fadeNear,this.m_fadeFar,i,c);return g.minZoomLevel=this.m_minZoomLevel,g.maxZoomLevel=this.m_maxZoomLevel,g.distanceScale=this.m_distanceScale,g.mayOverlap=this.m_mayOverlap,g.reserveSpace=this.m_reserveSpace,g.kind=m.kind,g.userData=o,g.textFadeTime=void 0!==m.textFadeTime?1e3*m.textFadeTime:void 0,g.pathLengthSqr=l,g.alwaysOnTop=this.m_alwaysOnTop,g.renderOrder=this.m_renderOrder,g.poiInfo=null===(d=this.m_poiBuilder)||void 0===d?void 0:d.build(g),h.alignZoomLevelRanges(g),g}withTextTechnique(e){this.m_mayOverlap=!0===e.mayOverlap,this.m_reserveSpace=!1!==e.reserveSpace,this.m_poiBuilder=void 0}withPoiTechnique(e){this.m_mayOverlap=!0===e.textMayOverlap,this.m_reserveSpace=!1!==e.textReserveSpace,this.m_alwaysOnTop=!0===e.alwaysOnTop,this.m_poiBuilder||(this.m_poiBuilder=new o.PoiBuilder(this.m_env)),this.m_poiBuilder.withTechnique(e)}isValidRenderOrder(e){return Math.abs(e)<this.renderOrderUpBound}}t.TextElementBuilder=h,h.RENDER_ORDER_UP_BOUND=1e7},3178:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementGroup=void 0;const r=i(2183);class n extends r.PriorityListGroup{}t.TextElementGroup=n},5267:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementGroupPriorityList=void 0;const r=i(2183);class n extends r.GroupedPriorityList{}t.TextElementGroupPriorityList=n},4557:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementGroupState=void 0;const r=i(2183),n=i(8170),s=i(4457);t.TextElementGroupState=class{constructor(e,t,i){this.group=e,this.tileKey=t,this.m_visited=!1,r.assert(e.elements.length>0);const o=e.elements.length;this.m_textElementStates=[],this.m_visited=!0;for(let t=0;t<o;++t){const r=e.elements[t];if(r.type===s.TextElementType.LineMarker&&void 0!==r.path){const e=r.path.length;for(let t=0;t<e;t++){const e=new n.TextElementState(r,t),s=i(e);e.update(s),this.m_textElementStates.push(e)}}else{const e=new n.TextElementState(r),t=i(e);e.update(t),this.m_textElementStates.push(e)}}}get visited(){return this.m_visited}set visited(e){this.m_visited=e}get priority(){return this.group.priority}updateFading(e,t){for(const i of this.m_textElementStates)void 0!==i&&i.updateFading(e,t)}traverseVisibleElements(e){for(const t of this.m_textElementStates)void 0!==t&&t.visible&&e(t)}updateElements(e){for(const t of this.m_textElementStates){const i=e(t);t.update(i)}}get size(){return this.m_textElementStates.length}get textElementStates(){return this.m_textElementStates}}},8170:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLineMarkerElementState=t.TextElementState=void 0;const r=i(5084),n=i(2183),s=i(9892),o=i(9754),a=i(4457);t.TextElementState=class{constructor(e,t){this.element=e,this.m_lineMarkerIndex=t}get initialized(){return void 0!==this.m_textRenderState||void 0!==this.m_iconRenderState}get visible(){if(void 0!==this.m_textRenderState&&this.m_textRenderState.isVisible())return!0;const e=this.iconRenderState;return!(void 0===e||!e.isVisible())}get textPlacement(){const e=this.element.layoutStyle,t=this.m_textLayoutState;return void 0!==t?t.textPlacement:{h:r.hPlacementFromAlignment(e.horizontalAlignment),v:r.vPlacementFromAlignment(e.verticalAlignment)}}set textPlacement(e){void 0===this.m_textLayoutState&&!0===this.isBaseTextPlacement(e)||(void 0===this.m_textLayoutState?this.m_textLayoutState=new s.LayoutState(e):this.m_textLayoutState.textPlacement=e)}isBaseTextPlacement(e){const t=this.element.layoutStyle;if(void 0!==t)return r.hAlignFromPlacement(e.h)===t.horizontalAlignment&&r.vAlignFromPlacement(e.v)===t.verticalAlignment}reset(){void 0!==this.m_textRenderState&&this.m_textRenderState.reset(),void 0!==this.m_textLayoutState&&(void 0!==this.element.layoutStyle?this.m_textLayoutState.reset(this.element.layoutStyle):this.m_textLayoutState=void 0),this.iconRenderState&&this.m_iconRenderState.reset(),this.m_viewDistance=void 0,this.element.textBufferObject=void 0,this.element.bounds=void 0}replace(e){this.m_textRenderState=e.m_textRenderState,this.m_textLayoutState=e.m_textLayoutState,this.m_iconRenderState=e.m_iconRenderState,e.m_textRenderState=void 0,e.m_textLayoutState=void 0,e.m_iconRenderState=void 0,void 0===this.element.glyphs&&(this.element.glyphs=e.element.glyphs,this.element.glyphCaseArray=e.element.glyphCaseArray),this.element.bounds=void 0,this.element.textBufferObject=void 0}get viewDistance(){return this.m_viewDistance}update(e){this.initialized||void 0===e||this.initializeRenderStates(),this.setViewDistance(e)}setViewDistance(e){this.m_viewDistance=e}get renderDistance(){return!0===this.element.alwaysOnTop?0:void 0!==this.m_viewDistance?-this.m_viewDistance:0}get textRenderState(){return this.m_textRenderState}get iconRenderState(){return this.m_iconRenderState}get lineMarkerIndex(){return this.m_lineMarkerIndex}get position(){return void 0!==this.element.path&&void 0!==this.m_lineMarkerIndex?this.element.path[this.m_lineMarkerIndex]:this.element.position}updateFading(e,t){void 0!==this.m_textRenderState&&this.m_textRenderState.updateFading(e,t),void 0!==this.iconRenderState&&this.iconRenderState.updateFading(e,t)}initializeRenderStates(){var e;n.assert(void 0===this.m_textRenderState),n.assert(void 0===this.m_textLayoutState),n.assert(void 0===this.m_iconRenderState);const{textFadeTime:t}=this.element;if(this.m_textRenderState=new o.RenderState(t),this.element.type===a.TextElementType.PoiLabel||this.element.type===a.TextElementType.LineMarker){const i=null===(e=this.element.poiInfo)||void 0===e?void 0:e.technique.iconFadeTime,r=void 0!==i?1e3*i:t;this.m_iconRenderState=new o.RenderState(r)}}},t.isLineMarkerElementState=function(e){return void 0!==e.m_lineMarkerIndex}},7753:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementStateCache=void 0;const r=i(2183),n=i(4557),s=i(8170),o=i(4457),a=r.LoggerManager.instance.create("TextElementsStateCache",{level:r.LogLevel.Log}),l={entries:[],index:-1};function c(e){return e.hasFeatureId()?e.featureId:e.text}function h(e,t,i,r){return void 0!==e.pathLengthSqr&&void 0!==i.pathLengthSqr&&e.pathLengthSqr>i.pathLengthSqr}function d(e,t,i,r){return t<r}t.TextElementStateCache=class{constructor(){this.m_referenceMap=new Map,this.m_textMap=new Map}getOrSet(e,t,i){let r=this.get(e);return void 0!==r?(r.updateElements(i),[r,!0]):(r=new n.TextElementGroupState(e,t,i),this.set(e,r),[r,!1])}get size(){return this.m_referenceMap.size}get cacheSize(){return this.m_textMap.size}get sortedGroupStates(){return void 0===this.m_sortedGroupStates&&(this.m_sortedGroupStates=Array.from(this.m_referenceMap.values()),this.m_sortedGroupStates.sort(((e,t)=>t.group.priority-e.group.priority))),r.assert(this.m_referenceMap.size===this.m_sortedGroupStates.length),this.m_sortedGroupStates}update(e,t,i,r){const n=i?this.replaceElement.bind(this,r):void 0;let s=!1;for(const[r,o]of this.m_referenceMap.entries())o.visited?o.updateFading(e,t):(i&&o.traverseVisibleElements(n),this.m_referenceMap.delete(r),this.m_sortedGroupStates=void 0,s=!0);return s}clearVisited(){for(const e of this.m_referenceMap.values())e.visited=!1}clearTextCache(){this.m_textMap.clear()}clear(){this.m_referenceMap.clear(),this.m_sortedGroupStates=void 0,this.m_textMap.clear()}deduplicateElement(e,t){const i=this.findDuplicate(t,e);if(void 0===i)return this.m_textMap.set(c(t.element),[t]),!0;if(-1===i.index)return i.entries.push(t),!0;const r=i.entries[i.index];return!(r.visible||!t.visible||(i.entries[i.index]=t,r.reset(),0))}replaceElement(e,t){r.assert(t.visible);const i=this.findDuplicate(t,e);if(void 0===i||-1===i.index)return!1;const n=i.entries[i.index];return r.assert(!n.visible),n.replace(t),!0}get(e){const t=this.m_referenceMap.get(e);return void 0!==t&&(t.visited=!0),t}set(e,t){r.assert(e.elements.length>0),this.m_referenceMap.set(e,t),this.m_sortedGroupStates=void 0}findDuplicate(e,t){const i=e.element,n=this.m_textMap.get(c(i));if(void 0===n)return;l.entries=n;const u=i.hasFeatureId()?function(e,t){const i=e.element,n=t.findIndex((e=>e.element.tileOffset===i.tileOffset));if(-1===n)return-1;const s=t[n].element;if(r.assert(i.featureId===s.featureId),s.text===i.text)return n;a.debug(`Text feature id ${i.featureId} collision between "${i.text} and              ${s.text}`)}(e,n):function(e,t,i){const r=e.element,n=function(e){return 100<<(Math.min(4,13-Math.min(13,Math.floor(e)))<<2)}(i),a=t.length,l=e.position,c=e.visible,u=s.isLineMarkerElementState(e);let m,p=-1,f=1/0;const g=r.type===o.TextElementType.PathLabel?h:d;for(let e=0;e<a;++e){const i=t[e],o=i.element,a=r.type!==o.type||u!==s.isLineMarkerElementState(i),h=c&&i.visible;if(a||h)continue;const d=l.distanceToSquared(o.position);d>n||(void 0===m||g(o,d,m,f))&&(p=e,m=o,f=d)}return p}(e,n,t);return void 0===u?(i.featureId=void 0,this.findDuplicate(e,t)):(l.index=u,l)}}},4457:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementType=void 0,(i=t.TextElementType||(t.TextElementType={}))[i.PoiLabel=0]="PoiLabel",i[i.PathLabel=1]="PathLabel",i[i.LineMarker=2]="LineMarker"},6682:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextElementsRenderer=t.DEFAULT_TEXT_DISTANCE_SCALE=t.DEFAULT_FONT_CATALOG_NAME=void 0;const r=i(5084),n=i(2183),s=i(4428),o=i(8601),a=i(4111),l=i(6552),c=i(9580),h=i(6758),d=i(77),u=i(8976),m=(i(772),i(1878)),p=i(6966),f=i(3171),g=i(5370),v=i(7753),_=i(4457),y=i(3925);var x;i(7955),function(e){e[e.PersistentLabels=0]="PersistentLabels",e[e.NewLabels=1]="NewLabels"}(x||(x={})),t.DEFAULT_FONT_CATALOG_NAME="default",t.DEFAULT_TEXT_DISTANCE_SCALE=.5;const b=n.LoggerManager.instance.create("TextElementsRenderer",{level:n.LogLevel.Log}),T=new s.Vector3,w=new s.Vector2,S=[],M=new s.Vector2,E={},P={},C={},A={vector2:[new s.Vector2]};class L{constructor(e,t){this.tile=e,this.group=t}}class R{constructor(e){this.lists=e}get priority(){return n.assert(this.lists.length>0),this.lists[0].group.priority}count(){let e=0;for(const t of this.lists)e+=t.group.elements.length;return e}}function D(e,t,i,r,n){P.path=r,P.pathOverflow=n,P.layer=e.renderOrder,P.letterCaseArray=e.glyphCaseArray,P.pickingData=e.userData?e:void 0,t.addText(e.glyphs,i,P)}function O(e){return void 0!==e&&n.PerformanceTimer.now()-e>10&&(b.debug("Placement time limit exceeded."),!0)}t.TextElementsRenderer=class{constructor(e,t,i,r,n,o,a,l,d,u){this.m_viewState=e,this.m_viewUpdateCallback=t,this.m_screenProjector=i,this.m_poiManager=r,this.m_renderer=n,this.m_imageCaches=o,this.m_loadPromisesCount=0,this.m_textCanvases=new Map,this.m_tmpVector=new s.Vector2,this.m_tmpVector3=new s.Vector3,this.m_cameraLookAt=new s.Vector3,this.m_overloaded=!1,this.m_cacheInvalidated=!1,this.m_forceNewLabelsPass=!1,this.m_addNewLabels=!0,this.m_textElementStateCache=new v.TextElementStateCache,this.m_camera=new s.OrthographicCamera(-1,1,1,-1),this.m_textStyleCache=new y.TextStyleCache,this.m_screenCollisions=new h.ScreenCollisions,this.m_options=Object.assign({},a),g.initializeDefaultOptions(this.m_options),u?this.m_screenCollisions=u:void 0!==this.m_options.collisionDebugCanvas&&null!==this.m_options.collisionDebugCanvas&&(this.m_screenCollisions=new h.ScreenCollisionsDebug(this.m_options.collisionDebugCanvas)),this.m_textCanvasFactory=null!=l?l:new p.TextCanvasFactory(this.m_renderer),this.m_textCanvasFactory.setGlyphCountLimits(this.m_options.minNumGlyphs,this.m_options.maxNumGlyphs),this.m_poiRenderer=null!=d?d:new c.PoiRenderer(this.m_renderer,this.m_poiManager,this.m_imageCaches),this.initializeCamera(),this.initializeDefaultFontCatalog(),this.m_textStyleCache.updateTextCanvases(this.m_textCanvases)}set disableFading(e){this.m_options.disableFading=e}get disableFading(){return!0===this.m_options.disableFading}get styleCache(){return this.m_textStyleCache}get delayLabelsUntilMovementFinished(){return!0===this.m_options.delayLabelsUntilMovementFinished}set delayLabelsUntilMovementFinished(e){this.m_options.delayLabelsUntilMovementFinished=e}get showReplacementGlyphs(){return!0===this.m_options.showReplacementGlyphs}set showReplacementGlyphs(e){this.m_options.showReplacementGlyphs=e,this.m_textCanvases.forEach((t=>{(null==t?void 0:t.fontCatalog)&&(t.fontCatalog.showReplacementGlyphs=e)}))}restoreRenderers(e){this.m_renderer=e,this.m_poiRenderer=new c.PoiRenderer(this.m_renderer,this.m_poiManager,this.m_imageCaches)}async updateFontCatalogs(e){if(this.m_defaultFontCatalogConfig&&(e&&-1!==e.findIndex((e=>e.name===t.DEFAULT_FONT_CATALOG_NAME))?this.m_textCanvases.has(t.DEFAULT_FONT_CATALOG_NAME)&&this.m_textCanvases.delete(t.DEFAULT_FONT_CATALOG_NAME):(e||(e=[]),e.unshift(this.m_defaultFontCatalogConfig))),e&&e.length>0){for(const[t]of this.m_textCanvases)e.findIndex((e=>e.name===t))<0&&this.m_textCanvases.delete(t);for(const t of e)await this.addTextCanvas(t)}else this.m_textCanvases.clear();this.m_textStyleCache.updateTextCanvases(this.m_textCanvases)}async updateTextStyles(e,t){this.m_textStyleCache.updateTextStyles(e,t),await this.waitLoaded(),this.m_textStyleCache.updateTextCanvases(this.m_textCanvases)}renderText(e){let t;this.m_camera.far=e,this.updateGlyphDebugMesh(),this.m_poiRenderer.update();for(const e of this.m_poiRenderer.layers){for(const[,i]of this.m_textCanvases)null==i||i.render(this.m_camera,null==t?void 0:t.id,e.id,void 0,!1);this.m_poiRenderer.render(this.m_camera,e),t=e}for(const[,e]of this.m_textCanvases)null==e||e.render(this.m_camera,null==t?void 0:t.id,void 0,void 0,!1)}invalidateCache(){this.m_cacheInvalidated=!0}movementStarted(){this.delayLabelsUntilMovementFinished&&(this.m_addNewLabels=!1)}movementFinished(){this.invalidateCache(),this.delayLabelsUntilMovementFinished&&(this.m_addNewLabels=!0)}get overloaded(){return this.m_overloaded}placeText(e,t){const i=function(e){let t=!1;return e.forEach((({renderedTiles:e})=>{e.forEach((e=>{e.textElementsChanged&&(e.textElementsChanged=!1,t=!0)}))})),t}(e);if(!(this.hasOverlayText()||i||function(e){for(let t=0;t<e.length;t++)for(const[i,r]of e[t].renderedTiles)if(r.hasTextElements())return!0;return!1}(e)||this.m_cacheInvalidated||this.m_viewState.renderedTilesChanged))return;const r=this.m_cacheInvalidated||i||this.m_viewState.renderedTilesChanged,n=r&&this.m_addNewLabels;n&&(this.m_textElementStateCache.clearVisited(),this.updateTextElements(e));const s=this.m_textElementStateCache.update(t,this.m_options.disableFading,n,this.m_viewState.zoomLevel);this.reset(),this.m_addNewLabels&&this.prepopulateScreenWithBlockingElements(e);const o=(r||s)&&this.m_addNewLabels;this.placeTextElements(t,o),this.placeOverlayTextElements()}addOverlayText(e){0!==e.length&&(this.m_overlayTextElements=void 0===this.m_overlayTextElements?e.slice():this.m_overlayTextElements.concat(e))}clearOverlayText(){this.m_overlayTextElements=[]}hasOverlayText(){return void 0!==this.m_overlayTextElements&&this.m_overlayTextElements.length>0}get overlayText(){return this.m_overlayTextElements}pickTextElements(e,t){const i=(i,r)=>{if(void 0===i)return;const n=i,s={type:r,point:e,distance:0,renderOrder:n.renderOrder,featureId:n.featureId,userData:n.userData,text:n.text};t.addResult(s)};for(const[,t]of this.m_textCanvases)null==t||t.pickText(e,(e=>{i(e,l.PickObjectType.Text)}));this.m_poiRenderer.pickTextElements(e,(e=>{i(e,l.PickObjectType.Icon)}))}get loading(){return this.m_loadPromisesCount>0}async waitLoaded(){if(void 0!==this.m_loadPromise)return await this.m_loadPromise}clearRenderStates(){this.m_textElementStateCache.clear()}getMemoryUsage(){const e={heapSize:0,gpuSize:0};for(const[,t]of this.m_textCanvases)null==t||t.getMemoryUsage(e);return this.m_poiRenderer.getMemoryUsage(e),e}async addDefaultTextCanvas(){!this.m_textCanvases.has(t.DEFAULT_FONT_CATALOG_NAME)&&this.m_defaultFontCatalogConfig&&(await this.addTextCanvas(this.m_defaultFontCatalogConfig),this.m_textStyleCache.updateTextCanvases(this.m_textCanvases))}reset(){this.m_cameraLookAt.copy(this.m_viewState.lookAtVector),this.m_screenCollisions.reset();for(const[,e]of this.m_textCanvases)null==e||e.clear();this.m_poiRenderer.reset()}prepopulateScreenWithBlockingElements(e){const t=[];e.forEach((e=>{const i=new s.Vector3,r=new s.Vector3;for(const n of e.renderedTiles.values())for(const e of n.blockingElements)if(!(e.points.length<2)){this.m_screenProjector.project3(e.points[0],i);for(let n=1;n<e.points.length;n++){this.m_screenProjector.project3(e.points[n],r);const s=e.screenSpaceLines[n-1];s.start.copy(i),s.end.copy(r);const o={minX:Math.min(i.x,r.x),maxX:Math.max(i.x,r.x),minY:Math.min(i.y,r.y),maxY:Math.max(i.y,r.y),line:s};t.push(o),i.copy(r)}}})),this.m_screenCollisions.allocateIBoxes(t)}placeTextElementGroup(e,t,i,s){var o;n.assert(e.visited);const l=[],c=this.m_viewState.hiddenGeometryKinds,h=this.m_viewState.projection,d=this.m_viewState.elevationProvider,m=null==d?void 0:d.getDisplacementMap(e.tileKey);for(const n of e.textElementStates){if(s===x.PersistentLabels);else if(void 0!==i&&t.numRenderedTextElements>=i)return b.debug("Placement label limit exceeded."),!1;if(!n.initialized)continue;if(void 0===n.viewDistance||n.viewDistance<0)continue;const e=n.visible;if(s===x.PersistentLabels&&!e||s===x.NewLabels&&e)continue;const p=n.element,f=this.m_textStyleCache.getTextElementStyle(p.style),g=f.textCanvas;if(void 0!==c&&void 0!==p.kind&&c.hasOrIntersects(p.kind))continue;if(void 0!==d&&!p.elevated){if(!m){this.m_viewUpdateCallback(),this.m_forceNewLabelsPass=!0;continue}a.overlayTextElement(p,d,m,h)}const v=p.type;if(v===_.TextElementType.PathLabel&&u.isPathLabelTooSmall(p,this.m_screenProjector,S)){p.dbgPathTooSmall,n.reset();continue}const y=!0;if(g){if(!this.initializeGlyphs(p,f,y))continue;const e=g.getLayer(null!==(o=p.renderOrder)&&void 0!==o?o:r.DEFAULT_TEXT_CANVAS_LAYER);if(void 0!==e&&e.storage.drawCount+p.glyphs.length>e.storage.capacity){b.warn("layer glyph storage capacity exceeded.");continue}g.textRenderStyle=p.renderStyle,g.textLayoutStyle=p.layoutStyle}switch(v){case _.TextElementType.PoiLabel:this.addPoiLabel(n,g,t);break;case _.TextElementType.LineMarker:this.addLineMarkerLabel(n,l,g,t);break;case _.TextElementType.PathLabel:g&&this.addPathLabel(n,S,g,t)}}return!0}initializeGlyphs(e,t,i){if(e.loadingState===f.LoadingState.Initialized)return void 0!==e.glyphs;n.assert(void 0!==t.textCanvas);const s=t.textCanvas;if(void 0===e.loadingState)if(e.loadingState=f.LoadingState.Requested,void 0===e.renderStyle&&(e.renderStyle=new r.TextRenderStyle(Object.assign(Object.assign({},t.renderParams),e.renderParams))),void 0===e.layoutStyle&&(e.layoutStyle=new r.TextLayoutStyle(Object.assign(Object.assign({},t.layoutParams),e.layoutParams))),""===e.text)e.loadingState=f.LoadingState.Loaded;else{const t=s.fontCatalog.loadCharset(e.text,e.renderStyle).then((()=>{--this.m_loadPromisesCount,e.loadingState=f.LoadingState.Loaded,this.m_forceNewLabelsPass=this.m_forceNewLabelsPass||i,this.m_viewUpdateCallback()}));0===this.m_loadPromisesCount&&(this.m_loadPromise=void 0),++this.m_loadPromisesCount,this.m_loadPromise=void 0===this.m_loadPromise?t:Promise.all([this.m_loadPromise,t])}return e.loadingState===f.LoadingState.Loaded&&(s.textRenderStyle=e.renderStyle,s.textLayoutStyle=e.layoutStyle,e.glyphCaseArray=[],e.bounds=void 0,e.glyphs=s.fontCatalog.getGlyphs(e.text,s.textRenderStyle,e.glyphCaseArray),e.loadingState=f.LoadingState.Initialized),void 0!==e.glyphs}initializeCamera(){this.m_camera.position.z=1,this.m_camera.near=0}updateCamera(){const{width:e,height:t}=this.m_renderer.getSize(A.vector2[0]);this.m_camera.left=e/-2,this.m_camera.right=e/2,this.m_camera.bottom=t/-2,this.m_camera.top=t/2,this.m_camera.updateProjectionMatrix(),this.m_camera.updateMatrixWorld(!1),this.m_screenCollisions.update(e,t)}initializeDefaultFontCatalog(){var e;this.m_options.fontCatalog&&(this.m_defaultFontCatalogConfig=(e=this.m_options.fontCatalog,{name:t.DEFAULT_FONT_CATALOG_NAME,url:e}),this.addDefaultTextCanvas())}async addTextCanvas(e){const t=(e,t)=>{if(this.m_textCanvases.has(e)){const i=this.m_textCanvasFactory.createTextCanvas(t,e);t.showReplacementGlyphs=this.showReplacementGlyphs,this.m_textCanvases.set(e,i)}},i=()=>{this.m_textCanvases.delete(e.name)};if(this.m_textCanvases.has(e.name))return Promise.resolve();{this.m_textCanvases.set(e.name,void 0);const r=d.loadFontCatalog(e,t,i).then((()=>{--this.m_loadPromisesCount,this.m_viewUpdateCallback()})).catch((e=>{b.info("rendering without font catalog, only icons possible",e),--this.m_loadPromisesCount}));return 0===this.m_loadPromisesCount&&(this.m_loadPromise=void 0),++this.m_loadPromisesCount,this.m_loadPromise=void 0===this.m_loadPromise?r:Promise.all([this.m_loadPromise,r]),r}}updateGlyphDebugMesh(){const e=o.debugContext.getValue("DEBUG_GLYPHS");void 0!==e&&(e&&void 0===this.m_debugGlyphTextureCacheMesh&&this.initializeGlyphDebugMesh(),n.assert(void 0!==this.m_debugGlyphTextureCacheMesh),n.assert(void 0!==this.m_debugGlyphTextureCacheWireMesh),this.m_debugGlyphTextureCacheMesh.visible=e,this.m_debugGlyphTextureCacheWireMesh.visible=e)}initializeGlyphDebugMesh(){if(0===this.m_textCanvases.size)return;const e=this.m_textCanvases.values().next().value,t=e.fontCatalog,i=new s.PlaneGeometry(t.textureSize.width/2.5,t.textureSize.height/2.5,t.textureSize.width/t.maxWidth,t.textureSize.height/t.maxHeight),n=new s.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!1,map:t.texture});this.m_debugGlyphTextureCacheMesh=new s.Mesh(i,n),this.m_debugGlyphTextureCacheMesh.renderOrder=1e4,this.m_debugGlyphTextureCacheMesh.visible=!1,this.m_debugGlyphTextureCacheMesh.name="glyphDebug";const o=new s.WireframeGeometry(i),a=new s.LineBasicMaterial({transparent:!0,color:10066329,depthWrite:!1,depthTest:!1});this.m_debugGlyphTextureCacheWireMesh=new s.LineSegments(o,a),this.m_debugGlyphTextureCacheWireMesh.renderOrder=9999,this.m_debugGlyphTextureCacheWireMesh.visible=!1,this.m_debugGlyphTextureCacheWireMesh.name="glyphDebug",e.getLayer(r.DEFAULT_TEXT_CANVAS_LAYER).storage.scene.add(this.m_debugGlyphTextureCacheMesh,this.m_debugGlyphTextureCacheWireMesh)}updateTextElements(e){this.m_textElementStateCache.clearTextCache(),this.m_cacheInvalidated=!1,this.checkIfOverloaded(e);const t=this.overloaded&&this.m_viewState.isDynamic?n.PerformanceTimer.now():void 0;e.forEach((e=>{this.updateTextElementsFromSource(e.dataSource,e.storageLevel,Array.from(e.renderedTiles.values()),t)}))}updateTextElementsFromSource(e,t,i,r){const s=i;s.sort(((e,t)=>e.tileKey.mortonCode()-t.tileKey.mortonCode()));const o=[];this.createSortedGroupsForSorting(e,t,s,o);let a=0;for(const e of o)if(this.selectTextElementsToUpdateByDistance(e),void 0!==r){if(n.PerformanceTimer.now()-r>5){b.debug("Update time limit exceeded.");break}if(a+=e.count(),a>=100){b.debug("Update label limit exceeded.");break}}}prepareTextElementGroup(e,t,i){if(0===e.elements.length)return;const[,r]=this.m_textElementStateCache.getOrSet(e,t,(e=>{let{result:t,viewDistance:r}=u.checkReadyForPlacement(e.element,e.element.type===_.TextElementType.LineMarker?e.lineMarkerIndex:void 0,this.m_viewState,this.m_poiManager,i);return t!==u.PrePlacementResult.Ok||this.m_textElementStateCache.deduplicateElement(this.m_viewState.zoomLevel,e)||(t=u.PrePlacementResult.Duplicate,r=void 0),r}))}createSortedGroupsForSorting(e,t,i,r){if(0===i.length)return;const n=[];for(const r of i)e.shouldRenderText(t,r.tileKey)&&n.push(r);const s=new Map;for(const e of n)for(const t of e.textElementGroups.groups.values()){if(0===t.elements.length)continue;const i=s.get(t.priority);void 0===i?s.set(t.priority,new R([new L(e,t)])):i.lists.push(new L(e,t))}if(0!==s.size){for(const e of s){const t=e[1];r.push(t)}r.sort(((e,t)=>t.priority-e.priority))}}selectTextElementsToUpdateByDistance(e){const t=Math.max(this.m_options.maxDistanceRatioForTextLabels,this.m_options.maxDistanceRatioForPoiLabels),i=u.getMaxViewDistance(this.m_viewState,t);for(const t of e.lists)this.prepareTextElementGroup(t.group,t.tile.tileKey,i)}placeTextElements(e,t){const i={numRenderedTextElements:0,fadeAnimationRunning:!1,time:e},r=this.overloaded&&this.m_viewState.isDynamic?n.PerformanceTimer.now():void 0;if(0===this.m_textElementStateCache.size)return void b.debug("Text element cache empty.");const s=this.m_forceNewLabelsPass||t;this.m_forceNewLabelsPass&&(this.m_forceNewLabelsPass=!1);const o=this.m_options.maxNumVisibleLabels,a=this.m_textElementStateCache.sortedGroupStates;let l=a[0].priority,c=0;for(let e=0;e<a.length;++e){const t=a[e],n=t.priority;if(s&&l!==n){if(this.placeNewTextElements(c,e,i),O(r))break;l=n,c=e}if(!this.placeTextElementGroup(t,i,o,x.PersistentLabels))break;if(O(r))break}s&&this.placeNewTextElements(c,a.length,i),i.fadeAnimationRunning&&this.m_viewUpdateCallback()}placeNewTextElements(e,t,i){const r=this.m_textElementStateCache.sortedGroupStates;for(let n=e;n<t&&this.placeTextElementGroup(r[n],i,this.m_options.maxNumVisibleLabels,x.NewLabels);++n);}placeOverlayTextElements(){var e;if(void 0===this.m_overlayTextElements||0===this.m_overlayTextElements.length)return;const t=this.m_tmpVector.set(this.m_screenProjector.width,this.m_screenProjector.height),i=-t.width/2,n=t.height/2;for(const o of this.m_overlayTextElements){const a=this.m_textStyleCache.getTextElementStyle(o.style),l=a.textCanvas;if(void 0===l)continue;const c=!1;if(this.initializeGlyphs(o,a,c),o.loadingState!==f.LoadingState.Initialized)continue;const h=l.getLayer(null!==(e=o.renderOrder)&&void 0!==e?e:r.DEFAULT_TEXT_CANVAS_LAYER);if(void 0!==h&&h.storage.drawCount+o.glyphs.length>h.storage.capacity)continue;let d;if(l.textRenderStyle=o.renderStyle,l.textLayoutStyle=o.layoutStyle,o.type!==_.TextElementType.PathLabel)w.x=i+o.position.x*t.width,w.y=n-o.position.y*t.height,void 0!==o.xOffset&&(w.x+=o.xOffset),void 0!==o.yOffset&&(w.y-=o.yOffset),T.x=w.x,T.y=w.y,T.z=0,D(o,l,T);else{w.x=i,w.y=n,void 0!==o.xOffset&&(w.x+=o.xOffset),void 0!==o.yOffset&&(w.y-=o.yOffset);const e=[];for(const i of o.path){const r=w.x+i.x*t.width,n=w.y-i.y*t.height;e.push(new s.Vector2(r,n))}d=new m.SimplePath;for(let t=0;t<e.length-1;++t)d.add(new s.LineCurve(e[t],e[t+1]));D(o,l,T,d,!0)}}}getDistanceScalingFactor(e,t,i){let r=i/t;return r=1+(r-1)*e.distanceScale,r=Math.max(r,this.m_options.labelDistanceScaleMin),r=Math.min(r,this.m_options.labelDistanceScaleMax),r}getDistanceFadingFactor(e,t,i){let r=1;const n=t.viewDistance;if(void 0!==n&&void 0!==e.fadeFar&&e.fadeFar>0){const t=void 0===e.fadeNear?0:e.fadeNear,o=e.fadeFar;o>t&&(r=1-s.MathUtils.clamp((n/i-t)/(o-t),0,1))}return r}addPointLabel(e,t,i,r,s){var o;const a=e.element,l=e.textRenderState,c=a.type===_.TextElementType.LineMarker,h=e.iconRenderState;n.assert(void 0!==h),w.x=M.x=i.x,w.y=M.y=i.y;const d=u.pointToPlaneDistance(t,this.m_viewState.worldCenter,this.m_cameraLookAt);if(void 0!==a.fadeFar&&(a.fadeFar<=0||a.fadeFar*this.m_viewState.maxVisibilityDist<d))return!1;e.setViewDistance(d);const m=a.poiInfo;let p=!1;const f=void 0!==m&&n.MathUtils.isClamped(this.m_viewState.zoomLevel,m.iconMinZoomLevel,m.iconMaxZoomLevel)&&!1!==m.isValid,g=this.getDistanceScalingFactor(a,d,this.m_viewState.lookAtDistance),v=f&&this.m_poiRenderer.prepareRender(a,this.m_viewState.env);let y=!1;if(v){const e=u.placeIcon(h,m,M,g,this.m_viewState.env,this.m_screenCollisions);y=e===u.PlacementResult.Invisible,p=e===u.PlacementResult.Rejected,y&&h.reset()}else f&&!1!==m.isValid&&(this.m_forceNewLabelsPass=!0,this.m_viewUpdateCallback());const x=this.getDistanceFadingFactor(a,e,this.m_viewState.maxVisibilityDist);if(r&&function(e,t,i){const r=e.textRenderState,s=e.element,o=s.poiInfo;if(n.assert(s.type!==_.TextElementType.PathLabel),void 0===r||""===s.text)return!1;if(void 0!==o&&!n.MathUtils.isClamped(t.zoomLevel,o.textMinZoomLevel,o.textMaxZoomLevel))return!1;const a=u.getMaxViewDistance(t,i.maxDistanceRatioForPoiLabels);return!(!(!0===s.ignoreDistance||void 0===e.viewDistance||e.viewDistance<a&&e.viewDistance>0)||o&&!0!==o.isValid&&!0!==o.iconIsOptional)}(e,this.m_viewState,this.m_options)){const t=!e.visible,i=p&&t?u.PlacementResult.Rejected:u.placePointLabel(e,w,g,r,this.m_viewState.env,this.m_screenCollisions,T,!c),n=i===u.PlacementResult.Invisible;if(n){if(!f||y)return e.reset(),!1;l.reset()}const h=!0===(null==m?void 0:m.iconIsOptional),d=p&&v&&!h||i===u.PlacementResult.Rejected;if(!p&&!y){const e=!0===(null===(o=a.poiInfo)||void 0===o?void 0:o.textIsOptional);p=d&&!e}d&&l.startFadeOut(s.time),!n&&(!d&&function(e,t){const i=e.element.poiInfo;return!t.cameraIsMoving||void 0===i||!0===i.renderTextDuringMovements}(e,this.m_viewState)||l.isFading())&&(d||l.startFadeIn(s.time,this.m_options.disableFading),s.fadeAnimationRunning=s.fadeAnimationRunning||l.isFading(),function(e,t,i,r,n){const s=e.element,o=e.textRenderState.opacity*r*s.renderStyle.opacity;if(0===o)return!1;E.letterCaseArray=s.glyphCaseArray,void 0===s.textBufferObject&&(s.textBufferObject=t.createTextBufferObject(s.glyphs,E));const a=s.renderStyle.backgroundOpacity>0&&t.textRenderStyle.fontSize.backgroundSize>0;C.layer=s.renderOrder,C.position=i,C.scale=n,C.opacity=o,C.backgroundOpacity=a?C.opacity*s.renderStyle.backgroundOpacity:0,C.pickingData=s.userData?s:void 0,t.addTextBufferObject(s.textBufferObject,C)}(e,r,T,x,g))}if(v&&!y){p?h.startFadeOut(s.time):h.startFadeIn(s.time,this.m_options.disableFading),s.fadeAnimationRunning=s.fadeAnimationRunning||h.isFading();const t=h.opacity*x;if(t>0){const i=!1!==m.reserveSpace&&!p;this.m_poiRenderer.addPoi(m,M,this.m_screenCollisions,e.renderDistance,g,i,t,this.m_viewState.env)}}return s.numRenderedTextElements++,!0}addPoiLabel(e,t,i){const r=u.getWorldPosition(e.element,this.m_viewState.projection,this.m_viewState.env,this.m_tmpVector3);return!!this.labelPotentiallyVisible(r,w)&&this.addPointLabel(e,r,w,t,i)}addLineMarkerLabel(e,t,i,r){var s;const o=e.element,a=o.poiInfo;if(!(null===(s=this.m_poiRenderer)||void 0===s?void 0:s.prepareRender(o,this.m_viewState.env)))return;let l;void 0!==a.shieldGroupIndex&&(l=t[a.shieldGroupIndex],void 0===l&&(l=[],t[a.shieldGroupIndex]=l));const c=a.technique,h=void 0!==c.minDistance?c.minDistance*c.minDistance:0;if(h>0&&void 0!==l){let t=0;const s=e.position;if(this.labelPotentiallyVisible(s,w)){let o=!1;for(let e=0;e<l.length&&(o=n.Math2D.distSquared(l[e],l[e+1],w.x,w.y)<h,!o);e+=2);o||this.addPointLabel(e,s,w,i,r)&&(l.push(w.x,w.y),t++)}0===t&&e.reset()}else{const t=e.position;this.labelPotentiallyVisible(t,w)&&this.addPointLabel(e,t,w,i,r)}}addPathLabel(e,t,i,r){const n=u.getMaxViewDistance(this.m_viewState,this.m_options.maxDistanceRatioForTextLabels),o=e.element;if(!(!0===o.ignoreDistance||void 0===e.viewDistance||e.viewDistance<n))return e.textRenderState.reset(),!1;if(void 0!==o.fadeFar&&(o.fadeFar<=0||o.fadeFar*this.m_viewState.maxVisibilityDist<e.renderDistance))return e.textRenderState.reset(),!1;let a=new s.Path;w.copy(t[0]);for(let e=0;e<t.length-1;++e)a.add(new m.SimpleLineCurve(t[e],t[e+1]));if(a.getPoint(.5).x-a.getPoint(.51).x>0){w.copy(t[t.length-1]),a=new s.Path;for(let e=t.length-1;e>0;--e)a.add(new m.SimpleLineCurve(t[e],t[e-1]))}e.setViewDistance(u.computeViewDistance(o,void 0,this.m_viewState.worldCenter,this.m_cameraLookAt));const l=-e.renderDistance,c=this.getDistanceScalingFactor(o,l,this.m_viewState.lookAtDistance),h=i.textRenderStyle.fontSize.size;if(i.textRenderStyle.fontSize.size*=c,u.placePathLabel(e,a,w,i,this.m_screenCollisions)!==u.PlacementResult.Ok)return i.textRenderStyle.fontSize.size=h,e.textRenderState.reset(),!1;e.textRenderState.startFadeIn(r.time,this.m_options.disableFading);let d=o.renderStyle.opacity;if(e.textRenderState.isFading()&&(d*=e.textRenderState.opacity,r.fadeAnimationRunning=!0),0===e.textRenderState.opacity)return i.textRenderStyle.fontSize.size=h,!1;const p=i.textRenderStyle.opacity,f=i.textRenderStyle.backgroundOpacity,g=this.getDistanceFadingFactor(o,e,this.m_viewState.maxVisibilityDist);return i.textRenderStyle.opacity=d*g,i.textRenderStyle.backgroundOpacity=i.textRenderStyle.opacity*o.renderStyle.backgroundOpacity,T.z=e.renderDistance,D(o,i,T,a),r.numRenderedTextElements++,i.textRenderStyle.fontSize.size=h,i.textRenderStyle.opacity=p,i.textRenderStyle.backgroundOpacity=f,!0}checkIfOverloaded(e){let t=0;e.forEach((e=>{for(const i of e.renderedTiles.values())t+=i.textElementGroups.count()}));const i=t>2e4;return i&&!this.m_overloaded&&b.debug("Overloaded Mode enabled."),this.m_overloaded=i,this.m_overloaded}labelPotentiallyVisible(e,t){var i;const r=s.MathUtils.clamp(null!==(i=this.m_options.maxPoiDistanceToBorder)&&void 0!==i?i:0,0,1);return void 0!==this.m_screenProjector.projectAreaToScreen(e,r,r,t)}}},5370:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initializeDefaultOptions=void 0,t.initializeDefaultOptions=function(e){void 0===e.minNumGlyphs&&(e.minNumGlyphs=1024),void 0===e.maxNumGlyphs&&(e.maxNumGlyphs=32768),void 0===e.labelDistanceScaleMin&&(e.labelDistanceScaleMin=.7),void 0===e.labelDistanceScaleMax&&(e.labelDistanceScaleMax=1.5),void 0===e.maxDistanceRatioForTextLabels&&(e.maxDistanceRatioForTextLabels=.99),void 0===e.maxDistanceRatioForPoiLabels&&(e.maxDistanceRatioForPoiLabels=.99),void 0===e.disableFading&&(e.disableFading=!1),void 0===e.delayLabelsUntilMovementFinished&&(e.delayLabelsUntilMovementFinished=!0),void 0===e.showReplacementGlyphs&&(e.showReplacementGlyphs=!1),void 0===e.maxPoiDistanceToBorder&&(e.maxPoiDistanceToBorder=.2)}},3925:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextStyleCache=void 0;const r=i(3187),n=i(5084),s=i(2183),o=i(7365),a=i(2084),l=i(6682),c=s.LoggerManager.instance.create("TextStyleCache"),h=new n.TextRenderStyle({fontSize:{unit:n.FontUnit.Pixel,size:32,backgroundSize:8},color:o.ColorCache.instance.getColor("#6d7477"),opacity:1,backgroundColor:o.ColorCache.instance.getColor("#f7fbfd"),backgroundOpacity:.5}),d=new n.TextLayoutStyle({verticalAlignment:n.VerticalAlignment.Center,horizontalAlignment:n.HorizontalAlignment.Center,placements:[]}),u="default";function m(e,t,i){const s=i?function(e){const t=[];return(e?e.toUpperCase().replace(" ","").split(","):[]).forEach((e=>{const i=function(e){if(e.length<1||e.length>2)return;const t={h:n.HorizontalPlacement.Center,v:n.VerticalPlacement.Center};let i=e.charAt(0),s=!0;switch(i){case r.PlacementToken.Top:case r.PlacementToken.North:t.v=n.VerticalPlacement.Top;break;case r.PlacementToken.Bottom:case r.PlacementToken.South:t.v=n.VerticalPlacement.Bottom;break;default:if(s=!1,2===e.length)return}if(s&&1===e.length)return t;switch(i=1===e.length?e.charAt(0):e.charAt(1),i){case r.PlacementToken.Right:case r.PlacementToken.East:t.h=n.HorizontalPlacement.Right;break;case r.PlacementToken.Left:case r.PlacementToken.West:t.h=n.HorizontalPlacement.Left;break;default:return}return t}(e);void 0!==i&&t.push(i)})),t}(i):void 0;return n.resolvePlacementAndAlignment(function(e){return"Left"===e||"Center"===e||"Right"===e?n.HorizontalAlignment[e]:d.horizontalAlignment}(e),function(e){return"Above"===e||"Center"===e||"Below"===e?n.VerticalAlignment[e]:d.verticalAlignment}(t),s)}t.TextStyleCache=class{constructor(){this.m_textStyles=new Map,this.m_defaultStyle={name:u,fontCatalog:void 0,renderParams:h.params,layoutParams:d.params},this.updateDefaultTextStyle()}updateTextStyles(e,t){this.m_textStyles.clear(),null==e||e.forEach((e=>{this.m_textStyles.set(e.name,this.createTextElementStyle(e,e.name))})),this.updateDefaultTextStyle(t,e)}updateTextCanvases(e){this.initializeTextCanvas(this.m_defaultStyle,e);for(const[,t]of this.m_textStyles)this.initializeTextCanvas(t,e)}getTextElementStyle(e){let t;return void 0===e?t=this.m_defaultStyle:(t=this.m_textStyles.get(e),void 0===t&&(t=this.m_defaultStyle)),t}createRenderStyle(e,t){const i=e.mapView,l=i.zoomLevel,c=Math.floor(l),h=new r.MapEnv({$zoom:c},i.env),d=this.m_defaultStyle.renderParams,u=s.getOptionValue(d.opacity,1);let m,p=r.getPropertyValue(s.getOptionValue(t.opacity,u),h);if(void 0!==t.color){let e=a.evaluateColorProperty(t.color,h);void 0!==e&&(r.ColorUtils.hasAlphaInHex(e)&&(p*=r.ColorUtils.getAlphaFromHex(e),e=r.ColorUtils.removeAlphaFromHex(e)),m=o.ColorCache.instance.getColor(e))}const f=s.getOptionValue(d.fontSize.backgroundSize,0),g=r.getPropertyValue(s.getOptionValue(t.backgroundSize,f),h),v=void 0!==t.backgroundColor&&void 0!==t.backgroundSize&&g>0,_=s.getOptionValue(d.backgroundOpacity,0);let y,x=r.getPropertyValue(s.getOptionValue(t.backgroundOpacity,v?1:_),h);if(void 0!==t.backgroundColor){let e=a.evaluateColorProperty(t.backgroundColor,h);void 0!==e&&(r.ColorUtils.hasAlphaInHex(e)&&(x*=r.ColorUtils.getAlphaFromHex(e),e=r.ColorUtils.removeAlphaFromHex(e)),y=o.ColorCache.instance.getColor(e))}const b={fontName:s.getOptionValue(t.fontName,d.fontName),fontSize:{unit:n.FontUnit.Pixel,size:r.getPropertyValue(s.getOptionValue(t.size,d.fontSize.size),h),backgroundSize:g},fontStyle:"Regular"===t.fontStyle||"Bold"===t.fontStyle||"Italic"===t.fontStyle||"BoldItalic"===t.fontStyle?n.FontStyle[t.fontStyle]:d.fontStyle,fontVariant:"Regular"===t.fontVariant||"AllCaps"===t.fontVariant||"SmallCaps"===t.fontVariant?n.FontVariant[t.fontVariant]:d.fontVariant,rotation:s.getOptionValue(t.rotation,d.rotation),color:s.getOptionValue(m,s.getOptionValue(d.color,n.DefaultTextStyle.DEFAULT_COLOR)),backgroundColor:s.getOptionValue(y,s.getOptionValue(d.backgroundColor,n.DefaultTextStyle.DEFAULT_BACKGROUND_COLOR)),opacity:p,backgroundOpacity:x},T=this.getTextElementStyle(t.style).renderParams;return new n.TextRenderStyle(Object.assign(Object.assign({},T),b))}createLayoutStyle(e,t){var i,s,o,a,l,c;const h=e.mapView,d=Math.floor(e.mapView.zoomLevel),u=new r.MapEnv({$zoom:d},h.env),p=this.m_defaultStyle.layoutParams,f=r.getPropertyValue(t.hAlignment,u),g=r.getPropertyValue(t.vAlignment,u),v=r.isPoiTechnique(t)?r.getPropertyValue(t.placements,u):null,{horizontalAlignment:_,verticalAlignment:y,placements:x}=m(f,g,v),b=r.getPropertyValue(t.wrappingMode,u),T="None"===b||"Character"===b||"Word"===b?n.WrappingMode[b]:p.wrappingMode,w={tracking:null!==(i=r.getPropertyValue(t.tracking,u))&&void 0!==i?i:p.tracking,leading:null!==(s=r.getPropertyValue(t.leading,u))&&void 0!==s?s:p.leading,maxLines:null!==(o=r.getPropertyValue(t.maxLines,u))&&void 0!==o?o:p.maxLines,lineWidth:null!==(a=r.getPropertyValue(t.lineWidth,u))&&void 0!==a?a:p.lineWidth,canvasRotation:null!==(l=r.getPropertyValue(t.canvasRotation,u))&&void 0!==l?l:p.canvasRotation,lineRotation:null!==(c=r.getPropertyValue(t.lineRotation,u))&&void 0!==c?c:p.lineRotation,wrappingMode:T,horizontalAlignment:_,verticalAlignment:y,placements:x},S=this.getTextElementStyle(t.style);return new n.TextLayoutStyle(Object.assign(Object.assign({},S),w))}updateDefaultTextStyle(e,t){var i,r;this.m_defaultStyle.fontCatalog=void 0;const n=null!==(r=null!==(i=null==t?void 0:t.find((e=>e.name===u)))&&void 0!==i?i:e)&&void 0!==r?r:null==t?void 0:t[0];n&&(this.m_defaultStyle=this.createTextElementStyle(n,u)),this.m_defaultStyle.textCanvas=void 0}initializeTextCanvas(e,t){var i;if(!e.textCanvas){if(void 0!==e.fontCatalog){const i=t.get(e.fontCatalog);if(e.textCanvas=i,t.has(e.fontCatalog)&&!i)return void c.info(`fontCatalog(${e.fontCatalog}), not yet loaded`)}if(void 0===e.textCanvas){void 0!==e.fontCatalog&&e.fontCatalog!==l.DEFAULT_FONT_CATALOG_NAME&&c.warn(`FontCatalog '${e.fontCatalog}' set in TextStyle\n                     '${e.name}' not found`);let r=t.get(l.DEFAULT_FONT_CATALOG_NAME);if(!r&&t.size>0)for(const[,e]of t)if(e){r=e;break}r&&(e.textCanvas=r,void 0!==e.fontCatalog&&c.info(`fontCatalog: '${e.fontCatalog}' not found,\n                      using default fontCatalog(${null===(i=e.textCanvas)||void 0===i?void 0:i.name}).`))}}}createTextElementStyle(e,t){var i;const{horizontalAlignment:r,verticalAlignment:a,placements:l}=m(e.hAlignment,e.vAlignment,e.placements);return{name:t,fontCatalog:s.getOptionValue(e.fontCatalogName,this.m_defaultStyle.fontCatalog),renderParams:{fontName:e.fontName,fontSize:{unit:n.FontUnit.Pixel,size:32,backgroundSize:null!==(i=e.backgroundSize)&&void 0!==i?i:8},fontStyle:"Regular"===e.fontStyle||"Bold"===e.fontStyle||"Italic"===e.fontStyle||"BoldItalic"===e.fontStyle?n.FontStyle[e.fontStyle]:void 0,fontVariant:"Regular"===e.fontVariant||"AllCaps"===e.fontVariant||"SmallCaps"===e.fontVariant?n.FontVariant[e.fontVariant]:void 0,rotation:e.rotation,color:void 0!==e.color?o.ColorCache.instance.getColor(e.color):void 0,backgroundColor:void 0!==e.backgroundColor?o.ColorCache.instance.getColor(e.backgroundColor):void 0,opacity:e.opacity,backgroundOpacity:e.backgroundOpacity},layoutParams:{tracking:e.tracking,leading:e.leading,maxLines:e.maxLines,lineWidth:e.lineWidth,canvasRotation:e.canvasRotation,lineRotation:e.lineRotation,wrappingMode:"None"===e.wrappingMode||"Character"===e.wrappingMode||"Word"===e.wrappingMode?n.WrappingMode[e.wrappingMode]:n.WrappingMode.Word,verticalAlignment:a,horizontalAlignment:r,placements:l}}}}},3661:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileTextStyleCache=void 0,t.TileTextStyleCache=class{constructor(e){this.textRenderStyles=[],this.textLayoutStyles=[],this.tile=e}clear(){this.textRenderStyles.length=0,this.textLayoutStyles.length=0}getRenderStyle(e){let t=this.textRenderStyles[e._index];return void 0===t&&(t=this.textRenderStyles[e._index]=this.tile.mapView.textElementsRenderer.styleCache.createRenderStyle(this.tile,e)),t}getLayoutStyle(e){let t=this.textLayoutStyles[e._index];return void 0===t&&(t=this.textLayoutStyles[e._index]=this.tile.mapView.textElementsRenderer.styleCache.createLayoutStyle(this.tile,e)),t}}},7955:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateStats=void 0;const r=i(8976);t.UpdateStats=class{constructor(e){this.m_logger=e,this.tiles=0,this.totalGroups=0,this.newGroups=0,this.totalLabels=0,this.results=new Array(r.PrePlacementResult.Count),this.results.fill(0)}clear(){this.tiles=0,this.totalGroups=0,this.newGroups=0,this.totalLabels=0,this.results.fill(0)}log(){this.m_logger.debug("Tiles",this.tiles),this.m_logger.debug("Total groups",this.totalGroups),this.m_logger.debug("New groups",this.newGroups),this.m_logger.debug("Total labels",this.totalLabels),this.m_logger.debug("Placed labels",this.results[r.PrePlacementResult.Ok]),this.m_logger.debug("Invisible",this.results[r.PrePlacementResult.Invisible]),this.m_logger.debug("Poi not ready",this.results[r.PrePlacementResult.NotReady]),this.m_logger.debug("Too far",this.results[r.PrePlacementResult.TooFar]),this.m_logger.debug("Duplicate",this.results[r.PrePlacementResult.Duplicate])}}},494:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isWorkerBootstrapResponse=t.isWorkerBootstrapRequest=void 0,t.isWorkerBootstrapRequest=function(e){return e&&"worker-bootstrap-request"===e.type&&Array.isArray(e.dependencies)},t.isWorkerBootstrapResponse=function(e){return e&&"worker-bootstrap-response"===e.type&&Array.isArray(e.resolvedDependencies)}},2235:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerLoader=void 0,i(4456);const r=i(2183),n=i(494),s=r.LoggerManager.instance.create("WorkerLoader");class o{static startWorker(e,t=1e4){return e.startsWith("blob:")?this.startWorkerImmediately(e,t):this.directlyFallbackToBlobBasedLoading?this.startWorkerBlob(e,t):this.startWorkerImmediately(e,t).catch((i=>{if("undefined"!=typeof window){const n=window.location.href,a=new URL(e,n).href;if(r.getUrlOrigin(a)===r.getUrlOrigin(n))throw i;return s.log("#startWorker: cross-origin worker construction failed, trying load with blob"),this.directlyFallbackToBlobBasedLoading=!0,o.startWorkerBlob(e,t)}throw i}))}static startWorkerImmediately(e,t){try{const i=new Worker(e);return this.waitWorkerInitialized(i,t)}catch(e){return Promise.reject(e)}}static startWorkerBlob(e,t){return this.fetchScriptSourceToBlobUrl(e).then((e=>this.startWorkerImmediately(e,t)))}static fetchScriptSourceToBlobUrl(e){let t=this.sourceLoaderCache.get(e);return void 0!==t||(t=fetch(e).then((e=>e.text())).catch((e=>{throw new Error(`WorkerLoader#fetchScriptSourceToBlob: failed to load worker script: ${e}`)})).then((t=>{this.sourceLoaderCache.delete(e);const i=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(i)})),this.sourceLoaderCache.set(e,t)),t}static waitWorkerInitialized(e,t){return new Promise(((i,r)=>{const s=t=>{const s=t.data;if(n.isWorkerBootstrapRequest(s)){const t=s.dependencies,i=[];for(const e of t){const t=this.dependencyUrlMapping[e];if(!t)return a(),void r(new Error(`#waitWorkerInitialized: Unable to resolve '${e}' as needed by worker script.`));i.push(t)}const n={type:"worker-bootstrap-response",resolvedDependencies:i};e.postMessage(n)}else a(),i(e),setTimeout((()=>{e.dispatchEvent(t)}),0)},o=e=>{a();let t="Error during worker initialization";e.message&&(t+=`: ${e.message}`),"string"==typeof e.filename&&"number"==typeof e.lineno&&(t+=` in ${e.filename}:${e.lineno}`),r(new Error(t))},a=()=>{clearTimeout(l),e.removeEventListener("message",s),e.removeEventListener("error",o)};e.addEventListener("error",o),e.addEventListener("message",s);const l=setTimeout((()=>{a(),r(new Error("Timeout exceeded when waiting for first message from worker."))}),t)}))}}t.WorkerLoader=o,o.directlyFallbackToBlobBasedLoading=!1,o.sourceLoaderCache=new Map,o.dependencyUrlMapping={}},963:function(e,t,i){"use strict";var r=this&&this.__rest||function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]])}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.CirclePointsMaterial=void 0;const n=i(4428),s=i(3993),o=i(1703);class a extends s.RawShaderMaterial{constructor(e){const t=new n.Color;let i,s,l,c;if(e){const{size:o,color:h,opacity:d}=e,u=r(e,["size","color","opacity"]);i=o,s=h,l=d,u.name="CirclePointsMaterial",u.vertexShader="\nuniform float size;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nattribute vec3 position;\n\nvoid main() {\n    vec3 transformed = vec3(position);\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.0);\n\n    gl_Position = projectionMatrix * mvPosition;\n    gl_PointSize = size;\n}\n",u.fragmentShader="\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform float opacity;\n\nvoid main() {\n    float alpha = opacity;\n\n    float radius = 0.5;\n    vec2 coords = gl_PointCoord.xy - vec2(0.5);\n    float len = length(coords);\n    float falloff = fwidth(len);\n    float threshold = 1.0 - smoothstep(radius - falloff, radius, len);\n    alpha *= threshold;\n\n    gl_FragColor = vec4(diffuse, alpha);\n}",u.uniforms=n.UniformsUtils.merge([{size:new n.Uniform(a.DEFAULT_CIRCLE_SIZE),diffuse:new n.Uniform(t),opacity:new n.Uniform(1)},n.UniformsLib.fog]),u.depthTest=!1,u.extensions=Object.assign(Object.assign({},u.extensions),{derivatives:!0}),c=u}super(c),o.enforceBlending(this),this.type="CirclePointsMaterial",this.setOpacity(1),void 0!==i&&(this.size=i),void 0!==s&&(this.color=s),void 0!==l&&this.setOpacity(l)}get size(){return this.uniforms.size.value}set size(e){this.uniforms.size.value=e}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value.copy(e)}}t.CirclePointsMaterial=a,a.DEFAULT_CIRCLE_SIZE=1},5083:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CopyMaterial=t.CopyShader=void 0;const r=i(4428);t.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",fragmentShader:"\n    uniform float opacity;\n    uniform sampler2D tDiffuse;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        gl_FragColor = opacity * texel;\n    }"};class n extends r.ShaderMaterial{constructor(e){super({name:"CopyMaterial",uniforms:e,vertexShader:t.CopyShader.vertexShader,fragmentShader:t.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!1,blending:r.NoBlending,depthTest:!1,depthWrite:!1})}}t.CopyMaterial=n},3255:(e,t)=>{"use strict";function i(e){return"displacementMap"in e}Object.defineProperty(t,"__esModule",{value:!0}),t.setDisplacementMapToMaterial=t.hasDisplacementFeature=void 0,t.hasDisplacementFeature=i,t.setDisplacementMapToMaterial=function(e,t){i(t)&&t.displacementMap!==e&&(t.displacementMap=e,t.needsUpdate=!0,null!==t.displacementMap&&(t.displacementMap.needsUpdate=!0))}},7833:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeMaterial=void 0;const r=i(4428),n=i(5722),s=i(8136),o=i(3993),a=i(1703);class l extends o.RawShaderMaterial{constructor(e){var t;let i;if(e){const o={},c=void 0!==e.extrusionRatio&&e.extrusionRatio>=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN&&e.extrusionRatio<s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX;e.displacementMap&&a.setShaderDefine(o,"USE_DISPLACEMENTMAP",!0),c&&a.setShaderDefine(o,"USE_EXTRUSION",!0),!0===e.vertexColors&&a.setShaderDefine(o,"USE_COLOR",!0),i={name:"EdgeMaterial",vertexShader:"\n#define EDGE_DEPTH_OFFSET 0.0001\n\n#ifdef USE_COLOR\nattribute vec4 color;\n#else\nuniform vec3 color;\n#endif\n\n// SHADER_NAME may be defined by THREE.JS own shaders in which case these attributes & uniforms are\n// already defined\n#ifndef SHADER_NAME\nattribute vec3 position;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat3 normalMatrix;\n#endif\n\nuniform vec3 edgeColor;\nuniform float edgeColorMix;\n\n#ifdef USE_DISPLACEMENTMAP\nattribute vec3 normal;\nattribute vec2 uv;\nuniform sampler2D displacementMap;\n#endif\n\nvarying vec3 vColor;\n\n#ifdef USE_EXTRUSION\n#include <extrusion_pars_vertex>\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\nvoid main() {\n\n    vColor = mix(edgeColor.rgb, color.rgb, edgeColorMix);\n\n    vec3 transformed = vec3( position );\n\n    #ifdef USE_EXTRUSION\n    #include <extrusion_vertex>\n    #endif\n\n    #ifdef USE_DISPLACEMENTMAP\n    transformed += normalize( normal ) * texture2D( displacementMap, uv ).x;\n    #endif\n\n    vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n    gl_Position = projectionMatrix * mvPosition;\n    // After projection gl_Position contains clip space coordinates of each vertex\n    // before perspective division (1 / w), thus only vertexes with -w < z < w should\n    // be displayed and offset. We offset only those edges which z coordinate in NDC\n    // space is between: -inf < z < 1\n    float depthOffset = step(-1.0, -gl_Position.z / gl_Position.w) * EDGE_DEPTH_OFFSET;\n    gl_Position.z -= depthOffset;\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n}",fragmentShader:"\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vColor;\n\n#ifdef USE_EXTRUSION\n#include <extrusion_pars_fragment>\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\nvoid main() {\n    float alphaValue = 1.0;\n    gl_FragColor = vec4(vColor, alphaValue);\n\n    #ifdef USE_EXTRUSION\n    #include <extrusion_fragment>\n    #endif\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}",uniforms:{color:new r.Uniform(new r.Color(l.DEFAULT_COLOR)),edgeColor:new r.Uniform(new r.Color(l.DEFAULT_COLOR)),edgeColorMix:new r.Uniform(l.DEFAULT_COLOR_MIX),fadeNear:new r.Uniform(n.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new r.Uniform(n.FadingFeature.DEFAULT_FADE_FAR),extrusionRatio:new r.Uniform(s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX),displacementMap:new r.Uniform(null!==(t=e.displacementMap)&&void 0!==t?t:new r.Texture)},depthWrite:!1,defines:o,rendererCapabilities:e.rendererCapabilities}}super(i),a.enforceBlending(this),n.FadingFeature.patchGlobalShaderChunks(),n.ExtrusionFeature.patchGlobalShaderChunks(),void 0!==e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.colorMix&&(this.colorMix=e.colorMix),void 0!==e.fadeNear&&(this.fadeNear=e.fadeNear),void 0!==e.fadeFar&&(this.fadeFar=e.fadeFar),void 0!==e.displacementMap&&(this.displacementMap=e.displacementMap),void 0!==e.extrusionRatio&&(this.extrusionRatio=e.extrusionRatio))}get objectColor(){return this.uniforms.color.value}set objectColor(e){this.uniforms.color.value.copy(e)}get color(){return this.uniforms.edgeColor.value}set color(e){this.uniforms.edgeColor.value.copy(e)}get lineWidth(){return this.linewidth}set lineWidth(e){this.linewidth=e,this.linewidth<=0?this.visible=!1:this.visible=!0}get colorMix(){return this.uniforms.edgeColorMix.value}set colorMix(e){this.uniforms.edgeColorMix.value!==e&&(this.uniforms.edgeColorMix.value=e)}get fadeNear(){return this.uniforms.fadeNear.value}set fadeNear(e){this.uniforms.fadeNear.value=e}get fadeFar(){return this.uniforms.fadeFar.value}set fadeFar(e){this.uniforms.fadeFar.value!==e&&(this.uniforms.fadeFar.value=e,a.setShaderMaterialDefine(this,"USE_FADING",e>0))}get extrusionRatio(){return this.uniforms.extrusionRatio.value}set extrusionRatio(e){if(this.uniforms.extrusionRatio.value===e)return;this.uniforms.extrusionRatio.value=e;const t=e>=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN;a.setShaderMaterialDefine(this,"USE_EXTRUSION",t)}get displacementMap(){return this.uniforms.displacementMap.value}set displacementMap(e){if(this.uniforms.displacementMap.value===e)return;this.uniforms.displacementMap.value=e;const t=null!==e;t&&(this.uniforms.displacementMap.value.needsUpdate=!0),a.setShaderMaterialDefine(this,"USE_DISPLACEMENTMAP",t)}}t.EdgeMaterial=l,l.DEFAULT_COLOR=0,l.DEFAULT_COLOR_MIX=0},5656:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroundAtmosphereMaterial=t.GroundAtmosphereShader=void 0;const r=i(4428),n=i(3993),s=i(2870),o=i(1703);t.GroundAtmosphereShader={uniforms:{u_eyePositionWorld:new r.Uniform(new r.Vector3),u_lightDirectionWorld:new r.Uniform(new r.Vector3(0,1,0)),u_modelViewProjection:new r.Uniform(new r.Matrix4),u_atmosphereEnv:new r.Uniform(new r.Vector3(6384515.136999999,6537590.425,0)),u_hsvCorrection:new r.Uniform(new r.Vector3(0,0,0)),topColor:new r.Uniform(new r.Color(30719)),bottomColor:new r.Uniform(new r.Color(16777215)),offset:new r.Uniform(33),exponent:new r.Uniform(.6),fogColor:new r.Uniform(new r.Color(30719)),fogNear:new r.Uniform(new r.Color(30719)),fogFar:new r.Uniform(new r.Color(16777215))},vertexShader:`\n\n    #define IMPROVE_INTERSECT_PRECISION 1\n    #define IMPROVE_DOT_PRECISION 1\n\n    precision highp float;\n    precision highp int;\n\n    attribute vec4 position;\n\n    // Base mandatory uniforms\n    uniform mat4 u_modelViewProjection;\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_hsvCorrection;\n\n    const float Pi = 3.141592653589793;\n    const float Kr = 0.0025;\n    const float Km = 0.0015;\n    const float Kr4PI = Kr * 4.0 * Pi;\n    const float Km4PI = Km * 4.0 * Pi;\n    const float ESun = 25.0; // should be 15.0\n    const float KmESun = Km * ESun;\n    const float KrESun = Kr * ESun;\n    const vec3 InvWavelength = vec3(\n        1.0 / pow(0.650, 4.0), // Red\n        1.0 / pow(0.570, 4.0), // Green\n        1.0 / pow(0.475, 4.0)); // Blue\n\n    const int nSamples = 2;\n    const float fSamples = 2.0;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n    varying vec3 v_vertToOrigin;\n\n    ${s.default.atmosphere_vertex_utils}\n\n    //\n    // Computes rayleight and mia atmosphere factors for ground.\n    //\n    // Code based on GPU Gems article.\n    //\n    // Author: Sean O'Neil\n    //\n    // Copyright (c) 2004 Sean O'Neil\n    //\n    // https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering\n    //\n    // Further modifications by HERE.\n    //\n    AtmosphereColor computeGroundAtmosphere(vec3 v3Pos, vec3 vLightDir)\n    {\n        // Retrieve environment variables\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        // All that may be moved to const or define(s) at further optimizations:\n        float fScale = 1.0 / (fOuterRadius - fInnerRadius);\n        float fScaleOverScaleDepth = fScale / RayleighScaleDepth;\n        float fCameraHeight2 = fCameraHeight * fCameraHeight;\n        float fOuterRadius2 = fOuterRadius * fOuterRadius;\n\n        // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n        vec3 v3Ray = v3Pos - u_eyePositionWorld;\n        float fFar = length(v3Ray);\n        v3Ray /= fFar;\n\n#if !defined(IMPROVE_DOT_PRECISION)\n        vec3 v3Dir = normalize(v3Pos);\n#endif\n\n#ifdef CAMERA_IN_SPACE\n\n        // Calculate first point of camera ray and sphere intersection.\n        float fNear = getNearSphereIntersect(u_eyePositionWorld, v3Ray, fCameraHeight2, fOuterRadius2);\n        // Make far relative to first atmosphere intersection, setting it to\n        // the length of ray passed through atmosphere\n        fFar -= fNear;\n\n        // Compute the ray's starting position within the atmosphere, then\n        // calculate its scattering offset\n        vec3 v3Start = u_eyePositionWorld + v3Ray * fNear;\n        float fDepth = exp((fInnerRadius - fOuterRadius) / RayleighScaleDepth);\n\n#else // CAMERA_IN_ATMOSPHERE\n\n        // The ray starts already in atmosphere\n        vec3 v3Start = u_eyePositionWorld;\n        // Virtually fNear is just at eye position, so ray passing through atmosphere does not shorten\n        // fFar -= 0.0;\n        float fDepth = exp((fInnerRadius - fCameraHeight) / RayleighScaleDepth);\n#endif\n\n#if defined(IMPROVE_DOT_PRECISION)\n        float fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\n#else\n        float fCameraAngle = dot(-v3Ray, v3Dir);\n#endif\n        float fCameraScale = scale(fCameraAngle);\n\n#ifdef DYNAMIC_LIGHT\n        // When we want the atmosphere to be uniform over the globe so it is set to 1.0.\n        #if defined(IMPROVE_DOT_PRECISION)\n            // The light angle for given light source may be calculated as:\n            // angle = dot(vLightDir, v3Dir) / length(v3Dir);\n            // where v3Dir holds normalized vertex position, but for precision issues we v3Pos (un-normalized)\n            float fLightAngle = dot(vLightDir, v3Pos) / length(v3Pos);\n        #else\n            float fLightAngle = dot(vLightDir, v3Dir);\n        #endif\n#else\n        float fLightAngle = 1.0;\n#endif\n        float fLightScale = scale(fLightAngle);\n\n        float fCameraOffset = fDepth * fCameraScale;\n        float fTemp = (fLightScale + fCameraScale);\n\n        // Initialize the scattering loop variables\n        float fSampleLength = fFar / fSamples;\n        float fScaledLength = fSampleLength * fScale;\n        vec3 v3SampleRay = v3Ray * fSampleLength;\n        vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n        // Now loop through the sample rays\n        vec3 v3BaseColor = vec3(0.0);\n        vec3 v3Attenuate = vec3(0.0);\n        for(int i = 0; i < nSamples; i++)\n        {\n            float fHeight = length(v3SamplePoint);\n            float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n            float fScatter = fDepth * fTemp - fCameraOffset;\n            // Compute color factors\n            v3Attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\n            v3BaseColor += v3Attenuate * (fDepth * fScaledLength);\n            // Move to the next point\n            v3SamplePoint += v3SampleRay;\n        }\n\n        AtmosphereColor color;\n        color.mie = v3BaseColor * (InvWavelength * KrESun + KmESun);\n        // Calculate the attenuation factor for the ground\n        color.rayleigh = v3Attenuate;\n\n        return color;\n    }\n\n    void main(void)\n    {\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        AtmosphereColor atmColor = computeGroundAtmosphere(position.xyz, vLightDir);\n        v_mieColor = atmColor.mie;\n        v_rayleighColor = atmColor.rayleigh;\n        v_vertToCamera = u_eyePositionWorld - position.xyz;\n        v_vertToOrigin = normalize(position.xyz);\n\n        gl_Position = u_modelViewProjection * position;\n    }\n    `,fragmentShader:`\n\n    // Exposure correction gives more subtle gradients on the ground.\n    #define CORRECT_EXPOSURE 1\n    #define FADE_DEPTH 1\n    #define NIGHT_LOCAL 1\n\n    precision highp float;\n    precision highp int;\n\n    #ifdef CORRECT_COLOR\n    uniform vec3 u_hsvCorrection; // Hue, saturation, brightness\n    #endif\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    const float g = -0.95;\n    const float g2 = g * g;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n    varying vec3 v_vertToOrigin;\n\n    ${s.default.atmosphere_fragment_utils}\n\n    void main(void)\n    {\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        // GPU gems mix of ground solution, with custom alpha settings\n        vec3 cRgb = v_mieColor + 0.25 * v_rayleighColor;\n\n        // Not needed for HDR frame buffer\n    #if !defined(HDR_FRAME_BUFFER) && defined(CORRECT_EXPOSURE)\n        // Interesting results with exposure factor: 2.0, 3.5, 4.0\n        cRgb = correctExposure(cRgb, 3.0);\n    #endif\n\n    #ifdef CORRECT_COLOR\n        cRgb = correctColor(cRgb, u_hsvCorrection);\n    #endif\n\n        // Base atmosphere opacity\n        float fAtmosphereAlpha = 1.0;\n\n        // Factor based on the distance of camera atmosphere and ground, results are:\n        // 0.0 = camera on the ground surface,\n        // 1.0 = at the outer edge of the atmosphere.\n        float fDepthFactor = clamp((fCameraHeight - fInnerRadius) /\n            (fOuterRadius - fInnerRadius), 0.0, 1.0);\n    #ifdef FADE_DEPTH\n        // Fade alpha based on the distance of camera between atmosphere layers\n        #ifdef FADE_DEPTH_LINEAR\n            fAtmosphereAlpha *= fDepthFactor;\n        #else\n            fAtmosphereAlpha *= pow(fDepthFactor, 1.5);\n        #endif\n    #endif\n\n#if defined(FADE_NIGHT) || defined(DARKEN_NIGHT)\n    #ifdef DYNAMIC_LIGHT\n        // Adjust factor based on time of day, results are:\n        // 0.0 = night,\n        // 1.0 = day.\n        #ifdef NIGHT_GLOBAL\n            // Global night fade based on camera and light orientation\n            float fNightFactor = clamp(dot(normalize(u_eyePositionWorld), vLightDir), 0.0, 1.0);\n            fNightFactor = pow(fNightFactor, 0.5);\n        #else // NIGHT_LOCAL\n            float fNightFactor =\n                clamp(dot(v_vertToOrigin, vLightDir) / length(v_vertToOrigin), 0.0, 1.0);\n            fNightFactor = pow(fNightFactor, 0.8);\n        #endif\n    #else\n        float fNightFactor = 1.0;\n    #endif\n#endif\n\n    #ifdef FADE_NIGHT\n        // Adjust alpha for night side of the globe\n        fAtmosphereAlpha *= fNightFactor;\n    #endif\n\n    #ifdef DARKEN_NIGHT\n        // Change the brightness depending on night / day side.\n        // NOTE: Darkening should be rather applied in HSV space, without loss on saturation,\n        // but it is much more GPU consuming.\n        const float minBrightness = 0.5;\n        float fDarkenFactor = clamp(fNightFactor, minBrightness, 1.0);\n        cRgb *= fDarkenFactor;\n    #endif\n\n    #ifdef EXPOSURE_DEPTH\n        // Control exposure depending from ground distance\n        float exposureBoost = 3.0 - fDepthFactor;\n        cRgb = correctExposure(cRgb, exposureBoost);\n    #endif\n\n        // Experimental fading out of focus point - similar to fresnel effect in top view.\n        // This fade is handy to better expose cartographic/map features in screen center.\n        float fFocusFactor = 1.0 - clamp(dot(normalize(v_vertToCamera), v_vertToOrigin), 0.0, 1.0) + 0.1;\n        fFocusFactor = pow(fFocusFactor, 2.5);\n        fAtmosphereAlpha *= fFocusFactor;\n\n        // Integrate all features\n        gl_FragColor = vec4(cRgb, fAtmosphereAlpha);\n    }\n    `};class a extends n.RawShaderMaterial{constructor(e){let i;e&&(i={name:"GroundAtmosphereMaterial",vertexShader:t.GroundAtmosphereShader.vertexShader,fragmentShader:t.GroundAtmosphereShader.fragmentShader,uniforms:t.GroundAtmosphereShader.uniforms,transparent:!0,depthTest:!1,depthWrite:!1,side:r.FrontSide,blending:r.NormalBlending,fog:!1,rendererCapabilities:e.rendererCapabilities}),super(i)}setDynamicLighting(e){o.setShaderMaterialDefine(this,"DYNAMIC_LIGHT",e)}set outerRadius(e){this.uniforms.u_atmosphereEnv.value.y=e}get outerRadius(){return this.uniforms.u_atmosphereEnv.value.y}set innerRadius(e){this.uniforms.u_atmosphereEnv.value.x=e}get innerRadius(){return this.uniforms.u_atmosphereEnv.value.x}updateUniforms(e,t,i,r){const n=this.getCameraInfo(t,i);if(void 0===e||!e.isMaterial)throw Error("Wrong object used, only Material objects are supported");if(!(e.uniforms&&e.uniforms.u_atmosphereEnv&&e.uniforms.u_hsvCorrection&&e.uniforms.u_eyePositionWorld&&e.uniforms.u_modelViewProjection&&e.uniforms.u_lightDirectionWorld))throw Error("Atmosphere material has missing uniforms");{const t=n.eyePos,i=n.modelViewProjection,s=n.eyeHeight;e.uniforms.u_eyePositionWorld.value.copy(t),e.uniforms.u_modelViewProjection.value.copy(i),e.uniforms.u_atmosphereEnv.value.z=s,e.uniforms.u_lightDirectionWorld.value=r.clone();const a=s>this.outerRadius,l=o.setShaderDefine(e.defines,"CAMERA_IN_SPACE",a),c=o.setShaderDefine(e.defines,"CAMERA_IN_ATMOSPHERE",!a);e.needsUpdate=e.needsUpdate||l||c}}getCameraInfo(e,t,i=!1){if(i){const i=(new r.Matrix4).identity(),n=(new r.Matrix4).copy(e.matrixWorld).invert().transpose(),s=t.projectionMatrix,o=new r.Matrix4;o.multiplyMatrices(n,i),o.multiplyMatrices(s,o);const a=new r.Vector3;e.getWorldPosition(a);const l=new r.Vector3;return t.getWorldPosition(l),{modelViewProjection:o,eyePos:a,eyeHeight:l.distanceTo(a)}}{const i=e.matrixWorld,n=t.matrixWorldInverse,s=t.projectionMatrix,o=new r.Matrix4;o.multiplyMatrices(n,i),o.multiplyMatrices(s,o);const a=new r.Vector3;t.getWorldPosition(a);const l=new r.Vector3;e.getWorldPosition(l);const c=l.distanceTo(a);return a.sub(l),{modelViewProjection:o,eyePos:a,eyeHeight:c}}}}t.GroundAtmosphereMaterial=a},5172:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isHighPrecisionLineMaterial=t.HighPrecisionLineMaterial=void 0;const r=i(4428),n=i(3993),s=i(5477);class o extends n.RawShaderMaterial{constructor(e){Object.assign(r.ShaderChunk,s.default);const t=e?{name:"HighPrecisionLineMaterial",vertexShader:"\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 position;        // high part\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n}",fragmentShader:"\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifdef USE_COLOR\nvarying vec3 color;\n#endif\n\nvoid main() {\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( diffuse * vColor, opacity );\n    #else\n    gl_FragColor = vec4( diffuse, opacity );\n    #endif\n}",uniforms:{diffuse:new r.Uniform(new r.Color(o.DEFAULT_COLOR)),opacity:new r.Uniform(o.DEFAULT_OPACITY),u_mvp:new r.Uniform(new r.Matrix4),u_eyepos:new r.Uniform(new r.Vector3),u_eyepos_lowpart:new r.Uniform(new r.Vector3)},rendererCapabilities:e.rendererCapabilities}:void 0;Object.assign(t,e),super(t),this.type="HighPrecisionLineMaterial",this.isHighPrecisionLineMaterial=!0,e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.opacity&&(this.opacity=e.opacity)),this.updateTransparencyFeature()}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value.copy(e)}updateTransparencyFeature(){this.transparent=this.opacity<1}}t.HighPrecisionLineMaterial=o,o.DEFAULT_COLOR=80,o.DEFAULT_OPACITY=1,t.isHighPrecisionLineMaterial=function(e){return void 0!==e&&!0===e.isHighPrecisionLineMaterial}},884:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isHighPrecisionPointMaterial=t.HighPrecisionPointMaterial=void 0;const r=i(4428),n=i(5477);class s extends r.PointsMaterial{constructor(e){Object.assign(r.ShaderChunk,n.default),super(e),this.type="HighPrecisionPointMaterial",this.vertexShader="\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\nuniform float size;\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n\n    // ignore sizeAttenuation for now!\n    gl_PointSize = size;\n}",this.fragmentShader=r.ShaderChunk.points_frag,this.fog=!1,this.uniforms={diffuse:new r.Uniform(new r.Color(s.DEFAULT_COLOR)),opacity:new r.Uniform(s.DEFAULT_OPACITY),size:new r.Uniform(s.DEFAULT_SIZE),scale:new r.Uniform(s.DEFAULT_SCALE),map:new r.Uniform(new r.Texture),uvTransform:new r.Uniform(new r.Matrix3),u_mvp:new r.Uniform(new r.Matrix4),u_eyepos:new r.Uniform(new r.Vector3),u_eyepos_lowpart:new r.Uniform(new r.Vector3)},this.isHighPrecisionPointMaterial=!0,void 0!==e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.opacity&&(this.opacity=e.opacity),void 0!==e.size&&(this.size=e.size),void 0!==e.scale&&(this.scale=e.scale),void 0!==e.uvTransform&&(this.uvTransform=e.uvTransform),void 0!==e.map&&(this.map=e.map))}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}get uvTransform(){return this.uniforms.uvTransform.value}set uvTransform(e){this.uniforms.uvTransform.value=e}}t.HighPrecisionPointMaterial=s,s.DEFAULT_COLOR=80,s.DEFAULT_OPACITY=1,s.DEFAULT_SIZE=1,s.DEFAULT_SCALE=1,t.isHighPrecisionPointMaterial=function(e){return void 0!==e&&!0===e.isHighPrecisionPointMaterial}},2343:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconMaterial=void 0;const r=i(4428),n=i(3993);class s extends n.RawShaderMaterial{constructor(e){super(e?{name:"IconMaterial",vertexShader:"\nattribute vec4 position;\nattribute vec4 color;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    vColor = color;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n}",fragmentShader:"\nprecision highp float;\nprecision highp int;\n\nuniform sampler2D map;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n\n    vec4 color = texture2D(map, vUv.xy);\n    color *= vColor;\n    if (color.a < 0.05) {\n        discard;\n    }\n    gl_FragColor = color;\n}",uniforms:{map:new r.Uniform(e.map)},depthTest:!0,depthWrite:!1,transparent:!0,vertexColors:!0,premultipliedAlpha:!0,rendererCapabilities:e.rendererCapabilities}:void 0)}get map(){return this.uniforms.map.value}}t.IconMaterial=s},5930:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LuminosityHighPassShader=void 0;const r=i(4428);t.LuminosityHighPassShader={uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new r.Color(0)},defaultOpacity:{value:0}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform vec3 defaultColor;\n    uniform float defaultOpacity;\n    uniform float luminosityThreshold;\n    uniform float smoothWidth;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        vec3 luma = vec3( 0.299, 0.587, 0.114 );\n        float v = dot( texel.xyz, luma );\n        vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n        float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n        gl_FragColor = mix( outputColor, texel, alpha );\n    }"}},8682:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MSAAMaterial=void 0;const r=i(4428),n=i(5083);class s extends r.ShaderMaterial{constructor(e){super({uniforms:e,vertexShader:n.CopyShader.vertexShader,fragmentShader:n.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:r.AdditiveBlending,depthTest:!1,depthWrite:!1})}}t.MSAAMaterial=s},5722:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapMeshStandardMaterial=t.MapMeshDepthMaterial=t.MapMeshBasicMaterial=t.ExtrusionFeatureMixin=t.ExtrusionFeature=t.FadingFeatureMixin=t.FadingFeature=t.DisplacementFeatureMixin=t.hasExtrusionFeature=void 0;const r=i(2183),n=i(4428),s=i(8136),o=i(7225),a=i(9178),l=i(5888),c=i(1703),h=new n.Texture;function d(e,t){return e*t.maximum}function u(e,t){void 0===t.defines&&(t.defines={}),e.shaderDefines=t.defines,void 0===e.shaderUniforms&&(e.shaderUniforms={})}function m(e,t){Object.assign(t.uniforms,e.shaderUniforms),e.shaderUniforms=t.uniforms}var p,f,g;t.hasExtrusionFeature=function(e){return"extrusionRatio"in e},function(e){function t(e){return null!==e.displacementMap}e.isEnabled=t,e.updateDisplacementFeature=function(e){r.assert(void 0!==e.shaderDefines),r.assert(void 0!==e.shaderUniforms);const i=t(e),n=c.setShaderDefine(e.shaderDefines,"USE_DISPLACEMENTMAP",i);if(e.needsUpdate=n,i){const t=e.displacementMap;t.needsUpdate=!0,e.shaderUniforms.displacementMap.value=t}else n&&(e.shaderUniforms.displacementMap.value=h)},e.onBeforeCompile=function(e,i){t(e)&&(r.assert(void 0!==e.shaderUniforms),m(e,i),i.vertexShader=i.vertexShader.replace("#include <skinbase_vertex>","#include <skinbase_vertex>\n#ifndef USE_ENVMAP\n    vec3 objectNormal = vec3( normal );\n#endif"),i.vertexShader=c.insertShaderInclude(i.vertexShader,"uv2_pars_vertex","displacementmap_pars_vertex"),i.vertexShader=c.insertShaderInclude(i.vertexShader,"skinning_vertex","displacementmap_vertex",!0))}}(p||(p={}));class v{constructor(){this.m_displacementMap=null}get displacementMap(){return this.m_displacementMap}set displacementMap(e){this.setDisplacementMap(e)}getDisplacementMap(){return this.m_displacementMap}setDisplacementMap(e){e!==this.m_displacementMap&&(this.m_displacementMap=e,p.updateDisplacementFeature(this))}addDisplacementProperties(){Object.defineProperty(this,"displacementMap",{get:()=>this.getDisplacementMap(),set:e=>{this.setDisplacementMap(e)}})}applyDisplacementParameters(e){u(this,this),r.assert(void 0!==this.shaderDefines),r.assert(void 0!==this.shaderUniforms);const t=this.shaderUniforms;t.displacementMap=new n.Uniform(h),t.displacementScale=new n.Uniform(1),t.displacementBias=new n.Uniform(0),void 0!==e&&void 0!==e.displacementMap&&this.setDisplacementMap(e.displacementMap),this.onBeforeCompile=r.chainCallbacks(this.onBeforeCompile,(e=>{p.onBeforeCompile(this,e)})),this.needsUpdate=p.isEnabled(this)}copyDisplacementParameters(e){return this.setDisplacementMap(e.displacementMap),this}}t.DisplacementFeatureMixin=v,function(e){function t(e){return void 0!==e.fadeNear&&void 0!==e.fadeFar&&e.fadeFar>0}e.DEFAULT_FADE_NEAR=-1,e.DEFAULT_FADE_FAR=-1,e.isEnabled=t,e.isDefined=function(e){return void 0!==e.fadeNear&&void 0!==e.fadeFar},e.patchGlobalShaderChunks=function(){void 0===n.ShaderChunk.fading_pars_vertex&&Object.assign(n.ShaderChunk,a.default)},e.updateFadingFeature=function(i){r.assert(void 0!==i.shaderDefines),r.assert(void 0!==i.shaderUniforms);const n=t(i),s=c.setShaderDefine(i.shaderDefines,"FADING_MATERIAL",n);i.needsUpdate=s,r.assert(void 0!==i.shaderUniforms.fadeNear&&void 0!==i.shaderUniforms.fadeFar),n?(i.shaderUniforms.fadeNear.value=i.fadeNear,i.shaderUniforms.fadeFar.value=i.fadeFar,s&&c.enableBlending(i)):s&&(i.shaderUniforms.fadeNear.value=e.DEFAULT_FADE_NEAR,i.shaderUniforms.fadeFar.value=e.DEFAULT_FADE_FAR,c.disableBlending(i))},e.onBeforeCompile=function(e,i){t(e)&&(r.assert(void 0!==e.shaderUniforms),m(e,i),i.vertexShader=c.insertShaderInclude(i.vertexShader,"fog_pars_vertex","fading_pars_vertex"),i.vertexShader=c.insertShaderInclude(i.vertexShader,"fog_vertex","fading_vertex",!0),i.fragmentShader=c.insertShaderInclude(i.fragmentShader,"fog_pars_fragment","fading_pars_fragment"),i.fragmentShader=c.insertShaderInclude(i.fragmentShader,"fog_fragment","fading_fragment",!0))},e.addRenderHelper=function(t,i,n,s,o,a){t.onBeforeRender=r.chainCallbacks(t.onBeforeRender,((t,r,o,l,c,h)=>{const u=c;u.fadeNear=void 0===n||n===e.DEFAULT_FADE_NEAR?e.DEFAULT_FADE_NEAR:d(n,i),u.fadeFar=void 0===s||s===e.DEFAULT_FADE_FAR?e.DEFAULT_FADE_FAR:d(s,i),void 0!==a&&a(t,c)}))}}(f=t.FadingFeature||(t.FadingFeature={}));class _{constructor(){this.m_fadeNear=f.DEFAULT_FADE_NEAR,this.m_fadeFar=f.DEFAULT_FADE_FAR}getFadeNear(){return this.m_fadeNear}setFadeNear(e){e!==this.m_fadeNear&&(this.m_fadeNear=e,f.updateFadingFeature(this))}getFadeFar(){return this.m_fadeFar}setFadeFar(e){e!==this.m_fadeFar&&(this.m_fadeFar=e,f.updateFadingFeature(this))}addFadingProperties(){Object.defineProperty(this,"fadeNear",{get:()=>this.getFadeNear(),set:e=>{this.setFadeNear(e)}}),Object.defineProperty(this,"fadeFar",{get:()=>this.getFadeFar(),set:e=>{this.setFadeFar(e)}})}applyFadingParameters(e){u(this,this),r.assert(void 0!==this.shaderDefines),r.assert(void 0!==this.shaderUniforms),this.shaderUniforms.fadeNear=new n.Uniform(f.DEFAULT_FADE_NEAR),this.shaderUniforms.fadeFar=new n.Uniform(f.DEFAULT_FADE_FAR),void 0!==e&&(void 0!==e.fadeNear&&this.setFadeNear(e.fadeNear),void 0!==e.fadeFar&&this.setFadeFar(e.fadeFar)),this.onBeforeCompile=r.chainCallbacks(this.onBeforeCompile,(e=>{f.onBeforeCompile(this,e)})),this.needsUpdate=f.isEnabled(this)}copyFadingParameters(e){return this.setFadeNear(void 0===e.fadeNear?f.DEFAULT_FADE_NEAR:e.fadeNear),this.setFadeFar(void 0===e.fadeFar?f.DEFAULT_FADE_FAR:e.fadeFar),this}}t.FadingFeatureMixin=_,function(e){function t(e){return void 0!==e.extrusionRatio&&e.extrusionRatio>=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MIN}e.isEnabled=t,e.patchGlobalShaderChunks=function(){void 0===n.ShaderChunk.extrusion_pars_vertex&&Object.assign(n.ShaderChunk,o.default)},e.updateExtrusionFeature=function(e){r.assert(void 0!==e.shaderDefines),r.assert(void 0!==e.shaderUniforms);const i=t(e),n=c.setShaderDefine(e.shaderDefines,"EXTRUSION_MATERIAL",i);e.needsUpdate=n,i?e.shaderUniforms.extrusionRatio.value=e.extrusionRatio:n&&(e.shaderUniforms.extrusionRatio.value=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX)},e.onBeforeCompile=function(e,i){t(e)&&(r.assert(void 0!==e.shaderUniforms),m(e,i),i.vertexShader=c.insertShaderInclude(i.vertexShader,"common","extrusion_pars_vertex"),i.vertexShader=c.insertShaderInclude(i.vertexShader,"begin_vertex","extrusion_vertex",!0),i.fragmentShader=c.insertShaderInclude(i.fragmentShader,"fog_pars_fragment","extrusion_pars_fragment"),i.fragmentShader=i.fragmentShader.replace("#include <normal_fragment_begin>","#include <extrusion_normal_fragment_begin>"),i.fragmentShader=c.insertShaderInclude(i.fragmentShader,"fog_fragment","extrusion_fragment",!0))}}(g=t.ExtrusionFeature||(t.ExtrusionFeature={}));class y{constructor(){this.m_extrusion=s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}getExtrusionRatio(){return this.m_extrusion}setExtrusionRatio(e){e!==this.m_extrusion&&(this.m_extrusion=e,g.updateExtrusionFeature(this))}addExtrusionProperties(){Object.defineProperty(this,"extrusionRatio",{get:()=>this.getExtrusionRatio(),set:e=>{this.setExtrusionRatio(e)}})}applyExtrusionParameters(e){u(this,this),r.assert(void 0!==this.shaderDefines),r.assert(void 0!==this.shaderUniforms),e&&!0===e.zFightingWorkaround&&(this.shaderDefines.ZFIGHTING_WORKAROUND=""),this.shaderUniforms.extrusionRatio=new n.Uniform(s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX),void 0!==e&&void 0!==e.extrusionRatio&&this.setExtrusionRatio(e.extrusionRatio),this.onBeforeCompile=r.chainCallbacks(this.onBeforeCompile,(e=>{g.onBeforeCompile(this,e)})),this.needsUpdate=g.isEnabled(this)}copyExtrusionParameters(e){return void 0!==e.extrusionRatio&&this.setExtrusionRatio(e.extrusionRatio),this}}t.ExtrusionFeatureMixin=y;class x extends n.MeshBasicMaterial{constructor(e){super(e),f.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),g.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!0})),this.addDisplacementProperties(),this.applyDisplacementParameters(e)}clone(){return(new x).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this.copyDisplacementParameters(e),this}get fadeNear(){return f.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return f.DEFAULT_FADE_FAR}set fadeFar(e){}get extrusionRatio(){return s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}get displacementMap(){return null}set displacementMap(e){}setDisplacementMap(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}addDisplacementProperties(){}applyDisplacementParameters(e){}copyDisplacementParameters(e){}}t.MapMeshBasicMaterial=x;class b extends n.MeshDepthMaterial{constructor(e){super(e),g.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!1})),this.flatShading=!1}get extrusionRatio(){return s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshDepthMaterial=b;class T extends n.MeshStandardMaterial{constructor(e){super(e),f.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),g.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(Object.assign(Object.assign({},e),{zFightingWorkaround:!0})),!0===(null==e?void 0:e.removeDiffuseLight)&&(this.onBeforeCompile=r.chainCallbacks(this.onBeforeCompile,(e=>{e.fragmentShader=n.ShaderChunk.meshphysical_frag.replace("#include <lights_physical_pars_fragment>",l.simpleLightingShadowChunk)})))}clone(){return(new T).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this}get fadeNear(){return f.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return f.DEFAULT_FADE_FAR}set fadeFar(e){}get extrusionRatio(){return s.ExtrusionFeatureDefs.DEFAULT_RATIO_MAX}set extrusionRatio(e){}get removeDiffuseLight(){return!1}set removeDiffuseLight(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshStandardMaterial=T,r.applyMixinsWithoutProperties(x,[_]),r.applyMixinsWithoutProperties(T,[_]),r.applyMixinsWithoutProperties(x,[y]),r.applyMixinsWithoutProperties(T,[y]),r.applyMixinsWithoutProperties(b,[y]),r.applyMixinsWithoutProperties(x,[v])},8136:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ExtrusionFeatureDefs=void 0,(i=t.ExtrusionFeatureDefs||(t.ExtrusionFeatureDefs={})).DEFAULT_RATIO_MIN=0,i.DEFAULT_RATIO_MAX=1,i.MIN_BUILDING_HEIGHT=.01},3993:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RawShaderMaterial=void 0;const r=i(2183),n=i(4428),s=i(1703);class o extends n.RawShaderMaterial{constructor(e){const t=!0===(null==e?void 0:e.rendererCapabilities.isWebGL2),i=e?Object.assign(Object.assign({},e),{glslVersion:t?n.GLSL3:n.GLSL1,vertexShader:t&&e.vertexShader?r.convertVertexShaderToWebGL2(e.vertexShader):e.vertexShader,fragmentShader:t&&e.fragmentShader?r.convertFragmentShaderToWebGL2(e.fragmentShader):e.fragmentShader}):void 0;i&&delete i.rendererCapabilities,super(i),this.invalidateFog(),this.setOpacity(null==i?void 0:i.opacity)}invalidateFog(){void 0!==this.defines&&this.fog!==s.getShaderMaterialDefine(this,"USE_FOG")&&s.setShaderMaterialDefine(this,"USE_FOG",this.fog)}setOpacity(e){var t;void 0!==e&&(this.opacity=e,(null===(t=this.uniforms)||void 0===t?void 0:t.opacity)&&(this.uniforms.opacity.value=e))}}t.RawShaderMaterial=o},5421:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SepiaShader=void 0,t.SepiaShader={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        uniform float amount;\n        uniform sampler2D tDiffuse;\n        varying vec2 vUv;\n        void main() {\n            vec4 color = texture2D( tDiffuse, vUv );\n            vec3 c = color.rgb;\n            color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\n            color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\n            color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\n            gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n        }"}},2870:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={atmosphere_vertex_utils:"\n\n    const float RayleighScaleDepth = 0.25;\n\n    struct AtmosphereColor\n    {\n        vec3 mie;\n        vec3 rayleigh;\n    };\n\n    float scale(float cosAngle)\n    {\n        float x = 1.0 - cosAngle;\n        return RayleighScaleDepth  * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n    }\n\n    float getNearSphereIntersect(vec3 v3Pos, vec3 v3Ray, float fCameraHeight2, float fOuterRadius2) {\n        // Solve simple square equation for the x0 (first point of intersection).\n#if defined(IMPROVE_INTERSECT_PRECISION)\n        // To improve precision instead of simple projection: b = 2.0 * dot(vPos, v3Ray),\n        // we change the equation that gives better results especially around the poles.\n        float fB = 2.0 * length(v3Pos) * dot(normalize(v3Pos), v3Ray);\n#else\n        float fB = 2.0 * dot(v3Pos, v3Ray);\n#endif\n        float fC = fCameraHeight2 - fOuterRadius2;\n        // det = b^2 - 4*a*c, where a = 1\n        float fDet = max(0.0, fB * fB - 4.0 * fC);\n        // Intersection points distances are defined as follows:\n        // x0 = (-b - sqrt(det)) / 2*a ^ x1 = (-b + sqrt(det)) / 2*a\n        // we search for x0:\n        return 0.5 * (-fB - sqrt(fDet));\n    }\n\n    float getFarSphereIntersect(vec3 v3Pos, vec3 v3Ray, float fCameraHeight2, float fOuterRadius2) {\n        // Solve simple square equation for the x1 (second point of intersection).\n#if defined(IMPROVE_INTERSECT_PRECISION)\n        float fB = 2.0 * length(v3Pos) * dot(normalize(v3Pos), v3Ray);\n#else\n        float fB = 2.0 * dot(v3Pos, v3Ray);\n#endif\n        float fC = fCameraHeight2 - fOuterRadius2;\n        // det = b^2 - 4*a*c, where a = 1\n        float fDet = max(0.0, fB * fB - 4.0 * fC);\n        // Compute second intersection distance:\n        // x1 = (-b + sqrt(det)) / 2*a\n        return 0.5 * (-fB + sqrt(fDet));\n    }\n    ",atmosphere_fragment_utils:"\n\n    // Branch free RGB to HSV conversion.\n    // Based on article:\n    // http://lolengine.net/blog/2013/01/13/fast-rgb-to-hsv\n    // and optimized OpenGL SL algorithm\n    // http://lolengine.net/blog/2013/07/27/rgb-to-hsv-in-glsl\n    vec3 rgb2Hsv(vec3 c)\n    {\n        const vec4 RGB_HSV_CONV = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        // Ternary operator may be used explicitly if compiler can use fast conditional move.\n        // vec4 p = c.g < c.b ? vec4(c.bg, RGB_HSV_CONV.wz) : vec4(c.gb, RGB_HSV_CONV.xy);\n        vec4 p = mix(vec4(c.bg, RGB_HSV_CONV.wz), vec4(c.gb, RGB_HSV_CONV.xy), step(c.b, c.g));\n        // vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n        vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n        float d = q.x - min(q.w, q.y);\n        float e = 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n    }\n\n    // Branch free HSV to RGB conversion\n    vec3 hsv2Rgb(vec3 c)\n    {\n        const vec4 HSV_RGB_CONV = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + HSV_RGB_CONV.xyz) * 6.0 - HSV_RGB_CONV.www);\n        return c.z * mix(HSV_RGB_CONV.xxx, clamp(p - HSV_RGB_CONV.xxx, 0.0, 1.0), c.y);\n    }\n\n    vec3 correctExposure(vec3 rgb, float exposure)\n    {\n        const vec3 fullColor = vec3(1.0);\n        return fullColor - exp(-exposure * rgb);\n    }\n\n    vec3 correctColor(vec3 rgb, vec3 hsvShift)\n    {\n        const float e = 0.0000001;\n        // Convert rgb color to hsv\n        vec3 hsv = rgb2Hsv(rgb);\n        // Shift hue value with angle wrapping\n        hsv.x = mod(hsv.x + hsvShift.x, 1.0);\n        // Shift and clamp saturation\n        hsv.y = clamp(hsv.y + hsvShift.y, 0.0, 1.0);\n        // Change value if it is significant (greater then epsilon)\n        hsv.z = hsv.z > e ? clamp(hsv.z + hsvShift.z, 0.0, 1.0) : 0.0;\n        // Convert shifted hsv back to rgb\n        return hsv2Rgb(hsv);\n    }\n    "}},7225:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(8136),n=r.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT*r.ExtrusionFeatureDefs.MIN_BUILDING_HEIGHT;t.default={extrusion_pars_vertex:"\n// Add define so we can check for it in the outline effect (see Outline.ts).\n#define HAS_EXTRUSION_PARS_VERTEX\n// Extrusion axis (xyz: vector, w: factor).\nattribute vec4 extrusionAxis;\nuniform float extrusionRatio;\n#ifdef FLAT_SHADED\nvarying vec4 vExtrusionAxis;\n#endif\n#ifdef ZFIGHTING_WORKAROUND\nvarying float vExtrusionRatio;\n#endif\n",extrusion_vertex:`\n#define HAS_EXTRUSION_VERTEX\n#ifdef ZFIGHTING_WORKAROUND\n// Cancel extrusionRatio (meaning, force to 1) if extrusionAxisLen < MIN_BUILDING_HEIGHT.\nconst float MIN_BUILDING_HEIGHT_SQUARED = ${n};\nfloat extrusionAxisLenSquared = dot(extrusionAxis.xyz, extrusionAxis.xyz);\nvExtrusionRatio = (extrusionAxisLenSquared < MIN_BUILDING_HEIGHT_SQUARED) ? 1.0 : extrusionRatio;\n#else\nfloat vExtrusionRatio = extrusionRatio;\n#endif\ntransformed = transformed + extrusionAxis.xyz * (vExtrusionRatio - 1.0);\n#ifdef FLAT_SHADED\nvExtrusionAxis = vec4(normalMatrix * extrusionAxis.xyz, extrusionAxis.w);\n#endif\n`,extrusion_normal_fragment_begin:"\n#ifdef FLAT_SHADED\n    // Flattened this divergent path to prevent undefined behaviour in the following derivatives\n    // functions. For more info:\n    // http://www.aclockworkberry.com/shader-derivative-functions/#Derivatives_and_branches\n\n    // Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n    vec3 fdx = vec3(dFdx(vViewPosition.x), dFdx(vViewPosition.y), dFdx(vViewPosition.z));\n    vec3 fdy = vec3(dFdy(vViewPosition.x), dFdy(vViewPosition.y), dFdy(vViewPosition.z));\n    vec3 normal = cross( fdx, fdy );\n    if (vExtrusionAxis.w > 0.999999) {\n        normal = vExtrusionAxis.xyz;\n    }\n    normal = normalize(normal);\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\tbitangent = bitangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t#endif\n\t#endif\n#endif\n// non perturbed normal for clearcoat among others\nvec3 geometryNormal = normal;\n",extrusion_pars_fragment:"\n#ifdef ZFIGHTING_WORKAROUND\nvarying float vExtrusionRatio;\n#else\nuniform float extrusionRatio;\n#endif\nvarying vec4 vExtrusionAxis;\n",extrusion_fragment:"\n#ifndef ZFIGHTING_WORKAROUND\nfloat vExtrusionRatio = extrusionRatio;\n#endif\ngl_FragColor.a *= smoothstep( 0.0, 0.25, vExtrusionRatio );\n"}},9178:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={fading_pars_vertex:"\nvarying float fadingDepth;\n",fading_vertex:"\nfadingDepth = -mvPosition.z;\n",fading_pars_fragment:"\nvarying float fadingDepth;\nuniform float fadeNear;\nuniform float fadeFar;\n",fading_fragment:'\n\n// lerp with "hard" edges\n//float fadingFactor = 1.0 - clamp((fadingDepth - fadeNear) / (fadeFar - fadeNear), 0.0, 1.0);\n\n// smooth transitions\nfloat fadingFactor = smoothstep( fadeNear, fadeFar, fadingDepth );\n\ngl_FragColor.a *= 1.0 - fadingFactor;\n\n// debugging color:\n// gl_FragColor = vec4(1., fadingFactor, fadingFactor, 1.0);\n'}},5477:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.LineCapsModes=void 0,function(e){e[e.CAPS_NONE=0]="CAPS_NONE",e[e.CAPS_SQUARE=1]="CAPS_SQUARE",e[e.CAPS_ROUND=2]="CAPS_ROUND",e[e.CAPS_TRIANGLE_IN=3]="CAPS_TRIANGLE_IN",e[e.CAPS_TRIANGLE_OUT=4]="CAPS_TRIANGLE_OUT"}(i=t.LineCapsModes||(t.LineCapsModes={})),t.default={extrude_line_vert_func:"\nvec3 extrudeLine(\n        in vec3 vertexPosition,\n        in float linePosition,\n        in float extrusionWidth,\n        in vec4 bitangent,\n        in vec3 tangent,\n        in float tanHalfAngle,\n        inout vec2 uv\n    ) {\n    vec3 result = vertexPosition;\n    // Retrieve the angle between this segment and the previous one (stored in the bitangent w\n    // component).\n    float angle = bitangent.w;\n    // Extrude according to the angle between segments to properly render narrow joints...\n    if (angle != 0.0) {\n        result += uv.y * extrusionWidth * bitangent.xyz / cos(angle / 2.0);\n        uv.x = linePosition + uv.x * extrusionWidth * uv.y * tanHalfAngle;\n    }\n    // ... or extrude in a simple manner for segments that keep the same direction.\n    else {\n        result += uv.y * extrusionWidth * bitangent.xyz + uv.x * extrusionWidth * tangent;\n        uv.x = linePosition + uv.x * extrusionWidth;\n    }\n    uv.y *= extrusionWidth;\n    return result;\n}\n",round_edges_and_add_caps:`\n#define CAPS_NONE ${i.CAPS_NONE}\n#define CAPS_SQUARE ${i.CAPS_SQUARE}\n#define CAPS_ROUND ${i.CAPS_ROUND}\n#define CAPS_TRIANGLE_IN ${i.CAPS_TRIANGLE_IN}\n#define CAPS_TRIANGLE_OUT ${i.CAPS_TRIANGLE_OUT}\n\nfloat roundEdgesAndAddCaps(in vec4 coords, in vec3 range) {\n    // Compute the line's width to length ratio.\n    float widthRatio = range.y / range.x;\n\n    // Compute the inner segment distance (same for all cap mode).\n    float dist = abs(coords.y);\n    float segmentBeginMask = clamp(ceil(coords.z - coords.x), 0.0, 1.0);\n    float segmentEndMask = clamp(ceil(coords.x - coords.w), 0.0, 1.0);\n    dist = max(dist, segmentBeginMask * length(vec2((coords.x - coords.z) / widthRatio, coords.y)));\n    dist = max(dist, segmentEndMask * length(vec2((coords.x - coords.w) / widthRatio, coords.y)));\n\n    #if CAPS_MODE != CAPS_ROUND\n    // Compute the caps mask.\n    float capRangeMask = clamp(1.0 - ceil(range.z - drawRange.y), 0.0, 1.0);\n    float beginCapMask = clamp(ceil(drawRange.x - coords.x), 0.0, 1.0);\n    float endCapMask = clamp(ceil(coords.x - drawRange.y), 0.0, 1.0);\n    float capMask = capRangeMask * max(beginCapMask, endCapMask);\n\n    // Compute the outer segment distance (specific for each cap mode).\n    float capDist = max(coords.x - drawRange.y, drawRange.x - coords.x) / widthRatio;\n    #if CAPS_MODE == CAPS_NONE\n    dist = mix(dist, max(abs(coords.y), (capDist + 0.1) / 0.1), capMask);\n    #elif CAPS_MODE == CAPS_SQUARE\n    dist = mix(dist, max(abs(coords.y), capDist), capMask);\n    #elif CAPS_MODE == CAPS_TRIANGLE_OUT\n    dist = mix(dist, abs(coords.y) + capDist, capMask);\n    #elif CAPS_MODE == CAPS_TRIANGLE_IN\n    dist = mix(dist, max(abs(coords.y), (capDist - abs(coords.y)) + capDist), capMask);\n    #endif\n    #endif // CAPS_MODE != CAPS_ROUND\n\n    return dist;\n}\n`,tile_clip_func:"\nvoid tileClip(vec2 tilePos, vec2 tileSize) {\n    if (tileSize.x > 0.0 && (tilePos.x < -tileSize.x / 2.0 || tilePos.x > tileSize.x / 2.0))\n        discard;\n    if (tileSize.y > 0.0 && (tilePos.y < -tileSize.y / 2.0 || tilePos.y > tileSize.y / 2.0))\n        discard;\n}\n",high_precision_vert_func:"\nvec3 subtractDblEyePos( const in vec3 pos ) {\n    vec3 t1 = positionLow - u_eyepos_lowpart;\n    vec3 e = t1 - positionLow;\n    vec3 t2 = ((-u_eyepos_lowpart - e) + (positionLow - (t1 - e))) + pos - u_eyepos;\n    vec3 high_delta = t1 + t2;\n    vec3 low_delta = t2 - (high_delta - t1);\n    return (high_delta + low_delta);\n}\n"}},5888:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.simpleLightingShadowChunk=void 0,t.simpleLightingShadowChunk="\n    struct PhysicalMaterial {\n        vec3\tdiffuseColor;\n        float\tspecularRoughness;\n        vec3\tspecularColor;\n    };\n\n    #define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n    void RE_Direct_Physical( const in IncidentLight directLight,\n        const in GeometricContext geometry,\n        const in PhysicalMaterial material,\n        inout ReflectedLight reflectedLight ) {\n        // directLight.color is the light color * shadow, internally three.js uses a step function, so\n        // this value is either the light color or black. in order to lighten up the shadows, we\n        // take add 50% of the color to grey (to give us either pure white or grey) and multiply this to\n        // the material's diffuse color.\n        #if defined(USE_SHADOWMAP)\n            reflectedLight.directDiffuse = (0.5 * directLight.color +\n                vec3(0.5,0.5,0.5)) * material.diffuseColor;\n        #else\n            reflectedLight.directDiffuse = material.diffuseColor;\n        #endif\n    }\n\n    void RE_IndirectDiffuse_Physical( const in vec3 irradiance,\n        const in GeometricContext geometry,\n        const in PhysicalMaterial material,\n        inout ReflectedLight reflectedLight ) {\n            // Disable influence of indirect light (it is handled in the RE_Direct_Physical function)\n    }\n\n    void RE_IndirectSpecular_Physical( const in vec3 radiance,\n        const in vec3 irradiance,\n        const in vec3 clearcoatRadiance,\n        const in GeometricContext geometry,\n        const in PhysicalMaterial material,\n        inout ReflectedLight reflectedLight) {\n            // Disable specular reflection of light.\n    }\n\n    #define RE_Direct               RE_Direct_Physical\n    #define RE_IndirectDiffuse      RE_IndirectDiffuse_Physical\n    #define RE_IndirectSpecular     RE_IndirectSpecular_Physical\n"},1420:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyAtmosphereMaterial=t.SkyAtmosphereShader=void 0;const r=i(4428),n=i(3993),s=i(2870),o=i(1703);t.SkyAtmosphereShader={uniforms:{u_eyePositionWorld:new r.Uniform(new r.Vector3),u_lightDirectionWorld:new r.Uniform(new r.Vector3(0,1,0)),u_modelViewProjection:new r.Uniform(new r.Matrix4),u_atmosphereEnv:new r.Uniform(new r.Vector3(6378137,6537590.425,0)),u_hsvCorrection:new r.Uniform(new r.Vector3(0,0,0)),topColor:new r.Uniform(new r.Color(30719)),bottomColor:new r.Uniform(new r.Color(16777215)),offset:new r.Uniform(33),exponent:new r.Uniform(.6),fogColor:new r.Uniform(new r.Color(30719)),fogNear:new r.Uniform(new r.Color(30719)),fogFar:new r.Uniform(new r.Color(16777215))},vertexShader:`\n    precision highp float;\n    precision highp int;\n\n    attribute vec4 position;\n\n    uniform mat4 u_modelViewProjection;\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_hsvCorrection;\n\n    const float Pi = 3.141592653589793;\n    const float Kr = 0.0025;\n    const float Kr4PI = Kr * 4.0 * Pi;\n    const float Km = 0.0015;\n    const float Km4PI = Km * 4.0 * Pi;\n    const float ESun = 15.0; // should be 15.0\n    const float KmESun = Km * ESun;\n    const float KrESun = Kr * ESun;\n    const vec3 InvWavelength = vec3(\n        5.60204474633241,  // Red = 1.0 / Math.pow(0.650, 4.0)\n        9.473284437923038, // Green = 1.0 / Math.pow(0.570, 4.0)\n        19.643802610477206); // Blue = 1.0 / Math.pow(0.475, 4.0)\n\n    const int nSamples = 2;\n    const float fSamples = 2.0;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n\n    ${s.default.atmosphere_vertex_utils}\n\n    //\n    // Computes rayleight and mia atmosphere factors for sky.\n    //\n    // Code based on GPU Gems article.\n    //\n    // Author: Sean O'Neil\n    //\n    // Copyright (c) 2004 Sean O'Neil\n    //\n    // https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering\n    //\n    // Further modifications by HERE\n    //\n    AtmosphereColor computeSkyAtmosphere(vec3 v3Pos, vec3 vLightDir)\n    {\n        // Unpack attributes\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        // All that may be const or define(s) at further optimization:\n        float fScale = 1.0 / (fOuterRadius - fInnerRadius);\n        float fScaleOverScaleDepth = (fScale / RayleighScaleDepth);\n        float fCameraHeight2 = fCameraHeight * fCameraHeight;\n        float fOuterRadius2 = fOuterRadius * fOuterRadius;\n\n        // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n        vec3 v3Ray = v3Pos - u_eyePositionWorld;\n        float fFar = length(v3Ray);\n        v3Ray /= fFar;\n\n    #ifdef CAMERA_IN_SPACE\n\n        // Calculate the closest intersection of the ray with the outer\n        // atmosphere, this is the first point of the ray passing through the atmosphere dome.\n        float fNear = getNearSphereIntersect(u_eyePositionWorld, v3Ray, fCameraHeight2, fOuterRadius2);\n        // Make far relative to first atmosphere intersection\n        fFar -= fNear;\n\n        // Compute the ray's starting position within the atmosphere, then\n        // calculate its scattering offset\n        vec3 v3Start = u_eyePositionWorld + v3Ray * fNear;\n\n        float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\n        float fStartDepth = exp(-1.0 / RayleighScaleDepth );\n        float fStartOffset = fStartDepth * scale(fStartAngle);\n\n    #else // CAMERA_IN_ATMOSPHERE\n\n        // The ray starts already in atmosphere\n        vec3 v3Start = u_eyePositionWorld;\n        float height = length(v3Start);\n        float depth = exp(fScaleOverScaleDepth * (fInnerRadius - fCameraHeight));\n        float fStartAngle = dot(v3Ray, v3Start) / height;\n        float fStartOffset = depth * scale(fStartAngle);\n\n    #endif\n\n        // Initialize the scattering loop variables\n        float fSampleLength = fFar / fSamples;\n        float fScaledLength = fSampleLength * fScale;\n        vec3 v3SampleRay = v3Ray * fSampleLength;\n        vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n        // Now loop through the sample rays\n        vec3 v3BaseColor = vec3(0.0);\n        vec3 v3Attenuate = vec3(0.0);\n        for(int i=0; i < nSamples; i++)\n        {\n            float height = length(v3SamplePoint);\n            float depth = exp(fScaleOverScaleDepth * (fInnerRadius - height));\n            float fLightAngle = dot(vLightDir, v3SamplePoint) / height;\n            float fCameraAngle = dot(v3Ray, v3SamplePoint) / height;\n            float fScatter = (fStartOffset + depth * (scale(fLightAngle) - scale(fCameraAngle)));\n            v3Attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\n            v3BaseColor += v3Attenuate * (depth * fScaledLength);\n            v3SamplePoint += v3SampleRay;\n        }\n\n        // Scale the Mie and Rayleigh colors and set up output of the function\n        AtmosphereColor color;\n        color.mie = v3BaseColor * KmESun;\n        color.rayleigh = v3BaseColor * (InvWavelength * KrESun);\n        return color;\n    }\n\n    void main(void)\n    {\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        AtmosphereColor atmColor = computeSkyAtmosphere(position.xyz, vLightDir);\n        v_mieColor = atmColor.mie;\n        v_rayleighColor = atmColor.rayleigh;\n        v_vertToCamera = u_eyePositionWorld - position.xyz;\n\n        gl_Position = u_modelViewProjection * position;\n    }\n    `,fragmentShader:`\n    // Because of harsh light distribution the exposure correction is always enabled for the sky.\n    #define CORRECT_EXPOSURE 1\n\n    precision highp float;\n    precision highp int;\n\n    #ifdef CORRECT_COLOR\n    uniform vec3 u_hsvCorrection; // Hue, saturation, brightness\n    #endif\n\n    uniform vec3 u_atmosphereEnv; // Atmosphere inner and outer radius, camera height\n    uniform vec3 u_eyePositionWorld;\n    uniform vec3 u_lightDirectionWorld;\n\n    const float g = -0.95;\n    const float g2 = g * g;\n\n    varying vec3 v_rayleighColor;\n    varying vec3 v_mieColor;\n    varying vec3 v_vertToCamera;\n\n    ${s.default.atmosphere_fragment_utils}\n\n    void main(void)\n    {\n        float fInnerRadius = u_atmosphereEnv.x;\n        float fOuterRadius = u_atmosphereEnv.y;\n        float fCameraHeight = u_atmosphereEnv.z;\n\n        #ifdef DYNAMIC_LIGHT\n            vec3 vLightDir = u_lightDirectionWorld;\n            // Alter alpha based on time of day (0.0 = night , 1.0 = day)\n            float fNightAlpha = clamp(dot(normalize(u_eyePositionWorld), vLightDir), 0.0, 1.0);\n        #else\n            vec3 vLightDir = u_eyePositionWorld;\n            float fNightAlpha = 1.0;\n        #endif\n        vLightDir = normalize(vLightDir);\n\n        // NOTE:\n        // For better precision normalization may be added on fragment (for mobile devices)\n        // while in vertex shader may be left un-normalized\n        // dot(vLightDir, normalize(v_vertToCamera)) / length(v_vertToCamera);\n        float fCosAngle = dot(vLightDir, v_vertToCamera) / length(v_vertToCamera);\n        float fRayleighPhase = 0.75 * (1.0 + fCosAngle * fCosAngle);\n        float fMiePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCosAngle * fCosAngle) / pow(1.0 + g2 - 2.0 * g * fCosAngle, 1.5);\n\n        vec3 cRgb = fRayleighPhase * v_rayleighColor + fMiePhase * v_mieColor;\n\n        // Sky produces very harsh lighting effect so exposure correction is always enabled.\n    #if !defined(HDR_FRAME_BUFFER) && defined(CORRECT_EXPOSURE)\n        // Exposure factor may be exposed to uniform variable.\n        cRgb = correctExposure(cRgb, 2.0);\n    #endif\n\n    #ifdef CORRECT_COLOR\n        cRgb = correctColor(cRgb, u_hsvCorrection);\n    #endif\n\n        // Alter alpha based on how close the viewer is to the ground (1.0 = on ground, 0.0 = at edge of atmosphere)\n        float fAtmosphereAlpha = clamp((fOuterRadius - fCameraHeight) /\n            (fOuterRadius - fInnerRadius), 0.0, 1.0);\n        fAtmosphereAlpha *= pow(fNightAlpha, 0.5);\n\n        gl_FragColor = vec4(cRgb, mix(cRgb.b, 1.0, fAtmosphereAlpha));\n    }\n    `};class a extends n.RawShaderMaterial{constructor(e){let i;e&&(i={name:"SkyAtmosphereMaterial",vertexShader:t.SkyAtmosphereShader.vertexShader,fragmentShader:t.SkyAtmosphereShader.fragmentShader,uniforms:t.SkyAtmosphereShader.uniforms,transparent:!0,depthTest:!0,depthWrite:!1,side:r.BackSide,blending:r.NormalBlending,fog:!1,rendererCapabilities:e.rendererCapabilities}),super(i)}setDynamicLighting(e){o.setShaderMaterialDefine(this,"DYNAMIC_LIGHT",e)}set outerRadius(e){this.uniforms.u_atmosphereEnv.value.y=e}get outerRadius(){return this.uniforms.u_atmosphereEnv.value.y}set innerRadius(e){this.uniforms.u_atmosphereEnv.value.x=e}get innerRadius(){return this.uniforms.u_atmosphereEnv.value.x}updateUniforms(e,t,i,r){const n=this.getCameraInfo(t,i);if(void 0===e||!e.isMaterial)throw Error("Wrong object used, only Material objects are supported");if(!(e.uniforms&&e.uniforms.u_atmosphereEnv&&e.uniforms.u_hsvCorrection&&e.uniforms.u_eyePositionWorld&&e.uniforms.u_modelViewProjection&&e.uniforms.u_lightDirectionWorld))throw Error("Atmosphere material has missing uniforms");{const t=n.eyePos,i=n.modelViewProjection,s=n.eyeHeight;e.uniforms.u_eyePositionWorld.value.copy(t),e.uniforms.u_modelViewProjection.value.copy(i),e.uniforms.u_atmosphereEnv.value.z=s,e.uniforms.u_lightDirectionWorld.value=r.clone();const a=s>this.outerRadius,l=o.setShaderDefine(e.defines,"CAMERA_IN_SPACE",a),c=o.setShaderDefine(e.defines,"CAMERA_IN_ATMOSPHERE",!a);e.needsUpdate=e.needsUpdate||l||c}}getCameraInfo(e,t,i=!1){if(i){const i=(new r.Matrix4).identity(),n=(new r.Matrix4).copy(e.matrixWorld).invert().transpose(),s=t.projectionMatrix,o=new r.Matrix4;o.multiplyMatrices(n,i),o.multiplyMatrices(s,o);const a=new r.Vector3;e.getWorldPosition(a);const l=new r.Vector3;return t.getWorldPosition(l),{modelViewProjection:o,eyePos:a,eyeHeight:l.distanceTo(a)}}{const i=e.matrixWorld,n=t.matrixWorldInverse,s=t.projectionMatrix,o=new r.Matrix4;o.multiplyMatrices(n,i),o.multiplyMatrices(s,o);const a=new r.Vector3;t.getWorldPosition(a);const l=new r.Vector3;e.getWorldPosition(l);const c=l.distanceTo(a);return a.sub(l),{modelViewProjection:o,eyePos:a,eyeHeight:c}}}}t.SkyAtmosphereMaterial=a},7355:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SolidLineMaterial=t.LineDashesModes=void 0;const r=i(4428),n=i(5722),s=i(3993),o=i(5477),a=i(1703),l={None:o.LineCapsModes.CAPS_NONE,Square:o.LineCapsModes.CAPS_SQUARE,Round:o.LineCapsModes.CAPS_ROUND,TriangleIn:o.LineCapsModes.CAPS_TRIANGLE_IN,TriangleOut:o.LineCapsModes.CAPS_TRIANGLE_OUT},c=Object.keys(l).reduce(((e,t)=>{const i=t;return e[l[i]]=i,e}),{});var h;!function(e){e[e.DASHES_SQUARE=0]="DASHES_SQUARE",e[e.DASHES_ROUND=1]="DASHES_ROUND",e[e.DASHES_DIAMOND=2]="DASHES_DIAMOND"}(h=t.LineDashesModes||(t.LineDashesModes={}));const d={Square:h.DASHES_SQUARE,Round:h.DASHES_ROUND,Diamond:h.DASHES_DIAMOND},u=Object.keys(d).reduce(((e,t)=>{const i=t;return e[d[i]]=i,e}),{}),m=new r.Color,p=`\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform vec3 outlineColor;\nuniform float opacity;\nuniform float extrusionWidth;\nuniform float outlineWidth;\nuniform vec2 tileSize;\nuniform vec2 drawRange;\n\n#ifdef USE_DASHED_LINE\nuniform float dashSize;\nuniform float gapSize;\nuniform vec3 dashColor;\n\n#define DASHES_SQUARE ${h.DASHES_SQUARE}\n#define DASHES_ROUND ${h.DASHES_ROUND}\n#define DASHES_DIAMOND ${h.DASHES_DIAMOND}\n#endif\n\n#ifdef USE_TILE_CLIP\nvarying vec3 vPosition;\n#endif\n\nvarying vec3 vRange;\nvarying vec4 vCoords;\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\n#include <round_edges_and_add_caps>\n#include <tile_clip_func>\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\n#include <fog_pars_fragment>\n\nvoid main() {\n    float alpha = opacity;\n    vec3 outputDiffuse = diffuse;\n\n    #ifdef USE_TILE_CLIP\n    tileClip(vPosition.xy, tileSize);\n    #endif\n\n    // Calculate distance to center (0.0: lineCenter, 1.0: lineEdge).\n    float distToCenter = roundEdgesAndAddCaps(vCoords, vRange);\n    // Calculate distance to edge (-1.0: lineCenter, 0.0: lineEdge).\n    float distToEdge = distToCenter - (extrusionWidth + outlineWidth) / extrusionWidth;\n\n    // Decrease the line opacity by the distToEdge, making the transition steeper when the slope\n    // of distToChange increases (i.e. the line is further away).\n    float width = fwidth(distToEdge);\n\n    float s = opacity < 0.98\n        ? clamp((distToEdge + width) / (2.0 * width), 0.0, 1.0) // prefer a boxstep\n        : smoothstep(-width, width, distToEdge);\n\n    if (opacity < 0.98 && 1.0 - s < opacity) {\n        // drop the fragment when the line is using opacity.\n        discard;\n    }\n\n    alpha *= 1.0 - s;\n\n    #ifdef USE_DASHED_LINE\n    // Compute the distance to the dash origin (0.0: dashOrigin, 1.0: dashEnd, (d+g)/d: gapEnd).\n    float d = dashSize / vRange.x;\n    float g = gapSize / vRange.x;\n    float distToDashOrigin = mod(vCoords.x, d + g) / d;\n\n    // Compute distance to dash edge (0.5: dashCenter, 0.0: dashEdge) and compute the\n    // dashBlendFactor similarly on how we did it for the line opacity.\n    float distToDashEdge = 0.5 - distance(distToDashOrigin, (d + g) / d * 0.5);\n    #if DASHES_MODE == DASHES_ROUND\n    distToDashEdge = 0.5 - distance(vec2(distToCenter * 0.5, distToDashEdge), vec2(0.0, 0.5));\n    #elif DASHES_MODE == DASHES_DIAMOND\n    distToDashEdge -= distToCenter * 0.5;\n    #endif\n    float dashWidth = fwidth(distToDashEdge);\n    float dashBlendFactor = 1.0 - smoothstep(-dashWidth, dashWidth, distToDashEdge);\n\n    #ifdef USE_DASH_COLOR\n    outputDiffuse = mix(diffuse, dashColor, dashBlendFactor);\n    #endif\n    #endif\n\n    #ifdef USE_OUTLINE\n    // Calculate distance to outline (0.0: lineEdge, outlineWidth/lineWidth: outlineEdge) and\n    // compute the outlineBlendFactor (used to mix line and outline colors).\n    float distToOutline = distToCenter - 1.0;\n    float outlineWidth = fwidth(distToOutline);\n    float outlineBlendFactor = smoothstep(-outlineWidth, outlineWidth, distToOutline);\n\n    // Mix the colors using the different computed factors.\n    #if defined(USE_DASHED_LINE) && !defined(USE_DASH_COLOR)\n    float colorBlendFactor = smoothstep(-1.0, 1.0, dashBlendFactor - outlineBlendFactor);\n    outputDiffuse = mix(\n      mix(\n        mix(outlineColor, diffuse, colorBlendFactor),\n        outputDiffuse,\n        dashBlendFactor\n      ),\n      outlineColor,\n      outlineBlendFactor\n    );\n    #else\n    outputDiffuse = mix(outputDiffuse, outlineColor, outlineBlendFactor);\n    #endif\n    #endif\n\n    #if defined(USE_DASHED_LINE) && !defined(USE_DASH_COLOR)\n    // Multiply the alpha by the dashBlendFactor.\n    #if defined(USE_OUTLINE)\n    alpha *= clamp(dashBlendFactor + outlineBlendFactor, 0.0, 1.0);\n    #else\n    alpha *= 1.0 - dashBlendFactor;\n    #endif\n    #endif\n\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( outputDiffuse * vColor, alpha );\n    #else\n    gl_FragColor = vec4( outputDiffuse, alpha );\n    #endif\n\n    #include <fog_fragment>\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}`;class f extends s.RawShaderMaterial{constructor(e){var t;Object.assign(r.ShaderChunk,o.default),n.FadingFeature.patchGlobalShaderChunks();const i={CAPS_MODE:o.LineCapsModes.CAPS_ROUND,DASHES_MODE:h.DASHES_SQUARE};let s,l,c=!0,d=1;e&&(c=!0===e.fog,c&&a.setShaderDefine(i,"USE_FOG",!0),d=void 0!==e.opacity?e.opacity:d,s=e.displacementMap,void 0!==s&&a.setShaderDefine(i,"USE_DISPLACEMENTMAP",!0),void 0!==e.outlineWidth&&e.outlineWidth>0&&a.setShaderDefine(i,"USE_OUTLINE",!0),l={name:"SolidLineMaterial",vertexShader:"\n#define SEGMENT_OFFSET 0.1\n\nattribute vec3 extrusionCoord;\nattribute vec3 position;\nattribute vec4 bitangent;\nattribute vec3 tangent;\nattribute vec2 uv;\nattribute vec3 normal;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float extrusionWidth;\nuniform float outlineWidth;\nuniform float offset;\nuniform vec2 drawRange;\n\n#ifdef USE_DISPLACEMENTMAP\nuniform sampler2D displacementMap;\n#endif\n\n#ifdef USE_TILE_CLIP\nvarying vec3 vPosition;\n#endif\nvarying vec3 vRange;\nvarying vec4 vCoords;\n#ifdef USE_COLOR\nattribute vec3 color;\nvarying vec3 vColor;\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\n#include <fog_pars_vertex>\n\n#include <extrude_line_vert_func>\n\nvoid main() {\n    // Calculate the segment.\n    vec2 segment = abs(extrusionCoord.xy) - SEGMENT_OFFSET;\n    float segmentPos = sign(extrusionCoord.x) / 2.0 + 0.5;\n\n    // Calculate the vertex position inside the line (segment) and extrusion direction and factor.\n    float linePos = mix(segment.x, segment.y, segmentPos);\n    vec2 extrusionDir = sign(extrusionCoord.xy);\n    // Precompute to avoid computing multiple times\n    float tanHalfAngle = tan(bitangent.w / 2.0);\n    float extrusionFactor = extrusionDir.y * tanHalfAngle;\n\n    // Calculate the extruded vertex position (and scale the extrusion direction).\n    vec3 pos = extrudeLine(\n        position, linePos, extrusionWidth + outlineWidth, bitangent, tangent, tanHalfAngle,\n        extrusionDir);\n\n    // Store the normalized extrusion coordinates in vCoords (with their ranges in vRange).\n    vRange = vec3(extrusionCoord.z, extrusionWidth, extrusionFactor);\n    vCoords = vec4(extrusionDir / vRange.xy, segment / vRange.x);\n\n    // Adjust the segment to fit the drawRange.\n    float capDist = (extrusionWidth + outlineWidth) / extrusionCoord.z;\n    if ((vCoords.w + capDist) < drawRange.x || (vCoords.z - capDist) > drawRange.y) {\n        vCoords.zw += 1.0;\n    }\n    if (vCoords.z < drawRange.x) {\n        vCoords.zw += vec2(drawRange.x - vCoords.z, 0.0);\n    }\n    if (vCoords.w > drawRange.y) {\n        vCoords.zw -= vec2(0.0, vCoords.w - drawRange.y);\n    }\n\n    // Transform position.\n    #ifdef USE_DISPLACEMENTMAP\n    pos += normalize( normal ) * texture2D( displacementMap, uv ).x;\n    #endif\n\n    // Shift the line based on the offset, where the bitangent is the cross product of the average\n    // of the two direction vectors (the previous and next segment directions) and the normal of\n    // the line (facing into the sky). The w component is the angle between the two segments.\n    // Note, we need to take the angle into consideration, so we use trigonometry to calculate how\n    // much we need to extend the offset. Note, orthough this looks complicated we are doing this\n    // in the vertex shader, so it should not cause a performance issue.\n    pos += bitangent.xyz * offset * sqrt(1.0 + pow(abs(tanHalfAngle), 2.0));\n\n    vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    // Pass extruded position to fragment shader.\n    #ifdef USE_TILE_CLIP\n    vPosition = pos;\n    #endif\n\n    #ifdef USE_COLOR\n    // Pass vertex color to fragment shader.\n    vColor = color;\n    #endif\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n\n    #include <fog_vertex>\n}",fragmentShader:p,uniforms:r.UniformsUtils.merge([{diffuse:new r.Uniform(new r.Color(f.DEFAULT_COLOR)),dashColor:new r.Uniform(new r.Color(f.DEFAULT_COLOR)),outlineColor:new r.Uniform(new r.Color(f.DEFAULT_COLOR)),extrusionWidth:new r.Uniform(f.DEFAULT_WIDTH),outlineWidth:new r.Uniform(f.DEFAULT_OUTLINE_WIDTH),offset:new r.Uniform(f.DEFAULT_OFFSET),opacity:new r.Uniform(f.DEFAULT_OPACITY),tileSize:new r.Uniform(new r.Vector2),fadeNear:new r.Uniform(n.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new r.Uniform(n.FadingFeature.DEFAULT_FADE_FAR),displacementMap:new r.Uniform(void 0!==s?s:new r.Texture),drawRange:new r.Uniform(new r.Vector2(f.DEFAULT_DRAW_RANGE_START,f.DEFAULT_DRAW_RANGE_END)),dashSize:new r.Uniform(f.DEFAULT_DASH_SIZE),gapSize:new r.Uniform(f.DEFAULT_GAP_SIZE)},r.UniformsLib.fog]),defines:i,fog:c,opacity:d,rendererCapabilities:e.rendererCapabilities}),super(l),this.fog=c,this.setOpacity(d),this.stencilFunc=r.NotEqualStencilFunc,this.stencilZPass=r.ReplaceStencilOp,this.stencilRef=1,this.stencilWrite=!1,a.enforceBlending(this),this.extensions.derivatives=!0,e&&(void 0!==e.color&&(m.set(e.color),this.color=m),void 0!==e.outlineColor&&(m.set(e.outlineColor),this.outlineColor=m),void 0!==e.lineWidth&&(this.lineWidth=e.lineWidth),void 0!==e.outlineWidth&&(this.outlineWidth=e.outlineWidth),void 0!==e.opacity&&this.setOpacity(e.opacity),void 0!==e.depthTest&&(this.depthTest=e.depthTest),void 0!==e.depthWrite&&(this.depthWrite=e.depthWrite),void 0!==e.fadeNear&&(this.fadeNear=e.fadeNear),void 0!==e.fadeFar&&(this.fadeFar=e.fadeFar),void 0!==e.displacementMap&&(this.displacementMap=e.displacementMap),void 0!==e.caps&&(this.caps=e.caps),void 0!==e.drawRangeStart&&(this.drawRangeStart=e.drawRangeStart),void 0!==e.drawRangeEnd&&(this.drawRangeEnd=e.drawRangeEnd),void 0!==e.dashes&&(this.dashes=e.dashes),void 0!==e.dashColor&&(m.set(e.dashColor),this.dashColor=m),void 0!==e.dashSize&&(this.dashSize=e.dashSize),void 0!==e.gapSize&&(this.gapSize=e.gapSize),void 0!==e.fog&&(this.fog=e.fog,this.invalidateFog()),this.offset=null!==(t=e.offset)&&void 0!==t?t:0)}set offset(e){this.uniforms.offset.value=e}get offset(){return this.uniforms.offset.value}set outline(e){a.setShaderMaterialDefine(this,"USE_OUTLINE",e)}get outline(){return!0===a.getShaderMaterialDefine(this,"USE_OUTLINE")}setOpacity(e){super.setOpacity(e),void 0!==e&&(this.stencilWrite=e<.98)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value.copy(e)}get outlineColor(){return this.uniforms.outlineColor.value}set outlineColor(e){this.uniforms.outlineColor.value.copy(e)}get dashColor(){return this.uniforms.dashColor.value}set dashColor(e){this.uniforms.dashColor.value.copy(e),a.setShaderMaterialDefine(this,"USE_DASH_COLOR",!0)}get lineWidth(){return 2*this.uniforms.extrusionWidth.value}set lineWidth(e){this.uniforms.extrusionWidth.value=e/2}get outlineWidth(){return this.uniforms.outlineWidth.value}set outlineWidth(e){this.uniforms.outlineWidth.value=e,this.outline=e>0}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){var t,i;this.uniforms.gapSize.value=e,a.setShaderMaterialDefine(this,"USE_DASHED_LINE",e>0),0===(null===(i=null===(t=this.uniforms)||void 0===t?void 0:t.gapSize)||void 0===i?void 0:i.value)&&(this.stencilWrite=this.opacity<.98)}get caps(){let e="Round";const t=a.getShaderMaterialDefine(this,"CAPS_MODE");return"number"==typeof t&&c.hasOwnProperty(t)&&(e=c[t]),e}set caps(e){l.hasOwnProperty(e)&&a.setShaderMaterialDefine(this,"CAPS_MODE",l[e])}get dashes(){let e="Square";const t=a.getShaderMaterialDefine(this,"DASHES_MODE");return"number"==typeof t&&u.hasOwnProperty(t)&&(e=u[t]),e}set dashes(e){d.hasOwnProperty(e)&&a.setShaderMaterialDefine(this,"DASHES_MODE",d[e])}get fadeNear(){return this.uniforms.fadeNear.value}set fadeNear(e){this.uniforms.fadeNear.value=e}get fadeFar(){return this.uniforms.fadeFar.value}set fadeFar(e){this.uniforms.fadeFar.value=e,a.setShaderMaterialDefine(this,"USE_FADING",e>0)}get displacementMap(){return this.uniforms.displacementMap.value}set displacementMap(e){if(this.uniforms.displacementMap.value===e)return;this.uniforms.displacementMap.value=e;const t=null!==e;t&&(this.uniforms.displacementMap.value.needsUpdate=!0),a.setShaderMaterialDefine(this,"USE_DISPLACEMENTMAP",t)}get drawRangeStart(){return this.uniforms.drawRange.value.x}set drawRangeStart(e){this.uniforms.drawRange.value.x=e}get drawRangeEnd(){return this.uniforms.drawRange.value.y}set drawRangeEnd(e){this.uniforms.drawRange.value.y=e}set clipTileSize(e){this.uniforms.tileSize.value.copy(e);const t=e.x>0&&e.y>0;a.setShaderMaterialDefine(this,"USE_TILE_CLIP",t)}get clipTileSize(){return this.uniforms.tileSize.value}copy(e){return super.copy(e),this.invalidateFog(),this.setOpacity(e.opacity),this}}t.SolidLineMaterial=f,f.DEFAULT_COLOR=16711680,f.DEFAULT_WIDTH=1,f.DEFAULT_OUTLINE_WIDTH=0,f.DEFAULT_OPACITY=1,f.DEFAULT_DRAW_RANGE_START=0,f.DEFAULT_DRAW_RANGE_END=1,f.DEFAULT_DASH_SIZE=1,f.DEFAULT_GAP_SIZE=1,f.DEFAULT_OFFSET=0},1703:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getShaderDefine=t.setShaderDefine=t.getShaderMaterialDefine=t.setShaderMaterialDefine=t.disableBlending=t.enableBlending=t.enforceBlending=t.insertShaderInclude=t.DEFINE_BOOL_FALSE=t.DEFINE_BOOL_TRUE=void 0;const r=i(2183),n=i(4428);function s(e){!0!==e.transparent&&!0!==e.forcedBlending&&(e.blending=n.CustomBlending,!0===e.premultipliedAlpha?(e.blendSrc=n.OneFactor,e.blendDst=n.OneMinusSrcAlphaFactor,e.blendSrcAlpha=n.OneFactor,e.blendDstAlpha=n.OneMinusSrcAlphaFactor):(e.blendSrc=n.SrcAlphaFactor,e.blendDst=n.OneMinusSrcAlphaFactor,e.blendSrcAlpha=n.OneFactor,e.blendDstAlpha=n.OneMinusSrcAlphaFactor))}function o(e,t,i=!1){return void 0===e.defines?i:l(e.defines,t)}function a(e,i,r){let n=!1;return"number"==typeof r?(n=e[i]!==r,e[i]=r):!0===r?(n=e[i]!==t.DEFINE_BOOL_TRUE,e[i]=t.DEFINE_BOOL_TRUE):!1===r&&void 0!==e[i]&&(delete e[i],n=!0),n}function l(e,i){const r=e[i];return r!==t.DEFINE_BOOL_FALSE&&(r===t.DEFINE_BOOL_TRUE||r)}t.DEFINE_BOOL_TRUE="",t.DEFINE_BOOL_FALSE=void 0,t.insertShaderInclude=function(e,t,i,r){const n=!0===r?"\t":"";return e.replace(`#include <${t}>`,`#include <${t}>\n${n}#include <${i}>`)},t.enforceBlending=function(e){e.transparent||(s(e),e.forcedBlending=!0)},t.enableBlending=s,t.disableBlending=function(e){!0!==e.transparent&&!0!==e.forcedBlending&&(e.blending=n.NormalBlending)},t.setShaderMaterialDefine=function(e,t,i){r.assert(void 0!==e.defines,"Do not use this function in ShaderMaterial derived c-tor.");const n=i!==o(e,t);return!!n&&(a(e.defines,t,i),e.needsUpdate=n,!0)},t.getShaderMaterialDefine=o,t.setShaderDefine=a,t.getShaderDefine=l},9930:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VignetteShader=void 0,t.VignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        uniform float offset;\n        uniform float darkness;\n        uniform sampler2D tDiffuse;\n        varying vec2 vUv;\n        void main() {\n            vec4 texel = texture2D( tDiffuse, vUv );\n            vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\n            gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n        }"}},8193:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvDataSource=void 0;const r=i(4742);class n extends r.VectorTileDataSource{}t.OmvDataSource=n},2577:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextCanvas=t.DEFAULT_TEXT_CANVAS_LAYER=void 0;const r=i(4428),n=i(5813),s=i(3298),o=i(4836),a=i(1819),l=i(8634),c=i(9678),h=new r.Vector3,d={array:[new r.Box2],offset:0};let u=new Float32Array;t.DEFAULT_TEXT_CANVAS_LAYER=0;class m{constructor(e){this.m_renderer=e.renderer,this.m_fontCatalog=e.fontCatalog,this.minGlyphCount=e.minGlyphCount,this.maxGlyphCount=e.maxGlyphCount,this.name=e.name,void 0===e.material?(this.m_ownsMaterial=!0,this.m_material=c.createSdfTextMaterial({fontCatalog:e.fontCatalog,rendererCapabilities:this.m_renderer.capabilities})):(this.m_ownsMaterial=!1,this.m_material=e.material),void 0===e.backgroundMaterial?(this.m_ownsBgMaterial=!0,this.m_bgMaterial=c.createSdfTextMaterial({fontCatalog:e.fontCatalog,isBackground:!0,rendererCapabilities:this.m_renderer.capabilities})):(this.m_ownsBgMaterial=!1,this.m_bgMaterial=e.backgroundMaterial),this.m_defaultLayer={id:t.DEFAULT_TEXT_CANVAS_LAYER,storage:new s.TextGeometry(new r.Scene,this.m_material,this.m_bgMaterial,this.minGlyphCount,this.maxGlyphCount)},this.m_layers=[this.m_defaultLayer],this.m_currentTextRenderStyle=(new o.TextRenderStyle).copy(m.defaultTextRenderStyle),this.m_currentTextLayoutStyle=(new o.TextLayoutStyle).copy(m.defaultTextLayoutStyle),this.m_lineTypesetter=new a.LineTypesetter,this.m_pathTypesetter=new l.PathTypesetter}get fontCatalog(){return this.m_fontCatalog}set fontCatalog(e){this.m_fontCatalog=e;const t=this.m_material;t.uniforms.sdfTexture.value=this.m_fontCatalog.texture,t.uniforms.sdfParams.value=new r.Vector4(this.m_fontCatalog.textureSize.x,this.m_fontCatalog.textureSize.y,this.m_fontCatalog.size,this.m_fontCatalog.distanceRange),t.defines.MSDF="msdf"===this.m_fontCatalog.type?1:0;const i=this.m_bgMaterial;i.uniforms.sdfTexture.value=this.m_fontCatalog.texture,i.uniforms.sdfParams.value=new r.Vector4(this.m_fontCatalog.textureSize.x,this.m_fontCatalog.textureSize.y,this.m_fontCatalog.size,this.m_fontCatalog.distanceRange),i.defines.MSDF="msdf"===this.m_fontCatalog.type?1:0}get material(){return this.m_material}set material(e){this.m_ownsMaterial&&(this.m_material.dispose(),this.m_ownsMaterial=!1),this.m_material=e;for(const e of this.m_layers)e.storage.mesh.material=this.m_material}get backgroundMaterial(){return this.m_bgMaterial}set backgroundMaterial(e){this.m_ownsBgMaterial&&(this.m_bgMaterial.dispose(),this.m_ownsBgMaterial=!1),this.m_bgMaterial=e;for(const e of this.m_layers)e.storage.backgroundMesh.material=this.m_bgMaterial}get textRenderStyle(){return this.m_currentTextRenderStyle}set textRenderStyle(e){this.m_currentTextRenderStyle.copy(e)}get textLayoutStyle(){return this.m_currentTextLayoutStyle}set textLayoutStyle(e){this.m_currentTextLayoutStyle.copy(e)}clear(){for(const e of this.m_layers)e.storage.clear();this.m_currentTextRenderStyle.copy(m.defaultTextRenderStyle),this.m_currentTextLayoutStyle.copy(m.defaultTextLayoutStyle)}render(e,t,i,r,n){this.m_fontCatalog.update(this.m_renderer);let s=null;void 0!==r&&(s=this.m_renderer.getRenderTarget(),this.m_renderer.setRenderTarget(r)),!0===n&&this.m_renderer.clear(!0);for(let r=0;r<this.m_layers.length;r++){const n=this.m_layers[r];if(n.id>=(null!=t?t:0)){if(!(void 0===i||n.id<i))break;n.storage.update(),this.m_renderer.render(n.storage.scene,e)}}void 0!==r&&this.m_renderer.setRenderTarget(s)}addLayer(e){let t=this.getLayer(e);return void 0===t&&(t={id:e,storage:new s.TextGeometry(new r.Scene,this.m_material,this.m_bgMaterial,this.minGlyphCount,this.maxGlyphCount)},this.m_layers.push(t),this.m_layers.sort(((e,t)=>e.id-t.id))),t}getLayer(e){return this.m_layers.find((t=>t.id===e))}getAllLayers(){return this.m_layers}measureText(e,t,i){let r,n,s,o;if(h.set(0,0,0),void 0!==i){if(r=i.path,n=i.pathOverflow,o=i.outputCharacterBounds,void 0!==i.path){const e=i.path.getPoint(0);if(null===e)return!1;h.set(e.x,e.y,0)}i.letterCaseArray&&(s=i.letterCaseArray)}return this.placeText({input:e,layer:this.m_defaultLayer,textPath:r,textPathOverflow:n,bounds:t,individualBounds:o,letterCaseArray:s})}addText(e,t,i){let r,n,s;h.copy(t);let o=this.m_defaultLayer;if(void 0!==i){if(r=i.path,n=i.pathOverflow,void 0!==i.layer){let e=this.getLayer(i.layer);void 0===e&&(e=this.addLayer(i.layer)),o=e}void 0!==i.path&&h.set(0,0,h.z),i.letterCaseArray&&(s=i.letterCaseArray)}const a=o.storage.drawCount,l=this.placeText({input:e,textPath:r,textPathOverflow:n,layer:o,letterCaseArray:s});return l&&void 0!==i?(!0===i.updatePosition&&t.copy(h),void 0!==i.pickingData&&o.storage.addPickingData(a,o.storage.drawCount,i.pickingData)):l||(o.storage.m_drawCount=a),l}createTextBufferObject(e,t){let i,s;h.set(0,0,0);const a=this.m_currentTextRenderStyle.fontVariant===o.FontVariant.SmallCaps;if("string"!=typeof e)i=e,void 0!==t&&t.letterCaseArray&&(s=t.letterCaseArray);else if(s=[],i=this.m_fontCatalog.getGlyphs(e,this.m_currentTextRenderStyle,a?s:void 0),void 0===i)return;let l,c,d,m,p,f;return void 0!==t&&(l=t.path,c=t.pathOverflow,!0===t.outputBounds&&(d=new r.Box2),!0===t.outputCharacterBounds&&(m=[]),!0===t.storeStyles&&(p=this.m_currentTextRenderStyle.clone(),f=this.m_currentTextLayoutStyle.clone())),this.placeText({input:e,layer:this.m_defaultLayer,computeTextBuffer:!0,textPath:l,textPathOverflow:c,bounds:d,individualBounds:m,letterCaseArray:s}),new n.TextBufferObject(i,new Float32Array(u),d,m,p,f)}addTextBufferObject(e,t){var i;let r,n,s,o,a,l,c,h=this.m_defaultLayer;if(void 0!==t){if(void 0!==t.layer){let e=this.getLayer(t.layer);void 0===e&&(e=this.addLayer(t.layer)),h=e}r=null===(i=t.position)||void 0===i?void 0:i.clone(),n=t.scale,s=t.rotation,o=t.color,a=t.opacity,l=t.backgroundColor,c=t.backgroundOpacity}const d=h.storage.drawCount,u=h.storage.addTextBufferObject(e,r,n,s,o,a,l,c);return u&&void 0!==t?void 0!==t.pickingData&&h.storage.addPickingData(d,h.storage.drawCount,t.pickingData):u||(h.storage.m_drawCount=d),u}pickText(e,t){for(const i of this.m_layers)i.storage.pick(e,t)}getMemoryUsage(e){this.m_fontCatalog.updateMemoryUsage(e);for(const t of this.m_layers)t.storage.updateMemoryUsage(e)}placeText(e){if(0===e.input.length||0===this.m_currentTextLayoutStyle.maxLines)return void 0!==e.bounds&&(e.bounds.min.set(0,0),e.bounds.max.set(0,0)),void 0!==e.individualBounds&&(e.individualBounds.length=0),!0;let t,i;const r=this.m_currentTextRenderStyle.fontVariant===o.FontVariant.SmallCaps;if("string"!=typeof e.input)t=e.input,e.letterCaseArray&&(i=e.letterCaseArray);else if(i=[],t=this.m_fontCatalog.getGlyphs(e.input,this.m_currentTextRenderStyle,r?i:void 0),void 0===t)return!1;let n;void 0!==e.individualBounds&&(d.array=e.individualBounds,d.offset=0,n=d),void 0!==e.bounds&&(e.bounds.min.set(1/0,1/0),e.bounds.max.set(-1/0,-1/0)),!0===e.computeTextBuffer&&(u=new Float32Array(t.length*s.QUAD_VERTEX_MEMORY_FOOTPRINT));const a=void 0!==e.textPath,l={glyphs:t,fontCatalog:this.m_fontCatalog,textRenderStyle:this.m_currentTextRenderStyle,textLayoutStyle:this.m_currentTextLayoutStyle,position:h,geometry:e.layer.storage,smallCapsArray:r?i:void 0,globalBounds:e.bounds,individualBounds:n,vertexBuffer:!0===e.computeTextBuffer?u:void 0};let c=!0;return a?(Object.assign(l,{path:e.textPath,pathOverflow:!0===e.textPathOverflow}),c=this.m_pathTypesetter.arrangeGlyphs(l)):c=this.m_lineTypesetter.arrangeGlyphs(l),void 0!==n&&(n.array.length=n.offset),c}}t.TextCanvas=m,m.defaultTextRenderStyle=new o.TextRenderStyle,m.defaultTextLayoutStyle=new o.TextLayoutStyle},2272:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FontCatalog=void 0;const r=i(4428),n=i(7984),s=i(4453),o=i(962),a=i(4836),l="_BoldAssets/",c="_ItalicAssets/";class h{constructor(e,t,i,r,n,s,a,l,c,h,d){this.url=e,this.name=t,this.type=i,this.size=r,this.maxWidth=n,this.maxHeight=s,this.distanceRange=a,this.fonts=l,this.unicodeBlocks=c,this.maxCodePointCount=h,this.m_replacementGlyph=d,this.showReplacementGlyphs=!1,this.m_glyphTextureCache=new o.GlyphTextureCache(h,this.maxWidth+1,this.maxHeight+1),this.m_loadingJson=new Map,this.m_loadingPages=new Map,this.m_loadingGlyphs=new Map,this.m_loadedJson=new Map,this.m_loadedPages=new Map,this.m_loadedGlyphs=new Map}static async load(e,t){const i=new URL(e,window.location.href),n=await h.loadJSON(i.href),o=new URL(`${n.name}_Assets/Extra/`,i),a=await h.loadJSON(o.href+"Specials.json"),l=await h.loadTexture(o.href+"Specials.png");l.wrapS=r.ClampToEdgeWrapping,l.wrapT=r.ClampToEdgeWrapping,l.minFilter=r.NearestFilter,l.needsUpdate=!0;const c=n.fonts.find((e=>"Extra"===e.name)),d=new s.GlyphData(65533,"Specials",a.chars[0].width,a.chars[0].height,a.chars[0].xadvance,a.chars[0].xoffset,a.chars[0].yoffset,0,0,1,1,l,c,!0);return new h(i.href.substr(0,i.href.lastIndexOf("/")),n.name,n.type,n.size,n.maxWidth,n.maxHeight,n.distanceRange,n.fonts,n.supportedBlocks,t,d)}static async loadTexture(e){return await new Promise((t=>{(new r.TextureLoader).load(e,t)}))}static async loadJSON(e){const t=await fetch(e);if(!t.ok)throw new Error(`${e} Status Text:  ${t.statusText}`);const i=await t.text();return JSON.parse(i)}dispose(){this.fonts.length=0,this.unicodeBlocks.length=0,this.m_glyphTextureCache.dispose(),this.m_loadingJson.clear(),this.m_loadingPages.clear(),this.m_loadingGlyphs.clear(),this.m_loadedJson.clear(),this.m_loadedPages.clear(),this.m_loadedGlyphs.clear()}clear(){this.m_glyphTextureCache.clear(),this.m_loadingJson.clear(),this.m_loadingPages.clear(),this.m_loadingGlyphs.clear(),this.m_loadedJson.clear(),this.m_loadedPages.clear(),this.m_loadedGlyphs.clear()}update(e){this.m_glyphTextureCache.update(e)}get texture(){return this.m_glyphTextureCache.texture}get textureSize(){return this.m_glyphTextureCache.textureSize}get isLoading(){return this.m_loadingJson.size>0||this.m_loadingPages.size>0||this.m_loadingGlyphs.size>0}async loadBlock(e,t,i,r){const n=this.getAssetsPath(i,t),s=`${n}/${e.name.replace(/ /g,"_")}.json`;let o=this.m_loadedJson.get(s);if(void 0===o){let t=this.m_loadingJson.get(s);if(void 0===t)try{t=h.loadJSON(s),this.m_loadingJson.set(s,t),o=await t,this.m_loadingJson.delete(s),this.m_loadedJson.set(s,o)}catch(e){console.error(e),this.m_loadingJson.delete(s)}else o=await t}const a=[];if(!0===r)for(const e of o.pages)a.push(this.loadPage(`${n}/${e}`));return await Promise.all(a),o}removeBlock(e,t,i){const r=this.getAssetsPath(i,t),n=`${r}/${e.name.replace(/ /g,"_")}.json`,s=this.m_loadedJson.get(n);if(void 0!==s){for(const e of s.pages){const t=`${r}/${e}`;this.m_loadingPages.delete(t),this.m_loadedPages.delete(t)}this.m_loadingJson.delete(n),this.m_loadedJson.delete(n)}}async loadCharset(e,t){const i=t.fontName,r=t.fontStyle,n=(t.fontVariant===a.FontVariant.AllCaps||t.fontVariant===a.FontVariant.SmallCaps?e.toUpperCase():e).replace(/[\s\S](?=([\s\S]+))/g,((e,t)=>t.indexOf(e)+1?"":e)),s=[];for(const e of n){const t=e.codePointAt(0),n=this.getFont(t,i),o=`${n.name}_${r}`,a=`${o}_${t}`;let l=this.m_loadedGlyphs.get(o);void 0===l&&(l=new Map,this.m_loadedGlyphs.set(o,l));const c=l.get(t);if(void 0===c){let i=this.m_loadingGlyphs.get(a);if(void 0===i){if(!n.charset.includes(String.fromCodePoint(t))){const i=this.createReplacementGlyph(t,e,n);l.set(t,i),this.m_glyphTextureCache.add(a,i);continue}let s;for(const e of this.unicodeBlocks)if(t>=e.min&&t<=e.max){s=e;break}i=this.loadAssets(t,r,s,n),this.m_loadingGlyphs.set(a,i),i.then((e=>{this.m_loadingGlyphs.delete(a),l.set(t,e),this.m_glyphTextureCache.add(a,e)}))}s.push(i)}else this.m_glyphTextureCache.has(a)||(s.push(Promise.resolve(c)),this.m_glyphTextureCache.add(a,c))}return Promise.all(s)}getGlyph(e,t,i){const r=this.m_loadedGlyphs.get(`${t.name}_${i}`);if(void 0!==r)return r.get(e)}getGlyphs(e,t,i){const r=[],n=t.fontName,s=t.fontStyle,o=t.fontVariant,l=o===a.FontVariant.AllCaps||o===a.FontVariant.SmallCaps;for(const t of e){const e=l?t.toUpperCase():t;for(const o of e){const e=o.codePointAt(0),a=this.getFont(e,n),l=this.getGlyph(e,a,s);if(void 0===l||l.isReplacement&&!this.showReplacementGlyphs)return;r.push(l),void 0!==i&&i.push(o!==t)}}return r}getFont(e,t){let i=this.fonts[0].name;for(const r of this.unicodeBlocks)if(e>=r.min&&e<=r.max){i=void 0!==t&&void 0!==r.fonts.find((e=>e===t))?t:r.fonts[0];break}return this.fonts.find((e=>e.name===i))}updateMemoryUsage(e){let t=0;for(const e of this.unicodeBlocks)t+=2*(e.max-e.min);let i=this.m_glyphTextureCache.textureSize.x*this.m_glyphTextureCache.textureSize.y*4;for(const e in this.m_loadedPages.entries)if(void 0!==this.m_loadedPages.get(e)){const t=this.m_loadedPages.get(e);void 0!==t&&(i+=t.image.width*t.image.height*4)}e.heapSize+=t+i,e.gpuSize+=i}createReplacementGlyph(e,t,i){const r=this.m_replacementGlyph.clone();return r.codePoint=e,r.character=t,r.font=i,r.isReplacement=n.UnicodeUtils.isPrintable(e),r}async loadAssets(e,t,i,r){const n=await this.loadBlock(i,r,t);if(void 0===n)return this.m_replacementGlyph;const o=n.chars.find((t=>t.id===e)),a=`${this.getAssetsPath(t,r)}/${n.pages[o.page]}`,l=await this.loadPage(a);return new s.GlyphData(o.id,i.name,o.width,o.height,o.xadvance,o.xoffset,o.yoffset,o.x/l.image.width,1-(o.y+o.height)/l.image.height,(o.x+o.width)/l.image.width,1-o.y/l.image.height,l,r)}async loadPage(e){let t=this.m_loadedPages.get(e);if(void 0===t){let i=this.m_loadingPages.get(e);void 0===i?(i=h.loadTexture(e),this.m_loadingPages.set(e,i),t=await i,t.wrapS=r.ClampToEdgeWrapping,t.wrapT=r.ClampToEdgeWrapping,t.minFilter=r.NearestFilter,t.needsUpdate=!0,this.m_loadingPages.delete(e)&&this.m_loadedPages.set(e,t),this.m_loadingPages.delete(e)):t=await i}return t}getAssetsPath(e,t){let i="_Assets/";switch(e){case a.FontStyle.Bold:void 0!==t.bold&&(i=l);break;case a.FontStyle.Italic:void 0!==t.italic&&(i=c);break;case a.FontStyle.BoldItalic:void 0!==t.boldItalic?i="_BoldItalicAssets/":void 0!==t.italic?i=c:void 0!==t.bold&&(i=l)}return`${this.url}/${this.name}${i}${t.name}`}}t.FontCatalog=h},4453:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlyphData=void 0;const r=i(4428),n=i(7984);class s{constructor(e,t,i,s,o,a,l,c,h,d,u,m,p,f=!1){this.codePoint=e,this.block=t,this.width=i,this.height=s,this.advanceX=o,this.offsetX=a,this.offsetY=l,this.texture=m,this.font=p,this.isReplacement=f,this.positions=[],this.sourceTextureCoordinates=[],this.dynamicTextureCoordinates=[],this.copyIndex=0,this.isInCache=!1,this.character=String.fromCodePoint(e),this.direction=n.UnicodeUtils.getDirection(e,t);const g=this.offsetX,v=g+this.width,_=p.metrics.lineHeight-this.offsetY,y=_-this.height;this.positions.push(new r.Vector3(g,y,1),new r.Vector3(v,y,1),new r.Vector3(g,_,1),new r.Vector3(v,_,1)),this.sourceTextureCoordinates.push(new r.Vector2(c,h),new r.Vector2(d,h),new r.Vector2(c,u),new r.Vector2(d,u)),this.dynamicTextureCoordinates.push(new r.Vector2(0,0),new r.Vector2(1,0),new r.Vector2(0,1),new r.Vector2(1,1))}clone(){return new s(this.codePoint,this.block,this.width,this.height,this.advanceX,this.offsetX,this.offsetY,this.sourceTextureCoordinates[0].x,this.sourceTextureCoordinates[0].y,this.sourceTextureCoordinates[3].x,this.sourceTextureCoordinates[3].y,this.texture,this.font,this.isReplacement)}}t.GlyphData=s},962:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlyphTextureCache=void 0;const r=i(3844),n=i(4428),s=i(4453),o=i(5207);t.GlyphTextureCache=class{constructor(e,t,i){this.capacity=e,this.entryWidth=t,this.entryHeight=i;const s=Math.floor(Math.sqrt(e));this.m_cacheHeight=s*s<e?s+1:s,this.m_cacheWidth=s*this.m_cacheHeight<e?s+1:s,this.m_textureSize=new n.Vector2(this.m_cacheWidth*t,this.m_cacheHeight*i),(this.m_textureSize.y>4096||this.m_textureSize.x>4096)&&console.warn("GlyphTextureCache texture size ("+this.m_textureSize.x+", "+this.m_textureSize.y+") exceeds WebGL's widely supported MAX_TEXTURE_SIZE (4096).\nThis could result in rendering errors on some devices.\nPlease consider reducing its capacity or input assets size."),this.m_entryCache=new r.LRUCache(e),this.initCacheEntries(),this.m_scene=new n.Scene,this.m_camera=new n.OrthographicCamera(0,this.m_textureSize.x,this.m_textureSize.y,0),this.m_camera.position.z=1,this.m_camera.updateMatrixWorld(!1),this.m_rt=new n.WebGLRenderTarget(this.m_textureSize.x,this.m_textureSize.y,{wrapS:n.ClampToEdgeWrapping,wrapT:n.ClampToEdgeWrapping,depthBuffer:!1,stencilBuffer:!1}),this.m_copyTextureSet=new Set,this.m_copyTransform=new n.Matrix3,this.m_copyPositions=[],this.m_copyPositions.push(new n.Vector2,new n.Vector2,new n.Vector2,new n.Vector2),this.m_copyVertexBuffer=new n.InterleavedBuffer(new Float32Array(20*e),5),this.m_copyVertexBuffer.setUsage(n.DynamicDrawUsage),this.m_copyPositionAttribute=new n.InterleavedBufferAttribute(this.m_copyVertexBuffer,3,0),this.m_copyUVAttribute=new n.InterleavedBufferAttribute(this.m_copyVertexBuffer,2,3),this.m_copyGeometry=new n.BufferGeometry,this.m_copyGeometry.setAttribute("position",this.m_copyPositionAttribute),this.m_copyGeometry.setAttribute("uv",this.m_copyUVAttribute);const o=new n.BufferAttribute(new Uint32Array(6*e),1);o.setUsage(n.DynamicDrawUsage),this.m_copyGeometry.setIndex(o),this.m_copyMesh=new n.Mesh(this.m_copyGeometry),this.m_copyMesh.frustumCulled=!1,this.m_copyGeometryDrawCount=0,this.m_clearPositionAttribute=new n.BufferAttribute(new Float32Array(8*e),2),this.m_clearPositionAttribute.setUsage(n.DynamicDrawUsage),this.m_clearGeometry=new n.BufferGeometry,this.m_clearGeometry.setAttribute("position",this.m_clearPositionAttribute);const a=new n.BufferAttribute(new Uint32Array(6*e),1);a.setUsage(n.DynamicDrawUsage),this.m_clearGeometry.setIndex(a),this.m_clearMesh=new n.Mesh(this.m_clearGeometry),this.m_clearMesh.frustumCulled=!1,this.m_clearGeometryDrawCount=0,this.m_scene.add(this.m_clearMesh,this.m_copyMesh)}dispose(){var e,t;this.m_entryCache.clear(),this.m_scene.remove(this.m_clearMesh,this.m_copyMesh),this.m_rt.dispose(),null===(e=this.m_clearMaterial)||void 0===e||e.dispose(),null===(t=this.m_copyMaterial)||void 0===t||t.dispose(),this.m_copyTextureSet.clear(),this.m_clearGeometry.dispose(),this.m_copyGeometry.dispose()}get texture(){return this.m_rt.texture}get textureSize(){return this.m_textureSize}add(e,t){if(void 0!==this.m_entryCache.get(e))return;const i=this.m_entryCache.oldest;if(null===i)throw new Error("GlyphTextureCache is uninitialized!");this.clearCacheEntry(i.value),this.copyGlyphToCache(e,t,i.value.location)}has(e){return this.m_entryCache.has(e)}get(e){return this.m_entryCache.get(e)}clear(){this.m_copyGeometryDrawCount=0,this.m_clearGeometryDrawCount=0,this.m_entryCache.clear(),this.m_copyTextureSet.clear(),this.initCacheEntries()}update(e){let t=null;const i=this.m_clearGeometryDrawCount>0,r=this.m_copyGeometryDrawCount>0;if((i||r)&&(t=e.getRenderTarget(),e.setRenderTarget(this.m_rt)),i){if(this.m_clearMaterial||(this.m_clearMaterial=new o.GlyphClearMaterial({rendererCapabilities:e.capabilities}),this.m_clearMesh.material=this.m_clearMaterial),null===this.m_clearGeometry.index)throw new Error("GlyphTextureCache clear geometry index is uninitialized!");this.m_clearPositionAttribute.needsUpdate=!0,this.m_clearPositionAttribute.updateRange.offset=0,this.m_clearPositionAttribute.updateRange.count=8*this.m_clearGeometryDrawCount,this.m_clearGeometry.index.needsUpdate=!0,this.m_clearGeometry.index.updateRange.offset=0,this.m_clearGeometry.index.updateRange.count=6*this.m_clearGeometryDrawCount,this.m_clearGeometry.setDrawRange(0,6*this.m_clearGeometryDrawCount),this.m_clearMesh.visible=!0,this.m_copyMesh.visible=!1,e.render(this.m_scene,this.m_camera),this.m_clearGeometryDrawCount=0,this.m_clearMesh.visible=!1}if(r){if(this.m_copyMaterial||(this.m_copyMaterial=new o.GlyphCopyMaterial({rendererCapabilities:e.capabilities}),this.m_copyMesh.material=this.m_copyMaterial),null===this.m_copyGeometry.index)throw new Error("GlyphTextureCache copy geometry index is uninitialized!");this.m_copyVertexBuffer.needsUpdate=!0,this.m_copyVertexBuffer.updateRange.offset=0,this.m_copyVertexBuffer.updateRange.count=20*this.m_copyGeometryDrawCount,this.m_copyGeometry.index.needsUpdate=!0,this.m_copyGeometry.index.updateRange.offset=0,this.m_copyGeometry.index.updateRange.count=6*this.m_copyGeometryDrawCount,this.m_copyGeometry.setDrawRange(0,6*this.m_copyGeometryDrawCount),this.m_copyMesh.visible=!0;const t=Array.from(this.m_copyTextureSet),i=Math.ceil(this.m_copyTextureSet.size/8);for(let r=0;r<i;r++){const i=8*r;this.m_copyMaterial.uniforms.pageOffset.value=i;for(let e=0;e<8;e++){const r=i+e;r<this.m_copyTextureSet.size&&(this.m_copyMaterial.uniforms["page"+e].value=t[r])}e.render(this.m_scene,this.m_camera)}this.m_copyTextureSet.clear(),this.m_copyGeometryDrawCount=0}(i||r)&&e.setRenderTarget(t)}initCacheEntries(){const e=new s.GlyphData(0,"",0,0,0,0,0,0,0,0,0,n.Texture.DEFAULT_IMAGE,{name:"",metrics:{size:0,distanceRange:0,base:0,lineHeight:0,lineGap:0,capHeight:0,xHeight:0},charset:""});for(let t=0;t<this.m_cacheHeight;t++)for(let i=0;i<this.m_cacheWidth;i++){const r={glyphData:e,location:new n.Vector2(i,t)};this.m_entryCache.set(`Dummy_${t*this.m_cacheHeight+i}`,r)}}copyGlyphToCache(e,t,i){this.m_copyTextureSet.add(t.texture);let r=0;for(const e of this.m_copyTextureSet.values()){if(e===t.texture)break;r++}t.copyIndex=r,this.m_copyTransform.set(1,0,i.x*this.entryWidth-t.offsetX,0,1,i.y*this.entryHeight-t.positions[0].y,0,0,0);for(let e=0;e<4;++e)this.m_copyPositions[e].set(t.positions[e].x,t.positions[e].y),this.m_copyPositions[e].applyMatrix3(this.m_copyTransform);if(this.m_copyGeometryDrawCount>=this.capacity)return;const n=4*this.m_copyGeometryDrawCount,s=6*this.m_copyGeometryDrawCount;for(let e=0;e<4;++e)this.m_copyPositionAttribute.setXYZ(n+e,this.m_copyPositions[e].x,this.m_copyPositions[e].y,t.copyIndex),this.m_copyUVAttribute.setXY(n+e,t.sourceTextureCoordinates[e].x,t.sourceTextureCoordinates[e].y);if(null===this.m_copyGeometry.index)throw new Error("GlyphTextureCache copy geometry index is uninitialized!");this.m_copyGeometry.index.setX(s,n),this.m_copyGeometry.index.setX(s+1,n+1),this.m_copyGeometry.index.setX(s+2,n+2),this.m_copyGeometry.index.setX(s+3,n+2),this.m_copyGeometry.index.setX(s+4,n+1),this.m_copyGeometry.index.setX(s+5,n+3),++this.m_copyGeometryDrawCount;const o=this.m_copyPositions[0].x/this.m_textureSize.x,a=this.m_copyPositions[0].y/this.m_textureSize.y,l=this.m_copyPositions[3].x/this.m_textureSize.x,c=this.m_copyPositions[3].y/this.m_textureSize.y;t.dynamicTextureCoordinates[0].set(o,a),t.dynamicTextureCoordinates[1].set(l,a),t.dynamicTextureCoordinates[2].set(o,c),t.dynamicTextureCoordinates[3].set(l,c),t.isInCache=!0,this.m_entryCache.set(e,{glyphData:t,location:i})}clearCacheEntry(e){if(e.glyphData.isInCache=!1,this.m_copyPositions[0].set(e.location.x*this.entryWidth,e.location.y*this.entryHeight),this.m_copyPositions[1].set((e.location.x+1)*this.entryWidth,e.location.y*this.entryHeight),this.m_copyPositions[2].set(e.location.x*this.entryWidth,(e.location.y+1)*this.entryHeight),this.m_copyPositions[3].set((e.location.x+1)*this.entryWidth,(e.location.y+1)*this.entryHeight),this.m_clearGeometryDrawCount>=this.capacity)return;const t=4*this.m_clearGeometryDrawCount,i=6*this.m_clearGeometryDrawCount;for(let e=0;e<4;++e)this.m_clearPositionAttribute.setXY(t+e,this.m_copyPositions[e].x,this.m_copyPositions[e].y);if(null===this.m_clearGeometry.index)throw new Error("GlyphTextureCache clear geometry index is uninitialized!");this.m_clearGeometry.index.setX(i,t),this.m_clearGeometry.index.setX(i+1,t+1),this.m_clearGeometry.index.setX(i+2,t+2),this.m_clearGeometry.index.setX(i+3,t+2),this.m_clearGeometry.index.setX(i+4,t+1),this.m_clearGeometry.index.setX(i+5,t+3),++this.m_clearGeometryDrawCount}}},5813:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextBufferObject=void 0,t.TextBufferObject=class{constructor(e,t,i,r,n,s){this.glyphs=e,this.buffer=t,this.bounds=i,this.characterBounds=r,this.textRenderStyle=n,this.textLayoutStyle=s}}},3298:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextGeometry=t.QUAD_INDEX_MEMORY_FOOTPRINT=t.QUAD_VERTEX_MEMORY_FOOTPRINT=t.INDICES_PER_QUAD=t.VERTICES_PER_QUAD=t.INDEX_BUFFER_STRIDE=t.VERTEX_BUFFER_STRIDE=t.MAX_CAPACITY=void 0;const r=i(4428);t.MAX_CAPACITY=65536,t.VERTEX_BUFFER_STRIDE=16,t.INDEX_BUFFER_STRIDE=1,t.VERTICES_PER_QUAD=4,t.INDICES_PER_QUAD=6,t.QUAD_VERTEX_MEMORY_FOOTPRINT=t.VERTICES_PER_QUAD*t.VERTEX_BUFFER_STRIDE,t.QUAD_INDEX_MEMORY_FOOTPRINT=t.INDICES_PER_QUAD*t.INDEX_BUFFER_STRIDE,t.TextGeometry=class{constructor(e,i,n,s,o){this.scene=e,this.capacity=Math.min(o,t.MAX_CAPACITY),this.m_currentCapacity=Math.min(s,o),this.m_drawCount=0,this.m_updateOffset=0,this.m_pickingCount=0,this.m_vertexBuffer=new r.InterleavedBuffer(new Float32Array(this.m_currentCapacity*t.QUAD_VERTEX_MEMORY_FOOTPRINT),t.VERTEX_BUFFER_STRIDE),this.m_vertexBuffer.setUsage(r.DynamicDrawUsage),this.m_positionAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,0),this.m_uvAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,4),this.m_colorAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,8),this.m_bgColorAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,12),this.m_indexBuffer=new r.BufferAttribute(new Uint32Array(this.m_currentCapacity*t.QUAD_INDEX_MEMORY_FOOTPRINT),t.INDEX_BUFFER_STRIDE),this.m_indexBuffer.setUsage(r.DynamicDrawUsage),this.m_geometry=new r.BufferGeometry,this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("bgColor",this.m_bgColorAttribute),this.m_geometry.setIndex(this.m_indexBuffer),this.m_pickingDataArray=new Array(this.m_currentCapacity),this.m_mesh=new r.Mesh(this.m_geometry,i),this.m_bgMesh=new r.Mesh(this.m_geometry,n),this.m_mesh.renderOrder=Number.MAX_SAFE_INTEGER,this.m_bgMesh.renderOrder=Number.MAX_SAFE_INTEGER-1,this.m_mesh.frustumCulled=!1,this.m_bgMesh.frustumCulled=!1,this.scene.add(this.m_bgMesh,this.m_mesh)}get drawCount(){return this.m_drawCount}get mesh(){return this.m_mesh}get backgroundMesh(){return this.m_bgMesh}dispose(){this.scene.remove(this.m_bgMesh,this.m_mesh),this.m_geometry.dispose()}clear(){this.m_drawCount=0,this.m_updateOffset=0,this.m_pickingCount=0}update(){this.drawCount>this.m_updateOffset&&(this.m_vertexBuffer.needsUpdate=!0,this.m_vertexBuffer.updateRange.offset=this.m_updateOffset*t.QUAD_VERTEX_MEMORY_FOOTPRINT,this.m_vertexBuffer.updateRange.count=(this.m_drawCount-this.m_updateOffset)*t.QUAD_VERTEX_MEMORY_FOOTPRINT,this.m_indexBuffer.needsUpdate=!0,this.m_indexBuffer.updateRange.offset=this.m_updateOffset*t.QUAD_INDEX_MEMORY_FOOTPRINT,this.m_indexBuffer.updateRange.count=(this.m_drawCount-this.m_updateOffset)*t.QUAD_INDEX_MEMORY_FOOTPRINT),this.m_updateOffset=this.m_drawCount,this.m_geometry.setDrawRange(0,this.m_drawCount*t.INDICES_PER_QUAD)}add(e,i,r,n,s,o){if(this.m_drawCount>=this.capacity)return!1;if(this.m_drawCount>=this.m_currentCapacity){const e=Math.min(2*this.m_currentCapacity,this.capacity);this.resizeBuffers(e)}const a=this.m_drawCount*t.VERTICES_PER_QUAD,l=this.m_drawCount*t.INDICES_PER_QUAD;for(let l=0;l<t.VERTICES_PER_QUAD;++l){this.m_positionAttribute.setXYZW(a+l,i[l].x,i[l].y,i[l].z,(s?-1:1)*o.rotation);const t=s?(l+1)%2+2*Math.floor(l/2):l;this.m_uvAttribute.setXYZW(a+l,e.dynamicTextureCoordinates[t].x,e.dynamicTextureCoordinates[t].y,r,n),this.m_colorAttribute.setXYZW(a+l,o.color.r,o.color.g,o.color.b,o.opacity),this.m_bgColorAttribute.setXYZW(a+l,o.backgroundColor.r,o.backgroundColor.g,o.backgroundColor.b,o.backgroundOpacity)}return this.m_indexBuffer.setX(l,a),this.m_indexBuffer.setX(l+1,a+1),this.m_indexBuffer.setX(l+2,a+2),this.m_indexBuffer.setX(l+3,a+2),this.m_indexBuffer.setX(l+4,a+1),this.m_indexBuffer.setX(l+5,a+3),++this.m_drawCount,!0}addToBuffer(e,i,r,n,s,o,a,l){for(let c=0;c<t.VERTICES_PER_QUAD;++c){const h=i+t.VERTEX_BUFFER_STRIDE*c;e[h]=n[c].x,e[h+1]=n[c].y,e[h+2]=n[c].z,e[h+3]=(a?-1:1)*l.rotation;const d=a?(c+1)%2+2*Math.floor(c/2):c;e[h+4]=r.dynamicTextureCoordinates[d].x,e[h+5]=r.dynamicTextureCoordinates[d].y,e[h+6]=s,e[h+7]=o,e[h+8]=l.color.r,e[h+9]=l.color.g,e[h+10]=l.color.b,e[h+11]=l.opacity,e[h+12]=l.backgroundColor.r,e[h+13]=l.backgroundColor.g,e[h+14]=l.backgroundColor.b,e[h+15]=l.backgroundOpacity}}addTextBufferObject(e,i,r,n,s,o,a,l){if(this.m_drawCount+e.glyphs.length>=this.capacity)return!1;if(this.m_drawCount+e.glyphs.length>=this.m_currentCapacity){const e=Math.min(2*this.m_currentCapacity,this.capacity);this.resizeBuffers(e)}const c=null!=r?r:1,h=null!=n?n:0,d=Math.cos(h),u=Math.sin(h),m=void 0!==i?i.x:0,p=void 0!==i?i.y:0,f=e.buffer,g=f[3]<0?-1:1,v=void 0!==s?s.r:f[8],_=void 0!==s?s.g:f[9],y=void 0!==s?s.b:f[10],x=void 0!==o?o:f[11],b=void 0!==a?a.r:f[12],T=void 0!==a?a.g:f[13],w=void 0!==a?a.b:f[14],S=void 0!==l?l:f[15],M=this.m_drawCount*t.VERTICES_PER_QUAD;for(let i=0;i<e.glyphs.length;++i){const r=i*t.QUAD_VERTEX_MEMORY_FOOTPRINT,n=e.glyphs[i];if(!n.isInCache)return!1;const s=f[r+4]>f[r+t.VERTEX_BUFFER_STRIDE+4],o=f[r+6],a=f[r+7];for(let e=0;e<t.VERTICES_PER_QUAD;++e){const l=f[r+e*t.VERTEX_BUFFER_STRIDE],E=f[r+e*t.VERTEX_BUFFER_STRIDE+1];this.m_positionAttribute.setXYZW(M+i*t.VERTICES_PER_QUAD+e,l*c*d+E*c*-u+m,l*c*u+E*c*d+p,f[r+e*t.VERTEX_BUFFER_STRIDE+2]+0,f[r+e*t.VERTEX_BUFFER_STRIDE+3]+g*h);const P=s?(e+1)%2+2*Math.floor(e/2):e;this.m_uvAttribute.setXYZW(M+i*t.VERTICES_PER_QUAD+e,n.dynamicTextureCoordinates[P].x,n.dynamicTextureCoordinates[P].y,o,(a-o)/c+o),this.m_colorAttribute.setXYZW(M+i*t.VERTICES_PER_QUAD+e,v,_,y,x),this.m_bgColorAttribute.setXYZW(M+i*t.VERTICES_PER_QUAD+e,b,T,w,S)}this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD,(this.m_drawCount+i)*t.VERTICES_PER_QUAD),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+1,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+1),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+2,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+2),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+3,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+2),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+4,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+1),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+5,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+3)}return this.m_drawCount+=e.glyphs.length,!0}addPickingData(e,t,i){return!(this.m_pickingCount>=this.m_currentCapacity||(this.m_pickingDataArray[this.m_pickingCount]={start:Math.min(e,this.capacity),end:Math.min(t,this.capacity),data:i},++this.m_pickingCount,0))}pick(e,i){for(const r of this.m_pickingDataArray){if(void 0===r)return;for(let n=r.start;n<r.end;++n){const s=n*t.VERTICES_PER_QUAD,o=Math.min(this.m_positionAttribute.getX(s+2),this.m_positionAttribute.getX(s+1));if(e.x<o)continue;const a=Math.max(this.m_positionAttribute.getX(s+2),this.m_positionAttribute.getX(s+1));if(e.x>a)continue;const l=Math.min(this.m_positionAttribute.getY(s+2),this.m_positionAttribute.getY(s+1));if(e.y<l)continue;const c=Math.max(this.m_positionAttribute.getY(s+2),this.m_positionAttribute.getY(s+1));if(!(e.y>c)){i(r.data);break}}}}updateMemoryUsage(e){const t=4*this.m_vertexBuffer.count+4*this.m_indexBuffer.count;e.heapSize+=t,e.gpuSize+=t}resizeBuffers(e){this.m_currentCapacity=e;const i=new Float32Array(e*t.QUAD_VERTEX_MEMORY_FOOTPRINT);i.set(this.m_vertexBuffer.array),this.m_vertexBuffer=new r.InterleavedBuffer(i,t.VERTEX_BUFFER_STRIDE),this.m_vertexBuffer.setUsage(r.DynamicDrawUsage),this.m_positionAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,0),this.m_uvAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,4),this.m_colorAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,8),this.m_bgColorAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,12);const n=new Uint32Array(e*t.QUAD_INDEX_MEMORY_FOOTPRINT);n.set(this.m_indexBuffer.array),this.m_indexBuffer=new r.BufferAttribute(n,t.INDEX_BUFFER_STRIDE),this.m_indexBuffer.setUsage(r.DynamicDrawUsage),this.m_geometry.dispose(),this.m_geometry=new r.BufferGeometry,this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("bgColor",this.m_bgColorAttribute),this.m_geometry.setIndex(this.m_indexBuffer),this.m_pickingDataArray.length=this.m_currentCapacity,this.scene.remove(this.m_bgMesh,this.m_mesh),this.m_mesh=new r.Mesh(this.m_geometry,this.m_mesh.material),this.m_bgMesh=new r.Mesh(this.m_geometry,this.m_bgMesh.material),this.m_mesh.renderOrder=Number.MAX_SAFE_INTEGER,this.m_bgMesh.renderOrder=Number.MAX_SAFE_INTEGER-1,this.m_mesh.frustumCulled=!1,this.m_bgMesh.frustumCulled=!1,this.scene.add(this.m_bgMesh,this.m_mesh)}}},5207:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SdfTextMaterial=t.GlyphCopyMaterial=t.GlyphClearMaterial=void 0;const r=i(2183),n=i(4428);Object.assign(n.ShaderChunk,{sdf_attributes:"\n        attribute vec4 position;\n        attribute vec4 uv;\n        attribute vec4 color;\n        attribute vec4 bgColor;\n        ",sdf_varying:"\n        varying vec4 vColor;\n        varying float vWeight;\n        varying vec2 vUv;\n        varying float vRotation;\n        ",sdf_varying_computation:"\n        #if BG_TEXT\n        vColor = bgColor;\n        vWeight = uv.w;\n        #else\n        vColor = color;\n        vWeight = uv.z;\n        #endif\n        vUv = vec2(uv.xy);\n        vRotation = position.w;\n        ",sdf_frag_uniforms:"\n        uniform sampler2D sdfTexture;\n        uniform vec4 sdfParams;\n        ",sdf_sampling_functions:"\n        float median(float r, float g, float b) {\n            return max(min(r, g), min(max(r, g), b));\n        }\n\n        float getDistance(vec2 uvOffset) {\n            vec3 texSample = texture2D(sdfTexture, vUv.xy + uvOffset).rgb;\n            #if MSDF\n            return median(texSample.r, texSample.g, texSample.b);\n            #else\n            return texSample.r;\n            #endif\n        }\n\n        float getOpacity(vec2 uvOffset, float weight) {\n            vec2 uv = vUv + uvOffset;\n            vec2 rotatedUVs = abs(vec2(\n                cos(vRotation) * uv.x - sin(vRotation) * uv.y,\n                sin(vRotation) * uv.x + cos(vRotation) * uv.y));\n\n            float dx = dFdx(rotatedUVs.x) * sdfParams.x;\n            float dy = dFdy(rotatedUVs.y) * sdfParams.y;\n            float toPixels = sdfParams.w * inversesqrt( dx * dx + dy * dy );\n\n            float dist = getDistance(uvOffset) + min(weight, 0.5 - 1.0 / sdfParams.w) - 0.5;\n            return clamp(dist * toPixels + 0.5, 0.0, 1.0);\n        }\n        "});class s extends n.RawShaderMaterial{constructor(e){const t=!0===(null==e?void 0:e.rendererCapabilities.isWebGL2),i=e?Object.assign(Object.assign({},e),{glslVersion:t?n.GLSL3:n.GLSL1,vertexShader:t&&e.vertexShader?r.convertVertexShaderToWebGL2(e.vertexShader):e.vertexShader,fragmentShader:t&&e.fragmentShader?r.convertFragmentShaderToWebGL2(e.fragmentShader):e.fragmentShader}):void 0;i&&delete i.rendererCapabilities,super(i)}}t.GlyphClearMaterial=class extends s{constructor(e){super(e?{name:"GlyphClearMaterial",vertexShader:"\n    attribute vec2 position;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    }",fragmentShader:"\n    precision highp float;\n    precision highp int;\n\n    void main() {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }",uniforms:{},depthTest:!1,depthWrite:!1,rendererCapabilities:e.rendererCapabilities}:void 0)}},t.GlyphCopyMaterial=class extends s{constructor(e){super(e?{name:"GlyphCopyMaterial",vertexShader:"\n    attribute vec3 position;\n    attribute vec2 uv;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    varying vec3 vUv;\n\n    void main() {\n        vUv = vec3(uv.xy, position.z);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    }",fragmentShader:"\n    precision highp float;\n    precision highp int;\n\n    uniform float pageOffset;\n    uniform sampler2D page0;\n    uniform sampler2D page1;\n    uniform sampler2D page2;\n    uniform sampler2D page3;\n    uniform sampler2D page4;\n    uniform sampler2D page5;\n    uniform sampler2D page6;\n    uniform sampler2D page7;\n\n    varying vec3 vUv;\n\n    void main() {\n        vec4 texSample = vec4(0.0);\n        if (vUv.z < pageOffset || vUv.z > (pageOffset + 7.0)) discard;\n        else if (vUv.z < pageOffset + 1.0) texSample = texture2D(page0, vUv.xy);\n        else if (vUv.z < pageOffset + 2.0) texSample = texture2D(page1, vUv.xy);\n        else if (vUv.z < pageOffset + 3.0) texSample = texture2D(page2, vUv.xy);\n        else if (vUv.z < pageOffset + 4.0) texSample = texture2D(page3, vUv.xy);\n        else if (vUv.z < pageOffset + 5.0) texSample = texture2D(page4, vUv.xy);\n        else if (vUv.z < pageOffset + 6.0) texSample = texture2D(page5, vUv.xy);\n        else if (vUv.z < pageOffset + 7.0) texSample = texture2D(page6, vUv.xy);\n        else texSample = texture2D(page7, vUv.xy);\n\n        gl_FragColor = texSample;\n    }",uniforms:{pageOffset:new n.Uniform(0),page0:new n.Uniform(n.Texture.DEFAULT_IMAGE),page1:new n.Uniform(n.Texture.DEFAULT_IMAGE),page2:new n.Uniform(n.Texture.DEFAULT_IMAGE),page3:new n.Uniform(n.Texture.DEFAULT_IMAGE),page4:new n.Uniform(n.Texture.DEFAULT_IMAGE),page5:new n.Uniform(n.Texture.DEFAULT_IMAGE),page6:new n.Uniform(n.Texture.DEFAULT_IMAGE),page7:new n.Uniform(n.Texture.DEFAULT_IMAGE)},depthTest:!1,depthWrite:!1,rendererCapabilities:e.rendererCapabilities}:void 0)}},t.SdfTextMaterial=class extends s{constructor(e){super(e?{name:"SdfTextMaterial",vertexShader:void 0!==e.vertexSource?e.vertexSource:"\n    #include <sdf_attributes>\n    #include <sdf_varying>\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        #include <sdf_varying_computation>\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n    }",fragmentShader:void 0!==e.fragmentSource?e.fragmentSource:"\n    precision highp float;\n    precision highp int;\n\n    #include <sdf_varying>\n    #include <sdf_frag_uniforms>\n    #include <sdf_sampling_functions>\n\n    void main() {\n        vec4 color = vColor;\n        color.a *= getOpacity(vec2(0.0), vWeight);\n        if (color.a < 0.05) {\n            discard;\n        }\n        gl_FragColor = color;\n    }",uniforms:{sdfTexture:new n.Uniform(e.texture),sdfParams:new n.Uniform(new n.Vector4(e.textureSize.x,e.textureSize.y,e.size,e.distanceRange))},defines:{MSDF:e.isMsdf?1:0,BG_TEXT:e.isBackground?1:0},depthTest:!0,depthWrite:!1,side:n.DoubleSide,transparent:!0,rendererCapabilities:e.rendererCapabilities}:void 0),this.extensions.derivatives=!0}}},4836:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolvePlacementAndAlignment=t.TextLayoutStyle=t.TextRenderStyle=t.DefaultTextStyle=t.vPlacementFromAlignment=t.hPlacementFromAlignment=t.vAlignFromPlacement=t.hAlignFromPlacement=t.WrappingMode=t.HorizontalPlacement=t.VerticalPlacement=t.HorizontalAlignment=t.VerticalAlignment=t.FontVariant=t.FontStyle=t.FontUnit=void 0;const r=i(4428);var n,s,o,a,l,c,h,d,u;!function(e){e[e.Em=0]="Em",e[e.Pixel=1]="Pixel",e[e.Point=2]="Point",e[e.Percent=3]="Percent"}(n=t.FontUnit||(t.FontUnit={})),function(e){e[e.Regular=0]="Regular",e[e.Bold=1]="Bold",e[e.Italic=2]="Italic",e[e.BoldItalic=3]="BoldItalic"}(s=t.FontStyle||(t.FontStyle={})),function(e){e[e.Regular=0]="Regular",e[e.AllCaps=1]="AllCaps",e[e.SmallCaps=2]="SmallCaps"}(o=t.FontVariant||(t.FontVariant={})),function(e){e[e.Above=0]="Above",e[e.Center=-.5]="Center",e[e.Below=-1]="Below"}(a=t.VerticalAlignment||(t.VerticalAlignment={})),function(e){e[e.Left=0]="Left",e[e.Center=-.5]="Center",e[e.Right=-1]="Right"}(l=t.HorizontalAlignment||(t.HorizontalAlignment={})),(u=t.VerticalPlacement||(t.VerticalPlacement={}))[u.Top=0]="Top",u[u.Center=-.5]="Center",u[u.Bottom=-1]="Bottom",(d=t.HorizontalPlacement||(t.HorizontalPlacement={}))[d.Left=-1]="Left",d[d.Center=-.5]="Center",d[d.Right=0]="Right",function(e){e[e.None=0]="None",e[e.Character=1]="Character",e[e.Word=2]="Word"}(c=t.WrappingMode||(t.WrappingMode={})),t.hAlignFromPlacement=function(e){return e},t.vAlignFromPlacement=function(e){return e},t.hPlacementFromAlignment=function(e){return e},t.vPlacementFromAlignment=function(e){return e},function(e){e.DEFAULT_FONT_NAME="",e.DEFAULT_FONT_SIZE={unit:Object.freeze(n.Pixel),size:Object.freeze(16),backgroundSize:Object.freeze(0)},e.DEFAULT_FONT_STYLE=s.Regular,e.DEFAULT_FONT_VARIANT=o.Regular,e.DEFAULT_ROTATION=0,e.DEFAULT_COLOR=new r.Color(0),e.DEFAULT_OPACITY=1,e.DEFAULT_BACKGROUND_COLOR=new r.Color(0),e.DEFAULT_BACKGROUND_OPACITY=0,e.DEFAULT_TRACKING=0,e.DEFAULT_LEADING=0,e.DEFAULT_MAX_LINES=1/0,e.DEFAULT_LINE_WIDTH=1/0,e.DEFAULT_CANVAS_ROTATION=0,e.DEFAULT_LINE_ROTATION=0,e.DEFAULT_WRAPPING_MODE=c.Word,e.DEFAULT_VERTICAL_ALIGNMENT=a.Above,e.DEFAULT_HORIZONTAL_ALIGNMENT=l.Left,e.DEFAULT_PLACEMENTS=[]}(h=t.DefaultTextStyle||(t.DefaultTextStyle={}));class m{constructor(e={}){this.m_params={fontName:void 0!==e.fontName?e.fontName:h.DEFAULT_FONT_NAME,fontSize:void 0!==e.fontSize?Object.assign({},e.fontSize):{unit:h.DEFAULT_FONT_SIZE.unit,size:h.DEFAULT_FONT_SIZE.size,backgroundSize:h.DEFAULT_FONT_SIZE.backgroundSize},fontStyle:void 0!==e.fontStyle?e.fontStyle:h.DEFAULT_FONT_STYLE,fontVariant:void 0!==e.fontVariant?e.fontVariant:h.DEFAULT_FONT_VARIANT,rotation:void 0!==e.rotation?e.rotation:h.DEFAULT_ROTATION,color:void 0!==e.color?e.color.clone():h.DEFAULT_COLOR.clone(),opacity:void 0!==e.opacity?e.opacity:h.DEFAULT_OPACITY,backgroundColor:void 0!==e.backgroundColor?e.backgroundColor.clone():h.DEFAULT_BACKGROUND_COLOR.clone(),backgroundOpacity:void 0!==e.backgroundOpacity?e.backgroundOpacity:h.DEFAULT_BACKGROUND_OPACITY}}get params(){return this.m_params}set params(e){this.m_params=Object.assign(Object.assign({},this.m_params),e)}get fontName(){return this.m_params.fontName}set fontName(e){this.m_params.fontName=e}get fontSize(){return this.m_params.fontSize}set fontSize(e){this.m_params.fontSize=Object.assign({},e)}get fontStyle(){return this.m_params.fontStyle}set fontStyle(e){this.m_params.fontStyle=e}get fontVariant(){return this.m_params.fontVariant}set fontVariant(e){this.m_params.fontVariant=e}get rotation(){return this.m_params.rotation}set rotation(e){this.m_params.rotation=e}get color(){return this.m_params.color}set color(e){this.m_params.color.copy(e)}get backgroundColor(){return this.m_params.backgroundColor}set backgroundColor(e){this.m_params.backgroundColor.copy(e)}get opacity(){return this.m_params.opacity}set opacity(e){this.m_params.opacity=e}get backgroundOpacity(){return this.m_params.backgroundOpacity}set backgroundOpacity(e){this.m_params.backgroundOpacity=e}clone(e={}){return new m(Object.assign(Object.assign({},this.m_params),e))}copy(e){return this.m_params.fontName=e.fontName,this.m_params.fontSize=Object.assign({},e.fontSize),this.m_params.fontStyle=e.fontStyle,this.m_params.fontVariant=e.fontVariant,this.m_params.rotation=e.rotation,this.m_params.color.copy(e.color),this.m_params.backgroundColor.copy(e.backgroundColor),this.m_params.opacity=e.opacity,this.m_params.backgroundOpacity=e.backgroundOpacity,this}}t.TextRenderStyle=m;class p{constructor(e={}){const{horizontalAlignment:t,verticalAlignment:i,placements:r}=f(e.horizontalAlignment,e.verticalAlignment,e.placements);this.m_params={tracking:void 0!==e.tracking?e.tracking:h.DEFAULT_TRACKING,leading:void 0!==e.leading?e.leading:h.DEFAULT_LEADING,maxLines:void 0!==e.maxLines?e.maxLines:h.DEFAULT_MAX_LINES,lineWidth:void 0!==e.lineWidth?e.lineWidth:h.DEFAULT_LINE_WIDTH,canvasRotation:void 0!==e.canvasRotation?e.canvasRotation:h.DEFAULT_CANVAS_ROTATION,lineRotation:void 0!==e.lineRotation?e.lineRotation:h.DEFAULT_LINE_ROTATION,wrappingMode:void 0!==e.wrappingMode?e.wrappingMode:h.DEFAULT_WRAPPING_MODE,verticalAlignment:i,horizontalAlignment:t,placements:r}}get params(){return this.m_params}set params(e){this.m_params=Object.assign(Object.assign({},this.m_params),e)}get tracking(){return this.m_params.tracking}set tracking(e){this.m_params.tracking=e}get leading(){return this.m_params.leading}set leading(e){this.m_params.leading=e}get maxLines(){return this.m_params.maxLines}set maxLines(e){this.m_params.maxLines=e}get lineWidth(){return this.m_params.lineWidth}set lineWidth(e){this.m_params.lineWidth=e}get canvasRotation(){return this.m_params.canvasRotation}set canvasRotation(e){this.m_params.canvasRotation=e}get lineRotation(){return this.m_params.lineRotation}set lineRotation(e){this.m_params.lineRotation=e}get wrappingMode(){return this.m_params.wrappingMode}set wrappingMode(e){this.m_params.wrappingMode=e}get verticalAlignment(){return this.m_params.verticalAlignment}set verticalAlignment(e){this.m_params.verticalAlignment=e}get horizontalAlignment(){return this.m_params.horizontalAlignment}set horizontalAlignment(e){this.m_params.horizontalAlignment=e}get placements(){return this.m_params.placements}set placements(e){const{horizontalAlignment:t,verticalAlignment:i,placements:r}=f(this.horizontalAlignment,this.verticalAlignment,e);this.m_params.horizontalAlignment=t,this.m_params.verticalAlignment=i,this.m_params.placements=r}clone(e={}){return new p(Object.assign(Object.assign({},this.m_params),e))}copy(e){return this.params=Object.assign({},e.params),this}}function f(e,t,i){var r;const n=null!==(r=null==i?void 0:i.map((e=>Object.assign({},e))))&&void 0!==r?r:h.DEFAULT_PLACEMENTS.map((e=>Object.assign({},e)));return{horizontalAlignment:n.length>0?n[0].h:null!=e?e:h.DEFAULT_HORIZONTAL_ALIGNMENT,verticalAlignment:n.length>0?n[0].v:null!=t?t:h.DEFAULT_VERTICAL_ALIGNMENT,placements:n}}t.TextLayoutStyle=p,t.resolvePlacementAndAlignment=f},1819:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineTypesetter=void 0;const r=i(4428),n=i(3298),s=i(4836),o=i(9668),a=i(7984);t.LineTypesetter=class{constructor(){this.m_tempTransform=new r.Matrix3,this.m_tempCorners=[new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3],this.m_tempLineDirection=a.UnicodeUtils.Direction.LTR,this.m_tempRunDirection=a.UnicodeUtils.Direction.LTR,this.m_tempPixelSize=1,this.m_tempPixelBgSize=1,this.m_tempScale=1,this.m_tempSmallCaps=!1}arrangeGlyphs(e){this.m_currentParams=e,this.m_tempLineDirection=o.TypesettingUtils.getDirection(this.m_currentParams.glyphs,0),this.m_tempRunDirection=this.m_tempLineDirection,this.m_tempPixelSize=o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_tempScale=this.m_tempPixelSize/this.m_currentParams.fontCatalog.size,this.m_tempPixelBgSize=Math.min(o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_currentParams.fontCatalog.distanceRange*this.m_tempScale),this.m_tempSmallCaps=void 0!==this.m_currentParams.smallCapsArray,this.m_currentParams.position.y+=this.m_currentParams.textLayoutStyle.verticalAlignment*this.m_currentParams.glyphs[0].font.metrics.capHeight*this.m_tempScale;const t=void 0!==this.m_currentParams.globalBounds&&void 0===this.m_currentParams.vertexBuffer,i=this.m_currentParams.position.x,r=this.m_currentParams.glyphs[0].font.metrics.lineHeight+this.m_currentParams.textLayoutStyle.leading;let n=0,l=0,c=0,h=0,d=0,u=0,m=0,p=0,f=!1;for(let e=0;e<this.m_currentParams.glyphs.length&&!(p>this.m_currentParams.textLayoutStyle.maxLines-1);++e){const g=this.m_currentParams.glyphs[e];if(!g.isInCache&&!t)return!1;const v=a.UnicodeUtils.isNewLine(g.codePoint),_=a.UnicodeUtils.isWhiteSpace(g.codePoint);if(f||g.direction!==-this.m_tempLineDirection||(f=!0),a.UnicodeUtils.isPrintable(g.codePoint)&&(d+=(g.advanceX+this.m_currentParams.textLayoutStyle.tracking)*this.m_tempScale*(this.m_tempSmallCaps?o.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs,this.m_currentParams.smallCapsArray,e,this.m_currentParams.textRenderStyle.fontVariant):1)),e===n&&(h=d,u=d,m=d),v||this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Character&&d>this.m_currentParams.textLayoutStyle.lineWidth||this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Word&&d>this.m_currentParams.textLayoutStyle.lineWidth&&m!==h){if(this.m_currentParams.textLayoutStyle.wrappingMode!==s.WrappingMode.None){let t=l,i=u;this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Word&&m!==h&&(t=c,i=m),d=i,e=Math.min(v?n===e?t:e:t,this.m_currentParams.glyphs.length-1)}const t=this.m_tempLineDirection===a.UnicodeUtils.Direction.RTL&&f?1+this.m_currentParams.textLayoutStyle.horizontalAlignment:this.m_currentParams.textLayoutStyle.horizontalAlignment;if(this.m_currentParams.position.x=this.m_currentParams.position.x+d*t,!this.placeLine(n,e,this.m_tempLineDirection,f))return!1;for(this.m_currentParams.position.y-=r*this.m_tempScale,this.m_currentParams.position.x=i;e!==n&&e+1<this.m_currentParams.glyphs.length&&a.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[e+1].codePoint);)++e;if(n=e+1,n===this.m_currentParams.glyphs.length)break;v&&(this.m_tempLineDirection=o.TypesettingUtils.getDirection(this.m_currentParams.glyphs,n),this.m_tempRunDirection=this.m_tempLineDirection),h=0,d=0,l=n,u=0,c=n,m=0,f=!1,p++}else this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.None||_||(l=e,u=d,this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Word&&e+1<this.m_currentParams.glyphs.length&&(a.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[e+1].codePoint)||a.UnicodeUtils.isNewLine(this.m_currentParams.glyphs[e+1].codePoint))&&(c=e,m=d))}if(p<=this.m_currentParams.textLayoutStyle.maxLines-1&&n<=this.m_currentParams.glyphs.length-1){const e=this.m_tempLineDirection===a.UnicodeUtils.Direction.RTL&&f?1+this.m_currentParams.textLayoutStyle.horizontalAlignment:this.m_currentParams.textLayoutStyle.horizontalAlignment;if(this.m_currentParams.position.setX(this.m_currentParams.position.x+d*e),!this.placeLine(n,this.m_currentParams.glyphs.length-1,this.m_tempLineDirection,f))return!1}return!0}placeLine(e,t,i,r){if(!r)return this.placeRun(e,t,i);const n=this.m_currentParams.glyphs,s=this.m_currentParams.smallCapsArray,l=this.m_currentParams.textRenderStyle,c=this.m_currentParams.textLayoutStyle,h=this.m_currentParams.position,d=i===a.UnicodeUtils.Direction.RTL,u=h.x;let m=0,p=e;for(let r=e;r<=t;++r){const e=n[r];if(e.direction===-this.m_tempRunDirection){if(d&&(h.x=u+m),!this.placeRun(p,r-1,this.m_tempRunDirection))return!1;d||(h.x=u+m),p=r,this.m_tempRunDirection*=-1}else if(e.direction===a.UnicodeUtils.Direction.Neutral&&this.m_tempRunDirection===-i){let e=r;for(;e+1<n.length&&1!==Math.abs(n[e].direction);)++e;if(n[e].direction!==this.m_tempRunDirection){if(d&&(h.x=u+m),!this.placeRun(p,r-1,this.m_tempRunDirection))return!1;d||(h.x=u+m),p=r,this.m_tempRunDirection*=-1}}m+=(e.advanceX+c.tracking)*this.m_tempScale*(this.m_tempSmallCaps?o.TypesettingUtils.getSmallCapsScale(n,s,r,l.fontVariant):1)*i}if(p<=t){if(d&&(h.x=u+m),!this.placeRun(p,t,this.m_tempRunDirection))return!1;d||(h.x=u+m)}return!0}placeRun(e,t,i){const r=this.m_currentParams.glyphs,l=this.m_currentParams.smallCapsArray,c=this.m_currentParams.fontCatalog,h=this.m_currentParams.textRenderStyle,d=this.m_currentParams.textLayoutStyle,u=this.m_currentParams.position,m=this.m_currentParams.geometry,p=this.m_currentParams.globalBounds,f=this.m_currentParams.individualBounds,g=this.m_currentParams.vertexBuffer,v=i===a.UnicodeUtils.Direction.LTR?e:t,_=i===a.UnicodeUtils.Direction.LTR?t:e;for(let y=v;i===a.UnicodeUtils.Direction.RTL?y>=_:y<=_;y+=i){const v=r[y];if(!a.UnicodeUtils.isPrintable(v.codePoint))continue;if(e!==t&&0!==y&&i===a.UnicodeUtils.Direction.RTL&&v.direction===a.UnicodeUtils.Direction.Weak){let t=y,i=r[t-1];for(;t!==e&&(i.direction===a.UnicodeUtils.Direction.Weak||i.direction===a.UnicodeUtils.Direction.Neutral&&!a.UnicodeUtils.isWhiteSpace(i.codePoint));)--t,i=r[t-1];this.placeRun(Math.max(t,e),y,a.UnicodeUtils.Direction.LTR),y=t;continue}const _=v.font,x=_.metrics,b=h.fontStyle,T=b===s.FontStyle.Bold&&void 0===_.bold||b===s.FontStyle.BoldItalic&&void 0===_.bold&&void 0===_.boldItalic,w=b===s.FontStyle.Italic&&void 0===_.italic||b===s.FontStyle.BoldItalic&&void 0===_.italic&&void 0===_.boldItalic,S=!!this.m_tempSmallCaps&&l[y]&&h.fontVariant===s.FontVariant.SmallCaps,M=S?x.xHeight/x.capHeight:1,E=this.m_tempScale*M,P=((T?.02:0)+(S?.01:0))*(c.size/c.distanceRange),C=.5*this.m_tempPixelBgSize/(c.distanceRange*Math.max(E,1)),A=a.UnicodeUtils.isRtlMirrored(v.codePoint)&&i===a.UnicodeUtils.Direction.RTL,L=x.lineHeight-x.base-.5*x.distanceRange;o.TypesettingUtils.computeGlyphTransform(this.m_tempTransform,u,E,d.canvasRotation,h.rotation);for(let e=0;e<4;++e){const t=v.positions[e],i=w&&e>1?o.TypesettingUtils.OBLIQUE_OFFSET*x.size:0;this.m_tempCorners[e].set(t.x+i,t.y-L,t.z),this.m_tempCorners[e].applyMatrix3(this.m_tempTransform)}if(void 0===p&&void 0===g){if(!m.add(v,this.m_tempCorners,P,P+C,A,h))return!1}else void 0!==p&&o.TypesettingUtils.updateBounds(this.m_tempCorners,p,f),void 0!==g&&m.addToBuffer(g,y*n.QUAD_VERTEX_MEMORY_FOOTPRINT,v,this.m_tempCorners,P,P+C,A,h);u.set(u.x+(v.advanceX+d.tracking)*E*Math.cos(d.lineRotation),u.y+(v.advanceX+d.tracking)*E*Math.sin(d.lineRotation),u.z)}return!0}}},8634:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PathTypesetter=void 0;const r=i(4428),n=i(3298),s=i(4836),o=i(9668),a=i(7984);t.PathTypesetter=class{constructor(){this.m_tempTransform=new r.Matrix3,this.m_tempCorners=[new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3],this.m_tempLineDirection=a.UnicodeUtils.Direction.LTR,this.m_tempRunDirection=a.UnicodeUtils.Direction.LTR,this.m_tempPixelSize=1,this.m_tempPixelBgSize=1,this.m_tempScale=1,this.m_tempSmallCaps=!1,this.m_tempPathPosition=new r.Vector3,this.m_tempPathLength=0,this.m_tempPathOffset=0}arrangeGlyphs(e){this.m_currentParams=e,this.m_tempLineDirection=o.TypesettingUtils.getDirection(this.m_currentParams.glyphs,0),this.m_tempRunDirection=this.m_tempLineDirection,this.m_tempPixelSize=o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_tempScale=this.m_tempPixelSize/this.m_currentParams.fontCatalog.size,this.m_tempPixelBgSize=Math.min(o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_currentParams.fontCatalog.distanceRange*this.m_tempScale),this.m_tempSmallCaps=void 0!==this.m_currentParams.smallCapsArray,this.m_tempPathLength=this.m_currentParams.path.getLength(),this.m_tempPathOffset=0;const t=void 0!==this.m_currentParams.globalBounds&&void 0===this.m_currentParams.vertexBuffer;let i=!1,r=0;for(let e=0;e<this.m_currentParams.glyphs.length;++e){const n=this.m_currentParams.glyphs[e];if(!n.isInCache&&!t)return!1;a.UnicodeUtils.isPrintable(n.codePoint)&&(i||n.direction!==-this.m_tempLineDirection||(i=!0),r+=(n.advanceX+this.m_currentParams.textLayoutStyle.tracking)*this.m_tempScale*(this.m_tempSmallCaps?o.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs,this.m_currentParams.smallCapsArray,e,this.m_currentParams.textRenderStyle.fontVariant):1))}return this.m_tempPathOffset=Math.min(Math.max(-this.m_currentParams.textLayoutStyle.horizontalAlignment+this.m_currentParams.textLayoutStyle.horizontalAlignment*r/this.m_tempPathLength,0),1),this.placeLine(this.m_tempLineDirection,i)}placeLine(e,t){if(!t)return this.placeRun(0,this.m_currentParams.glyphs.length-1,e);const i=this.m_currentParams.glyphs;let r=0;for(let t=r;t<i.length;++t){const n=i[t];if(n.direction===-this.m_tempRunDirection){if(!this.placeRun(r,t-1,this.m_tempRunDirection))return!1;r=t,this.m_tempRunDirection*=-1}else if(n.direction===a.UnicodeUtils.Direction.Neutral&&this.m_tempRunDirection===-e){let e=t;for(;e+1<i.length&&1!==Math.abs(i[e].direction);)++e;if(i[e].direction!==this.m_tempRunDirection){if(!this.placeRun(r,t-1,this.m_tempRunDirection))return!1;r=t,this.m_tempRunDirection*=-1}}}return!(r<i.length&&!this.placeRun(r,i.length-1,this.m_tempRunDirection))}placeRun(e,t,i){const l=this.m_currentParams.glyphs,c=this.m_currentParams.smallCapsArray,h=this.m_currentParams.fontCatalog,d=this.m_currentParams.textRenderStyle,u=this.m_currentParams.textLayoutStyle,m=this.m_currentParams.position,p=this.m_currentParams.geometry,f=this.m_currentParams.globalBounds,g=this.m_currentParams.individualBounds,v=this.m_currentParams.vertexBuffer,_=this.m_currentParams.path,y=d.rotation,x=u.verticalAlignment*l[0].font.metrics.capHeight*this.m_tempScale,b=i===a.UnicodeUtils.Direction.LTR?e:t,T=i===a.UnicodeUtils.Direction.LTR?t:e;for(let w=b;i===a.UnicodeUtils.Direction.RTL?w>=T:w<=T;w+=i){const b=l[w];if(!a.UnicodeUtils.isPrintable(b.codePoint))continue;if(e!==t&&0!==w&&i===a.UnicodeUtils.Direction.RTL&&b.direction===a.UnicodeUtils.Direction.Weak){let t=w,i=l[t-1];for(;t!==e&&(i.direction===a.UnicodeUtils.Direction.Weak||i.direction===a.UnicodeUtils.Direction.Neutral&&!a.UnicodeUtils.isWhiteSpace(i.codePoint));)--t,i=l[t-1];this.placeRun(Math.max(t,e),w,a.UnicodeUtils.Direction.LTR),w=t;continue}const T=b.font,S=T.metrics,M=d.fontStyle,E=M===s.FontStyle.Bold&&void 0===T.bold||M===s.FontStyle.BoldItalic&&void 0===T.bold&&void 0===T.boldItalic,P=M===s.FontStyle.Italic&&void 0===T.italic||M===s.FontStyle.BoldItalic&&void 0===T.italic&&void 0===T.boldItalic,C=!!this.m_tempSmallCaps&&c[w]&&d.fontVariant===s.FontVariant.SmallCaps,A=C?S.xHeight/S.capHeight:1,L=this.m_tempScale*A,R=((E?.02:0)+(C?.01:0))*(h.size/h.distanceRange),D=.5*this.m_tempPixelBgSize/(h.distanceRange*Math.max(L,1)),O=a.UnicodeUtils.isRtlMirrored(b.codePoint)&&i===a.UnicodeUtils.Direction.RTL,F=S.lineHeight-S.base-.5*S.distanceRange,I=_.getPoint(this.m_tempPathOffset);if(null===I)return this.m_currentParams.pathOverflow;const U=_.getTangent(this.m_tempPathOffset),V=new r.Vector2(-U.y,U.x).multiplyScalar(x),k=Math.atan2(U.y,U.x);this.m_tempPathPosition.set(V.x+I.x,V.y+I.y,m.z),d.rotation=y+k,o.TypesettingUtils.computeGlyphTransform(this.m_tempTransform,this.m_tempPathPosition,L,0,d.rotation);for(let e=0;e<4;++e){const t=b.positions[e],i=P&&e>1?o.TypesettingUtils.OBLIQUE_OFFSET*S.size:0;this.m_tempCorners[e].set(t.x+i,t.y-F,t.z),this.m_tempCorners[e].applyMatrix3(this.m_tempTransform),this.m_tempCorners[e].x-=m.x,this.m_tempCorners[e].y-=m.y}if(void 0===f&&void 0===v){if(!p.add(b,this.m_tempCorners,R,R+D,O,d))return!1}else void 0!==f&&o.TypesettingUtils.updateBounds(this.m_tempCorners,f,g),void 0!==v&&p.addToBuffer(v,w*n.QUAD_VERTEX_MEMORY_FOOTPRINT,b,this.m_tempCorners,R,R+D,O,d);d.rotation=y,this.m_tempPathOffset+=(b.advanceX+u.tracking)*L/this.m_tempPathLength}return!0}}},4673:(e,t)=>{"use strict";var i,r;Object.defineProperty(t,"__esModule",{value:!0}),t.ContextualArabicConverter=void 0,function(e){e[e.Initial=0]="Initial",e[e.Medial=1]="Medial",e[e.Final=2]="Final"}(i||(i={})),function(e){e[e.Isolated=0]="Isolated",e[e.Connected=1]="Connected"}(r||(r={}));class n{constructor(){this.m_singleCharactersMap=new Map,this.m_combinedCharactersMap=new Map,this.m_singleCharactersMap.set(1569,[void 0,void 0,void 0]),this.m_singleCharactersMap.set(1570,[void 0,void 0,65154]),this.m_singleCharactersMap.set(1571,[void 0,void 0,65156]),this.m_singleCharactersMap.set(1572,[void 0,void 0,65158]),this.m_singleCharactersMap.set(1573,[void 0,void 0,65160]),this.m_singleCharactersMap.set(1574,[65163,65164,65162]),this.m_singleCharactersMap.set(1575,[void 0,void 0,65166]),this.m_singleCharactersMap.set(1576,[65169,65170,65168]),this.m_singleCharactersMap.set(1577,[void 0,void 0,65172]),this.m_singleCharactersMap.set(1578,[65175,65176,65174]),this.m_singleCharactersMap.set(1579,[65179,65180,65178]),this.m_singleCharactersMap.set(1580,[65183,65184,65182]),this.m_singleCharactersMap.set(1581,[65187,65188,65186]),this.m_singleCharactersMap.set(1582,[65191,65192,65190]),this.m_singleCharactersMap.set(1583,[void 0,void 0,65194]),this.m_singleCharactersMap.set(1584,[void 0,void 0,65196]),this.m_singleCharactersMap.set(1585,[void 0,void 0,65198]),this.m_singleCharactersMap.set(1586,[void 0,void 0,65200]),this.m_singleCharactersMap.set(1587,[65203,65204,65202]),this.m_singleCharactersMap.set(1588,[65207,65208,65206]),this.m_singleCharactersMap.set(1589,[65211,65212,65210]),this.m_singleCharactersMap.set(1590,[65215,65216,65214]),this.m_singleCharactersMap.set(1591,[65219,65220,65218]),this.m_singleCharactersMap.set(1592,[65223,65224,65222]),this.m_singleCharactersMap.set(1593,[65227,65228,65226]),this.m_singleCharactersMap.set(1594,[65231,65232,65230]),this.m_singleCharactersMap.set(1600,[1600,1600,1600]),this.m_singleCharactersMap.set(1601,[65235,65236,65234]),this.m_singleCharactersMap.set(1602,[65239,65240,65238]),this.m_singleCharactersMap.set(1603,[65243,65244,65242]),this.m_singleCharactersMap.set(1604,[65247,65248,65246]),this.m_singleCharactersMap.set(1605,[65251,65252,65250]),this.m_singleCharactersMap.set(1606,[65255,65256,65254]),this.m_singleCharactersMap.set(1607,[65259,65260,65258]),this.m_singleCharactersMap.set(1608,[void 0,void 0,65262]),this.m_singleCharactersMap.set(1609,[void 0,void 0,65264]),this.m_singleCharactersMap.set(1610,[65267,65268,65266]),this.m_singleCharactersMap.set(1662,[64344,64345,64343]),this.m_singleCharactersMap.set(1740,[64510,64511,64509]),this.m_singleCharactersMap.set(1670,[64380,64381,64379]),this.m_singleCharactersMap.set(1705,[64400,64401,64399]),this.m_singleCharactersMap.set(1711,[64404,64405,64403]),this.m_singleCharactersMap.set(1688,[void 0,void 0,64395]),this.m_combinedCharactersMap.set(1604,new Map),this.m_combinedCharactersMap.get(1604).set(1570,[65269,65270]),this.m_combinedCharactersMap.get(1604).set(1571,[65271,65272]),this.m_combinedCharactersMap.get(1604).set(1573,[65273,65274]),this.m_combinedCharactersMap.get(1604).set(1575,[65275,65276]),this.m_neutralCharacters=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}static get instance(){return void 0===this.m_instance&&(this.m_instance=new n),this.m_instance}convert(e){let t="";for(let n=0;n<e.length;++n){const s=e.charCodeAt(n);if(this.isArabicCharacter(s)){let o=n-1;for(;o>=0&&this.isNeutral(e.charCodeAt(o));--o);let a=o>=0?e.charCodeAt(o):void 0;if(void 0!==a){const e=this.getCharacterMap(a);(void 0===e||void 0===e[i.Initial]&&void 0===e[i.Medial])&&(a=void 0)}let l=n+1;for(;l<e.length&&this.isNeutral(e.charCodeAt(l));++l);let c=l<e.length?e.charCodeAt(l):void 0;if(void 0!==c){const e=this.getCharacterMap(c);(void 0===e||void 0===e[i.Medial]&&void 0===e[i.Final])&&(c=void 0)}if(1604===s&&void 0!==c&&(1570===c||1571===c||1573===c||1575===c)){const e=this.getCombinedCharacterMap(s,c);t+=void 0!==a?String.fromCharCode(e[r.Connected]):String.fromCharCode(e[r.Isolated]),++n;continue}const h=this.getCharacterMap(s);void 0!==a&&void 0!==c&&void 0!==h[i.Medial]?t+=String.fromCharCode(h[i.Medial]):void 0!==a&&void 0!==h[i.Final]?t+=String.fromCharCode(h[i.Final]):void 0!==c&&void 0!==h[i.Initial]?t+=String.fromCharCode(h[i.Initial]):t+=String.fromCharCode(s)}else t+=String.fromCharCode(s)}return t}isArabicCharacter(e){return this.m_singleCharactersMap.has(e)}getCharacterMap(e){return this.m_singleCharactersMap.get(e)}getCombinedCharacterMap(e,t){const i=this.m_combinedCharactersMap.get(e);if(void 0!==i)return i.get(t)}isNeutral(e){for(const t of this.m_neutralCharacters)if(t===e)return!0;return!1}}t.ContextualArabicConverter=n},9678:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSdfTextMaterial=void 0;const r=i(5207);t.createSdfTextMaterial=function(e){return new r.SdfTextMaterial({texture:e.fontCatalog.texture,textureSize:e.fontCatalog.textureSize,size:e.fontCatalog.size,distanceRange:e.fontCatalog.distanceRange,isMsdf:"msdf"===e.fontCatalog.type,isBackground:!0===e.isBackground,vertexSource:e.vertexSource,fragmentSource:e.fragmentSource,rendererCapabilities:e.rendererCapabilities})}},9668:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypesettingUtils=void 0;const r=i(4428),n=i(4836),s=i(7984);var o;(o=t.TypesettingUtils||(t.TypesettingUtils={})).EM_TO_PX=16,o.PT_TO_PX=1.25,o.OBLIQUE_ANGLE=.174533,o.OBLIQUE_OFFSET=Math.tan(o.OBLIQUE_ANGLE),o.getPixelSize=function(e,t,i){let r=e;switch(t){case n.FontUnit.Em:r*=o.EM_TO_PX;break;case n.FontUnit.Point:r*=o.PT_TO_PX;break;case n.FontUnit.Percent:r*=.01*i}return r},o.getSmallCapsScale=function(e,t,i,r){return t[i]&&r===n.FontVariant.SmallCaps?e[i].font.metrics.xHeight/e[i].font.metrics.capHeight:1},o.getDirection=function(e,t){let i=s.UnicodeUtils.Direction.LTR,r=t;for(;e[r].direction!==s.UnicodeUtils.Direction.LTR&&e[r].direction!==s.UnicodeUtils.Direction.RTL&&r<e.length-1;)++r;return 1===Math.abs(e[r].direction)&&(i=e[r].direction),i},o.computeGlyphTransform=function(e,t,i,r,n){const s=Math.cos(r),o=Math.sin(r),a=Math.cos(n),l=Math.sin(n);e.set(i*a,i*-l,s*t.x-o*t.y,i*l,i*a,o*t.x+s*t.y,0,0,1)},o.updateBounds=function(e,t,i){const n=Math.min(e[0].x,e[1].x,e[2].x,e[3].x),s=Math.max(e[0].x,e[1].x,e[2].x,e[3].x),o=Math.min(e[0].y,e[1].y,e[2].y,e[3].y),a=Math.max(e[0].y,e[1].y,e[2].y,e[3].y);void 0!==i&&(void 0!==i.array[i.offset]?(i.array[i.offset].min.set(n,o),i.array[i.offset].max.set(s,a)):i.array.push(new r.Box2(new r.Vector2(n,o),new r.Vector2(s,a))),++i.offset),t.min.set(Math.min(t.min.x,n),Math.min(t.min.y,o)),t.max.set(Math.max(t.max.x,s),Math.max(t.max.y,a))}},7984:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeUtils=void 0,function(e){let t;e.whiteSpaceRanges=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]],e.isWhiteSpace=function(t){for(const i of e.whiteSpaceRanges)if(t>=i[0]&&t<=i[1])return!0;return!1},e.newLineRanges=[[10,13],[133,133],[8232,8233]],e.isNewLine=function(t){for(const i of e.newLineRanges)if(t>=i[0]&&t<=i[1])return!0;return!1},e.nonPrintableRanges=[[0,31],[127,159]],e.isPrintable=function(t){for(const i of e.nonPrintableRanges)if(t>=i[0]&&t<=i[1])return!1;return!0},function(e){e[e.Neutral=0]="Neutral",e[e.Weak=.5]="Weak",e[e.LTR=1]="LTR",e[e.RTL=-1]="RTL"}(t=e.Direction||(e.Direction={})),e.rtlBlocks=["Hebrew","Alphabetic Presentation Forms","Arabic","Arabic Supplement","Arabic Extended-A","Arabic Presentation Forms-A","Arabic Presentation Forms-B","Arabic Mathematical Alphabetic Symbols","Indic Siyaq Numbers","Rumi Numeral Symbols","Syriac","Syriac Supplement","Samaritan","Mandaic","Thaana","Mende Kikakui","NKo","Adlam","Hanifi Rohingya"],e.neutralBidirectionalRanges=[[32,47],[58,64],[91,96],[123,126]],e.weakBidirectionalRanges=[[48,57],[1632,1641],[1776,1785]],e.getDirection=function(i,r){for(const r of e.weakBidirectionalRanges)if(i>=r[0]&&i<=r[1])return t.Weak;for(const r of e.neutralBidirectionalRanges)if(i>=r[0]&&i<=r[1])return t.Neutral;return void 0!==e.rtlBlocks.find((e=>e===r))?t.RTL:t.LTR},e.rtlMirroredCodePoints=[40,41,60,62,91,93,123,125],e.isRtlMirrored=function(t){return void 0!==e.rtlMirroredCodePoints.find((e=>e===t))}}(t.UnicodeUtils||(t.UnicodeUtils={}))},4940:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeferredPromise=void 0,t.DeferredPromise=class{constructor(e){this.executor=e,this.promise=new Promise(((e,t)=>{this.resolveFunc=e,this.rejectFunc=t}))}exec(){this.executor().then((e=>this.resolveFunc(e))).catch((e=>this.rejectFunc(e)))}}},1341:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransferManager=void 0,i(4456);const r=i(4940);class n{constructor(e=fetch,t=5){this.fetchFunction=e,this.maxRetries=t,this.activeDownloadCount=0,this.downloadQueue=new Array,this.activeDownloads=new Map}static instance(){return n.defaultInstance}static async fetchRepeatedly(e,t,i,r,s){try{if(!(t<i))throw new Error("Max number of retries reached");{const n=await e(r,s);if(200===n.status||204===n.status)return n;if(n.status>=400&&n.status<500){t=i;const e=await n.text();throw new Error(e)}}}catch(e){if(e.hasOwnProperty("isCancelled")||"AbortError"===e.name||t>=i)throw e}return await n.waitFor(n.retryTimeout*t).then((()=>n.fetchRepeatedly(e,t+1,i,r,s)))}static waitFor(e){return new Promise((t=>setTimeout(t,e)))}downloadJson(e,t){return this.downloadAs((e=>e.json()),e,t)}downloadArrayBuffer(e,t){return this.download(e,t).then((e=>e.arrayBuffer()))}download(e,t){if(this.activeDownloadCount>=n.maxParallelDownloads){const i=new r.DeferredPromise((()=>this.doDownload(e,t)));return this.downloadQueue.push(i),i.promise}return this.doDownload(e,t)}async doDownload(e,t){try{++this.activeDownloadCount;const i=await n.fetchRepeatedly(this.fetchFunction,0,this.maxRetries,e,t);return this.onDownloadDone(),i}catch(e){throw this.onDownloadDone(),e}}onDownloadDone(){--this.activeDownloadCount,this.execDeferredDownload()}execDeferredDownload(){const e=this.downloadQueue.pop();void 0!==e&&e.exec()}downloadAs(e,t,i){const r=t,n=this.activeDownloads.get(r);if(void 0!==n)return Promise.resolve(n);const s=this.download(t,i).then((t=>{if(this.activeDownloads.delete(r),t.ok)return e(t);throw new Error(JSON.stringify(t))})).catch((e=>{throw this.activeDownloads.delete(r),e}));return this.activeDownloads.set(r,s),s}}t.TransferManager=n,n.retryTimeout=500,n.maxParallelDownloads=16,n.defaultInstance=new n},9826:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(274),t),n(i(5353),t),n(i(2230),t),n(i(5383),t),n(i(6780),t),n(i(2382),t),n(i(4216),t),n(i(2996),t),n(i(8051),t),n(i(8689),t),n(i(8819),t),n(i(6357),t),n(i(7436),t),n(i(9973),t),n(i(40),t),n(i(5433),t),n(i(2736),t),n(i(6615),t)},2736:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4216:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2996:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContextLogger=void 0,t.ContextLogger=class{constructor(e,t){this.m_logger=e,this.headerMessage=t,this.context=[],this.m_headerLogged=!1,this.warn=this.createLogMethod("warn"),this.info=this.createLogMethod("info"),this.error=this.createLogMethod("error")}pushAttr(e){this.context.push(`${this.context.length>0?".":""}${e}`)}pushIndex(e){this.context.push(`[${e}]`)}pop(){this.context.pop()}createLogMethod(e){return(t,...i)=>{this.m_headerLogged||(this.m_logger.info(this.headerMessage),this.m_headerLogged=!0),this.m_logger[e](`${this.context.join("")}: ${t}`,...i)}}}},40:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chainCallbacks=void 0,t.chainCallbacks=function(e,t){return function(...i){return e&&e.apply(this,i),t.apply(this,i)}}},6615:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertFragmentShaderToWebGL2=t.convertVertexShaderToWebGL2=void 0,t.convertVertexShaderToWebGL2=function(e){return["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+e},t.convertFragmentShaderToWebGL2=function(e){return["#define varying in","out highp vec4 pc_fragColor;","#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+e}},274:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupedPriorityList=t.PriorityListGroup=void 0;class i{constructor(e,t=new Array){this.priority=e,this.elements=t}clone(){return new i(this.priority,this.elements.slice())}remove(e){const t=this.elements.indexOf(e);return-1!==t&&(this.elements.splice(t,1),!0)}}t.PriorityListGroup=i;class r{constructor(){this.groups=new Map}add(e){this.getGroup(e.priority).elements.push(e)}remove(e){const t=this.findGroup(e.priority);return!(void 0===t||!t.remove(e)||(0===t.elements.length&&this.groups.delete(t.priority),0))}clear(){this.groups.clear()}merge(e){for(const t of e.groups){const e=this.findGroup(t[1].priority);void 0!==e?e.elements=e.elements.concat(t[1].elements):this.groups.set(Math.floor(t[1].priority),t[1].clone())}return this}clone(){const e=new r;for(const[t,i]of this.groups)e.groups.set(t,i.clone());return e}forEach(e){for(const t of this.groups)t[1].elements.forEach(e)}count(){let e=0;for(const t of this.groups)e+=t[1].elements.length;return e}findGroup(e){const t=Math.floor(e);return this.groups.get(t)}getGroup(e){let t=this.findGroup(e);if(void 0===t){const r=Math.floor(e);t=new i(r),this.groups.set(t.priority,t)}return t}}t.GroupedPriorityList=r},98:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleChannel=void 0,t.ConsoleChannel=class{error(e,...t){console.error(e,...t)}debug(e,...t){console.debug(e,...t)}info(e,...t){console.info(e,...t)}log(e,...t){console.log(e,...t)}trace(e,...t){console.trace(e,...t)}warn(e,...t){console.warn(e,...t)}}},9984:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4789:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerOptions=t.LogLevel=void 0,(i=t.LogLevel||(t.LogLevel={}))[i.Trace=0]="Trace",i[i.Debug=1]="Debug",i[i.Log=2]="Log",i[i.Info=3]="Info",i[i.Warn=4]="Warn",i[i.Error=5]="Error",i[i.None=6]="None",t.LoggerOptions=class{}},289:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const r=i(4789);t.Logger=class{constructor(e,t,i){this.name=e,this.m_channel=t,this.enabled=!0,this.level=r.LogLevel.Trace,void 0!==i&&this.update(i)}error(e,...t){this.enabled&&this.level<=r.LogLevel.Error&&this.m_channel.error(this.prefix,e,...t)}debug(e,...t){this.enabled&&this.level<=r.LogLevel.Debug&&this.m_channel.debug(this.prefix,e,...t)}info(e,...t){this.enabled&&this.level<=r.LogLevel.Info&&this.m_channel.info(this.prefix,e,...t)}log(e,...t){this.enabled&&this.level<=r.LogLevel.Log&&this.m_channel.log(this.prefix,e,...t)}trace(e,...t){this.enabled&&this.level<=r.LogLevel.Trace&&this.m_channel.trace(this.prefix,e,...t)}warn(e,...t){this.enabled&&this.level<=r.LogLevel.Warn&&this.m_channel.warn(this.prefix,e,...t)}update(e){this.enabled=void 0===e.enabled?this.enabled:e.enabled,this.level=void 0===e.level?this.level:e.level}get prefix(){return this.name+":"}}},7857:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerManager=void 0;const r=i(2314);t.LoggerManager=class{static get instance(){return this.m_instance||(this.m_instance=new r.LoggerManagerImpl)}}},2314:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerManagerImpl=void 0;const r=i(98),n=i(289),s=i(9773);t.LoggerManagerImpl=class{constructor(){this.m_loggers=[],this.channel="undefined"==typeof self||void 0!==self.document?new r.ConsoleChannel:new s.WorkerChannel}getLoggerNames(){return this.m_loggers.map((e=>e.name))}getLogger(e){return this.m_loggers.find((t=>t.name===e))}create(e,t={}){void 0!==this.m_levelSetForAll&&(void 0===t.level||t.level<this.m_levelSetForAll)&&(t.level=this.m_levelSetForAll);const i=new n.Logger(e,this.channel,t);return this.m_loggers.push(i),i}dispose(e){const t=this.m_loggers.indexOf(e);if(t<0)throw new Error(`Cannot unregister "${e}" : no such logger registered.`);this.m_loggers.splice(t,1)}updateAll(e){for(const t of this.m_loggers)t.update(e)}update(e,t){for(const i of this.m_loggers)i.name===e&&i.update(t)}enableAll(e){for(const t of this.m_loggers)t.enabled=e}enable(e,t){this.update(e,{enabled:t})}setLogLevelForAll(e){this.m_levelSetForAll=e;for(const t of this.m_loggers)t.level=e}setLogLevel(e,t){this.update(e,{level:t})}setChannel(e){this.channel=e}}},44:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MultiChannel=void 0,t.MultiChannel=class{constructor(...e){this.channels=[],this.channels=e}error(e,...t){for(const i of this.channels)i.error(e,...t)}debug(e,...t){for(const i of this.channels)i.debug(e,...t)}info(e,...t){for(const i of this.channels)i.info(e,...t)}log(e,...t){for(const i of this.channels)i.log(e,...t)}trace(e,...t){for(const i of this.channels)i.trace(e,...t)}warn(e,...t){for(const i of this.channels)i.warn(e,...t)}}},9773:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerChannel=t.WORKERCHANNEL_MSG_TYPE=void 0;const r=i(4789);t.WORKERCHANNEL_MSG_TYPE="worker-channel-message",t.WorkerChannel=class{error(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Error};self.postMessage(n)}debug(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Debug};self.postMessage(n)}info(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Info};self.postMessage(n)}log(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Log};self.postMessage(n)}trace(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Trace};self.postMessage(n)}warn(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Warn};self.postMessage(n)}}},5353:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(98),t),n(i(9984),t),n(i(4789),t),n(i(289),t),n(i(7857),t),n(i(44),t),n(i(9773),t)},2230:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Math2D=void 0,function(e){function t(e,t,i,r){return(e-i)*(e-i)+(t-r)*(t-r)}e.Box=class{constructor(e=0,t=0,i=0,r=0){this.x=e,this.y=t,this.w=i,this.h=r}set(e,t,i,r){this.x=e,this.y=t,this.w=i,this.h=r}copy(e){this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h}contains(e,t){return this.x<=e&&this.x+this.w>=e&&this.y<=t&&this.y+this.h>=t}containsBox(e){const t=e.x+e.w,i=e.y+e.h;return this.contains(e.x,e.y)&&this.contains(t,e.y)&&this.contains(e.x,i)&&this.contains(t,i)}intersects(e){return this.x<=e.x+e.w&&this.x+this.w>=e.x&&this.y<=e.y+e.h&&this.y+this.h>=e.y}},e.distSquared=t,e.computeSquaredLineLength=function(e){let t=0;const i=e.length-4;for(let r=0;r<i;r+=3){const i=e[r+3]-e[r],n=e[r+4]-e[r+1];t+=i*i+n*n}return t},e.distToSegmentSquared=function(e,i,r,n,s,o){const a=t(r,n,s,o);if(0===a)return t(e,i,r,n);let l=((e-r)*(s-r)+(i-n)*(o-n))/a;return l=Math.max(0,Math.min(1,l)),t(e,i,r+l*(s-r),n+l*(o-n))},e.intersectLineAndCircle=function(e,t,i,r,n,s=0,o=0){const a=i-e,l=r-t,c=a*a+l*l,h=e*r-i*t-l*s+a*o,d=n*n*c-h*h;if(d<-1e-10)return;const u=h*l,m=-h*a;if(d<1e-10)return{x1:s+u/c,y1:o+m/c};const p=Math.sqrt(d),f=(l<0?-1:1)*a*p,g=Math.abs(l)*p;return{x1:s+(u+f)/c,y1:o+(m+g)/c,x2:s+(u-f)/c,y2:o+(m-g)/c}},e.intersectLines=function(e,t,i,r,n,s,o,a,l={x:0,y:0}){const c=(e-i)*(s-a)-(t-r)*(n-o);if(0===c)return;const h=((e*r-t*i)*(n-o)-(e-i)*(n*a-s*o))/c,d=((e*r-t*i)*(s-a)-(t-r)*(n*a-s*o))/c;return l.x=h,l.y=d,l}}(t.Math2D||(t.Math2D={}))},5383:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathUtils=void 0,function(e){function t(e,t,i){return e<t?t:e>i?i:e}e.clamp=t,e.smoothStep=function(e,i,r){return(r=t((r-e)/(i-e),0,1))*r*(3-2*r)},e.smootherStep=function(e,i,r){return(r=t((r-e)/(i-e),0,1))*r*r*(r*(6*r-15)+10)},e.map=function(e,t,i,r,n){return(e-t)*(n-r)/(i-t)+r},e.min2=function(e,t){let i;return void 0!==e&&(i=e),void 0!==t&&(i=void 0===i?t:Math.min(i,t)),i},e.max2=function(e,t){let i;return void 0!==e&&(i=e),void 0!==t&&(i=void 0===i?t:Math.max(i,t)),i},e.isClamped=function(e,t,i){return!(void 0!==t&&e<t||void 0!==i&&e>i)},e.easeInOutCubic=function(e,t,i){return e+(t-e)*(i<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1)}}(t.MathUtils||(t.MathUtils={}))},6780:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixinsWithoutProperties=t.applyMixins=void 0,t.applyMixins=function(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((i=>{e.prototype[i]=t.prototype[i]}))}))},t.applyMixinsWithoutProperties=function(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((i=>{const r=Object.getOwnPropertyDescriptor(t.prototype,i);void 0!==r&&void 0===r.get&&"constructor"!==i&&(e.prototype[i]=t.prototype[i])}))}))}},8689:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pick=t.cloneDeep=void 0,t.cloneDeep=function(e){const t=new Map,i=function e(i){if(null===i)return null;if("object"==typeof i){const r=t.get(i);if(void 0!==r)return r;if(Array.isArray(i)){const r=[];t.set(i,r),r.length=i.length;for(let t=0;t<r.length;++t)r[t]=e(i[t]);return r}if(i instanceof Date){const e=new Date(i.getTime());return t.set(i,e),e}if(i instanceof RegExp){const e=new RegExp(i.source,i.flags);return t.set(i,e),e}if(i.constructor!==Object)throw new Error("cloneDeep doesn't support objects with custom prototypes");{const r={};t.set(i,r);for(const t in i)i.hasOwnProperty(t)&&(r[t]=e(i[t]));return r}}return i}(e);return t.clear(),i},t.pick=function(e,t){const i={};for(const r of t)e.hasOwnProperty(r)&&(i[r]=e[r]);return i}},8819:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOptionValue=void 0,t.getOptionValue=function(...e){for(const t of e)if(null!=t)return t}},8051:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceTimer=void 0;class i{static now(){return i.nowFunc()}static getNowFunc(){return"undefined"!=typeof performance&&void 0!==performance.now?()=>performance.now():()=>(new Date).getTime()}}t.PerformanceTimer=i,i.instance=new i,i.nowFunc=i.getNowFunc()},5433:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sampleBilinear=void 0,t.sampleBilinear=function(e,t,i,r,n){const s=t-1,o=i-1,a=r*s,l=Math.floor(a),c=n*o,h=Math.floor(c),d=h*t+l,u=l<s?d+1:d,m=h<o?d+t:d,p=l<s?m+1:m,f=e[d],g=e[u],v=e[m],_=e[p],y=Number.isInteger(a)?0:a-l,x=1-y,b=Number.isInteger(c)?0:c-h,T=1-b;return f*x*T+g*y*T+v*x*b+_*y*b}},6357:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TaskQueue=void 0,t.TaskQueue=class{constructor(e){var t;this.m_options=e,this.m_taskLists=new Map,null===(t=this.m_options.groups)||void 0===t||t.forEach((e=>{this.m_taskLists.set(e,[])})),this.m_options.prioSortFn&&(this.sort=this.m_options.prioSortFn)}update(e){if(void 0===e)this.m_taskLists.forEach((e=>{this.updateTaskList(e)}));else{const t=this.getTaskList(e);t&&this.updateTaskList(t)}}add(e){var t;if(this.m_taskLists.has(e.group)){const i=this.m_taskLists.get(e.group);if(!(null==i?void 0:i.includes(e)))return null===(t=this.m_taskLists.get(e.group))||void 0===t||t.push(e),!0}return!1}remove(e){var t,i;if(this.m_taskLists.has(e.group)){const r=null===(t=this.m_taskLists.get(e.group))||void 0===t?void 0:t.indexOf(e);if(-1!==r)return null===(i=this.m_taskLists.get(e.group))||void 0===i||i.splice(r,1),!0}return!1}numItemsLeft(e){var t,i;let r=0;return void 0===e?this.m_taskLists.forEach((e=>{r+=e.length})):r+=null!==(i=null===(t=this.getTaskList(e))||void 0===t?void 0:t.length)&&void 0!==i?i:0,r}processNext(e,t,i=1){if(!this.getTaskList(e)||this.numItemsLeft(e)<=0)return!1;for(let r=0;r<i&&this.numItemsLeft(e)>0;r++){const i=this.pull(e,!0);void 0!==i&&(!t||(null==t?void 0:t(i))?i.execute():this.add(i))}return!0}clear(){this.m_taskLists.clear()}pull(e,t=!1){var i,r;let n;return this.getTaskList(e)&&(n=null===(i=this.getTaskList(e))||void 0===i?void 0:i.pop(),t&&n&&(null===(r=n.isExpired)||void 0===r?void 0:r.call(n)))?this.pull(e,t):n}sort(e,t){return t.getPriority()-e.getPriority()}getTaskList(e){return this.m_taskLists.get(e)}updateTaskList(e){var t;for(let i=0;i<e.length;i++){const r=e[i];(null===(t=null==r?void 0:r.isExpired)||void 0===t?void 0:t.call(r))&&(e.splice(i,1),i--)}e.sort(this.sort)}}},7436:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.composeUriResolvers=t.RelativeUriResolver=t.PrefixMapUriResolver=void 0;const r=i(9973);t.PrefixMapUriResolver=class{constructor(e){this.definitions=e}resolveUri(e){return Object.keys(this.definitions).reduce(((e,t)=>t.endsWith("/")&&e.startsWith(t)?this.definitions[t]+e.substr(t.length):e===t?this.definitions[t]:e),e)}},t.RelativeUriResolver=class{constructor(e){this.parentUri=e}resolveUri(e){return r.resolveReferenceUri(this.parentUri,e)}},t.composeUriResolvers=function(...e){return{resolveUri:t=>e.reduce(((e,t)=>void 0!==t?t.resolveUri(e):e),t)}}},1721:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAppBaseUrl=void 0;const r=i(9973);t.getAppBaseUrl=function(){return r.baseUrl(window.location.href)}},9973:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUrlHostAndProtocol=t.getUrlOrigin=t.baseUrl=t.resolveReferenceUri=void 0,t.resolveReferenceUri=function(e,t){return i.test(t)?t:t.startsWith("/")?n(e)+t:(t.startsWith("./")&&(t=t.substr(2)),r(e)+t)};const i=new RegExp("^(((?:[a-z]+:)?//)|(file:/)|(data:))","i");function r(e){if(void 0===e)return"./";let t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),t=e.indexOf("?"),-1!==t&&(e=e.slice(0,t)),t=e.lastIndexOf("/"),-1===t?"./":e.substring(0,t+1)}function n(e){if(void 0===e)return"";const t=s(e);return"file:"===t.protocol?"file://":t.host&&t.protocol?t.protocol+"//"+t.host:t.host?"//"+t.host:t.protocol?t.protocol+"//":""}function s(e){const t=new RegExp(/^(?:([a-z]+:))?\/\/([^\/]*)/,"i"),i=e.match(t);if(!i)throw new Error(`getUrlHostAndProtocol: unable to parse URL '${e}'`);return{protocol:i[1],host:i[2]}}t.baseUrl=r,t.getUrlOrigin=n,t.getUrlHostAndProtocol=s},2382:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assertExists=t.assert=void 0,t.assert=function(e,t){},t.assertExists=function(e,t){return e}},6007:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoJsonDataProvider=void 0,i(4456);const r=i(3187),n=i(2530),s=i(2972),o=i(2183),a=i(1173),l=o.LoggerManager.instance.create("GeoJsonDataProvider"),c="invalidated";let h=!1;class d extends s.DataProvider{constructor(e,t,i){var r;super(),this.name=e,this.input=t,this.m_registered=!1,this.m_tiler=null!==(r=null==i?void 0:i.tiler)&&void 0!==r?r:n.ConcurrentTilerFacade.getTiler(a.GEOJSON_TILER_SERVICE_TYPE,i&&i.workerTilerUrl)}async connect(){try{await this.m_tiler.connect()}catch(e){throw r.WorkerServiceProtocol.isUnknownServiceError(e)&&!h&&(l.info("Unable to start GeoJson tiler service in worker. Use  'OmvTilerService.start();' in decoder script."),h=!0),e}await this.m_tiler.registerIndex(this.name,this.input),this.m_registered=!0}updateInput(e){this.input=e,this.m_tiler.updateIndex(this.name,this.input),this.dispatchEvent({type:c})}ready(){return this.m_registered}async getTile(e){return await this.m_tiler.getTile(this.name,e)}onDidInvalidate(e){return this.addEventListener(c,e),()=>this.removeEventListener(c,e)}dispose(){this.m_tiler.dispose()}}t.GeoJsonDataProvider=d},1047:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvGenericFeatureModifier=t.ComposedDataFilter=t.OmvGenericFeatureFilter=t.OmvFeatureFilterDescriptionBuilder=void 0;const r=i(3187),n=i(1173);t.OmvFeatureFilterDescriptionBuilder=class{constructor(e){this.m_processLayersDefault=!0,this.m_processPointsDefault=!0,this.m_processLinesDefault=!0,this.m_processPolygonsDefault=!0,this.m_layersToProcess=new Array,this.m_layersToIgnore=new Array,this.m_pointsToProcess=new Array,this.m_ignoredPoints=new Array,this.m_linesToProcess=new Array,this.m_linesToIgnore=new Array,this.m_polygonsToProcess=new Array,this.m_polygonsToIgnore=new Array,this.m_kindsToProcess=[],this.m_kindsToIgnore=[],e&&(this.m_processLayersDefault=void 0===e.processLayersDefault||e.processLayersDefault,this.m_processPointsDefault=void 0===e.processPointsDefault||e.processPointsDefault,this.m_processLinesDefault=void 0===e.processLinesDefault||e.processLinesDefault,this.m_processPolygonsDefault=void 0===e.processPolygonsDefault||e.processPolygonsDefault)}processLayer(e,t=n.OmvFilterString.StringMatch.Match,i=0,r=1/0){this.m_layersToProcess.push({name:{value:e,match:t},minLevel:i,maxLevel:r})}ignoreLayer(e,t=n.OmvFilterString.StringMatch.Match,i=0,r=1/0){this.m_layersToIgnore.push({name:{value:e,match:t},minLevel:i,maxLevel:r})}processPoint(e){this.addItem(this.m_pointsToProcess,e)}processPoints(e){this.addItems(this.m_pointsToProcess,e)}ignorePoint(e){this.addItem(this.m_ignoredPoints,e)}ignorePoints(e){this.addItems(this.m_ignoredPoints,e)}processLine(e){this.addItem(this.m_linesToProcess,e)}processLines(e){this.addItems(this.m_linesToProcess,e)}ignoreLine(e){this.addItem(this.m_linesToIgnore,e)}ignoreLines(e){this.addItems(this.m_linesToIgnore,e)}processPolygon(e){this.addItem(this.m_polygonsToProcess,e)}processPolygons(e){this.addItems(this.m_polygonsToProcess,e)}ignorePolygon(e){this.addItem(this.m_polygonsToIgnore,e)}ignorePolygons(e){this.addItems(this.m_polygonsToIgnore,e)}processKinds(e){this.m_kindsToProcess=this.m_kindsToProcess.concat(e)}ignoreKinds(e){this.m_kindsToIgnore=this.m_kindsToIgnore.concat(e)}createDescription(){return{processLayersDefault:this.m_processLayersDefault,processPointsDefault:this.m_processPointsDefault,processLinesDefault:this.m_processLinesDefault,processPolygonsDefault:this.m_processPolygonsDefault,layersToProcess:this.m_layersToProcess,layersToIgnore:this.m_layersToIgnore,pointsToProcess:this.m_pointsToProcess,pointsToIgnore:this.m_ignoredPoints,linesToProcess:this.m_linesToProcess,linesToIgnore:this.m_linesToIgnore,polygonsToProcess:this.m_polygonsToProcess,polygonsToIgnore:this.m_polygonsToIgnore,kindsToProcess:this.m_kindsToProcess,kindsToIgnore:this.m_kindsToIgnore}}addItem(e,t){(void 0===t.minLevel||isNaN(t.minLevel))&&(t.minLevel=0),(void 0===t.maxLevel||isNaN(t.maxLevel))&&(t.maxLevel=1/0);const i={layerName:{value:t.layer,match:void 0===t.matchLayer?n.OmvFilterString.StringMatch.Match:t.matchLayer},geometryTypes:void 0!==t.geomType?Array.isArray(t.geomType)?t.geomType:[t.geomType]:void 0,classes:[{value:t.featureClass,match:void 0===t.matchClass?n.OmvFilterString.StringMatch.Match:t.matchClass}],minLevel:t.minLevel,maxLevel:t.maxLevel,featureAttribute:t.featureAttribute};e.push(i)}addItems(e,t){(void 0===t.minLevel||isNaN(t.minLevel))&&(t.minLevel=0),(void 0===t.maxLevel||isNaN(t.maxLevel))&&(t.maxLevel=1/0);const i={layerName:{value:t.layer,match:void 0===t.matchLayer?n.OmvFilterString.StringMatch.Match:t.matchLayer},geometryTypes:void 0!==t.geomTypes?Array.isArray(t.geomTypes)?t.geomTypes:[t.geomTypes]:void 0,classes:t.featureClasses,minLevel:t.minLevel,maxLevel:t.maxLevel,featureAttribute:t.featureAttribute};e.push(i)}};class s{constructor(e){this.description=e,this.description.kindsToProcess.length>0&&(this.enabledKinds=new r.GeometryKindSet(this.description.kindsToProcess)),this.description.kindsToIgnore.length>0&&(this.disabledKinds=new r.GeometryKindSet(this.description.kindsToIgnore))}static matchLayer(e,t,i){for(const r of t)if(!(i<r.minLevel||i>r.maxLevel)&&n.OmvFilterString.matchString(e,r.name))return!0;return!1}wantsLayer(e,t){return!!s.matchLayer(e,this.description.layersToProcess,t)||!s.matchLayer(e,this.description.layersToIgnore,t)&&this.description.processLayersDefault}wantsPointFeature(e,t,i){return this.wantsFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,i,this.description.processPointsDefault)}wantsLineFeature(e,t,i){return this.wantsFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,i,this.description.processLinesDefault)}wantsPolygonFeature(e,t,i){return this.wantsFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,i,this.description.processPolygonsDefault)}wantsKind(e){return void 0===e||!(void 0!==this.disabledKinds&&this.disabledKinds.hasOrIntersects(e))||void 0!==this.enabledKinds&&this.enabledKinds.hasOrIntersects(e)}get hasKindFilter(){return void 0!==this.enabledKinds||void 0!==this.disabledKinds}wantsFeature(e,t,i,r,s,o){for(const t of e)if(!(s<t.minLevel||s>t.maxLevel)&&n.OmvFilterString.matchString(i,t.layerName)&&void 0!==t.geometryTypes&&t.geometryTypes.includes(r))return!0;for(const e of t)if(n.OmvFilterString.matchString(i,e.layerName)&&void 0!==e.geometryTypes&&e.geometryTypes.includes(r))return!1;return o}}t.OmvGenericFeatureFilter=s,t.ComposedDataFilter=class{constructor(e){this.filters=e}get hasKindFilter(){return this.filters.reduce(((e,t)=>e&&t.hasKindFilter),!0)}wantsLayer(e,t){return this.filters.reduce(((i,r)=>i&&r.wantsLayer(e,t)),!0)}wantsPointFeature(e,t,i){return this.filters.reduce(((r,n)=>r&&n.wantsPointFeature(e,t,i)),!0)}wantsLineFeature(e,t,i){return this.filters.reduce(((r,n)=>r&&n.wantsLineFeature(e,t,i)),!0)}wantsPolygonFeature(e,t,i){return this.filters.reduce(((r,n)=>r&&n.wantsPolygonFeature(e,t,i)),!0)}wantsKind(e){return this.filters.reduce(((t,i)=>t&&i.wantsKind(e)),!0)}};class o{constructor(e){this.description=e}static matchItems(e,t,i){for(const r of i)if(void 0!==r.classes){if(!n.OmvFilterString.matchString(e,r.layerName))continue;for(const e of r.classes)if(n.OmvFilterString.matchString(t,e))return!0}return!1}static matchAttribute(e,t,i){for(const r of i)if(void 0!==r.featureAttribute&&n.OmvFilterString.matchString(e,r.layerName)&&t.lookup(r.featureAttribute.key)===r.featureAttribute.value)return!0;return!1}doProcessPointFeature(e,t){return this.doProcessFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,this.description.processPointsDefault)}doProcessLineFeature(e,t){return this.doProcessFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,this.description.processLinesDefault)}doProcessPolygonFeature(e,t){return this.doProcessFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,this.description.processPolygonsDefault)}doProcessFeature(e,t,i,r,n){if(void 0===i||0===e.length&&0===t.length)return n;let s;const a=r.lookup("class");return null!=a&&(s=a.toString()),!(!s||!o.matchItems(i,s,e))||(!s||!o.matchItems(i,s,t))&&(!!o.matchAttribute(i,r,e)||!o.matchAttribute(i,r,t)&&n)}}t.OmvGenericFeatureModifier=o},4992:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvDebugLabelsTile=void 0;const r=i(3187),n=i(2530),s=i(8601),o=i(4035),a=i(4457),l=i(5084),c=i(4428),h=new c.LineBasicMaterial({color:0,linewidth:1,depthTest:!1,depthFunc:c.NeverDepth}),d=new c.MeshBasicMaterial({color:16711680,depthTest:!1,depthFunc:c.NeverDepth});new c.MeshBasicMaterial({color:16711680,depthTest:!1,depthFunc:c.NeverDepth}).wireframe=!0,new c.MeshBasicMaterial({color:8421631,depthTest:!1,depthFunc:c.NeverDepth}).wireframe=!0;const u=new c.MeshBasicMaterial({color:0,depthTest:!1,depthFunc:c.NeverDepth}),m=new c.MeshBasicMaterial({color:255,depthTest:!1,depthFunc:c.NeverDepth,opacity:.75,transparent:!0}),p=new c.MeshBasicMaterial({color:10514432,depthTest:!1,depthFunc:c.NeverDepth,opacity:.75,transparent:!0}),f=new l.TextRenderStyle,g=new l.TextLayoutStyle;f.fontSize={unit:l.FontUnit.Point,size:9,backgroundSize:0},f.opacity=.75,f.backgroundOpacity=.75,f.color=new c.Color(.8,.2,.2);const v=Number.MAX_SAFE_INTEGER;class _{constructor(){this.geometry=new c.BufferGeometry,this.indices=new Array,this.positions=new Array}}function y(e,t,i,r,n){n.positions.push(e,t-r,i),n.positions.push(e+r,t,i),n.positions.push(e,t+r,i),n.positions.push(e-r,t,i);const s=n.positions.length/3;n.indices.push(s-4),n.indices.push(s-3),n.indices.push(s-2),n.indices.push(s-4),n.indices.push(s-2),n.indices.push(s-1)}function x(e,t,i=0,r){if(t.indices.length>0){t.geometry.addGroup(0,t.indices.length,0),t.geometry.setAttribute("position",new c.BufferAttribute(new Float32Array(t.positions),3)),t.geometry.setIndex(new c.BufferAttribute(new Uint32Array(t.indices),1));const n=r(t.geometry);n.renderOrder=v-i,e.push(n)}}class b extends n.Tile{constructor(e,t){super(e,t)}loadingFinished(){var e,t,i;const b=s.debugContext.getValue("DEBUG_TEXT_PATHS"),T=s.debugContext.getValue("DEBUG_TEXT_PATHS_FULL"),w=s.debugContext.getValue("DEBUG_TEXT_POIS_FULL"),S=s.debugContext.getValue("DEBUG_TEXT_LINE_MARKER");if(!(b||T||S)||void 0===this.decodedTile)return;const M=o.TileGeometryCreator.instance,E=this.decodedTile,P=new Map,C=s.debugContext.getValue("DEBUG_TEXT_PATHS.FILTER.TEXT"),A=s.debugContext.getValue("DEBUG_TEXT_PATHS.FILTER.INDEX"),L=this.mapView.env;void 0!==E.textPathGeometries&&(this.preparedTextPaths=M.prepareTextPaths(E.textPathGeometries,E));const R=this.center.x,D=this.center.y,O=this.center.z,F=this.mapView.pixelToWorld,I=this.computeWorldOffsetX();let U=0;if(this.textElementGroups.count()>0){const e=new _,t=new _,i=[];this.textElementGroups.forEach((r=>{if(r.type!==a.TextElementType.LineMarker&&r.type!==a.TextElementType.PoiLabel)return;const s=r.type===a.TextElementType.LineMarker?t:e,o=5*F,h=(e,t,a)=>{if(y(e,t,a,o,s),w||S){const s=.5*o,h=`${r.text} [${U}]`,d=new n.TextElement(l.ContextualArabicConverter.instance.convert(h),new c.Vector3(e+I+R+s,t+D+s,a+O),f,g,v,0,0);d.minZoomLevel=0,d.mayOverlap=!0,d.reserveSpace=!1,d.alwaysOnTop=!0,d.ignoreDistance=!0,d.priority=n.TextElement.HIGHEST_PRIORITY,d._isDebug=!0,i.push(d)}U++};if(void 0!==r.path&&Array.isArray(r.path))for(let e=0;e<r.path.length;e++){const t=r.path[e];h(t.x-R,t.y-D,10+t.z+5*e-O)}else w&&h(r.position.x-R,r.position.y-D,5-O)}));for(const e of i)this.addTextElement(e);x(this.objects,e,0,(e=>new c.Mesh(e,m))),x(this.objects,t,0,(e=>new c.Mesh(e,p)))}if(void 0!==this.preparedTextPaths){const s=new _,o=new _,a=new _;let m=0;for(const h of this.preparedTextPaths){const d=E.techniques[h.technique];if(!r.isTextTechnique(d)||void 0!==h._isDebug)continue;void 0!==d.color&&P.set(h.technique,new c.Color(r.getPropertyValue(d.color,L))),m=s.positions.length/3;const u=h.text,p=this.preparedTextPaths.indexOf(h);if((!C||u&&u.includes(C))&&(void 0===A||A===p)){for(let m=0;m<h.path.length;m+=3){const p=m/3,v=h.path[m]-R,_=h.path[m+1]-D,x=10+h.path[m+2]+m/3-O;b&&s.positions.push(v,_,x);const w=0===m&&b;if((T||w)&&(y(v,_,x,F*(w?6:4),w?o:a),T)){const s=null!==(e=d.xOffset)&&void 0!==e?e:0,o=null!==(t=d.yOffset)&&void 0!==t?t:0,a=d.minZoomLevel,h=p%5==0?u+":"+p:Number(p).toString(),m=new n.TextElement(l.ContextualArabicConverter.instance.convert(h),new c.Vector3(v+I+R,_+D,x+O),f,g,r.getPropertyValue(null!==(i=d.priority)&&void 0!==i?i:0,L),s,o);m.minZoomLevel=r.getPropertyValue(a,L),m.mayOverlap=!0,m.reserveSpace=!1,m.alwaysOnTop=!0,m.ignoreDistance=!0,m.priority=n.TextElement.HIGHEST_PRIORITY,this.addTextElement(m)}}const p=h.path.length/3;for(let e=0;e<p;++e)e>0&&s.indices.push(m+e),e+1<p&&s.indices.push(m+e)}}x(this.objects,s,-2,(e=>new c.LineSegments(e,h))),x(this.objects,o,0,(e=>new c.Mesh(e,d))),x(this.objects,a,-1,(e=>new c.Mesh(e,u)))}}}t.OmvDebugLabelsTile=b},1173:(e,t)=>{"use strict";var i,r;Object.defineProperty(t,"__esModule",{value:!0}),t.GEOJSON_TILER_SERVICE_TYPE=t.VECTOR_TILE_DECODER_SERVICE_TYPE=t.OmvGeometryType=t.OmvFilterString=t.FeatureModifierId=void 0,(r=t.FeatureModifierId||(t.FeatureModifierId={}))[r.default=0]="default",function(e){let t;!function(e){e[e.Any=0]="Any",e[e.Match=1]="Match",e[e.StartsWith=2]="StartsWith",e[e.Contains=3]="Contains",e[e.EndsWith=4]="EndsWith"}(t=e.StringMatch||(e.StringMatch={})),e.matchString=function(t,i){switch(i.match){case e.StringMatch.Any:return!0;case e.StringMatch.Match:return t===i.value;case e.StringMatch.StartsWith:return i.value.startsWith(t);case e.StringMatch.EndsWith:return i.value.endsWith(t);default:return t.includes(i.value)}}}(t.OmvFilterString||(t.OmvFilterString={})),(i=t.OmvGeometryType||(t.OmvGeometryType={}))[i.UNKNOWN=0]="UNKNOWN",i[i.POINT=1]="POINT",i[i.LINESTRING=2]="LINESTRING",i[i.POLYGON=3]="POLYGON",t.VECTOR_TILE_DECODER_SERVICE_TYPE="vector-tile-decoder",t.GEOJSON_TILER_SERVICE_TYPE="geojson-tiler"},9890:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OmvRestClient=t.AuthenticationTypeAccessToken=t.AuthenticationTypeTomTomV1=t.AuthenticationTypeBearer=t.AuthenticationMethod=t.APIFormat=void 0,i(4456);const r=i(2972),n=i(6919),s=i(2183).LoggerManager.instance.create("OmvRestClient");var o,a;!function(e){e[e.HereV1=0]="HereV1",e[e.MapboxV4=1]="MapboxV4",e[e.XYZMVT=2]="XYZMVT",e[e.XYZJson=3]="XYZJson",e[e.XYZOMV=4]="XYZOMV",e[e.TomtomV1=5]="TomtomV1",e[e.XYZSpace=6]="XYZSpace"}(o=t.APIFormat||(t.APIFormat={})),function(e){e[e.QueryString=0]="QueryString",e[e.AuthorizationHeader=1]="AuthorizationHeader"}(a=t.AuthenticationMethod||(t.AuthenticationMethod={})),t.AuthenticationTypeBearer={method:a.AuthorizationHeader,name:"Bearer"},t.AuthenticationTypeTomTomV1={method:a.QueryString,name:"key"},t.AuthenticationTypeAccessToken={method:a.QueryString,name:"access_token"};class l extends r.DataProvider{constructor(e){super(),this.params=e,this.downloadManager=void 0===e.downloadManager?n.TransferManager.instance():e.downloadManager,this.urlParams=void 0===e.urlParams?{}:e.urlParams}async connect(){}ready(){return!0}async getTile(e,t){const i={signal:t};let r=this.dataUrl(e);const n=await this.getActualAuthenticationCode();return r=this.applyAuthCode(r,i,n),r=this.addQueryParams(r,this.urlParams),this.params.apiFormat===o.XYZJson?await this.downloadManager.downloadJson(r,i):await this.downloadManager.downloadArrayBuffer(r,i)}dispose(){}async getActualAuthenticationCode(){return"string"==typeof this.params.authenticationCode?this.params.authenticationCode:void 0!==this.params.authenticationCode?await this.params.authenticationCode():void 0!==this.params.getBearerToken?await this.params.getBearerToken():void 0}getDefaultAuthMethod(){if(void 0!==this.params.getBearerToken)return t.AuthenticationTypeBearer;switch(this.params.apiFormat){case o.HereV1:return t.AuthenticationTypeBearer;case o.MapboxV4:case o.XYZOMV:case o.XYZMVT:case o.XYZSpace:case o.XYZJson:return t.AuthenticationTypeAccessToken;case o.TomtomV1:return t.AuthenticationTypeTomTomV1;default:return void s.warn(`#getDefaultAuthMethod: Not supported API format: ${this.params.apiFormat}`)}}applyAuthCode(e,t,i){var r,n,s;if(void 0===i)return e;const o=null!==(r=this.params.authenticationMethod)&&void 0!==r?r:this.getDefaultAuthMethod();if(void 0===o)return e;if(o.method===a.AuthorizationHeader){void 0===t.headers&&(t.headers=new Headers);const e=null!==(n=o.name)&&void 0!==n?n:"Bearer";t.headers.append("Authorization",`${e} ${i}`)}else if(o.method===a.QueryString){const t={};t[null!==(s=o.name)&&void 0!==s?s:"access_token"]=i,e=this.addQueryParams(e,t)}return e}dataUrl(e){if(void 0!==this.params.url)return this.params.url.replace("{x}",String(e.column)).replace("{y}",String(e.row)).replace("{z}",String(e.level));let t=[`/${e.level}`,e.column,e.row].join(this.params.apiFormat===o.XYZSpace||this.params.apiFormat===o.XYZJson?"_":"/");switch(this.params.apiFormat){case o.HereV1:case o.XYZOMV:t+="/omv";break;case o.MapboxV4:case o.XYZMVT:t+=".mvt";break;case o.XYZJson:break;case o.XYZSpace:t+=".mvt";break;case o.TomtomV1:t+=".pbf";break;default:s.warn(`Not supported API format: ${this.params.apiFormat}`)}return this.params.baseUrl+t}addQueryParams(e,t){let i="",r=e.includes("?")?"&":"?";for(const e in t)t.hasOwnProperty(e)&&(i+=`${r}${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`,"?"===r&&(r="&"));return e+i}}t.OmvRestClient=l},6555:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorTileDataSource=void 0;const r=i(3187),n=i(3139),s=i(2530),o=i(2972),a=i(2183),l=i(1173),c=i(9890),h=a.LoggerManager.instance.create("VectorTileDataSource");function d(e){var t;if(e.dataProvider)return e.dataProvider;if(null!==(t=e.baseUrl)&&void 0!==t?t:e.url)return new c.OmvRestClient(e);throw new Error("OmvDataSource: missing url, baseUrl or dataProvider params")}let u=!1;const m="https://vector.hereapi.com/v2/vectortiles/base/mc",p={baseUrl:m,apiFormat:c.APIFormat.XYZOMV,styleSetName:"tilezen",authenticationMethod:{method:c.AuthenticationMethod.QueryString,name:"apikey"},copyrightInfo:[{id:"here.com",year:(new Date).getFullYear(),label:"HERE",link:"https://legal.here.com/terms"}]},f=new Map([[m,p]]);class g extends o.TileDataSource{constructor(e){var t,i,r,h,u,p,g;super(null!==(t=e.tileFactory)&&void 0!==t?t:new o.TileFactory(s.Tile),Object.assign({styleSetName:null!==(i=e.styleSetName)&&void 0!==i?i:"omv",concurrentDecoderServiceName:l.VECTOR_TILE_DECODER_SERVICE_TYPE,minDataLevel:null!==(r=e.minDataLevel)&&void 0!==r?r:1,maxDataLevel:null!==(h=e.maxDataLevel)&&void 0!==h?h:17,storageLevelOffset:null!==(u=e.storageLevelOffset)&&void 0!==u?u:-1},function(e){var t;if(void 0===e.dataProvider&&void 0===e.url){const i=null!==(t=e.baseUrl)&&void 0!==t?t:m,r=Object.assign(Object.assign({},f.get(i)),e);return Object.assign(Object.assign({},r),{tilingScheme:n.webMercatorTilingScheme,dataProvider:new c.OmvRestClient(r)})}return Object.assign(Object.assign({},e),{tilingScheme:n.webMercatorTilingScheme,dataProvider:d(e)})}(e))),this.m_params=e,this.cacheable=!0,this.addGroundPlane=void 0===e.addGroundPlane||!0===e.addGroundPlane;let v=e.roundUpCoordinatesIfNeeded;void 0===v&&(null===(p=e)||void 0===p?void 0:p.baseUrl)===m&&(v=!0),this.m_decoderOptions={showMissingTechniques:!0===this.m_params.showMissingTechniques,filterDescription:this.m_params.filterDescr,gatherFeatureAttributes:!0===this.m_params.gatherFeatureAttributes,featureModifiers:this.m_params.featureModifierId?[this.m_params.featureModifierId]:void 0,politicalView:this.m_params.politicalView,skipShortLabels:this.m_params.skipShortLabels,storageLevelOffset:null!==(g=e.storageLevelOffset)&&void 0!==g?g:-1,enableElevationOverlay:!0===this.m_params.enableElevationOverlay,roundUpCoordinatesIfNeeded:v},this.maxGeometryHeight=a.getOptionValue(e.maxGeometryHeight,n.EarthConstants.MAX_BUILDING_HEIGHT),this.minGeometryHeight=a.getOptionValue(e.minGeometryHeight,0)}async connect(){try{await super.connect()}catch(e){throw e.message&&r.WorkerServiceProtocol.isUnknownServiceError(e)&&!u&&(h.info("Unable to create decoder service in worker. Use  'OmvTileDecoderService.start();' in decoder script."),u=!0),"string"==typeof e?new Error(e):e}this.configureDecoder(void 0,this.m_decoderOptions)}removeDataFilter(){this.configureDecoder(void 0,{filterDescription:null})}setDataFilter(e){this.m_decoderOptions.filterDescription=null!==e?e:void 0,this.configureDecoder(void 0,{filterDescription:e,featureModifiers:this.m_decoderOptions.featureModifiers,politicalView:this.m_decoderOptions.politicalView})}shouldPreloadTiles(){return!0}setPoliticalView(e){e=null==e?void 0:e.toLowerCase(),this.m_decoderOptions.politicalView!==e&&(this.m_decoderOptions.politicalView=e,this.configureDecoder(void 0,{filterDescription:this.m_decoderOptions.filterDescription,featureModifiers:this.m_decoderOptions.featureModifiers,politicalView:void 0!==e?e:""}))}get storageLevelOffset(){return super.storageLevelOffset}set storageLevelOffset(e){super.storageLevelOffset=e,this.m_decoderOptions.storageLevelOffset=this.storageLevelOffset,this.configureDecoder(void 0,{storageLevelOffset:this.storageLevelOffset})}setEnableElevationOverlay(e){this.m_decoderOptions.enableElevationOverlay!==e&&(this.m_decoderOptions.enableElevationOverlay=e,this.configureDecoder(void 0,{enableElevationOverlay:e}))}configureDecoder(e,t){this.clearCache(),this.decoder.configure(e,t),this.mapView.markTilesDirty(this)}}t.VectorTileDataSource=g},3838:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(7893),t),n(i(3158),t)},3158:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HereWebTileDataSource=t.HereTileProvider=void 0;const r=i(2530),n=i(2183),s=i(7893),o=new r.TextureLoader,a={eu:"baq",ca:"cat",zh:"chi",cs:"cze",da:"dan",nl:"dut",en:"eng",fi:"fin",fr:"fre",de:"ger",ga:"gle",el:"gre",he:"heb",hi:"hin",id:"ind",it:"ita",no:"nor",fa:"per",pl:"pol",pt:"por",ru:"rus",si:"sin",es:"spa",sv:"swe",th:"tha",tr:"tur",uk:"ukr",ur:"urd",vi:"vie",cy:"wel"};class l{constructor(e){var t,i;if(this.m_options=e,this.HERE_COPYRIGHT_INFO={id:"here.com",year:(new Date).getFullYear(),label:"HERE",link:"https://legal.here.com/terms"},this.m_ppi=n.getOptionValue(e.ppi,s.WebTileDataSource.ppiValue.ppi72),this.m_resolution=n.getOptionValue(e.resolution,s.WebTileDataSource.resolutionValue.resolution512),this.m_tileBaseAddress=null!==(t=e.tileBaseAddress)&&void 0!==t?t:l.TILE_BASE_NORMAL,this.m_tileBaseAddress===l.TILE_AERIAL_SATELLITE&&this.m_ppi!==s.WebTileDataSource.ppiValue.ppi72)throw new Error("Requested combination of scheme satellite.day and ppi is not valid");const o=this.parseBaseUrl(this.m_tileBaseAddress),a=o.baseUrl,c=n.getOptionValue(o.mapVersion,"newest"),h=(null!==(i=o.scheme)&&void 0!==i?i:"normal.day").split(".")[0]||"normal",d=`https://1.${a}/maptile/2.1/copyright/${c}${this.getCopyrightRequestParams()}`;this.m_copyrightProvider=new r.UrlCopyrightProvider(d,h)}async getTexture(e,t){const i=e.tileKey.column,r=e.tileKey.row,n=e.tileKey.level,s=e.tileKey.toQuadKey(),a=`https://${parseInt(s[s.length-1],10)+1}.${this.m_tileBaseAddress}/${n}/${i}/${r}/${this.m_resolution}/png8${this.getImageRequestParams()}`;return await this.getRequestHeaders().then((i=>Promise.all([o.load(a,i,t),this.getTileCopyright(e,i,t)])))}mapIsoLanguageToWebTile(e){this.m_languages=[];for(const t of e)void 0!==a[t]&&this.m_languages.push(a[t])}async getRequestHeaders(){const{authenticationCode:e}=this.m_options;let t;if("string"==typeof e?t=e:void 0!==e&&(t=await e()),void 0!==t)return{Authorization:`Bearer ${t}`}}async getTileCopyright(e,t,i){return!1===this.m_options.gatherCopyrightInfo?[this.HERE_COPYRIGHT_INFO]:(this.m_copyrightProvider.setRequestHeaders(t),await this.m_copyrightProvider.getCopyrights(e.geoBox,e.tileKey.level))}parseBaseUrl(e){const t=new URL(e.startsWith("https:")?e:`https://${e}`),i=t.pathname,r=new RegExp("^(/maptile/2.1/)([^/]+)/([^/]+)/([^/]+)"),n=i.match(r);if(!n)throw new Error(`HereWebTileDataSource: invalid baseUrl: ${e}`);return{baseUrl:t.host,path:n[1],tileType:n[2],mapVersion:n[3],scheme:n[4]}}getAuthParams(){const{apikey:e}=this.m_options,{appId:t,appCode:i}=this.m_options,{authenticationCode:r}=this.m_options;if(void 0!==r)return[];if(void 0!==e)return[`apikey=${e}`];if(void 0!==t&&void 0!==i)return[`app_id=${t}`,`app_code=${i}`];throw new Error("Neither apiKey, appId/appCode nor authenticationCode are defined.")}getCopyrightRequestParams(){return`?${["output=json",...this.getAuthParams()].join("&")}`}getImageRequestParams(){const e=this.getAuthParams();return void 0!==this.m_options.additionalRequestParameters&&e.push(this.m_options.additionalRequestParameters),this.m_ppi!==s.WebTileDataSource.ppiValue.ppi72&&e.push(`ppi=${this.m_ppi}`),void 0!==this.m_languages&&void 0!==this.m_languages[0]&&e.push(`lg=${this.m_languages[0]}`),void 0!==this.m_languages&&void 0!==this.m_languages[1]&&e.push(`lg2=${this.m_languages[1]}`),e.length>0?`?${e.join("&")}`:""}}t.HereTileProvider=l,l.TILE_BASE_NORMAL="base.maps.ls.hereapi.com/maptile/2.1/maptile/newest/normal.day",l.TILE_AERIAL_HYBRID="aerial.maps.ls.hereapi.com/maptile/2.1/maptile/newest/hybrid.day",l.TILE_AERIAL_SATELLITE="aerial.maps.ls.hereapi.com/maptile/2.1/maptile/newest/satellite.day",l.TILE_TRAFFIC_NORMAL="traffic.maps.ls.hereapi.com/maptile/2.1/traffictile/newest/normal.day";class c extends s.WebTileDataSource{constructor(e){var t;super(Object.assign(Object.assign({},e),{minDataLevel:1,maxDataLevel:20,resolution:e.resolution,dataProvider:new l(e),storageLevelOffset:null!==(t=e.storageLevelOffset)&&void 0!==t?t:-1})),this.cacheable=!0,this.resolution===s.WebTileDataSource.resolutionValue.resolution512&&(this.maxDataLevel=19)}setLanguages(e){void 0!==e&&(this.dataProvider.mapIsoLanguageToWebTile(e),this.mapView.markTilesDirty(this))}}t.HereWebTileDataSource=c},7893:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTileDataSource=void 0;const r=i(3139),n=i(2530),s=i(2183),o=i(2875);class a extends n.DataSource{constructor(e){var t,i,r,n,o;super(e),this.m_options=e,this.m_opacity=1,this.m_renderOrder=0,this.m_transparent=!1,this.dataProvider=this.m_options.dataProvider,this.cacheable=!0,this.m_opacity=null!==(i=null===(t=this.m_options.renderingOptions)||void 0===t?void 0:t.opacity)&&void 0!==i?i:1,this.m_transparent=!0===(null===(r=this.m_options.renderingOptions)||void 0===r?void 0:r.transparent)||this.m_opacity<1,this.m_renderOrder=null!==(o=null===(n=this.m_options.renderingOptions)||void 0===n?void 0:n.renderOrder)&&void 0!==o?o:0,this.m_resolution=s.getOptionValue(e.resolution,a.resolutionValue.resolution512)}set opacity(e){var t;this.m_opacity=e,this.m_opacity<1?this.m_transparent=!0:!0!==(null===(t=this.m_options.renderingOptions)||void 0===t?void 0:t.transparent)&&(this.m_transparent=!1)}get opacity(){return this.m_opacity}get resolution(){return this.m_resolution}get renderOrder(){return this.m_renderOrder}get transparent(){return this.m_transparent}shouldPreloadTiles(){return!0}getTilingScheme(){return r.webMercatorTilingScheme}getTile(e){const t=new n.Tile(this,e);return t.tileLoader=new o.WebTileLoader(this,t,this.dataProvider),t}isFullyCovering(){return!0}}t.WebTileDataSource=a,function(e){let t,i;!function(e){e[e.ppi72=72]="ppi72",e[e.ppi250=250]="ppi250",e[e.ppi320=320]="ppi320",e[e.ppi500=500]="ppi500"}(t=e.ppiValue||(e.ppiValue={})),function(e){e[e.resolution256=256]="resolution256",e[e.resolution512=512]="resolution512"}(i=e.resolutionValue||(e.resolutionValue={}))}(a=t.WebTileDataSource||(t.WebTileDataSource={}))},2875:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTileLoader=void 0;const r=i(2530),n=i(8944),s=i(284),o=i(4428);class a extends r.BaseTileLoader{constructor(e,t,i){super(e,t.tileKey),this.dataSource=e,this.tile=t,this.dataProvider=i}loadImpl(e,t,i){this.dataProvider.getTexture(this.tile,e).then((e=>{if(void 0===e||void 0===e[0])return this.tile.forceHasGeometry(!0),void t(r.TileLoaderState.Ready);const[i,a]=e;void 0!==a&&(this.tile.copyrightInfo=a),i.minFilter=o.LinearFilter,i.magFilter=o.LinearFilter,i.generateMipmaps=!1,this.tile.addOwnedTexture(i);const l=n.addGroundPlane(this.tile,this.dataSource.renderOrder,void 0,this.dataSource.opacity,!0).material;l.map=i,this.dataSource.transparent&&s.enableBlending(l),this.tile.invalidateResourceInfo(),this.dataSource.requestUpdate(),t(r.TileLoaderState.Ready)}),i).catch(i)}}t.WebTileLoader=a},3421:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapBundleMain=t.BundledUriResolver=t.getScriptUrl=t.getBundleScriptUrl=t.BUNDLE_SCRIPT_BASENAME=t.DEFAULT_DECODER_SCRIPT_URL=void 0;const r=i(2530),n=i(2235),s=i(2183);function o(){if(void 0!==a)return a;const e=document.currentScript,i=null!==e&&"string"==typeof e.src&&(e.src.endsWith(t.BUNDLE_SCRIPT_BASENAME+".js")||e.src.endsWith(t.BUNDLE_SCRIPT_BASENAME+".min.js"))?e.src:l(t.BUNDLE_SCRIPT_BASENAME);return i?(a=i,a):void(a=null)}let a;function l(e){var t,i,r;const n=null!==(r=null!==(i=null!==(t=document.querySelector(`script[src*='/${e}.min.js']`))&&void 0!==t?t:document.querySelector(`script[src='${e}.min.js']`))&&void 0!==i?i:document.querySelector(`script[src*='/${e}.js']`))&&void 0!==r?r:document.querySelector(`script[src='${e}.js']`);return n?n.src:void 0}t.DEFAULT_DECODER_SCRIPT_URL="harp.js-bundle://harp-decoders.js",t.BUNDLE_SCRIPT_BASENAME="harp",t.getBundleScriptUrl=o,t.getScriptUrl=l;const c="harp.js-bundle://";class h{resolveUri(e){if(e.startsWith(c)){const t=o();if(null==t)throw new Error(`harp.js: cannot resolve ${e} because 'harp.gl' base url is not set.`);return(e=e.substring(c.length)).startsWith("/")&&(e=e.substring(1)),s.baseUrl(t)+e}return e}}t.BundledUriResolver=h;const d=new h,u=()=>{const e=o();e||console.error("harp.js: Unable to determine default location of 'harp-decoders(min).js'. See https://github.com/heremaps/harp.gl/@here/harp.gl."),n.WorkerLoader.dependencyUrlMapping.three||console.error("harp.js: Unable to determine location of 'three(.min).js'. `See https://github.com/heremaps/harp.gl/@here/harp.gl.`");const i=e&&e.endsWith(".min.js")?t.DEFAULT_DECODER_SCRIPT_URL.replace(/\.js$/,".min.js"):t.DEFAULT_DECODER_SCRIPT_URL;return d.resolveUri(i)};t.mapBundleMain=function(){o(),function(){r.ConcurrentDecoderFacade.defaultScriptUrl="",r.ConcurrentTilerFacade.defaultScriptUrl="";const e=l("three");n.WorkerLoader.dependencyUrlMapping.three=e;const t=r.ConcurrentDecoderFacade.getWorkerSet;r.ConcurrentDecoderFacade.getWorkerSet=e=>{if(void 0===e&&""===r.ConcurrentDecoderFacade.defaultScriptUrl){const e=u();r.ConcurrentDecoderFacade.defaultScriptUrl=e}return t.apply(r.ConcurrentDecoderFacade,[e])};const i=r.ConcurrentTilerFacade.getWorkerSet;r.ConcurrentTilerFacade.getWorkerSet=e=>{if(void 0===e&&""===r.ConcurrentTilerFacade.defaultScriptUrl){const e=u();r.ConcurrentTilerFacade.defaultScriptUrl=e}return i.apply(r.ConcurrentTilerFacade,[e])}}()}},1206:function(e,t,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0});const s=i(3421);window.THREE||console.warn("harp.js: It looks like 'three.js' is not loaded. This script requires 'THREE' object to be defined. See https://github.com/heremaps/harp.gl/@here/harp.gl."),n(i(2530),t),n(i(4742),t),n(i(4100),t),n(i(1526),t),n(i(8113),t),n(i(2194),t),n(i(3838),t),n(i(4765),t),n(i(5335),t),n(i(3187),t),n(i(3139),t),n(i(2972),t),s.mapBundleMain()},4428:e=>{"use strict";e.exports=THREE}},t={};return function i(r){if(t[r])return t[r].exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,i),n.exports}(1206)})();